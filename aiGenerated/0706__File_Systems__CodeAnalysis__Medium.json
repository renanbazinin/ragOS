{
  "metadata": {
    "source": "ai_generated",
    "subject": "File Systems",
    "topic_hint": "File Systems",
    "requested_type": "CodeAnalysis",
    "requested_difficulty": "Medium",
    "generated_at": "2026-02-07 23:45:23",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 2680,
      "output_tokens": 1940,
      "total_tokens": 9009
    }
  },
  "question": {
    "id": 10,
    "type": "CodeAnalysis",
    "topic": [
      "File Systems",
      "Hard Links",
      "Inodes",
      "System Calls"
    ],
    "content": {
      "text": "נתונה תוכנית ה-C הבאה המבצעת פעולות על מערכת קבצים. יש לנתח את הקוד ולענות על השאלה: מה יהיה הפלט המדויק של התוכנית? הסבירו כל שורה בפלט.",
      "code_snippet": "#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/stat.h> // For stat and struct stat\n#include <fcntl.h>    // For open flags\n#include <string.h>   // For strlen, memset\n\nint main() {\n    const char *file_name = \"data.txt\";\n    const char *link_name = \"data_link.txt\";\n    const char *initial_content = \"OS Exam Question\";\n    int fd;\n    struct stat file_stat;\n\n    // 1. Create a file and write some content\n    fd = open(file_name, O_CREAT | O_WRONLY | O_TRUNC, 0644);\n    if (fd == -1) { perror(\"open file_name\"); return 1; }\n    write(fd, initial_content, strlen(initial_content));\n    close(fd);\n    printf(\"Step 1: File '%s' created and content written.\\n\", file_name);\n\n    // 2. Create a hard link to the file\n    if (link(file_name, link_name) == -1) { perror(\"link\"); return 1; }\n    printf(\"Step 2: Hard link '%s' created for '%s'.\\n\", link_name, file_name);\n\n    // 3. Get and print the link count for the original file\n    if (stat(file_name, &file_stat) == -1) { perror(\"stat file_name\"); return 1; }\n    printf(\"Step 3: Link count for '%s': %ld\\n\", file_name, file_stat.st_nlink);\n\n    // 4. Unlink the original file name\n    if (unlink(file_name) == -1) { perror(\"unlink file_name\"); return 1; }\n    printf(\"Step 4: '%s' unlinked.\\n\", file_name);\n\n    // 5. Try to open the original file name (should fail)\n    fd = open(file_name, O_RDONLY);\n    if (fd == -1) {\n        printf(\"Step 5: Cannot open '%s' (as expected).\\n\", file_name);\n    } else {\n        printf(\"Step 5: Successfully opened '%s' (unexpected).\\n\", file_name);\n        close(fd);\n    }\n\n    // 6. Get and print the link count for the hard link\n    if (stat(link_name, &file_stat) == -1) { perror(\"stat link_name\"); return 1; }\n    printf(\"Step 6: Link count for '%s': %ld\\n\", link_name, file_stat.st_nlink);\n\n    // 7. Read content using the hard link\n    char read_buffer[100];\n    memset(read_buffer, 0, sizeof(read_buffer));\n    fd = open(link_name, O_RDONLY);\n    if (fd == -1) { perror(\"open link_name\"); return 1; }\n    read(fd, read_buffer, sizeof(read_buffer) - 1);\n    close(fd);\n    printf(\"Step 7: Content read from '%s': '%s'\\n\", link_name, read_buffer);\n\n    // Cleanup: Remove the hard link as well\n    unlink(link_name);\n    return 0;\n}"
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "הפתרון מנתח את התוכנית שלב אחר שלב:\n\n*   **Step 1:** הקובץ `data.txt` נוצר ונכתב לתוכו התוכן \"OS Exam Question\". בשלב זה, לקובץ יש רק שם אחד במערכת הקבצים, ולכן מונה הקישורים (link count) שלו הוא 1.\n    *   **פלט:** `Step 1: File 'data.txt' created and content written.`\n\n*   **Step 2:** הפונקציה `link()` יוצרת קישור קשיח (hard link) בשם `data_link.txt` המצביע לאותו inode של `data.txt`. כעת, לשם `data.txt` ולשם `data_link.txt` יש שניהם ערך בטבלת התיקיות שמצביע לאותו בלוק inode דיסק. מונה הקישורים של ה-inode המשותף עולה ל-2.\n    *   **פלט:** `Step 2: Hard link 'data_link.txt' created for 'data.txt'.`\n\n*   **Step 3:** קריאה ל-`stat(file_name, &file_stat)` מאחזרת את המידע על ה-inode של `data.txt` (שהוא אותו inode כמו של `data_link.txt`). המשתנה `file_stat.st_nlink` יכיל את מספר הקישורים הקשיחים לאותו inode, שהוא 2.\n    *   **פלט:** `Step 3: Link count for 'data.txt': 2`\n\n*   **Step 4:** הפונקציה `unlink(file_name)` מסירה את הערך של `data.txt` מטבלת התיקיות ומקטינה את מונה הקישורים של ה-inode באחד. הקובץ עצמו (הנתונים בבלוקי הדיסק) עדיין קיים מכיוון שמונה הקישורים לא הגיע ל-0 (הוא כעת 1, בגלל `data_link.txt`).\n    *   **פלט:** `Step 4: 'data.txt' unlinked.`\n\n*   **Step 5:** ניסיון לפתוח את `data.txt` נכשל מכיוון ששם הקובץ `data.txt` כבר לא קיים במערכת הקבצים. למרות שהנתונים עדיין קיימים על הדיסק, אין דרך לגשת אליהם ישירות דרך השם `data.txt`.\n    *   **פלט:** `Step 5: Cannot open 'data.txt' (as expected).`\n\n*   **Step 6:** קריאה ל-`stat(link_name, &file_stat)` מאחזרת את המידע על ה-inode, אשר מונה הקישורים שלו כעת הוא 1 (הוא ירד מ-2 ל-1 לאחר ה-`unlink` של `data.txt`).\n    *   **פלט:** `Step 6: Link count for 'data_link.txt': 1`\n\n*   **Step 7:** פתיחה וקריאה מתוך `data_link.txt` מצליחה מכיוון שהקישור הקשיח עדיין קיים ומצביע ל-inode עם הנתונים. התוכן המקורי \"OS Exam Question\" יקרא ויוצג.\n    *   **פלט:** `Step 7: Content read from 'data_link.txt': 'OS Exam Question'`\n\n*   **Cleanup:** ה-`unlink(link_name)` האחרון יסיר את הקישור האחרון ל-inode, ובכך יקטין את מונה הקישורים ל-0. רק אז, הנתונים הפיזיים על הדיסק ישוחררו ויהפכו לזמינים לשימוש חוזר."
    },
    "difficulty_estimation": "Medium"
  }
}