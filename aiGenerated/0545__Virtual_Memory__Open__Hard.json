{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Virtual Memory",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:34:28",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 4142,
      "total_tokens": 15478
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Virtual Memory",
      "Paging",
      "Multi-level Page Tables",
      "TLB",
      "Page Faults",
      "Memory Management",
      "Superpages"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם מנגנון דפדוף (paging). המערכת מוגדרת באופן הבא:\n*   כתובות וירטואליות הן בגודל 64 ביטים.\n*   כתובות פיזיות הן בגודל 48 ביטים.\n*   גודל דף הוא 4KB (קילובייט).\n*   כל כניסה בטבלת הדפים (PTE) היא בגודל 8 בתים (64 ביטים).\n*   כל טבלת דפים (ברמה כלשהי) מאוחסנת בדף פיזי אחד בדיוק.\n*   למערכת יש TLB המכיל 128 כניסות (entries) והוא fully associative.\n\nענה על השאלות הבאות, פרט ונמק את חישוביך:",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "חישוב מבנה טבלת הדפים:\nא. כמה רמות של טבלאות דפים נדרשות במערכת זו? פרט את חלוקת הביטים של הכתובת הוירטואלית (Virtual Page Number - VPN) עבור כל רמה.\nב. מהו הגודל המקסימלי של היררכיית טבלאות דפים (בבתים וביחידות של דפים) עבור תהליך המשתמש במלוא מרחב הכתובות הוירטואלי (כלומר, כל הכתובות הוירטואליות ממופות)?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "תרגום כתובת וירטואלית וגישות לזיכרון:\nתאר, צעד אחר צעד, את רצף הפעולות (בדיקת TLB, גישות לזיכרון הראשי עבור טבלאות דפים, גישות לדיסק) המתרחשות כאשר תהליך ניגש לכתובת וירטואלית מסוימת, במקרה הגרוע ביותר (TLB Miss, ולאחר מכן Page Fault הדורש החלפה של דף מלוכלך (dirty page) מהזיכרון הראשי לדיסק וטעינה של דף חדש מהדיסק). כמה גישות לזיכרון הראשי (RAM) וכמה גישות לדיסק יתבצעו במקרה זה, לפני שהגישה לנתון עצמו תושלם? (פרט את החישוב).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "השפעת TLB גדול יותר:\nהצע שינוי אפשרי במבנה או באופן הפעולה של ה-TLB (או במנגנון הזיכרון הוירטואלי בכללותו) שישפר משמעותית את ביצועי המערכת עבור תוכניות המשתמשות במרחבי כתובות גדולים מאוד, אך בעלות לוקליות חזקה (spatial locality) בתוך בלוקים גדולים של זיכרון (לדוגמה, גישה לבלוקים של 2MB או 1GB ברצף). נמק את הצעתך והסבר כיצד היא פותרת את הבעיה.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון לשאלה:\n\n**סעיף 1.1: חישוב מבנה טבלת הדפים**\n\nא. **מספר רמות וחלוקת ביטים של הכתובת הוירטואלית (VPN):**\n*   גודל דף = 4KB = 2^12 בתים. לכן, ההיסט (Offset) הוא 12 ביטים.\n*   כתובת וירטואלית היא 64 ביטים. מספר הדף הוירטואלי (VPN) הוא 64 - 12 = 52 ביטים.\n*   גודל כניסה בטבלת הדפים (PTE) = 8 בתים = 64 ביטים.\n*   כל טבלת דפים מאוחסנת בדף פיזי אחד (4KB). לכן, מספר הכניסות בכל טבלת דפים הוא 4KB / 8 בתים = 4096 / 8 = 512 כניסות.\n*   מספר הביטים הנדרשים למיפוי אינדקס בתוך כל טבלת דפים הוא log2(512) = 9 ביטים.\n*   כדי למפות 52 ביטים של VPN באמצעות אינדקסים בני 9 ביטים, נחלק: 52 / 9 = 5 עם שארית 7. כלומר, נדרשות 6 רמות של טבלאות דפים.\n*   **חלוקת הביטים:**\n    *   רמה 5 (PML5): 7 ביטים (הביטים הגבוהים ביותר של ה-VPN)\n    *   רמה 4 (PML4): 9 ביטים\n    *   רמה 3 (PML3): 9 ביטים\n    *   רמה 2 (PML2): 9 ביטים\n    *   רמה 1 (PML1): 9 ביטים\n    *   רמה 0 (Page Table - PT): 9 ביטים (הביטים הנמוכים ביותר של ה-VPN לפני ההיסט)\n    *   סה\"כ ביטים ל-VPN: 7 + 9 + 9 + 9 + 9 + 9 = 52 ביטים.\n\nב. **הגודל המקסימלי של היררכיית טבלאות דפים:**\nעבור תהליך המשתמש במלוא מרחב הכתובות הוירטואלי (כלומר, כל 2^52 הדפים הוירטואליים ממופים), היררכיית טבלאות הדפים תהיה מלאה.\n*   מספר הדפים בכל רמה (אם היא מלאה): \n    *   PML5 (רמת הבסיס): 1 דף (הטבלה הראשית)\n    *   PML4: 2^7 דפים (כל כניסה ב-PML5 מצביעה על טבלת PML4)\n    *   PML3: 2^7 * 2^9 = 2^16 דפים\n    *   PML2: 2^16 * 2^9 = 2^25 דפים\n    *   PML1: 2^25 * 2^9 = 2^34 דפים\n    *   PT (רמת הדפים הסופית): 2^34 * 2^9 = 2^43 דפים\n*   **סה\"כ דפים עבור היררכיית טבלאות דפים:** סכום כל הדפים הנ\"ל:\n    1 + 2^7 + 2^16 + 2^25 + 2^34 + 2^43 דפים.\n    סכום זה נשלט על ידי המספר הגדול ביותר: 2^43 דפים.\n*   **גודל בבתים:** 2^43 דפים * 4KB/דף = 2^43 * 2^12 בתים = 2^55 בתים.\n    2^55 בתים = 32 פטה-בתים (PB). (כלומר, 32,768 טרה-בתים).\n\n**סעיף 1.2: תרגום כתובת וירטואלית וגישות לזיכרון במקרה הגרוע ביותר**\n\nהמקרה הגרוע ביותר כולל TLB Miss, Page Fault, וצורך בהחלפת דף מלוכלך מהזיכרון הראשי לדיסק לפני טעינת הדף המבוקש.\n\n**רצף הפעולות:**\n1.  **בדיקת TLB**: המעבד מנסה למצוא את ה-PTE המתאים ב-TLB. מתרחש **TLB Miss**. (0 גישות ל-RAM/דיסק בשלב זה).\n2.  **מעבר על טבלאות הדפים (Page Table Walk)**: ה-MMU נדרש לגשת לזיכרון הראשי כדי לאתר את ה-PTE המתאים.\n    *   גישה לטבלת PML5 (ב-RAM) כדי למצוא את ה-PTE עבור רמה 5. (1 גישה ל-RAM)\n    *   גישה לטבלת PML4 (ב-RAM) כדי למצוא את ה-PTE עבור רמה 4. (1 גישה ל-RAM)\n    *   גישה לטבלת PML3 (ב-RAM) כדי למצוא את ה-PTE עבור רמה 3. (1 גישה ל-RAM)\n    *   גישה לטבלת PML2 (ב-RAM) כדי למצוא את ה-PTE עבור רמה 2. (1 גישה ל-RAM)\n    *   גישה לטבלת PML1 (ב-RAM) כדי למצוא את ה-PTE עבור רמה 1. (1 גישה ל-RAM)\n    *   גישה לטבלת PT (ב-RAM) כדי למצוא את ה-PTE עבור הדף המבוקש. (1 גישה ל-RAM)\n    *   **סה\"כ 6 גישות ל-RAM עבור ה-Page Table Walk.**\n3.  **זיהוי Page Fault**: ה-PTE שנמצא ברמת PT (רמה 0) מציין שהדף אינו נוכח בזיכרון הראשי (Present bit = 0). מתרחשת **Page Fault**. מערכת ההפעלה מקבלת שליטה.\n4.  **טיפול ב-Page Fault (מקרה גרוע – החלפת דף מלוכלך):**\n    *   מערכת ההפעלה בוחרת דף (נניח דף 'קורבן') לפי אלגוריתם החלפה. במקרה הגרוע, דף זה הוא 'מלוכלך' (Dirty bit = 1), ולכן יש לכתוב את תוכנו בחזרה לדיסק.\n        *   קריאת תוכן דף ה'קורבן' מ-RAM. (1 גישה ל-RAM)\n        *   כתיבת תוכן דף ה'קורבן' לדיסק. (1 גישה לדיסק)\n        *   עדכון ה-PTE של דף ה'קורבן' בטבלת הדפים שלו (ב-RAM) כדי לסמן אותו כלא נוכח ולעדכן את מיקומו בדיסק. (1 גישה ל-RAM)\n    *   מערכת ההפעלה מקצה מסגרת פיזית (Frame) פנויה (או זו שפונתה כרגע) לדף המבוקש.\n    *   קריאת תוכן הדף המבוקש מהדיסק לתוך המסגרת שהוקצתה ב-RAM. (1 גישה לדיסק, 1 גישה ל-RAM עבור כתיבת התוכן).\n    *   עדכון ה-PTE של הדף המבוקש בטבלת הדפים שלו (ב-RAM) כדי לסמן אותו כנוכח ולעדכן את מספר המסגרת הפיזית שלו. (1 גישה ל-RAM).\n5.  **עדכון TLB**: ה-PTE החדש של הדף המבוקש מתווסף ל-TLB. (פעולה פנימית של החומרה, 0 גישות ל-RAM/דיסק).\n6.  **חזרה על הפקודה**: המעבד מחדש את הפקודה שגרמה ל-Page Fault. כעת, הגישה לכתובת הוירטואלית תצליח.\n    *   ה-TLB ימצא את ה-PTE (TLB Hit). (0 גישות ל-RAM/דיסק).\n    *   גישה לנתון עצמו ב-RAM. (1 גישה ל-RAM).\n\n**סיכום גישות:**\n*   **סה\"כ גישות לזיכרון הראשי (RAM):**\n    6 (Page Table Walk) + 1 (קריאת דף קורבן) + 1 (עדכון PTE דף קורבן) + 1 (כתיבת דף חדש) + 1 (עדכון PTE דף חדש) + 1 (גישה לנתון) = **11 גישות ל-RAM**.\n*   **סה\"כ גישות לדיסק:**\n    1 (כתיבת דף קורבן) + 1 (קריאת דף חדש) = **2 גישות לדיסק**.\n\n**סעיף 1.3: הצעת שינוי לשיפור ביצועים עם Superpages (Huge Pages)**\n\n**הצעה:** יש להוסיף תמיכה ב\"דפי ענק\" (Superpages או Huge Pages) למערכת הזיכרון הוירטואלי.\n\n**הסבר ונימוק:**\nתוכניות המשתמשות במרחבי כתובות גדולים מאוד ובעלות לוקליות חזקה בתוך בלוקים גדולים (לדוגמה, מערכים גדולים של נתונים, או קוד שרץ ברצף) יסבלו משיעור גבוה של TLB Misses אם גודל הדף הסטנדרטי הוא קטן (כמו 4KB). כל דף של 4KB בתוך בלוק של 2MB או 1GB דורש כניסת TLB נפרדת. המשמעות היא שגם אם יש לוקליות מצוינת, ה-TLB עלול להתמלא במהירות ולגרום ל-TLB Misses רבים.\n\n**כיצד Superpages פותרים את הבעיה:**\n*   **הגדרת Superpages:** המערכת תאפשר מיפוי של אזורים רציפים בזיכרון הוירטואלי לאזורים רציפים בזיכרון הפיזי באמצעות דפים גדולים יותר, לדוגמה 2MB או 1GB. במקום 512 כניסות TLB עבור 2MB של זיכרון (512 * 4KB = 2MB), כניסה אחת בלבד ב-TLB תספיק למיפוי כל ה-2MB.\n*   **שינויים במנגנון הזיכרון הוירטואלי:**\n    *   **טבלאות דפים:** ה-PTE ברמות גבוהות יותר של טבלת הדפים (לדוגמה, PML3 או PML2) יכול להכיל ביט מיוחד (לדוגמה, 'Page Size Extension' או 'Huge Page bit') שיציין שה-PTE הזה אינו מצביע על טבלת דפים ברמה נמוכה יותר, אלא ישירות על מסגרת פיזית גדולה (Large Physical Frame). במקרה זה, ביטי ה-VPN הנותרים (אלו שהיו משמשים לאינדוקס ברמות הנמוכות יותר) הופכים להיות חלק מההיסט של הדף הגדול.\n    *   **TLB:** ה-TLB צריך להיות מסוגל לאחסן כניסות בגדלים שונים. במערכות מודרניות, זה נפוץ שיש ל-TLB תמיכה בדפים בגדלים שונים. כאשר מתרחש TLB Hit עבור Superpage, הכתובת הפיזית מתקבלת ישירות, ללא צורך במעבר על טבלאות דפים נוספות.\n\n**היתרונות:**\n*   **הפחתה דרמטית ב-TLB Misses:** כניסת TLB אחת יכולה לכסות נפח זיכרון גדול בהרבה, מה שמגדיל את שיעור ה-TLB Hit ומשפר את ביצועי המערכת.\n*   **הפחתה ב-Page Table Walks:** מכיוון ש-PTE ברמה גבוהה יותר יכול למפות דף ענק, ייתכן שלא יהיה צורך לגשת לרמות נמוכות יותר של טבלאות הדפים, מה שמפחית את מספר הגישות ל-RAM.\n*   **חיסכון בזיכרון טבלאות דפים:** עבור אזורים גדולים הממופים כדפי ענק, אין צורך בטבלאות דפים ברמות הנמוכות, מה שיכול לחסוך בזיכרון המשמש לאחסון טבלאות דפים.\n\nפתרון זה מנצל את הלוקליות המרחבית החזקה בבלוקים גדולים על ידי הקטנת מספר המיפויים הנדרשים ב-TLB ובטבלאות הדפים, ובכך משפר משמעותית את זמן הגישה לזיכרון."
    },
    "difficulty_estimation": "Hard"
  }
}