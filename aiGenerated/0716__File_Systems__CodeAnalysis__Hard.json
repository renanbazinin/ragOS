{
  "metadata": {
    "source": "ai_generated",
    "subject": "File Systems",
    "topic_hint": "File Systems",
    "requested_type": "CodeAnalysis",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 23:50:47",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3062,
      "output_tokens": 2634,
      "total_tokens": 12496
    }
  },
  "question": {
    "id": 10,
    "type": "CodeAnalysis",
    "topic": [
      "File Systems",
      "System Calls",
      "Processes",
      "Links"
    ],
    "content": {
      "text": "נתונה התוכנית הבאה, המדגימה פעולות על מערכת קבצים בסביבת יוניקס. יש להניח שכל קריאות המערכת מצליחות, ואין שגיאות I/O למעט אלו שעשויות להיות צפויות מלוגיקת התוכנית עצמה.\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <sys/wait.h>\n#include <errno.h>\n\nint main() {\n    const char *original_file = \"data.txt\";\n    const char *hard_link = \"hlink.txt\";\n    const char *sym_link = \"slink.txt\";\n    char buffer[50];\n    int fd;\n\n    // 1. יצירת קובץ מקורי וכתיבת תוכן אליו\n    fd = open(original_file, O_CREAT | O_WRONLY | O_TRUNC, 0644);\n    write(fd, \"Hello World\", strlen(\"Hello World\"));\n    close(fd);\n\n    // 2. יצירת קישור קשיח (hard link) לקובץ המקורי\n    link(original_file, hard_link);\n\n    // 3. יצירת קישור סימלי (symbolic link) לקובץ המקורי\n    symlink(original_file, sym_link);\n\n    pid_t pid = fork();\n    if (pid == -1) { perror(\"fork\"); return 1; }\n\n    if (pid == 0) { // תהליך הבן\n        // 4. הבן מוחק את הקובץ המקורי (מבטל את הקישור בספרייה)\n        unlink(original_file);\n\n        // 5. הבן מנסה לפתוח/ליצור מחדש את הקובץ המקורי עם דגל O_CREAT | O_EXCL\n        fd = open(original_file, O_CREAT | O_EXCL | O_WRONLY, 0600);\n        if (fd != -1) { // בהנחה שהפעולה מצליחה\n            write(fd, \"Child's new data\", strlen(\"Child's new data\"));\n            close(fd);\n        }\n        exit(0);\n    } else { // תהליך האב\n        wait(NULL); // ממתין שהבן יסיים\n\n        // 6. האב קורא מתוך הקישור הקשיח\n        fd = open(hard_link, O_RDONLY);\n        if (fd != -1) {\n            memset(buffer, 0, sizeof(buffer));\n            ssize_t bytes_read = read(fd, buffer, sizeof(buffer) - 1);\n            if (bytes_read > 0) buffer[bytes_read] = '\\0';\n            printf(\"Content of '%s': '%s'\\n\", hard_link, buffer);\n            close(fd);\n        }\n\n        // 7. האב קורא מתוך הקישור הסימלי\n        fd = open(sym_link, O_RDONLY);\n        if (fd != -1) {\n            memset(buffer, 0, sizeof(buffer));\n            ssize_t bytes_read = read(fd, buffer, sizeof(buffer) - 1);\n            if (bytes_read > 0) buffer[bytes_read] = '\\0';\n            printf(\"Content of '%s': '%s'\\n\", sym_link, buffer);\n            close(fd);\n        }\n        \n        // 8. האב קורא מתוך הקובץ המקורי (שייתכן שהבן יצר מחדש)\n        fd = open(original_file, O_RDONLY);\n        if (fd != -1) {\n            memset(buffer, 0, sizeof(buffer));\n            ssize_t bytes_read = read(fd, buffer, sizeof(buffer) - 1);\n            if (bytes_read > 0) buffer[bytes_read] = '\\0';\n            printf(\"Content of '%s': '%s'\\n\", original_file, buffer);\n            close(fd);\n        }\n\n        // ניקוי קבצים (לא חלק מהפלט המבוקש)\n        unlink(hard_link);\n        unlink(sym_link);\n        unlink(original_file);\n    }\n    return 0;\n}\n```\n\nהסבירו מה יהיה הפלט המודפס למסך על ידי תהליך האב (Parent) עבור שלבי הקריאה (6, 7 ו-8). פרטו את ההסבר לכל שלב, כולל שינויים במבנה מערכת הקבצים (כגון מונים של קישורים (link count) ואינודים (inodes)) כתוצאה מפעולות התוכנית.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "כדי להבין את הפלט, נתח את שינויי מערכת הקבצים לאורך ריצת התוכנית:\n\n**מצב התחלתי (לפני ה-fork):**\n1.  **`open(original_file, O_CREAT | O_WRONLY | O_TRUNC, 0644)` ו-`write(\"Hello World\")`:**\n    *   נוצר קובץ בשם `data.txt`. מערכת הקבצים מקצה לו אינוד חדש (נניח **אינוד X**). תוכן הקובץ הוא \"Hello World\". מונה הקישורים (link count) של אינוד X הוא 1.\n2.  **`link(original_file, hard_link)`:**\n    *   נוצר קישור קשיח בשם `hlink.txt` המצביע גם הוא לאינוד X. מונה הקישורים של אינוד X עולה ל-2.\n3.  **`symlink(original_file, sym_link)`:**\n    *   נוצר קישור סימלי בשם `slink.txt`. זהו קובץ חדש בפני עצמו, המקבל אינוד משלו (נניח **אינוד Y**). תוכן אינוד Y הוא המחרוזת \"data.txt\". מונה הקישורים של אינוד Y הוא 1. אינוד X נשאר עם מונה קישורים של 2.\n\n**לאחר ה-fork (בתהליך הבן):**\n4.  **תהליך הבן: `unlink(original_file)`:**\n    *   הכניסה `data.txt` נמחקת מהספרייה. מונה הקישורים של אינוד X יורד ל-1 (בגלל ש-`hlink.txt` עדיין מצביע עליו). נתוני הקובץ באינוד X **אינם נמחקים** מהדיסק כל עוד מונה הקישורים גדול מ-0 (או שיש קבצים פתוחים המצביעים על האינוד).\n5.  **תהליך הבן: `open(original_file, O_CREAT | O_EXCL | O_WRONLY, 0600)` ו-`write(\"Child's new data\")`:**\n    *   מכיוון ש-`data.txt` נמחק בשלב הקודם (כלומר, אין כניסה כזו בספרייה), קריאת `open` עם `O_CREAT | O_EXCL` **מצליחה** ליצור קובץ *חדש* בשם `data.txt`. קובץ זה יקבל אינוד חדש משלו (נניח **אינוד Z**). תוכן הקובץ החדש הוא \"Child's new data\". מונה הקישורים של אינוד Z הוא 1.\n    *   **חשוב**: אינוד X (המכיל \"Hello World\") עדיין קיים ומצביע עליו `hlink.txt`. אינוד Y (הקישור הסימלי) עדיין מצביע על השם `data.txt`.\n\n**לאחר שהבן מסיים (בתהליך האב):**\nתהליך האב ממתין לבן באמצעות `wait(NULL)`.\n\n6.  **תהליך האב: `open(hard_link, O_RDONLY)` ו-`printf(\"Content of '%s': '%s'\\n\", hard_link, buffer)`:**\n    *   האב פותח את `hlink.txt`. קישור קשיח מצביע ישירות על האינוד המקורי. `hlink.txt` עדיין מצביע על **אינוד X**, שהכיל את הנתונים המקוריים \"Hello World\".\n    *   **פלט:** `Content of 'hlink.txt': 'Hello World'`\n\n7.  **תהליך האב: `open(sym_link, O_RDONLY)` ו-`printf(\"Content of '%s': '%s'\\n\", sym_link, buffer)`:**\n    *   האב פותח את `slink.txt`. קישור סימלי מכיל שם של קובץ (במקרה זה, \"data.txt\"). מערכת ההפעלה פותרת (resolves) את הנתיב `data.txt`. מכיוון שהבן יצר קובץ *חדש* בשם `data.txt` (המצביע על אינוד Z), הקישור הסימלי יצביע כעת לקובץ החדש הזה.\n    *   **פלט:** `Content of 'slink.txt': 'Child's new data'`\n\n8.  **תהליך האב: `open(original_file, O_RDONLY)` ו-`printf(\"Content of '%s': '%s'\\n\", original_file, buffer)`:**\n    *   האב פותח את `data.txt`. מכיוון שהבן יצר קובץ *חדש* בשם `data.txt` (המצביע על אינוד Z), האב יפתח את הקובץ החדש הזה.\n    *   **פלט:** `Content of 'data.txt': 'Child's new data'`\n\n**סיכום הפלט המודפס על ידי תהליך האב:**\n```\nContent of 'hlink.txt': 'Hello World'\nContent of 'slink.txt': 'Child's new data'\nContent of 'data.txt': 'Child's new data'\n```"
    },
    "difficulty_estimation": "Hard"
  }
}