{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 21:26:11",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 5682,
      "total_tokens": 23494
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory",
      "Page Replacement"
    ],
    "content": {
      "text": "מערכת הפעלה מודרנית משתמשת בזיכרון וירטואלי, דפדוף רב-שכבתי (multi-level paging) ו-TLB (Translation Lookaside Buffer) על מנת לנהל את הזיכרון. נתוני המערכת הם כדלקמן:\n- מרחב כתובות וירטואלי: 32 ביטים.\n- גודל דף: 4KB.\n- גודל זיכרון פיזי: 2GB.\n- גודל כניסה בטבלת דפים (PTE): 4 בתים.\n- ה-TLB מכיל 4 כניסות, הוא אסוציאטיבי מלא (fully associative) ומשתמש במדיניות החלפה LRU.\n- זמני הגישה הם:\n  - פגיעת TLB (TLB Hit): 10 ננו-שניות.\n  - גישה לזיכרון ראשי (RAM): 100 ננו-שניות.\n  - קריאה או כתיבה של דף לדיסק (Disk I/O): 10 מילי-שניות.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "חשב את מספר הרמות הנדרשות בטבלת הדפים ואת הגודל המקסימלי בבתים של טבלת דפים שלמה עבור תהליך בודד (בהנחה שכל המרחב הווירטואלי ממופה).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "תיאור מצב התחלתי עבור גישות לזיכרון:\nתהליך מסוים משתמש ב-4 מסגרות פיזיות בלבד (0x50, 0x51, 0x52, 0x53). מצב טבלת הדפים והמסגרות הפיזיות בתחילת הריצה הוא כדלקמן:\n- מסגרת 0x50 מכילה את דף וירטואלי 0x100 (דף מלוכלך - Dirty).\n- מסגרת 0x51 מכילה את דף וירטואלי 0x101 (דף נקי - Clean).\n- מסגרת 0x52 מכילה את דף וירטואלי 0x201 (דף נקי - Clean).\n- מסגרת 0x53 פנויה.\n- דף וירטואלי 0x200 ודף וירטואלי 0x300 אינם נמצאים בזיכרון הפיזי (P=0 ב-PTE שלהם).\nה-TLB ריק לחלוטין בתחילת הריצה. כמו כן, נניח שמצב ה-LRU ההתחלתי של המסגרות הפיזיות המאוכלסות הוא: 0x201 (ב-PFN 0x52) הוא ה-LRU ביותר, ואחריו 0x101 (ב-PFN 0x51), ואז 0x100 (ב-PFN 0x50) הוא ה-MRU ביותר.\n\nנתונה סדרת הגישות הבאה לכתובות וירטואליות (כל הגישות הן קריאה, אלא אם צוין אחרת, והן מתייחסות לתחילת הדף): \n1. גישה לדף 0x100 (קריאה)\n2. גישה לדף 0x200 (קריאה)\n3. גישה לדף 0x101 (קריאה)\n4. גישה לדף 0x300 (כתיבה)\n5. גישה לדף 0x201 (קריאה)\n6. גישה לדף 0x100 (קריאה)\n\nנתח את סדרת הגישות. עבור כל גישה, פרט:\nא. האם התרחשה פגיעת TLB (Hit) או החטאה (Miss)? אם החטאה, האם הדף נמצא בטבלת הדפים? אם כן, האם הוא תקף (Valid)?\nב. אילו אירועים התרחשו (לדוגמה: TLB Miss, Page Table Walk, Page Fault, Disk Write, Disk Read)?\nג. מהו מספר המסגרת הפיזית (PFN) הסופי אליו ממופה הדף?\nד. מהו מצב ה-TLB לאחר הגישה (עדכן את ה-LRU)?\nה. מהי העלות הכוללת של הגישה בננו-שניות?\n\nלאחר מכן, חשב את העלות הכוללת של כל סדרת הגישות בננו-שניות.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון שאלה 1:\n\n**סעיף 1.1: חישוב מספר רמות וגודל טבלת דפים**\n*   **מרחב כתובות וירטואלי:** 32 ביטים.\n*   **גודל דף:** 4KB = 2^12 בתים. לכן, ההיסט (offset) הוא 12 ביטים.\n*   **מספר ביטים עבור מספר הדף הווירטואלי (VPN):** 32 - 12 = 20 ביטים.\n*   **גודל כניסה בטבלת דפים (PTE):** 4 בתים.\n*   **מספר כניסות לטבלה שיכולות להיכנס לדף אחד:** גודל דף / גודל PTE = 4KB / 4 בתים = 1024 כניסות = 2^10 כניסות.\n*   **מספר ביטים של VPN שממופה על ידי רמה אחת:** log2(1024) = 10 ביטים.\n*   **מספר הרמות הנדרשות בטבלת הדפים:** 20 ביטים (VPN) / 10 ביטים לרמה = 2 רמות.\n\n*   **גודל טבלת דפים מלאה:**\n    *   טבלת הרמה הראשונה (L1) תכיל 2^10 כניסות (מכיוון שהיא ממפה 10 ביטים מה-VPN). גודלה יהיה 2^10 כניסות * 4 בתים/כניסה = 4KB.\n    *   טבלת הרמה הראשונה מפנה ל-2^10 טבלאות רמה שנייה (L2).\n    *   כל טבלת L2 מכילה 2^10 כניסות (וממפה את 10 הביטים הנותרים של ה-VPN). גודלה יהיה 2^10 כניסות * 4 בתים/כניסה = 4KB.\n    *   הגודל הכולל של כל טבלאות L2 יהיה 2^10 טבלאות * 4KB/טבלה = 4MB.\n    *   **הגודל המקסימלי של טבלת דפים שלמה:** 4KB (L1) + 4MB (כל ה-L2) = 4MB + 4KB.\n\n**סעיף 1.2: ניתוח סדרת הגישות וחישוב עלות כוללת**\n\n**נתונים התחלתיים:**\n*   **TLB:** ריק [ ]\n*   **מסגרות פיזיות (PFNs) בשימוש התהליך (4 מסגרות):**\n    *   PFN 0x50: מכיל VPN 0x100 (D=1)\n    *   PFN 0x51: מכיל VPN 0x101 (D=0)\n    *   PFN 0x52: מכיל VPN 0x201 (D=0)\n    *   PFN 0x53: פנוי\n*   **מצב טבלת דפים (PTEs) רלוונטיים:**\n    *   VPN 0x100: PFN 0x50, P=1, D=1\n    *   VPN 0x101: PFN 0x51, P=1, D=0\n    *   VPN 0x200: PFN (לא תקף), P=0, D=0\n    *   VPN 0x201: PFN 0x52, P=1, D=0\n    *   VPN 0x300: PFN (לא תקף), P=0, D=0\n*   **סדר LRU התחלתי של מסגרות פיזיות:** 0x201 (PFN 0x52) -> 0x101 (PFN 0x51) -> 0x100 (PFN 0x50) (0x201 הוא ה-LRU ביותר).\n\n**עלויות:**\n*   TLB Hit: 10 ns\n*   RAM Access: 100 ns\n*   Disk I/O: 10,000,000 ns (10 ms)\n\n**ניתוח גישות:**\n\n**גישה 1: VPN 0x100 (קריאה)**\n*   א. **TLB:** Miss (ריק). **טבלת דפים:** Page 0x100 נמצא בטבלת הדפים (P=1).\n*   ב. **אירועים:** TLB Miss, Page Table Walk (2 גישות ל-RAM עבור PTEs), גישת נתונים (1 גישה ל-RAM).\n*   ג. **PFN סופי:** 0x50.\n*   ד. **TLB לאחר גישה:** [(VPN: 0x100, PFN: 0x50, D:1, LRU:1)]\n*   ה. **עלות גישה:** (2 * 100 ns) [PTW] + 100 ns [Data Read] = 300 ns.\n*   **מצב LRU מסגרות:** 0x201 -> 0x101 -> 0x100 (MRU).\n*   **סה\"כ עלות מצטברת:** 300 ns.\n\n**גישה 2: VPN 0x200 (קריאה)**\n*   א. **TLB:** Miss. **טבלת דפים:** Page 0x200 לא נמצא בזיכרון הפיזי (P=0).\n*   ב. **אירועים:** TLB Miss, Page Table Walk (2 גישות ל-RAM), Page Fault.\n    *   **טיפול ב-Page Fault:**\n        1.  **מציאת מסגרת קורבן:** PFN 0x53 פנוי. נבחר בו.\n        2.  **טעינת דף:** קריאת דף 0x200 מהדיסק אל PFN 0x53 (Disk Read).\n        3.  **עדכון PTE:** עדכון ה-PTE עבור 0x200: PFN 0x53, P=1, D=0 (1 גישה ל-RAM).\n        4.  **גישת נתונים:** קריאת הנתונים מ-PFN 0x53 (1 גישה ל-RAM).\n*   ג. **PFN סופי:** 0x53.\n*   ד. **TLB לאחר גישה:** [(VPN: 0x100, PFN: 0x50, D:1, LRU:2), (VPN: 0x200, PFN: 0x53, D:0, LRU:1)]\n*   ה. **עלות גישה:** (2 * 100 ns) [PTW] + 10,000,000 ns [Disk Read] + 100 ns [PTE update] + 100 ns [Data Read] = 10,000,400 ns.\n*   **מצב LRU מסגרות:** 0x201 -> 0x101 -> 0x100 -> 0x200 (MRU).\n*   **סה\"כ עלות מצטברת:** 300 ns + 10,000,400 ns = 10,000,700 ns.\n\n**גישה 3: VPN 0x101 (קריאה)**\n*   א. **TLB:** Miss. **טבלת דפים:** Page 0x101 נמצא בטבלת הדפים (P=1).\n*   ב. **אירועים:** TLB Miss, Page Table Walk (2 גישות ל-RAM), גישת נתונים (1 גישה ל-RAM).\n*   ג. **PFN סופי:** 0x51.\n*   ד. **TLB לאחר גישה:** [(VPN: 0x200, PFN: 0x53, D:0, LRU:2), (VPN: 0x100, PFN: 0x50, D:1, LRU:3), (VPN: 0x101, PFN: 0x51, D:0, LRU:1)]\n*   ה. **עלות גישה:** (2 * 100 ns) [PTW] + 100 ns [Data Read] = 300 ns.\n*   **מצב LRU מסגרות:** 0x201 -> 0x100 -> 0x200 -> 0x101 (MRU).\n*   **סה\"כ עלות מצטברת:** 10,000,700 ns + 300 ns = 10,001,000 ns.\n\n**גישה 4: VPN 0x300 (כתיבה)**\n*   א. **TLB:** Miss. **טבלת דפים:** Page 0x300 לא נמצא בזיכרון הפיזי (P=0).\n*   ב. **אירועים:** TLB Miss, Page Table Walk (2 גישות ל-RAM), Page Fault.\n    *   **טיפול ב-Page Fault:**\n        1.  **מציאת מסגרת קורבן:** כל 4 המסגרות תפוסות. מסגרת ה-LRU היא PFN 0x52 (מכילה VPN 0x201). הדף 0x201 נקי (D=0).\n        2.  **פינוי דף:** אין צורך בכתיבה לדיסק עבור 0x201. עדכון PTE עבור 0x201: P=0 (1 גישה ל-RAM).\n        3.  **טעינת דף:** קריאת דף 0x300 מהדיסק אל PFN 0x52 (Disk Read).\n        4.  **עדכון PTE:** עדכון ה-PTE עבור 0x300: PFN 0x52, P=1, D=1 (בגלל גישת כתיבה) (1 גישה ל-RAM).\n        5.  **גישת נתונים:** כתיבת הנתונים ל-PFN 0x52 (1 גישה ל-RAM).\n*   ג. **PFN סופי:** 0x52.\n*   ד. **TLB לאחר גישה:** TLB מלא (4 כניסות). ה-LRU ב-TLB הוא 0x200. TLB: [(VPN: 0x100, PFN: 0x50, D:1, LRU:3), (VPN: 0x101, PFN: 0x51, D:0, LRU:2), (VPN: 0x200, PFN: 0x53, D:0, LRU:4), (VPN: 0x300, PFN: 0x52, D:1, LRU:1)]\n*   ה. **עלות גישה:** (2 * 100 ns) [PTW] + 100 ns [PTE update 0x201] + 10,000,000 ns [Disk Read] + 100 ns [PTE update 0x300] + 100 ns [Data Write] = 10,000,600 ns.\n*   **מצב LRU מסגרות:** 0x100 -> 0x200 -> 0x101 -> 0x300 (MRU). (0x201 פונה).\n*   **סה\"כ עלות מצטברת:** 10,001,000 ns + 10,000,600 ns = 20,001,600 ns.\n\n**גישה 5: VPN 0x201 (קריאה)**\n*   א. **TLB:** Miss. **טבלת דפים:** Page 0x201 לא נמצא בזיכרון הפיזי (P=0, פונה בגישה הקודמת).\n*   ב. **אירועים:** TLB Miss, Page Table Walk (2 גישות ל-RAM), Page Fault.\n    *   **טיפול ב-Page Fault:**\n        1.  **מציאת מסגרת קורבן:** כל 4 המסגרות תפוסות. מסגרת ה-LRU היא PFN 0x50 (מכילה VPN 0x100). הדף 0x100 מלוכלך (D=1).\n        2.  **פינוי דף:** כתיבת דף 0x100 לדיסק (Disk Write). עדכון PTE עבור 0x100: P=0 (1 גישה ל-RAM).\n        3.  **טעינת דף:** קריאת דף 0x201 מהדיסק אל PFN 0x50 (Disk Read).\n        4.  **עדכון PTE:** עדכון ה-PTE עבור 0x201: PFN 0x50, P=1, D=0 (1 גישה ל-RAM).\n        5.  **גישת נתונים:** קריאת הנתונים מ-PFN 0x50 (1 גישה ל-RAM).\n*   ג. **PFN סופי:** 0x50.\n*   ד. **TLB לאחר גישה:** TLB מלא. ה-LRU ב-TLB הוא 0x100. TLB: [(VPN: 0x200, PFN: 0x53, D:0, LRU:3), (VPN: 0x101, PFN: 0x51, D:0, LRU:2), (VPN: 0x300, PFN: 0x52, D:1, LRU:4), (VPN: 0x201, PFN: 0x50, D:0, LRU:1)]\n*   ה. **עלות גישה:** (2 * 100 ns) [PTW] + 100 ns [PTE update 0x100] + 10,000,000 ns [Disk Write] + 10,000,000 ns [Disk Read] + 100 ns [PTE update 0x201] + 100 ns [Data Read] = 20,000,600 ns.\n*   **מצב LRU מסגרות:** 0x200 -> 0x101 -> 0x300 -> 0x201 (MRU). (0x100 פונה).\n*   **סה\"כ עלות מצטברת:** 20,001,600 ns + 20,000,600 ns = 40,002,200 ns.\n\n**גישה 6: VPN 0x100 (קריאה)**\n*   א. **TLB:** Miss. **טבלת דפים:** Page 0x100 לא נמצא בזיכרון הפיזי (P=0, פונה בגישה הקודמת).\n*   ב. **אירועים:** TLB Miss, Page Table Walk (2 גישות ל-RAM), Page Fault.\n    *   **טיפול ב-Page Fault:**\n        1.  **מציאת מסגרת קורבן:** כל 4 המסגרות תפוסות. מסגרת ה-LRU היא PFN 0x53 (מכילה VPN 0x200). הדף 0x200 נקי (D=0).\n        2.  **פינוי דף:** אין צורך בכתיבה לדיסק עבור 0x200. עדכון PTE עבור 0x200: P=0 (1 גישה ל-RAM).\n        3.  **טעינת דף:** קריאת דף 0x100 מהדיסק אל PFN 0x53 (Disk Read).\n        4.  **עדכון PTE:** עדכון ה-PTE עבור 0x100: PFN 0x53, P=1, D=0 (1 גישה ל-RAM).\n        5.  **גישת נתונים:** קריאת הנתונים מ-PFN 0x53 (1 גישה ל-RAM).\n*   ג. **PFN סופי:** 0x53.\n*   ד. **TLB לאחר גישה:** TLB מלא. ה-LRU ב-TLB הוא 0x200. TLB: [(VPN: 0x101, PFN: 0x51, D:0, LRU:3), (VPN: 0x300, PFN: 0x52, D:1, LRU:4), (VPN: 0x201, PFN: 0x50, D:0, LRU:2), (VPN: 0x100, PFN: 0x53, D:0, LRU:1)]\n*   ה. **עלות גישה:** (2 * 100 ns) [PTW] + 100 ns [PTE update 0x200] + 10,000,000 ns [Disk Read] + 100 ns [PTE update 0x100] + 100 ns [Data Read] = 10,000,500 ns.\n*   **מצב LRU מסגרות:** 0x101 -> 0x300 -> 0x201 -> 0x100 (MRU). (0x200 פונה).\n*   **סה\"כ עלות מצטברת:** 40,002,200 ns + 10,000,500 ns = 50,002,700 ns.\n\n**עלות כוללת של כל סדרת הגישות:** 50,002,700 ננו-שניות."
    },
    "difficulty_estimation": "Hard"
  }
}