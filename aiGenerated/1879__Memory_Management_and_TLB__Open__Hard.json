{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 21:24:08",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 3735,
      "total_tokens": 19482
    }
  },
  "question": {
    "id": 101,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory",
      "Effective Access Time"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם טבלאות דפים מרובות רמות (שתי רמות). גודל הזיכרון הווירטואלי הוא 2^48 בתים, וגודל הדף הוא 4KB (קילו-בתים). כל כניסה בטבלת דפים (PTE) היא בגודל 8 בתים.\nהמערכת כוללת TLB (Translation Lookaside Buffer) בגודל 128 כניסות, הפועל בשיטת Full Associative עם אלגוריתם החלפה LRU. זמן גישה ל-TLB הוא 10ns (ננו-שניות). זמן גישה לזיכרון הראשי (RAM) הוא 100ns. זמן גישה לדיסק (לצורך טיפול ב-page fault) הוא 10ms (מילי-שניות).",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "101.1",
        "text": "א. כמה ביטים מוקצים לכל חלק בכתובת הוירטואלית (VPN1, VPN2, Offset)? פרטו את החישובים.\nב. מהו גודל הזיכרון הפיזי המקסימלי הנתמך על ידי מערכת זו? פרטו את החישובים.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "101.2",
        "text": "נניח ששיעור הפגיעות ב-TLB (TLB Hit Rate) הוא 95%, ושיעור כשלונות הדף (Page Fault Rate) הוא 0.1% (מתוך כלל הגישות לזיכרון, כולל אלו שפוגעות ב-TLB). חשבו את זמן הגישה האפקטיבי הממוצע לזיכרון (Effective Access Time - EAT). פרטו את כל החישובים וההנחות.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "101.3",
        "text": "תהליך מסוים מבצע סדרת גישות לזיכרון. נניח שהתהליך ניגש באופן סדרתי ל-256 דפים שונים, החל מדף 0 ועד דף 255 (כלומר, דף 0, דף 1, ..., דף 255). כל גישה היא לדף אחר בכתובת שונה. ה-TLB ריק בתחילת הרצף. כמה TLB misses יתרחשו במהלך סדרת גישות זו? נמקו.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "101.4",
        "text": "נניח שמיד לאחר סדרת גישות זו, מתרחשת החלפת הקשר (Context Switch) לתהליך אחר. כיצד הדבר משפיע על ה-TLB, ומהן ההשלכות האפשריות על ביצועי המערכת? פרטו והסבירו.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון לשאלה 101:\n\n**101.1.א. חלוקת הכתובת הוירטואלית:**\n*   **גודל כתובת וירטואלית:** נתון זיכרון וירטואלי בגודל 2^48 בתים, לכן הכתובת הוירטואלית היא באורך 48 ביטים.\n*   **גודל Offset:** גודל דף הוא 4KB = 2^12 בתים. לכן, ההיסט (Offset) הוא באורך 12 ביטים.\n*   **גודל VPN (Virtual Page Number):** סך הביטים המוקצים למספר הדף הוירטואלי הוא 48 ביטים (סה\"כ כתובת) - 12 ביטים (Offset) = 36 ביטים.\n*   **חלוקת ה-VPN לרמות (VPN1, VPN2):** נתון שהמערכת משתמשת בשתי רמות של טבלאות דפים. גודל כל כניסה בטבלת דפים (PTE) הוא 8 בתים. נניח שכל טבלת דפים (או מדריך דפים) ברמה מסוימת תופסת דף אחד בזיכרון הראשי (4KB).\n    *   מספר הכניסות בכל טבלת דפים ברמה אחת = גודל דף / גודל PTE = 4KB / 8 בתים = 4096 / 8 = 512 כניסות.\n    *   לכן, כל אינדקס (VPN1 או VPN2) יכול להיות באורך log2(512) = 9 ביטים.\n    *   אם סך ה-VPN הוא 36 ביטים, ובמערכת דו-רמתית, נחלק אותם כך ש-VPN1 יקבל 9 ביטים (כדי שמדריך הדפים יכנס לדף אחד) והשאר יוקצו ל-VPN2.\n    *   **VPN1:** 9 ביטים (לאינדוקס במדריך הדפים - Page Directory).\n    *   **VPN2:** 36 ביטים (סה\"כ VPN) - 9 ביטים (VPN1) = 27 ביטים (לאינדוקס בטבלת הדפים - Page Table).\n    *   **Offset:** 12 ביטים.\n\n**101.1.ב. גודל הזיכרון הפיזי המקסימלי:**\n*   גודל כניסה בטבלת דפים (PTE) הוא 8 בתים = 64 ביטים.\n*   PTE מכיל מספר מסגרת פיזית (PFN) ודגלים (כמו Valid, Dirty, Accessed, Read/Write וכו'). כדי למקסם את גודל הזיכרון הפיזי, נניח שמספר הביטים עבור הדגלים הוא מינימלי, למשל 4 ביטים (זהו אומדן סביר). כלומר, 64-4 = 60 ביטים מוקצים ל-PFN.\n*   מספר המסגרות הפיזיות המקסימלי במערכת הוא 2^60.\n*   גודל הזיכרון הפיזי המקסימלי = מספר מסגרות * גודל דף = 2^60 * 4KB = 2^60 * 2^12 בתים = 2^72 בתים.\n\n**101.2. חישוב זמן הגישה האפקטיבי הממוצע לזיכרון (EAT):**\nנתונים:\n*   TLB Hit Rate (THR) = 0.95\n*   TLB Miss Rate = 1 - 0.95 = 0.05\n*   Page Fault Rate (PFR) = 0.001 (מתוך כלל הגישות לזיכרון)\n*   t_TLB = 10ns\n*   t_mem = 100ns\n*   t_disk = 10ms = 10,000,000ns\n\nנחלק את המקרים האפשריים ונסכום את זמני הגישה המשוקללים:\n1.  **פגיעה ב-TLB (TLB Hit), ללא כשל דף (Page Fault):**\n    *   כאשר יש פגיעה ב-TLB, המשמעות היא שהמיפוי נמצא ב-TLB והדף קיים בזיכרון הראשי. לכן, אין כשל דף במקרה זה. ההסתברות למקרה זה היא THR = 0.95.\n    *   זמן גישה = t_TLB + t_mem = 10ns + 100ns = 110ns.\n\n2.  **החטאה ב-TLB (TLB Miss), ללא כשל דף:**\n    *   ההסתברות להחטאה ב-TLB היא (1 - THR) = 0.05.\n    *   מתוך ההחטאות ב-TLB, חלקן יגרמו לכשל דף וחלקן לא. ההסתברות שלא יתרחש כשל דף היא (1 - PFR) = 0.999.\n    *   ההסתברות למקרה זה היא P(TLB Miss AND No PF) = (1 - THR) - PFR = 0.05 - 0.001 = 0.049. (שכן כשל דף בהכרח גורר החטאה ב-TLB).\n    *   זמן גישה: t_TLB (החטאה ב-TLB) + 2 * t_mem (גישה לטבלאות הדפים ברמה 1 ורמה 2) + t_mem (גישה לנתונים בזיכרון הראשי) = 10ns + 2 * 100ns + 100ns = 10 + 200 + 100 = 310ns.\n\n3.  **כשל דף (Page Fault):**\n    *   ההסתברות לכשל דף היא PFR = 0.001. כשל דף תמיד כרוך בהחטאה ב-TLB.\n    *   זמן גישה: t_TLB (החטאה ב-TLB) + 2 * t_mem (גישה לטבלאות הדפים) + t_disk (טעינת הדף מהדיסק) + t_mem (גישה לנתונים לאחר טעינת הדף) = 10ns + 2 * 100ns + 10,000,000ns + 100ns = 10 + 200 + 10,000,000 + 100 = 10,000,310ns.\n\n**חישוב EAT:**\nEAT = (0.95 * 110ns) + (0.049 * 310ns) + (0.001 * 10,000,310ns)\nEAT = 104.5ns + 15.19ns + 10000.31ns\nEAT = 10119.99ns ≈ 10.12 מיקרו-שניות.\n\n**101.3. מספר TLB misses:**\n*   גודל ה-TLB הוא 128 כניסות.\n*   אלגוריתם ההחלפה הוא LRU.\n*   ה-TLB ריק בתחילה.\n*   התהליך ניגש באופן סדרתי ל-256 דפים שונים (דף 0 עד דף 255).\n\n1.  **גישות לדפים 0 עד 127:** כל אחת מ-128 הגישות הראשונות היא לדף שאינו ב-TLB (הוא ריק או לא מכיל את הדף). לכן, כל אחת מהן תגרום ל-TLB miss. לאחר 128 גישות אלו, ה-TLB יתמלא בכניסות עבור דפים 0 עד 127.\n    *   **מספר TLB misses בשלב זה: 128.**\n\n2.  **גישות לדפים 128 עד 255:** כל אחת מ-128 הגישות הבאות היא לדף חדש שאינו ב-TLB (דפים 128 והלאה). לכן, כל גישה כזו תגרום ל-TLB miss. מכיוון שה-TLB מלא, כל TLB miss יגרום להוצאת כניסה קיימת מה-TLB לפי אלגוריתם LRU.\n    *   הדף שהיה בשימוש הכי פחות לאחרונה יהיה דף 0 (כאשר ניגשים לדף 128), ואחריו דף 1 וכן הלאה.\n    *   **מספר TLB misses בשלב זה: 128.**\n\n*   **סה\"כ TLB misses:** 128 + 128 = 256.\n\n**101.4. השפעת Context Switch על ה-TLB:**\n*   **השפעה על ה-TLB:** כאשר מתרחשת החלפת הקשר (Context Switch) בין תהליך אחד לתהליך אחר, מרחב הכתובות הוירטואלי משתנה. מאחר שרשומות ה-TLB מכילות מיפויים של כתובות וירטואליות לכתובות פיזיות, ומיפויים אלו ספציפיים למרחב הכתובות של כל תהליך, יש צורך לטפל ברשומות ה-TLB הקיימות.\n    *   ברוב המערכות, ה-TLB מרוקן (flushed) לחלוטין. כלומר, כל הרשומות שהיו בו נפסלות או נמחקות. זאת כדי למנוע מהתהליך החדש להשתמש במיפויים שגויים או ישנים השייכים לתהליך הקודם. אם ה-TLB תומך ב-ASID (Address Space ID), ניתן לסמן רשומות לפי מזהה מרחב כתובות, ואז רק רשומות שלא מתאימות ל-ASID החדש יפסלו, או שהחומרה תתעלם מהן אוטומטית.\n\n*   **השלכות על ביצועי המערכת:**\n    1.  **\"התקררות\" ה-TLB (TLB Cold Start):** לאחר הריקון, ה-TLB ריק (או כמעט ריק). כאשר התהליך החדש מתחיל לבצע גישות לזיכרון, מרבית הגישות הראשוניות יגרמו להחטאות ב-TLB. כל החטאה ב-TLB דורשת גישה לטבלאות הדפים שבזיכרון הראשי, מה שמאט משמעותית את זמן הגישה לזיכרון.\n    2.  **עלייה בעומס על הזיכרון הראשי:** ריבוי החטאות ב-TLB פירושו ריבוי גישות לטבלאות הדפים בזיכרון הראשי. זה מגביר את העומס על בקר הזיכרון ועל אפיק הזיכרון, ויכול להשפיע לרעה על הביצועים הכוללים של המערכת.\n    3.  **האטה בביצועים הכוללים:** אם החלפות הקשר מתרחשות בתדירות גבוהה, וכל החלפה גוררת ריקון TLB מלא, המערכת עלולה לחוות ירידה משמעותית בביצועים עקב הזמן הרב המוקדש למילוי מחדש של ה-TLB עבור כל תהליך."
    },
    "difficulty_estimation": "Hard"
  }
}