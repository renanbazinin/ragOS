{
  "metadata": {
    "source": "ai_generated",
    "topic_hint": "Synchronization",
    "requested_type": "MultipleChoice",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 18:55:22",
    "examples_used": 2,
    "token_usage": {
      "prompt_tokens": 968,
      "output_tokens": 676,
      "total_tokens": 3437
    }
  },
  "question": {
    "id": 10,
    "type": "MultipleChoice",
    "topic": [
      "Synchronization",
      "Peterson's Algorithm",
      "Memory Barriers",
      "Concurrency"
    ],
    "content": {
      "text": "נניח מימוש של אלגוריתם פיטרסון (Peterson's Algorithm) עבור שני תהליכים (P0 ו-P1) במערכת מודרנית שבה המעבד או הקומפיילר עשויים לבצע אופטימיזציות של Reordering (שינוי סדר פעולות) לפעולות קריאה וכתיבה לזיכרון. הקוד עבור P0 מוצג להלן. מהי הסכנה העיקרית בהרצת קוד זה ללא שימוש ב-Memory Barriers (מחסומי זיכרון) או במשתנים אטומיים?",
      "code_snippet": "flag[0] = true;\nturn = 1;\nwhile (flag[1] && turn == 1);\n// Critical Section\nflag[0] = false;",
      "options": [
        "א. לא קיימת סכנה, האלגוריתם הוכח מתמטית ולכן יעבוד תמיד ללא קשר לארכיטקטורת החומרה.",
        "ב. ייתכן מצב שבו שני התהליכים יכנסו לקטע הקריטי בו-זמנית (פגיעה ב-Mutual Exclusion).",
        "ג. המערכת תיכנס ל-Deadlock ודאי בכל פעם ששני התהליכים ינסו להיכנס לקטע הקריטי יחד.",
        "ד. התהליכים יסבלו מהרעבה (Starvation) כיוון ש-turn לעולם לא יתעדכן בזמן, אך ה-Mutual Exclusion יישמר."
      ]
    },
    "sub_questions": null,
    "points": 10,
    "solution": {
      "is_present_in_file": true,
      "correct_option": "ב",
      "explanation": "בארכיטקטורות מחשב מודרניות, המעבד או הקומפיילר עשויים לשנות את סדר פעולות הכתיבה והקריאה (Out-of-order execution) כדי לשפר ביצועים. ללא Memory Barriers, ייתכן שהכתיבה ל-flag[0] תתבצע בפועל (או תיראה לשאר הליבות) רק אחרי הקריאה של flag[1] בתוך הלולאה. במצב כזה, שני התהליכים עלולים לראות ש-flag של הצד השני הוא false בו-זמנית, ושניהם ייכנסו לקטע הקריטי יחד, מה שמפר את עקרון ה-Mutual Exclusion."
    },
    "difficulty_estimation": "Hard"
  }
}