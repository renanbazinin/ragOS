{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 21:22:27",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 4479,
      "total_tokens": 12958
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory",
      "Performance"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת במנגנון זיכרון וירטואלי עם דפדוף (Paging).\n\nנתונים:\n*   מרחב כתובות וירטואלי: 32 ביטים.\n*   מרחב כתובות פיזי: 28 ביטים.\n*   גודל דף: 4KB.\n*   טבלת דפים דו-רמתית (Two-level page table). כל אינדקס ברמה הראשונה (P1) והשנייה (P2) הוא בגודל 10 ביטים.\n*   כל כניסה בטבלת הדפים (PTE) היא בגודל 4 בתים.\n*   זמן גישה לזיכרון הראשי: 100 ננו-שניות (ns).\n*   זמן גישה לדיסק (לצורך Page Fault): 10 מילי-שניות (ms).\n*   המערכת כוללת TLB בגודל 4 כניסות, בשיטת LRU (Least Recently Used) ובאסוציאטיביות מלאה (Fully Associative).\n*   זמן חיפוש ב-TLB: 10 ננו-שניות (ns).\n*   ה-TLB מנוקה (flushed) בעת החלפת הקשר (Context Switch).\n\nהניחו כי טבלאות הדפים עבור התהליך הנתון מאוחסנות בזיכרון הראשי, וכי ה-TLB והמטמון (cache) ריקים לחלוטין בתחילת כל סעיף, אלא אם צוין אחרת.\nיש לפרט את כל החישובים וההנחות.\n",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "תהליך P1 מבצע את סדרת הגישות לכתובות הוירטואליות הבאות (בבסיס 16, משמאל לימין):\n0x10000, 0x11000, 0x10000, 0x20000, 0x12000, 0x21000, 0x10000, 0x30000\nהניחו שכל הדפים הנדרשים נמצאים על הדיסק טרם הגישה הראשונה אליהם (כלומר, כל גישה לדף שאינו בזיכרון תגרום ל-Page Fault). לאחר טעינת דף לזיכרון הפיזי, הוא נשאר שם.\nא. מהו סך כל זמן הגישה לזיכרון עבור סדרת גישות זו?\nב. כמה TLB Miss-ים וכמה Page Fault-ים התרחשו בסך הכל?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "לאחר סיום סדרת הגישות בסעיף 1.1, מה יהיה מצבו הסופי של ה-TLB (ציינו את ה-VPN וה-PFN עבור כל כניסה, ואת סדר ה-LRU, כאשר 1 הוא ה-MRU - Most Recently Used)?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "מיד לאחר סיום סדרת הגישות בסעיף 1.1, מתרחשת החלפת קשר (Context Switch) לתהליך P2, המבצע גישה לכתובת הוירטואלית 0x40000. לאחר מכן, מתרחשת החלפת קשר חזרה לתהליך P1, אשר מנסה לגשת שוב לכתובת 0x10000.\nא. מה יהיה זמן הגישה לכתובת 0x40000 עבור P2?\nב. מה יהיה זמן הגישה לכתובת 0x10000 עבור P1 לאחר החזרה אליו?\nהניחו שכל הדפים הנדרשים עבור P2 נמצאים בזיכרון הראשי (אין Page Faults עבור P2), וטבלאות הדפים של P2 כבר טעונות.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון שאלה 1:\n\n**חישובים כלליים והגדרות:**\n*   גודל דף: 4KB = 2^12 בתים. לכן, ההיסט (Offset) הוא 12 ביטים.\n*   כתובת וירטואלית (VA): 32 ביטים. מספר הדף הוירטואלי (VPN) הוא 32 - 12 = 20 ביטים.\n*   כתובת פיזית (PA): 28 ביטים. מספר המסגרת הפיזית (PFN) הוא 28 - 12 = 16 ביטים.\n*   טבלת דפים דו-רמתית: אינדקס P1 הוא 10 ביטים, אינדקס P2 הוא 10 ביטים. (סה\"כ 20 ביטים ל-VPN).\n*   גודל PTE: 4 בתים. מספר כניסות לדף בטבלה: 4KB / 4 בתים/כניסה = 1024 כניסות (2^10), כך שכל טבלת דפים (P1 או P2) נכנסת לדף בודד.\n\n**זמני גישה:**\n*   **TLB Hit:** זמן חיפוש ב-TLB (10ns) + גישה לזיכרון הראשי (100ns) = **110ns**.\n*   **TLB Miss (Page Table Walk, ללא Page Fault):**\n    *   חיפוש ב-TLB (10ns) - Miss.\n    *   גישה לטבלת P1 בזיכרון הראשי (100ns).\n    *   גישה לטבלת P2 בזיכרון הראשי (100ns).\n    *   גישה לנתון עצמו בזיכרון הראשי (100ns).\n    *   סה\"כ: 10 + 100 + 100 + 100 = **310ns**. (לאחר מכן ה-TLB מתעדכן).\n*   **TLB Miss (Page Table Walk, עם Page Fault):**\n    *   חיפוש ב-TLB (10ns) - Miss.\n    *   גישה לטבלת P1 בזיכרון הראשי (100ns).\n    *   גישה לטבלת P2 בזיכרון הראשי (100ns) - מגלה שהדף אינו בזיכרון.\n    *   טיפול ב-Page Fault: גישה לדיסק (10ms = 10,000,000ns).\n    *   עדכון טבלת P2 בזיכרון הראשי (100ns) לאחר טעינת הדף.\n    *   גישה לנתון עצמו בזיכרון הראשי (100ns).\n    *   סה\"כ: 10 + 100 + 100 + 10,000,000 + 100 + 100 = **10,000,410ns**. (לאחר מכן ה-TLB מתעדכן).\n\n**כתובות וירטואליות ו-VPN:**\nנמיר את הכתובות הוירטואליות למספרי דפים וירטואליים (VPN) על ידי חלוקה בגודל הדף (0x1000):\n*   0x10000 -> VPN 0x10\n*   0x11000 -> VPN 0x11\n*   0x20000 -> VPN 0x20\n*   0x12000 -> VPN 0x12\n*   0x21000 -> VPN 0x21\n*   0x30000 -> VPN 0x30\n\nלצורך הפתרון, נניח PFNs עוקבים לדפים שנטענים (לדוגמה: VPN 0x10 ל-PFN 0x100, VPN 0x11 ל-PFN 0x101 וכן הלאה).\n\n--- \n\n**סעיף 1.1: סדרת גישות ל-P1**\n\n**מצב התחלתי:** TLB ריק, טבלאות דפים לא טעונות (כל גישה לדף תגרום ל-Page Fault).\n\n1.  **גישה ל-VA 0x10000 (VPN 0x10):**\n    *   TLB Miss.\n    *   Page Table Walk.\n    *   Page Fault (דף 0x10 לא בזיכרון, נטען ל-PFN 0x100).\n    *   זמן: 10,000,410ns.\n    *   TLB: [(0x10, 0x100), LRU=1]\n    *   סה\"כ: TLB Misses: 1, Page Faults: 1, זמן כולל: 10,000,410ns.\n\n2.  **גישה ל-VA 0x11000 (VPN 0x11):**\n    *   TLB Miss.\n    *   Page Table Walk.\n    *   Page Fault (דף 0x11 לא בזיכרון, נטען ל-PFN 0x101).\n    *   זמן: 10,000,410ns.\n    *   TLB: [(0x10, 0x100), LRU=2], [(0x11, 0x101), LRU=1]\n    *   סה\"כ: TLB Misses: 2, Page Faults: 2, זמן כולל: 20,000,820ns.\n\n3.  **גישה ל-VA 0x10000 (VPN 0x10):**\n    *   TLB Hit! (0x10 נמצא ב-TLB).\n    *   זמן: 110ns.\n    *   TLB: [(0x11, 0x101), LRU=2], [(0x10, 0x100), LRU=1]\n    *   סה\"כ: TLB Misses: 2, Page Faults: 2, זמן כולל: 20,000,930ns.\n\n4.  **גישה ל-VA 0x20000 (VPN 0x20):**\n    *   TLB Miss.\n    *   Page Table Walk.\n    *   Page Fault (דף 0x20 לא בזיכרון, נטען ל-PFN 0x102).\n    *   זמן: 10,000,410ns.\n    *   TLB: [(0x11, 0x101), LRU=3], [(0x10, 0x100), LRU=2], [(0x20, 0x102), LRU=1]\n    *   סה\"כ: TLB Misses: 3, Page Faults: 3, זמן כולל: 30,001,340ns.\n\n5.  **גישה ל-VA 0x12000 (VPN 0x12):**\n    *   TLB Miss.\n    *   Page Table Walk.\n    *   Page Fault (דף 0x12 לא בזיכרון, נטען ל-PFN 0x103).\n    *   זמן: 10,000,410ns.\n    *   TLB: [(0x11, 0x101), LRU=4], [(0x10, 0x100), LRU=3], [(0x20, 0x102), LRU=2], [(0x12, 0x103), LRU=1]\n    *   סה\"כ: TLB Misses: 4, Page Faults: 4, זמן כולל: 40,001,750ns.\n\n6.  **גישה ל-VA 0x21000 (VPN 0x21):**\n    *   TLB Miss.\n    *   Page Table Walk.\n    *   Page Fault (דף 0x21 לא בזיכרון, נטען ל-PFN 0x104).\n    *   TLB מלא. ה-LRU הוא (0x11, 0x101). נחליף אותו.\n    *   זמן: 10,000,410ns.\n    *   TLB: [(0x10, 0x100), LRU=4], [(0x20, 0x102), LRU=3], [(0x12, 0x103), LRU=2], [(0x21, 0x104), LRU=1]\n    *   סה\"כ: TLB Misses: 5, Page Faults: 5, זמן כולל: 50,002,160ns.\n\n7.  **גישה ל-VA 0x10000 (VPN 0x10):**\n    *   TLB Hit! (0x10 נמצא ב-TLB).\n    *   זמן: 110ns.\n    *   TLB: [(0x20, 0x102), LRU=4], [(0x12, 0x103), LRU=3], [(0x21, 0x104), LRU=2], [(0x10, 0x100), LRU=1]\n    *   סה\"כ: TLB Misses: 5, Page Faults: 5, זמן כולל: 50,002,270ns.\n\n8.  **גישה ל-VA 0x30000 (VPN 0x30):**\n    *   TLB Miss.\n    *   Page Table Walk.\n    *   Page Fault (דף 0x30 לא בזיכרון, נטען ל-PFN 0x105).\n    *   TLB מלא. ה-LRU הוא (0x20, 0x102). נחליף אותו.\n    *   זמן: 10,000,410ns.\n    *   TLB: [(0x12, 0x103), LRU=4], [(0x21, 0x104), LRU=3], [(0x10, 0x100), LRU=2], [(0x30, 0x105), LRU=1]\n    *   סה\"כ: TLB Misses: 6, Page Faults: 6, זמן כולל: 60,002,680ns.\n\n**תשובות לסעיף 1.1:**\nא. סך כל זמן הגישה לזיכרון עבור סדרת גישות זו: **60,002,680 ננו-שניות**.\nב. מספר TLB Miss-ים: **6**, מספר Page Fault-ים: **6**.\n\n--- \n\n**סעיף 1.2: מצב ה-TLB הסופי**\n\nלאחר סדרת הגישות בסעיף 1.1, מצב ה-TLB הוא (PFNים לדוגמה): \n*   **MRU (1):** (VPN 0x30, PFN 0x105)\n*   **2:** (VPN 0x10, PFN 0x100)\n*   **3:** (VPN 0x21, PFN 0x104)\n*   **LRU (4):** (VPN 0x12, PFN 0x103)\n\n--- \n\n**סעיף 1.3: השפעת החלפת קשר**\n\n**א. זמן גישה ל-VA 0x40000 עבור P2:**\n*   מתרחשת החלפת קשר מ-P1 ל-P2. ה-TLB מנוקה.\n*   P2 ניגש ל-VA 0x40000 (VPN 0x40).\n*   TLB Miss (ה-TLB ריק).\n*   Page Table Walk (P1, P2) - (דף 0x40 עבור P2 נמצא בזיכרון, אין Page Fault).\n*   זמן גישה: 10 (TLB Miss) + 100 (P1) + 100 (P2) + 100 (גישת נתונים) = **310ns**.\n\n**ב. זמן גישה ל-VA 0x10000 עבור P1 לאחר החזרה אליו:**\n*   מתרחשת החלפת קשר מ-P2 חזרה ל-P1. ה-TLB מנוקה שוב.\n*   P1 ניגש ל-VA 0x10000 (VPN 0x10).\n*   TLB Miss (ה-TLB ריק).\n*   Page Table Walk (P1, P2) - (דף 0x10 עבור P1 כבר נטען לזיכרון בסעיף 1.1, אין Page Fault).\n*   זמן גישה: 10 (TLB Miss) + 100 (P1) + 100 (P2) + 100 (גישת נתונים) = **310ns**.\n",
      "difficulty_estimation": "Hard"
    }
  }
}