{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Virtual Memory and Copy-on-Write",
    "requested_type": "Open",
    "requested_difficulty": "Medium",
    "generated_at": "2026-02-08 11:14:07",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 2412,
      "output_tokens": 2061,
      "total_tokens": 9827
    }
  },
  "question": {
    "id": 10,
    "type": "Open",
    "topic": [
      "Virtual Memory",
      "Copy-on-Write",
      "Process Management"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה התומכת בזיכרון וירטואלי ובמנגנון Copy-on-Write (CoW) עבור אזורי זיכרון ברי-כתיבה. גודל דף במערכת הוא 4KB. נניח שכל תהליך דורש דף אחד עבור טבלת הדפים שלו ודף אחד עבור המחסנית שלו (stack), בנוסף לדפי הקוד ודפי הנתונים. דף הקוד משותף וקריא בלבד.\n\nנתבונן בתוכנית C הבאה:\n",
      "code_snippet": "#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n\n#define ARRAY_SIZE (1024 * 32) // 32KB total\nint global_array[ARRAY_SIZE]; // Global array, initially zero-initialized, then touched\n\nint main() {\n    // שלב 1: אתחול המערך - נוגע בכל הדפים של המערך\n    for (int i = 0; i < ARRAY_SIZE; i++) {\n        global_array[i] = i;\n    }\n\n    pid_t pid = fork();\n\n    if (pid < 0) {\n        perror(\"fork failed\");\n        exit(1);\n    } else if (pid == 0) { // תהליך בן\n        // שלב 3: הבן משנה את חציו הראשון של המערך\n        for (int i = 0; i < ARRAY_SIZE / 2; i++) {\n            global_array[i] = -i;\n        }\n        exit(0);\n    } else { // תהליך אב\n        // שלב 3: האב משנה את חציו השני של המערך\n        for (int i = ARRAY_SIZE / 2; i < ARRAY_SIZE; i++) {\n            global_array[i] = i * 2;\n        }\n        wait(NULL); // ממתין לבן\n    }\n\n    return 0;\n}",
      "options": null
    },
    "sub_questions": [
      {
        "id": "10.1",
        "text": "בהתבסס על הקוד לעיל ובהנחה שדף הקוד תופס דף פיזי אחד (1 page) וכי המערך `global_array` תופס 8 דפים פיזיים (כיוון ש-32KB / 4KB = 8), כמה דפים פיזיים בסך הכל תפוסים על ידי התהליך הראשי (האב) מיד לפני קריאת ה-`fork()`? (שלב 1)",
        "code_snippet": null,
        "options": null,
        "solution": null
      },
      {
        "id": "10.2",
        "text": "כמה דפים פיזיים בסך הכל תפוסים במערכת מיד לאחר קריאת ה-`fork()` ולפני שמתבצעות פעולות כתיבה כלשהן על ידי האב או הבן? (שלב 2)",
        "code_snippet": null,
        "options": null,
        "solution": null
      },
      {
        "id": "10.3",
        "text": "כמה דפים פיזיים בסך הכל תפוסים במערכת לאחר שגם האב וגם הבן סיימו את פעולות הכתיבה שלהם (כפי שמוצג בלולאות בשלב 3)? (שלב 3)",
        "code_snippet": null,
        "options": null,
        "solution": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "נתונים:\n- גודל דף: 4KB\n- דף קוד: 1 דף פיזי (משותף וקריא בלבד)\n- דף מחסנית (stack): 1 דף פיזי לכל תהליך\n- טבלת דפים (page table): 1 דף פיזי לכל תהליך\n- המערך `global_array`: 32KB = 8 דפים פיזיים. מאותחל בשלב 1, לכן כל הדפים שלו כבר נמצאים בזיכרון פיזי.\n\nחישובים:\n\n1. **לפני `fork()` (שלב 1):**\n   התהליך האב דורש:\n   - 1 דף עבור טבלת הדפים שלו.\n   - 1 דף עבור המחסנית שלו.\n   - 1 דף עבור הקוד.\n   - 8 דפים עבור המערך `global_array`.\n   סה\"כ דפים פיזיים: 1 (טבלת דפים) + 1 (מחסנית) + 1 (קוד) + 8 (מערך) = **11 דפים**.\n\n2. **מיד לאחר `fork()` (שלב 2):**\n   מנגנון CoW נכנס לפעולה. התהליך הבן נוצר, ומקבל העתק של טבלת הדפים של האב. דפים ברי כתיבה (כמו המערך `global_array` והמחסנית) מסומנים כקריאה בלבד (read-only) בשתי טבלאות הדפים, ומצביעים על אותם דפים פיזיים. דף הקוד ממילא משותף וקריא בלבד.\n   - דפים ייחודיים לאב: 1 (טבלת דפים) + 1 (מחסנית).\n   - דפים ייחודיים לבן: 1 (טבלת דפים) + 1 (מחסנית).\n   - דפים משותפים לאב ולבן: 1 (קוד) + 8 (מערך `global_array`).\n   סה\"כ דפים פיזיים: (1+1) (ייחודי לאב) + (1+1) (ייחודי לבן) + (1+8) (משותפים) = 2 + 2 + 9 = **13 דפים**.\n\n3. **לאחר פעולות הכתיבה של האב והבן (שלב 3):**\n   המערך `global_array` מורכב מ-8 דפים. הבן משנה את חציו הראשון (4 דפים), והאב משנה את חציו השני (4 דפים). כל פעולת כתיבה לדף שסומן כ-read-only מפעילה את מנגנון CoW וגורמת להעתקת הדף. \n   - דף קוד: 1 דף (משותף).\n   - מחסנית אב: 1 דף (ייחודי לאב).\n   - טבלת דפים אב: 1 דף (ייחודי לאב).\n   - מחסנית בן: 1 דף (ייחודי לבן).\n   - טבלת דפים בן: 1 דף (ייחודי לבן).\n   - דפים של המערך `global_array`:\n     - 4 דפים עבור החצי הראשון של המערך (הדפים המקוריים, שעתה בשימוש בלעדי של האב, כי הבן קיבל עותק חדש).\n     - 4 דפים עבור החצי השני של המערך (הדפים המקוריים, שעתה בשימוש בלעדי של הבן, כי האב קיבל עותק חדש).\n     - 4 דפים חדשים שהועתקו לבן עבור החצי הראשון של המערך (CoW).\n     - 4 דפים חדשים שהועתקו לאב עבור החצי השני של המערך (CoW).\n   סה\"כ דפים פיזיים: 1 (קוד) + 1 (מחסנית אב) + 1 (טבלת דפים אב) + 1 (מחסנית בן) + 1 (טבלת דפים בן) + 4 (חצי 1 מקורי) + 4 (חצי 2 מקורי) + 4 (חצי 1 מועתק לבן) + 4 (חצי 2 מועתק לאב) = **21 דפים**."
    },
    "difficulty_estimation": "Medium"
  }
}