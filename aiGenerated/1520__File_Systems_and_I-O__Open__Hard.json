{
  "metadata": {
    "source": "ai_generated",
    "subject": "File Systems",
    "topic_hint": "File Systems and I/O",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 11:04:02",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4088,
      "output_tokens": 4120,
      "total_tokens": 20758
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "File Systems",
      "I/O",
      "Journaling",
      "Disk Performance"
    ],
    "content": {
      "text": "מערכת קבצים VSFS משתמשת בשיטת Journaling מלא (data=journal) עבור כל הנתונים, כולל metadata ו-data blocks. הדיסק מחולק לשני אזורים לוגיים עיקריים:\n1.  **אזור Metadata**: מכיל את ה-superblock, טבלאות ה-inodes, ובלוקי תיקיות. בלוקים באזור זה הם בעלי מספרי בלוקים נמוכים.\n2.  **אזור Data**: מכיל את בלוקי הנתונים של הקבצים. בלוקים באזור זה הם בעלי מספרי בלוקים גבוהים יותר.\nכמו כן, קיים אזור ייעודי ל-Journal על הדיסק, הממוקם באופן פיזי בין אזור ה-Metadata לאזור ה-Data.\n\nנתון מבנה ה-inode הבא:\n*   גודל בלוק: 4KB\n*   גודל מצביע: 4B\n*   10 מצביעים ישירים (Direct Pointers)\n*   מצביע עקיף יחיד אחד (Single Indirect Pointer)\n*   מצביע עקיף כפול אחד (Double Indirect Pointer)\n\nמשתמש מבצע פעולת כתיבה (append) של 4KB לקובץ קיים. לפני פעולה זו, הקובץ תפס בדיוק 10 בלוקי נתונים (כלומר, השתמש בכל המצביעים הישירים, אך לא במצביע העקיף היחיד). פעולה זו דורשת הקצאה של בלוק נתונים חדש וגם הקצאה של בלוק מצביעים עקיף יחיד חדש (מכיוון שהמצביע העקיף היחיד טרם היה בשימוש).",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "פרטו את רצף הפעולות המינימלי של כתיבות לדיסק (ל-Journal ולמיקומים הסופיים) הנדרשות כדי להבטיח עקביות מלאה (crash-safe) במערכת הקבצים לאחר השלמת הפעולה. עבור כל פעולה, ציינו מה נכתב, לאיזה אזור (Journal / אזור Metadata / אזור Data), ומדוע סדר פעולות זה קריטי לעקביות. התעלמו מקריאות דיסק לצורך איתור מידע (כגון קריאת bitmap או inode block קיים).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "בהנחה שכל הנתונים הנדרשים (בלוק ה-inode של הקובץ, הבלוק העקיף החדש, ובלוק הנתונים החדש) ממוקמים במיקומים הבאים על הדיסק, ובלוקי ה-Journal נמצאים גם הם במיקומים ספציפיים:\n*   בלוק ה-inode של הקובץ: בלוק #500 (אזור Metadata)\n*   בלוק ה-Journal (עבור טרנזקציה זו): בלוקים #2000 - #2004 (5 בלוקים רצופים)\n*   הבלוק העקיף החדש: בלוק #10000 (אזור Data)\n*   בלוק הנתונים החדש: בלוק #10001 (אזור Data)\n\nנתוני ביצועי הדיסק:\n*   מהירות סיבוב: 7200 RPM\n*   זמן Seek ממוצע: 8ms\n*   קצב העברה מקסימלי: 100 MB/s\n*   זמן סיבוב מלא (Full Rotation Latency): 60,000 ms / 7200 = 8.33 ms\n*   זמן סיבוב חצי ממוצע (Average Rotational Latency): 4.16 ms\n\nחשבו את הזמן המינימלי שלוקח לבצע את כל פעולות הכתיבה לדיסק שפירטתם בסעיף 1.1, בהנחה ש:\n1.  לא מתבצעות קריאות דיסק נוספות (רק כתיבות). \n2.  הכתיבות ל-Journal מתבצעות לבלוקים רצופים (2000-2004).\n3.  הכתיבות למיקומים הסופיים (בלוק עקיף ובלוק נתונים) מתבצעות לבלוקים רצופים (10000-10001).\n4.  הדיסק ממוקם באופן אופטימלי לפני כל כתיבה כדי למזער את זמן ה-seek וה-rotational latency, אך יש לקחת בחשבון מעבר בין אזורים שונים על הדיסק (Journal -> Metadata -> Data).\n5.  אין cache פעיל.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון:\n\n**סעיף 1.1: רצף פעולות כתיבה לדיסק להבטחת עקביות מלאה (data=journal)**\n\nבשיטת Journaling מלא (data=journal), כל הנתונים המשתנים (metadata ו-data blocks) נכתבים תחילה ל-Journal, ורק לאחר מכן מחויבים ונכתבים למיקומם הסופי. הטרנזקציה כוללת את עדכון ה-inode של הקובץ, יצירת בלוק מצביעים עקיף חדש, וכתיבת בלוק נתונים חדש. להלן רצף הפעולות המינימלי והקריטי לעקביות:\n\n1.  **כתיבת TxB (Transaction Begin) ל-Journal:**\n    *   **מה נכתב:** בלוק המכיל את כותרת הטרנזקציה, המסמן את תחילתה. הטרנזקציה תקבל ID ייחודי.\n    *   **לאיזה אזור:** אזור ה-Journal.\n    *   **למה קריטי:** פעולה זו מסמנת את נקודת ההתחלה של הטרנזקציה. אם קריסה תתרחש לפני כתיבה זו, הטרנזקציה כלל לא החלה, והמערכת נשארת במצב עקבי קודם.\n\n2.  **כתיבת בלוק ה-inode המעודכן ל-Journal:**\n    *   **מה נכתב:** עותק של בלוק ה-inode של הקובץ, המכיל את המצביע החדש לבלוק המצביעים העקיף היחיד, גודל הקובץ המעודכן, וזמני עדכון.\n    *   **לאיזה אזור:** אזור ה-Journal.\n    *   **למה קריטי:** זהו אחד מבלוקי המטא-דאטה החיוניים שמשתנים. העותק ב-Journal מבטיח שאם קריסה תתרחש לפני שה-inode ייכתב למיקומו הסופי, ה-Journal יכיל את המידע הנכון לשחזור.\n\n3.  **כתיבת בלוק המצביעים העקיף החדש ל-Journal:**\n    *   **מה נכתב:** בלוק מצביעים עקיף יחיד חדש, המכיל מצביע לבלוק הנתונים החדש שהוקצה.\n    *   **לאיזה אזור:** אזור ה-Journal.\n    *   **למה קריטי:** זהו בלוק מטא-דאטה חדש שנוצר כחלק מהרחבת הקובץ. העותק ב-Journal מבטיח שגם אם קריסה תתרחש לפני כתיבתו למיקומו הסופי, ה-Journal יכיל אותו לשחזור.\n\n4.  **כתיבת בלוק הנתונים החדש ל-Journal:**\n    *   **מה נכתב:** בלוק הנתונים של ה-4KB החדשים שנכתבו לקובץ.\n    *   **לאיזה אזור:** אזור ה-Journal.\n    *   **למה קריטי:** בשיטת `data=journal`, כל נתוני המשתמש נכתבים ל-Journal לפני כתיבתם למיקומם הסופי. זה מבטיח שלמות נתונים; אם קריסה תתרחש לאחר כתיבת ה-TxE אך לפני כתיבת הנתונים הסופית, ה-Journal יכיל עותק של הנתונים המלאים.\n\n5.  **כתיבת TxE (Transaction End) ל-Journal:**\n    *   **מה נכתב:** בלוק המכיל את כותרת סיום הטרנזקציה, המציין שהטרנזקציה הושלמה בהצלחה. זהו ה\"Commit Point\".\n    *   **לאיזה אזור:** אזור ה-Journal.\n    *   **למה קריטי:** ברגע ש-TxE זה נכתב פיזית לדיסק (לאחר סינכרון), הטרנזקציה נחשבת מחויבת. גם אם קריסה תתרחש מיד לאחר מכן, מערכת הקבצים תוכל לשחזר את כל הנתונים והמטא-דאטה מה-Journal למיקומם הסופי, ובכך להבטיח עקביות מלאה.\n\n6.  **`fsync` (או Barrier) ל-Journal:**\n    *   **מה נכתב:** זו אינה כתיבת נתונים חדשים, אלא פקודה המבטיחה שכל הכתיבות הקודמות ל-Journal (כולל ה-TxE) אכן נכתבו פיזית לדיסק לפני המשך הפעולות. (יש מערכות קבצים שמשלבות את ה-TxE וה-fsync לפעולה אחת).\n    *   **לאיזה אזור:** ה-Journal.\n    *   **למה קריטי:** מונע מצב שבו ה-TxE נכתב ל-buffer cache אך לא לדיסק פיזית, וקריסה משאירה את הטרנזקציה במצב לא מחויב.\n\n7.  **כתיבת בלוק ה-inode המעודכן למיקומו הסופי:**\n    *   **מה נכתב:** בלוק ה-inode של הקובץ עם העדכונים (כמו בסעיף 2).\n    *   **לאיזה אזור:** אזור Metadata (בלוק #500).\n    *   **למה קריטי:** זהו העדכון הסופי של המטא-דאטה של הקובץ במיקומו הקבוע. אם קריסה תתרחש לפני כן, ה-Journal יאפשר שחזור.\n\n8.  **כתיבת בלוק המצביעים העקיף החדש למיקומו הסופי:**\n    *   **מה נכתב:** בלוק המצביעים העקיף היחיד החדש (כמו בסעיף 3).\n    *   **לאיזה אזור:** אזור Data (בלוק #10000).\n    *   **למה קריטי:** כתיבת בלוק המטא-דאטה החדש למיקומו הקבוע.\n\n9.  **כתיבת בלוק הנתונים החדש למיקומו הסופי:**\n    *   **מה נכתב:** בלוק הנתונים של ה-4KB החדשים (כמו בסעיף 4).\n    *   **לאיזה אזור:** אזור Data (בלוק #10001).\n    *   **למה קריטי:** כתיבת נתוני המשתמש למיקומם הקבוע.\n\n(פעולת ניקוי ה-Journal (Checkpoint) מתרחשת בדרך כלל לאחר מכן, אך אינה קריטית לעקביות מיידית של הטרנזקציה ולרוב אינה נחשבת חלק מזמן הביצוע המינימלי של הפעולה עצמה).\n\n**סעיף 1.2: חישוב זמן ביצוע מינימלי**\n\n**נתונים:**\n*   זמן סיבוב מלא: 8.33ms (60,000 ms / 7200 RPM)\n*   זמן סיבוב ממוצע (חצי סיבוב): 4.16ms (8.33ms / 2)\n*   זמן Seek ממוצע: 8ms\n*   קצב העברה: 100 MB/s = 102,400 KB/s\n*   גודל בלוק: 4KB\n*   זמן העברת בלוק בודד: 4KB / 102,400 KB/s = 0.0390625 ms\n\n**פעולות הכתיבה לדיסק (סה\"כ 8 כתיבות נתונים):**\n1.  5 בלוקים ל-Journal (2000-2004) - רצופים (TxB, Inode, Indirect, Data, TxE).\n2.  1 בלוק ל-Metadata Zone (500) - בלוק Inode סופי.\n3.  2 בלוקים ל-Data Zone (10000-10001) - רצופים (בלוק מצביעים עקיף סופי, בלוק נתונים סופי).\n\nכדי למזער את הזמן, נבצע את הכתיבות בקבוצות רצופות ונמזער מעברים בין אזורים ככל הניתן. סדר הפעולות שפורט בסעיף 1.1 הוא קריטי לעקביות, ולכן נשמור עליו. החישוב מתייחס לזמן שנדרש *לפעולות הכתיבה בפועל לדיסק* לאחר שהנתונים מוכנים.\n\n1.  **כתיבת 5 בלוקים ל-Journal (בלוקים 2000-2004):**\n    *   זמן Seek (נניח ממיקום אקראי, לכן ממוצע): 8ms\n    *   זמן Rotational Latency (ממוצע): 4.16ms\n    *   זמן העברת 5 בלוקים (20KB): 5 * 0.0390625 ms = 0.1953125 ms\n    *   **סה\"כ לקבוצה 1:** 8 + 4.16 + 0.1953125 = 12.3553125 ms\n\n2.  **מעבר ו כתיבת בלוק ה-inode (בלוק 500):**\n    *   לאחר כתיבת ה-Journal (בלוק 2004), הראש צריך לעבור לאזור Metadata (בלוק 500). זהו Seek אחורה.\n    *   זמן Seek (ממוצע בין אזורים): 8ms\n    *   זמן Rotational Latency (ממוצע, מכיוון שהיה Seek): 4.16ms\n    *   זמן העברת 1 בלוק (4KB): 0.0390625 ms\n    *   **סה\"כ לקבוצה 2:** 8 + 4.16 + 0.0390625 = 12.1990625 ms\n\n3.  **מעבר ו כתיבת 2 בלוקים ל-Data Zone (בלוקים 10000-10001):**\n    *   לאחר כתיבת ה-inode (בלוק 500), הראש צריך לעבור לאזור Data (בלוק 10000). זהו Seek קדימה.\n    *   זמן Seek (ממוצע בין אזורים): 8ms\n    *   זמן Rotational Latency (ממוצע, מכיוון שהיה Seek): 4.16ms\n    *   זמן העברת 2 בלוקים (8KB): 2 * 0.0390625 ms = 0.078125 ms\n    *   **סה\"כ לקבוצה 3:** 8 + 4.16 + 0.078125 = 12.238125 ms\n\n**חישוב זמן כולל מינימלי:**\nזמן כולל = סה\"כ לקבוצה 1 + סה\"כ לקבוצה 2 + סה\"כ לקבוצה 3\nזמן כולל = 12.3553125 ms + 12.1990625 ms + 12.238125 ms = **36.7925 ms**"
    },
    "difficulty_estimation": "Hard"
  }
}