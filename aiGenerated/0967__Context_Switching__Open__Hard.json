{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Context Switching",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 07:10:22",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3023,
      "output_tokens": 2417,
      "total_tokens": 12479
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Context Switching",
      "Operating Systems",
      "Performance",
      "Memory Management",
      "CPU Architecture"
    ],
    "content": {
      "text": "בשאלה זו יש לתאר באופן מפורט את שלבי החלפת הקשר (Context Switch) בין שני תהליכי משתמש במערכת חד-מעבדתית, תוך התמקדות בהשלכות ארכיטקטוניות ובעלויות הביצועים. עליך לענות על הסעיפים הבאים:",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "פרט את רצף הפעולות המבוצעות על ידי ליבת מערכת ההפעלה בעת החלפת קשר.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "ציין אילו אוגרי מעבד (CPU Registers) ומבני זיכרון מושפעים/מתעדכנים ישירות במהלך החלפת קשר.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "הסבר את השלכות הביצועים של החלפת קשר, בדגש על ה-Translation Lookaside Buffer (TLB) וה-CPU Caches, וכיצד השפעות אלו ממוזערות או מחמירות.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "הצע שני מנגנונים/אופטימיזציות שמערכות הפעלה מפעילות כדי להפחית את עלויות החלפת הקשר, במיוחד בהקשר לביצועי TLB/Cache.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "הסבר מפורט:\n\n1.1. רצף הפעולות המבוצעות על ידי ליבת מערכת ההפעלה:\n    *   **הפסקת התהליך הנוכחי**: החלפת הקשר מתחילה בדרך כלל כתוצאה מהפסקת טיימר (preemption) או קריאת מערכת (system call) שמובילה לחסימת התהליך. המעבד עובר ממצב משתמש למצב ליבה.\n    *   **שמירת הקשר (Context Save)**: ליבת מערכת ההפעלה שומרת את מצבו המלא של התהליך הנוכחי (Process A) אל תוך ה-Process Control Block (PCB) שלו. זה כולל את כל האוגרים הכלליים של המעבד, אוגר מצביע התוכנית (PC), אוגר מצביע המחסנית (SP), אוגר הדגלים, ואוגרים נוספים כמו אוגרי נקודה צפה (FPU) או אוגרי SIMD אם רלוונטיים.\n    *   **בחירת תהליך חדש**: המתזמן (Scheduler) של מערכת ההפעלה בוחר את התהליך הבא להרצה (Process B) מתוך תור התהליכים המוכנים (Ready Queue).\n    *   **עדכון מצבי תהליכים**: מצב התהליך הנוכחי (Process A) משתנה לרוב ל-\"Ready\" או \"Waiting\", ומצב התהליך הנבחר (Process B) משתנה ל-\"Running\".\n    *   **טעינת הקשר (Context Load)**: ליבת מערכת ההפעלה טוענת את מצבו השמור של התהליך החדש (Process B) מתוך ה-PCB שלו אל אוגרי המעבד.\n    *   **עדכון ניהול זיכרון**: אוגר בסיס טבלת הדפים (לדוגמה, CR3 במעבדי x86) מתעדכן כך שיצביע על טבלת הדפים של התהליך החדש. זה משנה את מרחב הכתובות הוירטואלי של המעבד.\n    *   **חזרה למצב משתמש**: המעבד חוזר למצב משתמש (User Mode) וממשיך בביצוע התוכנית של תהליך B מהנקודה בה הופסק בפעם האחרונה.\n\n1.2. אוגרי מעבד ומבני זיכרון מושפעים/מתעדכנים ישירות:\n    *   **אוגרי מעבד כלליים (General-Purpose Registers)**: כל האוגרים המשמשים לאחסון נתונים וכתובות (לדוגמה: EAX, EBX, ECX, EDX, ESI, EDI, EBP, ESP ב-x86).\n    *   **אוגרי בקרה (Control Registers)**: אוגר מצביע התוכנית (PC/EIP), אוגר מצביע המחסנית (SP/ESP), אוגר הדגלים (Flags/EFLAGS). ייתכנו גם אוגרי מצב של יחידת נקודה צפה (FPU) או SIMD.\n    *   **אוגרי ניהול זיכרון**: אוגר בסיס טבלת הדפים (לדוגמה, CR3 ב-x86) מתעדכן לכתובת הפיזית של טבלת הדפים של התהליך החדש.\n    *   **Process Control Block (PCB)**: מבנה נתונים בזיכרון הליבה המכיל את כל המידע על תהליך, כולל הקשר השמור שלו.\n    *   **מחסנית הליבה (Kernel Stack)**: משמשת את הליבה במהלך ביצוע החלפת הקשר עצמה.\n\n1.3. השלכות הביצועים, בדגש על ה-Translation Lookaside Buffer (TLB) וה-CPU Caches:\n    *   **TLB Invalidation/Flush**: כאשר מתבצעת החלפת קשר בין תהליכים שונים, מרחב הכתובות הוירטואלי משתנה. מאחר שכל ערכי ה-TLB (Translation Lookaside Buffer) שייכים למרחב הכתובות של התהליך הקודם, הם הופכים ללא רלוונטיים עבור התהליך החדש. רוב המערכות דורשות \"ניקוי\" (flush) מלא של ה-TLB. פעולה זו יקרה מאוד, שכן לאחר מכן, כל גישת זיכרון וירטואלי חדשה תדרוש \"הליכה\" (walk) בטבלת הדפים שבזיכרון הראשי כדי לתרגם כתובת וירטואלית לפיזית, עד שה-TLB יתמלא מחדש (TLB misses), מה שמאט משמעותית את הביצועים בתחילת ריצת התהליך החדש.\n    *   **\"קאש קר\" (Cold Cache)**: בדומה ל-TLB, גם זיכרונות המטמון של המעבד (L1, L2, L3) מאחסנים נתונים והוראות שהיו בשימוש על ידי התהליך הקודם. כאשר תהליך חדש מתחיל לרוץ, הוא ניגש לנתונים והוראות שונים לחלוטין. הדבר מוביל למספר רב של \"פספוסי מטמון\" (cache misses) בתחילה, מכיוון שהמטמון \"קר\" (אינו מכיל את הנתונים הרלוונטיים לתהליך הנוכחי). טעינת הנתונים החדשים מהזיכרון הראשי למטמון אורכת זמן ופוגעת בביצועים.\n    *   **זמן ליבה (Kernel Overhead)**: הזמן שבו המעבד מבצע את קוד הליבה לצורך שמירה וטעינה של הקשר, בחירת תהליך ועדכוני ניהול זיכרון הוא זמן שאינו מוקדש לעבודת משתמש, ולכן הוא נחשב לעלות תקורה.\n\n1.4. מנגנונים/אופטימיזציות להפחתת עלויות החלפת הקשר (במיוחד TLB/Cache):\n    *   **מזהי מרחב כתובות (ASID - Address Space Identifiers / PCID - Process Context IDs)**: מעבדים מודרניים מספקים תמיכה בחומרה באמצעות ASID או PCID. אלו תגים ייחודיים המצורפים לכל ערך TLB, המזהים לאיזה מרחב כתובות הוא שייך. במקום לבצע ניקוי TLB מלא בעת החלפת קשר, מערכת ההפעלה פשוט מעדכנת את ה-ASID הפעיל. ערכי TLB של תהליכים אחרים עם ASID שונה יכולים להישאר ב-TLB, וכך נמנעת עלות הניקוי המלא וניתן לנצל את ערכי ה-TLB הקיימים עבור תהליכים שרצו לאחרונה.\n    *   **דפים גדולים (Large Pages)**: שימוש בדפי זיכרון בגודל גדול יותר (לדוגמה, 2MB או 1GB במקום 4KB) מפחית את מספר ערכי ה-TLB הנדרשים כדי לכסות את מרחב הכתובות של תהליך. כתוצאה מכך, קטן הסיכוי ל-TLB miss, ופחות דפים צריכים להיות ממופים ב-TLB לאחר flush.\n    *   **תזמון מודע למטמון (Cache-aware Scheduling)**: המתזמן יכול לנסות להחזיר תהליך לאותו ליבה עליו רץ קודם לכן, או לליבה קרובה אליו מבחינת היררכיית המטמון. זה מגדיל את הסיכוי שהנתונים וההוראות של התהליך עדיין נמצאים במטמון של הליבה, ובכך מפחית את עלויות ה-\"קאש קר\"."
    },
    "difficulty_estimation": "Hard"
  }
}