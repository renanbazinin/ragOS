{
  "metadata": {
    "source": "ai_generated",
    "topic_hint": "Memory Management",
    "requested_type": "MultipleChoice",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 21:34:53",
    "examples_used": 2,
    "token_usage": {
      "prompt_tokens": 969,
      "output_tokens": 2206,
      "total_tokens": 11332
    },
    "subject": "Virtualization"
  },
  "question": {
    "id": 1,
    "type": "MultipleChoice",
    "topic": [
      "Memory Management",
      "Paging",
      "TLB",
      "Page Faults",
      "Page Table Walk"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם כתובות וירטואליות בנות 32 ביטים וגודל דף של 4KB. טבלת הדפים היא דו-מפלסית, כאשר כל כניסה בטבלת דפים (PTE) היא בגודל 4 בתים. ה-TLB במערכת הינו בגודל 128 כניסות, אסוציאטיבי מלא (fully associative) ומשתמש במדיניות החלפה LRU. ה-TLB ריק בתחילת הריצה.\n\nתהליך מבצע את הלולאה הבאה:\n```c\nint arr[1024 * 1024 * 2]; // 2M integers\nfor (int i = 0; i < 1024 * 1024 * 2; i++) {\n    arr[i] = i;\n}\n```\nהנח כי הזיכרון הפיזי ריק בתחילת הריצה, וכי המערך `arr` ממוקם בכתובת וירטואלית המתחילה ביישור של דף (page-aligned). כמה אירועים מכל סוג יתרחשו במהלך ביצוע הלולאה?",
      "code_snippet": "int arr[1024 * 1024 * 2];\nfor (int i = 0; i < 1024 * 1024 * 2; i++) {\n    arr[i] = i;\n}",
      "options": [
        "א. 2048 Page Faults, 2048 TLB Misses, 2048 גישות לטבלת דפים (P1) ו-2048 גישות לטבלת דפים (P2).",
        "ב. 2048 Page Faults, 2048 TLB Misses, 2 גישות לטבלת דפים (P1) ו-2048 גישות לטבלת דפים (P2).",
        "ג. 2048 Page Faults, 2048 TLB Misses, 4096 גישות לטבלת דפים (סה\"כ).",
        "ד. 2048 Page Faults, 2048 * 1024 TLB Misses, 4096 גישות לטבלת דפים (סה\"כ).",
        "ה. אף אחת מהתשובות אינה נכונה."
      ]
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": "א",
      "explanation": "ניתוח המערכת:\n*   **גודל כתובת וירטואלית:** 32 ביטים.\n*   **גודל דף:** 4KB = 2^12 בתים. לכן, 12 הביטים הפחות משמעותיים (LSB) של הכתובת הווירטואלית הם ה-offset בתוך הדף.\n*   **מספר ביטים ל-VPN (Virtual Page Number):** 32 - 12 = 20 ביטים.\n*   **טבלת דפים דו-מפלסית:** כל כניסה בטבלת דפים (PTE) היא 4 בתים. גודל דף הוא 4KB. לכן, כל טבלת דפים (מפלס 1 או מפלס 2) יכולה להכיל `4096 / 4 = 1024` כניסות.\n    *   `log2(1024) = 10` ביטים. לכן, 10 הביטים הבאים משמשים לאינדקס בטבלת הדפים מפלס 2 (P2), ו-10 הביטים העליונים משמשים לאינדקס בטבלת הדפים מפלס 1 (P1). (P1: 10 ביטים, P2: 10 ביטים, Offset: 12 ביטים).\n\n*   **המערך `arr`:** מכיל `2 * 1024 * 1024` אינטגרים. כל אינטגר הוא 4 בתים.\n    *   גודל המערך הכולל: `2 * 1024 * 1024 * 4` בתים = `8MB`.\n    *   מספר הדפים שהמערך תופס: `8MB / 4KB לדף` = `2048` דפים.\n    *   כל דף מכיל `4KB / 4B לאינטגר` = `1024` אינטגרים.\n*   **גישה למערך:** הלולאה ניגשת לכל אלמנט במערך באופן סדרתי. סך הגישות: `2048 * 1024`.\n*   **TLB:** בגודל 128 כניסות, אסוציאטיבי מלא, LRU, ריק בתחילה.\n\n**חישובים:**\n1.  **Page Faults:**\n    *   המערך משתרע על פני 2048 דפים ייחודיים.\n    *   מכיוון שהזיכרון הפיזי ריק בתחילת הריצה, הגישה הראשונה לכל אחד מ-2048 הדפים הללו תגרום לפסיקת דף (Page Fault).\n    *   **סה\"כ Page Faults: 2048.**\n\n2.  **TLB Misses:**\n    *   עבור כל אחד מ-2048 הדפים הייחודיים, הגישה הראשונה לאינטגר כלשהו באותו דף תגרום ל-TLB Miss.\n    *   לאחר ה-TLB Miss, הכניסה לדף תוכנס ל-TLB. בתוך כל דף ישנם 1024 אינטגרים. לאחר הגישה הראשונה (שהיא Miss), 1023 הגישות הבאות לאינטגרים באותו דף יהיו TLB Hits.\n    *   מדיניות ה-LRU ב-TLB בגודל 128 כניסות: מכיוון שיש 2048 דפים ייחודיים ורק 128 כניסות ב-TLB, ה-TLB יתמלא ויתחיל להחליף כניסות. בגישה סדרתית, בכל פעם שניגשים לדף חדש שאינו ב-TLB (כלומר, הגישה הראשונה לכל אחד מ-2048 הדפים), תתרחש TLB Miss. הגישות הבאות לאותו דף יהיו Hits עד שהדף יוחלף. (הערה: הגישה הראשונה לכל דף תהיה TLB miss, אך כל 1023 הגישות הבאות לאותו דף יהיו TLB hit, כל עוד הדף לא יוחלף מה-TLB. אך מכיוון שעל כל 128 דפים יש החלפה, עדיין רק הגישה הראשונה לכל דף תגרום ל-miss). \n    *   **סה\"כ TLB Misses: 2048** (אחת לכל דף ייחודי).\n\n3.  **גישות לטבלת הדפים (Page Table Accesses):**\n    *   כל TLB Miss גורם לביצוע Page Table Walk.\n    *   **סה\"כ Page Table Walks: 2048.**\n    *   בטבלת דפים דו-מפלסית, כל Page Table Walk דורש שתי גישות לזיכרון:\n        1.  גישה לטבלת הדפים מפלס 1 (P1) כדי למצוא את הבסיס של טבלת הדפים מפלס 2.\n        2.  גישה לטבלת הדפים מפלס 2 (P2) כדי למצוא את ה-PTE של הדף המבוקש.\n    *   המערך משתרע על 2048 דפים. כל טבלת דפים מפלס 2 יכולה למפות 1024 דפים (4MB). לכן, המערך משתרע על פני שתי טבלאות דפים מפלס 2 (ולכן שתי כניסות P1 שונות).\n    *   עבור כל אחד מ-2048 ה-TLB Misses, תבוצע גישה אחת ל-P1 וגישה אחת ל-P2.\n    *   **סה\"כ גישות לטבלת דפים מפלס 1 (P1): 2048.**\n    *   **סה\"כ גישות לטבלת דפים מפלס 2 (P2): 2048.**\n\nלפי החישובים, התשובה המתאימה ביותר היא א'."
    },
    "difficulty_estimation": "Hard"
  }
}