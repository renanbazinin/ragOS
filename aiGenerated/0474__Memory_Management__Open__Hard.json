{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:27:49",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 3412,
      "total_tokens": 16757
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "Virtual Memory",
      "Paging",
      "TLB",
      "Page Faults"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המממשת זיכרון וירטואלי באמצעות דפדוף (paging) רב-שכבתי (multi-level paging). פרטי המערכת הם כדלקמן:\n*   מרחב כתובות וירטואלי: 48 ביטים.\n*   מרחב כתובות פיזי: 40 ביטים.\n*   גודל דף: 4KB.\n*   גודל כניסה בטבלת דפים (PTE): 8 בתים.\n\nבנוסף, המערכת משתמשת ב-Translation Lookaside Buffer (TLB) בעל המאפיינים הבאים:\n*   מספר כניסות כולל: 16.\n*   אסוציאטיביות: 4-way set associative.\n*   מדיניות החלפה: LRU (בתוך כל סט).\n*   אינדקס ה-TLB נגזר משני הביטים הפחות משמעותיים (LSB) של מספר הדף הווירטואלי (VPN) המלא.\n\nנתון תהליך המנסה לגשת לראשונה לכתובת הווירטואלית `0x0000_1234_5678_9ABC`.\nהניחו כי טבלאות הדפים של התהליך ריקות לחלוטין (כלומר, כל ביט Valid ב-PTE הוא 0 עבור כל הרמות), וה-TLB ריק לחלוטין לפני הגישה.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "כמה רמות של טבלאות דפים יש במערכת זו? כמה כניסות (PTEs) יכולה להכיל כל טבלת דפים ברמה אחת?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "תארו בפירוט את כל השלבים המתבצעים במערכת (חומרה ותוכנה) מרגע ניסיון הגישה לכתובת הווירטואלית `0x0000_1234_5678_9ABC` ועד להשלמתה או לטיפול בפסיקה. יש לכלול את כל הגישות ל-TLB, לזיכרון הראשי (RAM) ולזיכרון המשני (דיסק), ואת העדכונים הנדרשים (ל-TLB ולטבלאות הדפים). הניחו שנדרשת טעינת דף מהדיסק, וכי זיכרון ה-RAM מלא, כך שיש צורך לפנות דף קיים לדיסק.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "כמה גישות לזיכרון הראשי (RAM), לזיכרון המשני (דיסק), ול-TLB בסך הכל מתבצעות עבור תרגום כתובת יחידה זו, בהתאם לתיאורכם בסעיף ב'?",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון:\n\n**סעיף 1.1:**\n*   **חישוב גודל היסט הדף (Offset):** גודל דף הוא 4KB = 2^12 בתים. לכן, ההיסט בכתובת הוא 12 ביטים.\n*   **חישוב מספר ביטים של Virtual Page Number (VPN):** מרחב כתובות וירטואלי הוא 48 ביטים. VPN = 48 - 12 = 36 ביטים.\n*   **חישוב מספר כניסות לטבלת דפים ברמה אחת:** כל טבלת דפים מאוחסנת בדף אחד (4KB). גודל כניסה בטבלת דפים (PTE) הוא 8 בתים. לכן, מספר הכניסות בכל טבלת דפים הוא 4KB / 8 בתים = 4096 כניסות (2^12).\n*   **חישוב מספר ביטים שכל רמה בטבלת הדפים ממפה:** כל רמה ממפה 12 ביטים (log2(4096)).\n*   **חישוב מספר רמות:** מספר ביטים של VPN הוא 36. כל רמה ממפה 12 ביטים. לכן, מספר הרמות הוא 36 / 12 = 3 רמות.\n\n**תשובה:** ישנן 3 רמות של טבלאות דפים במערכת. כל טבלת דפים ברמה אחת יכולה להכיל 4096 כניסות.\n\n**סעיף 1.2:**\nהכתובת הווירטואלית היא `0x0000_1234_5678_9ABC`.\n*   **היסט (Offset):** 12 הביטים הפחות משמעותיים: `0x9ABC`.\n*   **מספר הדף הווירטואלי (VPN):** 36 הביטים הנותרים: `0x0000_1234_5678`.\n    *   P1 (אינדקס לרמה 1): 12 הביטים העליונים של ה-VPN: `0x000`.\n    *   P2 (אינדקס לרמה 2): 12 הביטים הבאים של ה-VPN: `0x123`.\n    *   P3 (אינדקס לרמה 3): 12 הביטים התחתונים של ה-VPN: `0x456`.\n*   **אינדקס TLB:** שני הביטים הפחות משמעותיים של ה-VPN (0x0000_1234_5678 בבינארי מסתיים ב-`00`). לכן, אינדקס ה-TLB הוא `00`.\n*   **תג TLB (Tag):** 34 הביטים הנותרים של ה-VPN.\n\n**שלבי הגישה:**\n1.  **חיפוש ב-TLB (חומרה):** ה-MMU מחלצת את ה-VPN ומחשבת את אינדקס ה-TLB (`00`). היא בודקת בסט 00 של ה-TLB האם יש כניסה עם התג המתאים (ה-34 ביטים הנותרים של ה-VPN) וביט Valid דולק. מכיוון שה-TLB ריק, מתרחש **TLB Miss**.\n    *   (1 גישה ל-TLB)\n\n2.  **מעבר על טבלאות הדפים (Page Table Walk - חומרה):** מכיוון שה-TLB Miss, ה-MMU מתחילה בחיפוש בטבלאות הדפים בזיכרון הראשי (RAM) כדי למצוא את ה-PFN המתאים. הניחו שכתובת הבסיס של טבלת הדפים הראשית (P1) נמצאת ברגיסטר CR3.\n    *   **גישה לרמה 1 (P1):** ה-MMU ניגשת לכתובת `CR3 + (P1 * PTE_size)` כדי לקרוא את ה-PTE עבור P1 (`0x000`). מכיוון שכל טבלאות הדפים ריקות (Valid=0), ה-PTE עבור `0x000` יהיה לא חוקי.\n        *   (1 גישה ל-RAM)\n    *   **התרחשות Page Fault:** ה-MMU מזהה שה-PTE אינו חוקי (Valid=0) ומאותת למעבד על **Page Fault**.\n\n3.  **טיפול ב-Page Fault (תוכנה - מערכת ההפעלה):**\n    *   מערכת ההפעלה מקבלת את פסיקת ה-Page Fault. היא מזהה שהדף הווירטואלי `0x0000_1234_5678` אינו קיים בזיכרון הפיזי וגם טבלאות הדפים המובילות אליו אינן מאותחלות.\n    *   **הקצאת דפי טבלאות דפים:** מערכת ההפעלה מקצה דפי זיכרון פיזיים חדשים עבור טבלאות הדפים ברמות P1, P2 ו-P3 (אם הן טרם הוקצו). כיוון שהן ריקות לחלוטין, יש צורך להקצות 3 דפים חדשים ב-RAM עבור טבלאות P1, P2 ו-P3.\n        *   (3 גישות ל-RAM: כתיבה ל-PTE בטבלת P1, כתיבה ל-PTE בטבלת P2, כתיבה ל-PTE בטבלת P3, כדי לעדכן את המצביעים לדפי הטבלאות הבאות ולדף הנתונים).\n    *   **טיפול בדף הנתונים:** מערכת ההפעלה מזהה שגם דף הנתונים עצמו (הדף הממופה ל-VPN `0x0000_1234_5678`) אינו נמצא ב-RAM.\n        *   **פינוי דף קיים (Page-out):** מכיוון שזיכרון ה-RAM מלא, מערכת ההפעלה בוחרת דף קורבן (לפי מדיניות החלפת דפים כלשהי, למשל LRU גלובלי). אם דף הקורבן 'מלוכלך' (Dirty=1), הוא נכתב לדיסק.\n            *   (1 גישה לדיסק: כתיבה של דף קורבן)\n        *   **טעינת הדף המבוקש (Page-in):** מערכת ההפעלה קוראת את דף הנתונים עבור הכתובת הווירטואלית `0x0000_1234_5678` מהדיסק ומטעינה אותו למסגרת הפיזית שהתפנתה (או חדשה).\n            *   (1 גישה לדיסק: קריאה של הדף המבוקש)\n        *   **עדכון טבלת הדפים:** מערכת ההפעלה מעדכנת את ה-PTE המתאים בטבלת הדפים ברמה P3 (עבור P3=`0x456`) עם מספר המסגרת הפיזית (PFN) של הדף החדש, ומגדירה את ביט Valid ל-1, את ביט Dirty ל-0 ואת ביט Access ל-1.\n            *   (1 גישה ל-RAM: כתיבת PTE מעודכן לטבלת P3).\n\n4.  **עדכון TLB (מערכת הפעלה/חומרה):** לאחר שהדף נטען וטבלאות הדפים עודכנו, מערכת ההפעלה מוסיפה את המיפוי החדש (VPN -> PFN) ל-TLB. אם הסט המתאים ב-TLB (סט `00`) מלא, הכניסה ה'פחות בשימוש לאחרונה' (LRU) מוחלפת.\n\n5.  **הפעלה מחדש של הפקודה (חומרה):** הפקודה שגרמה ל-Page Fault מופעלת מחדש.\n    *   **חיפוש חוזר ב-TLB:** ה-MMU שוב מחפשת את ה-VPN ב-TLB. הפעם, המיפוי קיים ומתרחש **TLB Hit**.\n        *   (1 גישה ל-TLB)\n    *   **בניית כתובת פיזית וגישה לנתונים:** ה-MMU מקבלת את ה-PFN מה-TLB, משלבת אותו עם ההיסט (`0x9ABC`) ויוצרת את הכתובת הפיזית. לבסוף, היא ניגשת לזיכרון הראשי כדי לבצע את פעולת ה-read/write המקורית על הנתונים.\n        *   (1 גישה ל-RAM: לנתונים עצמם).\n\n**סעיף 1.3:**\nבהתאם לתיאור המפורט בסעיף ב', סך הגישות עבור תרגום כתובת יחידה זו (כולל הגישה לנתונים עצמם) הן:\n*   **גישות ל-TLB:** 2 (אחת ל-TLB Miss, אחת ל-TLB Hit לאחר הטיפול ב-Page Fault).\n*   **גישות לזיכרון הראשי (RAM):**\n    *   1 (קריאת PTE ראשונית בטבלת P1).\n    *   3 (כתיבת PTEs לעדכון טבלאות P1, P2, P3 במהלך הטיפול ב-Page Fault - יצירת מצביעים לטבלאות הבאות ולדף הנתונים).\n    *   1 (כתיבת PTE מעודכן לטבלת P3 עבור דף הנתונים).\n    *   1 (גישה לנתונים עצמם לאחר התרגום המוצלח).\n    *   **סה\"כ גישות ל-RAM:** 1 + 3 + 1 + 1 = 6 גישות.\n\n*   **גישות לזיכרון המשני (דיסק):**\n    *   1 (כתיבת דף קורבן לדיסק – Page-out).\n    *   1 (קריאת הדף המבוקש מהדיסק – Page-in).\n    *   **סה\"כ גישות לדיסק:** 2 גישות.\n\n**סיכום:**\n*   **TLB:** 2 גישות\n*   **RAM:** 6 גישות\n*   **דיסק:** 2 גישות"
    },
    "difficulty_estimation": "Hard"
  }
}