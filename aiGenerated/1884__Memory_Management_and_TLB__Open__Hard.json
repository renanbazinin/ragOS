{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 21:29:22",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 4578,
      "total_tokens": 14430
    }
  },
  "question": {
    "id": 7,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory"
    ],
    "content": {
      "text": "נתונה מערכת מחשב עם המאפיינים הבאים:\n*   מרחב כתובות וירטואלי (VA) בגודל 48 ביטים.\n*   מרחב כתובות פיזי (PA) בגודל 40 ביטים.\n*   גודל דף (Page Size) הוא 8KB.\n*   כל כניסה בטבלת הדפים (PTE) היא בגודל 8 בתים (64 ביטים).\n*   מנגנון ניהול הזיכרון משתמש בטבלאות דפים מרובות רמות (multi-level page tables).\n*   ה-TLB (Translation Lookaside Buffer) מכיל 256 כניסות והוא 4-way set associative.\n*   זמן גישה ל-TLB (במקרה של פגיעה - hit) הוא 1 ננו-שנייה.\n*   זמן גישה לזיכרון הראשי הוא 100 ננו-שניות.\n*   זמן טיפול בפסיקת דף (page fault), כולל קריאה מהדיסק ועדכונים נדרשים, הוא 10 מילי-שניות.\n\n",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "7.1",
        "text": "1. מבנה הכתובת וטבלאות הדפים:\n   א. כמה ביטים מוקצים ל-offset בכתובת הוירטואלית?\n   ב. בהתחשב בגודל ה-PTE ובגודל הדף, כמה כניסות (PTEs) יכולות להכיל כל טבלת דפים ברמה אחת?\n   ג. כמה רמות של טבלאות דפים נדרשות למיפוי מרחב הכתובות הוירטואלי, וכיצד יחולקו ביטי ה-VPN בין הרמות השונות?\n",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.2",
        "text": "2. תהליך תרגום כתובת:\n   תאר בפירוט את רצף הפעולות המלא לתרגום כתובת וירטואלית לכתובת פיזית, החל מהגישה ל-TLB ועד לגישה לזיכרון הראשי, בהנחה שאין Page Fault ושה-PTE הסופי נמצא בזיכרון הראשי (כלומר, TLB miss אך Page Table hit).\n",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.3",
        "text": "3. זמן גישה אפקטיבי (EAT):\n   חשב את זמן הגישה האפקטיבי הממוצע (Effective Access Time - EAT) לזיכרון, בהינתן הנתונים הבאים:\n   *   אחוז פגיעות ב-TLB (TLB hit rate): 98%\n   *   אחוז פגיעות בדפי הזיכרון (Page table hit rate, כלומר, ה-PTE הסופי נמצא בזיכרון הראשי): 99.9% (מתוך הגישות שלא היו TLB hit)\n   *   אחוז פסיקות דף (Page Fault rate, כלומר, ה-PTE הסופי אינו נמצא בזיכרון הראשי): 0.1% (מתוך הגישות שלא היו TLB hit ולא היו Page Table hit)\n    *   הערה: יש להניח כי כל גישה לזיכרון (בין אם לטבלת דפים ובין אם לנתונים) אורכת את זמן הגישה לזיכרון הראשי.\n",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.4",
        "text": "4. עקביות TLB וטבלאות דפים (Hard Twist):\n   תהליך מסוים ניגש לכתובת וירטואלית. ה-TLB מצביע על פגיעה (hit) עבור כתובת זו, ומחזיר מספר מסגרת פיזית. אולם, כאשר מערכת ההפעלה ניגשת ל-PTE המתאים בזיכרון הראשי (כדי לאמת או לעדכן דגלים), מתגלה כי ביט ה-Present (או Valid) ב-PTE זה הוא 0, למרות שה-TLB הצביע על כניסה חוקית.\n   א. תאר מצב ספציפי שיכול להוביל לתרחיש כזה.\n   ב. הסבר כיצד מערכת ההפעלה צריכה לטפל במצב זה, ומהן ההשלכות מבחינת עקביות הנתונים ומנגנוני הזיכרון.\n",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": false,
      "correct_option": null,
      "explanation": "פתרון לשאלה:\n\n1. מבנה הכתובת וטבלאות הדפים:\n   א. גודל דף הוא 8KB = 2^13 בתים. לכן, ה-offset דורש 13 ביטים.\n   ב. גודל דף הוא 8KB = 8192 בתים. גודל כניסה בטבלת הדפים (PTE) הוא 8 בתים.\n      מספר כניסות לדף בודד של טבלת דפים: 8192 בתים / 8 בתים/PTE = 1024 כניסות.\n   ג. מרחב הכתובות הוירטואלי הוא 48 ביטים. ה-offset הוא 13 ביטים.\n      מספר ביטים עבור ה-VPN (Virtual Page Number) הוא 48 - 13 = 35 ביטים.\n      כל טבלת דפים יכולה להכיל 1024 כניסות, כלומר 2^10 כניסות. לכן, כל אינדקס לרמה בטבלת הדפים הוא בגודל 10 ביטים.\n      נצטרך לחלק את 35 ביטי ה-VPN למספר רמות של 10 ביטים:\n      35 / 10 = 3 עם שארית 5.\n      לכן, נצטרך 4 רמות של טבלאות דפים:\n      *   רמה 1: 5 ביטים (האינדקס העליון ביותר)\n      *   רמה 2: 10 ביטים\n      *   רמה 3: 10 ביטים\n      *   רמה 4: 10 ביטים\n      סה\"כ 5 + 10 + 10 + 10 = 35 ביטים ל-VPN.\n\n2. תהליך תרגום כתובת:\n   בהנחה שאין Page Fault ו-TLB miss אך Page Table hit:\n   1.  המעבד מפיק כתובת וירטואלית בת 48 ביטים.\n   2.  החומרה מנסה לחפש את ה-VPN של הכתובת ב-TLB. מכיוון שה-TLB הוא 4-way set associative, ה-VPN מחולק ל-tag ו-index. ה-index משמש לבחירת ה-set המתאים, ולאחר מכן ה-tag מושווה ל-tags של הכניסות ב-set. במקרה זה, מתרחש TLB miss.\n   3.  לאחר TLB miss, החומרה מתחילה ב\"הליכת טבלת דפים\" (Page Table Walk).\n   4.  המעבד משתמש באינדקסים של ה-VPN (שחולק ל-4 חלקים כמו בסעיף 1ג) כדי לגשת לטבלאות הדפים בזיכרון הראשי.\n      *   האינדקס הראשון (5 ביטים) משמש כדי למצוא את ה-PTE של טבלת הרמה הראשונה (PT1). גישה זו דורשת גישה לזיכרון הראשי.\n      *   ה-PFN (מספר מסגרת פיזית) מה-PTE של PT1 משמש ככתובת הבסיס לטבלת הרמה השנייה (PT2). האינדקס השני (10 ביטים) משמש למצוא את ה-PTE של PT2. גישה זו דורשת גישה שנייה לזיכרון הראשי.\n      *   ה-PFN מה-PTE של PT2 משמש ככתובת הבסיס לטבלת הרמה השלישית (PT3). האינדקס השלישי (10 ביטים) משמש למצוא את ה-PTE של PT3. גישה זו דורשת גישה שלישית לזיכרון הראשי.\n      *   ה-PFN מה-PTE של PT3 משמש ככתובת הבסיס לטבלת הרמה הרביעית (PT4). האינדקס הרביעי (10 ביטים) משמש למצוא את ה-PTE הסופי של הדף המבוקש. גישה זו דורשת גישה רביעית לזיכרון הראשי.\n   5.  ה-PTE הסופי (מ-PT4) מכיל את ה-PFN של הדף הפיזי המבוקש. מוודאים שביט ה-Present/Valid ב-PTE זה הוא 1.\n   6.  ה-PFN המתקבל משולב עם ה-offset (13 ביטים) ליצירת הכתובת הפיזית הסופית (40 ביטים).\n   7.  ה-VPN וה-PFN של ה-PTE הסופי נטענים ל-TLB כדי לזרז גישות עתידיות לאותו דף.\n   8.  המעבד ניגש לכתובת הפיזית בזיכרון הראשי כדי לאחזר את הנתונים המבוקשים. גישה זו היא הגישה החמישית לזיכרון הראשי.\n   סה\"כ 5 גישות לזיכרון הראשי (4 עבור הליכת טבלת הדפים + 1 עבור הנתונים עצמם).\n\n3. זמן גישה אפקטיבי (EAT):\n   *   TLB hit time (T_TLB_hit) = 1 ns\n   *   Memory access time (T_mem) = 100 ns\n   *   Page fault service time (T_pf) = 10 ms = 10,000,000 ns\n\n   EAT = (TLB hit rate * (T_TLB_hit + T_mem)) +\n         (TLB miss rate * Page table hit rate * (Number_of_PT_accesses_on_miss * T_mem + T_mem)) +\n         (TLB miss rate * Page fault rate * (Number_of_PT_accesses_until_PF_discovery * T_mem + T_pf))\n\n   נתונים:\n   *   TLB hit rate (H_TLB) = 0.98\n   *   TLB miss rate (M_TLB) = 1 - 0.98 = 0.02\n   *   Page table hit rate (H_PT) = 0.999 (מתוך הגישות שהיו TLB miss)\n   *   Page fault rate (M_PT) = 0.001 (מתוך הגישות שהיו TLB miss)\n\n   מספר גישות זיכרון עבור TLB miss, Page table hit:\n   הליכת טבלת דפים ברמה 4 דורשת 4 גישות לזיכרון הראשי. \n   לאחר מכן, יש גישה לנתונים עצמם. סה\"כ 4 + 1 = 5 גישות לזיכרון הראשי.\n   זמן כולל במקרה זה = (4 * 100 ns) + 100 ns = 500 ns.\n\n   מספר גישות זיכרון עבור TLB miss, Page fault:\n   הליכת טבלת דפים ברמה 4 דורשת 4 גישות לזיכרון הראשי עד לגילוי ה-page fault.\n   לאחר מכן, יש את זמן הטיפול בפסיקת הדף (T_pf).\n   זמן כולל במקרה זה = (4 * 100 ns) + 10,000,000 ns = 400 ns + 10,000,000 ns = 10,000,400 ns.\n\n   נחשב את ה-EAT:\n   EAT = (0.98 * (1 ns + 100 ns)) +\n         (0.02 * 0.999 * (500 ns)) +\n         (0.02 * 0.001 * (10,000,400 ns))\n\n   EAT = (0.98 * 101 ns) + (0.01998 * 500 ns) + (0.00002 * 10,000,400 ns)\n   EAT = 98.98 ns + 9.99 ns + 200.008 ns\n   EAT = 308.978 ns\n\n   זמן הגישה האפקטיבי הוא כ-308.98 ננו-שניות.\n\n4. עקביות TLB וטבלאות דפים (Hard Twist):\n   א. מצב ספציפי שיכול להוביל לתרחיש כזה:\n      תרחיש כזה מתרחש כאשר כניסה ב-TLB (TLB entry) אינה עקבית עם ה-PTE המקביל בטבלת הדפים בזיכרון הראשי. זה יכול לקרות במקרים הבאים:\n      *   החלפת דף (Page Replacement): מערכת ההפעלה החליטה לפנות דף מהזיכרון הפיזי (לשלוח אותו לדיסק) כדי לפנות מקום לדף אחר. בתהליך זה, היא מעדכנת את ה-PTE המתאים בטבלת הדפים בזיכרון הראשי, ומסמנת את ביט ה-Present (או Valid) כ-0. עם זאת, אם ה-TLB עדיין מכיל כניסה עבור דף זה, והיא לא בוטלה (invalidated) או נוקתה (flushed), אזי ה-TLB יצביע על פגיעה חוקית (hit) למרות שהדף כבר לא בזיכרון. ה-TLB בדרך כלל לא מכיל את ה-Present bit בעצמו (אלא רק את המיפוי VPN ל-PFN), אך הוא נטען מ-PTE חוקי. אם ה-PTE בזיכרון הראשי השתנה מאז שה-TLB entry נוצר, תיווצר אי-עקביות.\n      *   שינוי הרשאות גישה: מערכת ההפעלה שינתה את הרשאות הגישה לדף (לדוגמה, מקריאה/כתיבה לקריאה בלבד) ועדכנה את ה-PTE בזיכרון הראשי, אך לא ביטלה את הכניסה ב-TLB. למרות שהשאלה מציינת Present=0, שינוי הרשאות יכול להוביל לבעיות עקביות דומות.\n      *   שגיאה בטיפול במערכת ההפעלה: במקרים נדירים, ייתכן שמערכת ההפעלה לא ביצעה TLB invalidate/flush לאחר פעולה ששינתה את ה-PTE בזיכרון הראשי.\n\n   ב. טיפול מערכת ההפעלה והשלכות:\n      כאשר מתגלה חוסר עקביות כזה (TLB hit אך PTE.Present=0), מערכת ההפעלה חייבת לטפל בכך כדלקמן:\n      1.  זיהוי חוסר עקביות: המעבד, לאחר קבלת ה-PFN מה-TLB, ינסה לגשת לזיכרון הפיזי. אולם, לפני גישה לנתונים, מערכת ההפעלה (או חומרת ניהול הזיכרון) בדרך כלל תאמת את ה-PTE בזיכרון הראשי. אם ביט ה-Present ב-PTE האמיתי (בטבלת הדפים בזיכרון הראשי) הוא 0, זה מצביע על Page Fault.\n      2.  התייחסות כאל Page Fault: המערכת תטפל באירוע כ-Page Fault לכל דבר ועניין. גם אם ה-TLB הצביע על מיפוי, המיפוי הזה אינו תקף יותר.\n      3.  TLB Invalidation: מערכת ההפעלה תבצע invalidate (ביטול) לכניסה הספציפית ב-TLB עבור ה-VPN המדובר. זה חיוני כדי למנוע גישות עתידיות לאותו מיפוי שגוי.\n      4.  טיפול בפסיקת הדף: כמו בכל Page Fault, מערכת ההפעלה תבחר דף אחר לפנות מהזיכרון הפיזי (אם אין מקום פנוי), תטען את הדף המבוקש מהדיסק לזיכרון הפיזי, תעדכן את ה-PTE המתאים בטבלת הדפים בזיכרון הראשי (לסמן Present=1 ולעדכן את ה-PFN), ורק אז תאפשר לפקודה המקורית שגרמה לפסיקה להתבצע מחדש.\n      5.  השלכות:\n          *   ירידה בביצועים: התרחיש גורם ל-Page Fault, שהוא פעולה יקרה מאוד מבחינת זמן (גישה לדיסק). זה פוגע בביצועי המערכת.\n          *   צורך במנגנוני עקביות: המקרה מדגיש את החשיבות של מנגנוני TLB invalidation. בכל פעם שמערכת ההפעלה משנה PTE בזיכרון הראשי (לדוגמה, בגלל החלפת דף), היא חייבת לבטל את הכניסה המתאימה ב-TLB (אם קיימת) כדי לשמור על עקביות. אם היא לא עושה זאת, ייתכנו שגיאות קריטיות או כשלים (למשל, גישה לזיכרון שאינו מוקצה, או קריאת נתונים שגויים).\n          *   מורכבות OS: מנגנוני TLB Invalidation מוסיפים מורכבות למערכת ההפעלה, במיוחד במערכות מרובות מעבדים (Multi-core) שבהן ייתכן שיהיה צורך לבטל כניסות TLB במספר מעבדים."
    },
    "difficulty_estimation": "Hard"
  }
}