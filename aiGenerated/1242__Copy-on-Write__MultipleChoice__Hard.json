{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Copy-on-Write",
    "requested_type": "MultipleChoice",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 08:55:05",
    "examples_used": 2,
    "token_usage": {
      "prompt_tokens": 972,
      "output_tokens": 1365,
      "total_tokens": 5604
    }
  },
  "question": {
    "id": 1,
    "type": "MultipleChoice",
    "topic": [
      "Copy-on-Write",
      "Virtual Memory",
      "Process Management"
    ],
    "content": {
      "text": "תהליך אב (P) מקצה דף זיכרון בגודל 4KB ומאתחל אותו בנתונים מסוימים. לאחר מכן, P מבצע `fork()` ליצירת תהליך בן C1. מיד לאחר מכן, C1 מבצע `fork()` ליצירת תהליך בן C2. כל התהליכים (P, C1, C2) משתמשים במנגנון Copy-on-Write (COW) עבור דפים משותפים. בשלב הבא, מתבצעות הפעולות הבאות בסדר כרונולוגי:\n1. תהליך P כותב לכתובת כלשהי בתוך הדף המקורי.\n2. תהליך C1 כותב לכתובת כלשהי בתוך הדף המקורי (אותו דף וירטואלי).\n3. תהליך C2 כותב לכתובת כלשהי בתוך הדף המקורי (אותו דף וירטואלי).\n\nכמה דפים פיזיים יוקצו בסך הכל עבור הנתונים המקוריים של הדף הזה, לאחר סיום כל הפעולות? (בהנחה שהדף הפיזי המקורי נשאר בשימוש כל עוד יש לו הפניות).",
      "code_snippet": null,
      "options": [
        "א. 1",
        "ב. 2",
        "ג. 3",
        "ד. 4",
        "ה. תלוי בסדר הכתיבות הפנימיות בתוך כל תהליך."
      ]
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": "ד",
      "explanation": "הבה ננתח את המצב של הדף הפיזי המקורי ואת יצירת העותקים:\n1.  **מצב התחלתי:** תהליך P מקצה דף זיכרון ומאתחל אותו. קיים דף פיזי אחד (נכנה אותו `Page_Orig`) עם מונה הפניות (reference count) של 1. ה-PTE (Page Table Entry) של P מצביע על `Page_Orig` עם סימון COW (Copy-on-Write).\n2.  **P מבצע `fork()` ל-C1:** C1 נוצר. ה-PTE של C1 עבור הדף מצביע גם הוא על `Page_Orig` עם סימון COW. מונה ההפניות של `Page_Orig` עולה ל-2.\n3.  **C1 מבצע `fork()` ל-C2:** C2 נוצר. ה-PTE של C2 עבור הדף מצביע גם הוא על `Page_Orig` עם סימון COW. מונה ההפניות של `Page_Orig` עולה ל-3.\n    בשלב זה, P, C1 ו-C2 כולם חולקים את `Page_Orig` באופן וירטואלי.\n4.  **P כותב לדף:** מכיוון שה-PTE של P מסומן ב-COW, פעולת כתיבה גורמת ל-Page Fault. מערכת ההפעלה יוצרת עותק חדש של `Page_Orig` (נקרא לו `Page_P`). ה-PTE של P מתעדכן להצביע על `Page_P` (ללא סימון COW). מונה ההפניות של `Page_Orig` יורד ל-2 (כי C1 ו-C2 עדיין מצביעים אליו). כעת קיימים שני דפים פיזיים: `Page_Orig` (משותף ל-C1, C2) ו-`Page_P` (פרטי ל-P).\n5.  **C1 כותב לדף:** ה-PTE של C1 עדיין מצביע על `Page_Orig` ומסומן ב-COW. פעולת כתיבה גורמת ל-Page Fault. מערכת ההפעלה יוצרת עותק חדש של `Page_Orig` (נקרא לו `Page_C1`). ה-PTE של C1 מתעדכן להצביע על `Page_C1` (ללא סימון COW). מונה ההפניות של `Page_Orig` יורד ל-1 (כי רק C2 עדיין מצביע אליו). כעת קיימים שלושה דפים פיזיים: `Page_Orig` (משותף ל-C2), `Page_P` (פרטי ל-P) ו-`Page_C1` (פרטי ל-C1).\n6.  **C2 כותב לדף:** ה-PTE של C2 עדיין מצביע על `Page_Orig` ומסומן ב-COW. פעולת כתיבה גורמת ל-Page Fault. מערכת ההפעלה יוצרת עותק חדש של `Page_Orig` (נקרא לו `Page_C2`). ה-PTE של C2 מתעדכן להצביע על `Page_C2` (ללא סימון COW). מונה ההפניות של `Page_Orig` יורד ל-0. כעת קיימים ארבעה דפים פיזיים: `Page_P` (של P), `Page_C1` (של C1), `Page_C2` (של C2), והדף המקורי `Page_Orig` שכעת אינו משותף לאף תהליך.\n\nלכן, בסך הכל יוקצו 4 דפים פיזיים נפרדים המכילים את הנתונים המקוריים (אך עם שינויים שונים) של הדף הזה."
    },
    "difficulty_estimation": "Hard"
  }
}