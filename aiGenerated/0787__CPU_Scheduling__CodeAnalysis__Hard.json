{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "CPU Scheduling",
    "requested_type": "CodeAnalysis",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 00:23:57",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4397,
      "output_tokens": 4207,
      "total_tokens": 22923
    }
  },
  "question": {
    "id": 8,
    "type": "CodeAnalysis",
    "topic": [
      "CPU Scheduling",
      "Processes",
      "Concurrency",
      "System Calls"
    ],
    "content": {
      "text": "נתונה התוכנית הבאה, המדמה שלושה תהליכי בן (Child processes) המבצעים עבודת מעבד (CPU-bound) ועבודת קלט/פלט (I/O-bound) לסירוגין:\n\nהניחו את ההנחות הבאות לגבי המערכת והתזמון:\n1.  **מעבד:** המערכת כוללת מעבד יחיד.\n2.  **אלגוריתם תזמון:** Round Robin (RR).\n3.  **קוונטום (Quantum):** 10 מילישניות (ms).\n4.  **זמן החלפת קשר (Context Switch Overhead):** זניח (0ms).\n5.  **קריאות מערכת:** `fork()` ו-`printf()` לוקחות זמן זניח.\n6.  **`usleep(X)`:** חוסמת את התהליך למשך X מיקרושניות.\n7.  **`cpu_work(iterations)`:** הפונקציה צורכת בדיוק `iterations / 1,000,000` מילישניות של זמן מעבד (כלומר, `ITER_PER_MS` אחד שווה ל-1 מילישנייה של CPU).\n8.  **סדר יצירה והרצה:** תהליכים חדשים מתווספים לתור ההרצה (Ready Queue) בסדר יצירתם (Child 1, Child 2, Child 3). תהליך האב מסיים את פעולות ה-`fork` באופן מיידי ועובר למצב המתנה (wait) לילדיו, ואינו צורך זמן מעבד נוסף לאחר ה-forking.\n9.  **פלט:** `setbuf(stdout, NULL)` מבטיח הדפסה מיידית לפלט.\n\nכתבו את הפלט המדויק של התוכנית. יש להסביר בפירוט את כל שלבי הריצה, כולל זמני כניסה ויציאה של תהליכים מהמעבד וממצב חסימה.",
      "code_snippet": "#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n\n// Assuming 10^6 iterations take 1ms of CPU time\n#define ITER_PER_MS 1000000\n\nvoid cpu_work(long long iterations, int child_id, int stage) {\n    volatile long long sum = 0;\n    for (volatile long long j = 0; j < iterations; ++j) {\n        sum += j; // Simulate CPU work\n    }\n    printf(\"Child %d: CPU done (stage %d)\\n\", child_id, stage);\n}\n\nvoid io_sleep(useconds_t us, int child_id, int stage) {\n    usleep(us);\n    printf(\"Child %d: I/O done (stage %d)\\n\", child_id, stage);\n}\n\nint main() {\n    setbuf(stdout, NULL); // Unbuffer stdout\n    pid_t pids[3];\n    int child_num;\n\n    printf(\"Parent: Starting\\n\");\n\n    for (int i = 0; i < 3; ++i) {\n        pids[i] = fork();\n        if (pids[i] == -1) {\n            perror(\"fork failed\");\n            exit(1);\n        } else if (pids[i] == 0) {\n            // Child process\n            child_num = i + 1;\n            printf(\"Child %d: Forked (PID %d)\\n\", child_num, getpid());\n\n            if (child_num == 1) { // Child 1: (10ms CPU, 30ms IO) x 2\n                cpu_work(10 * ITER_PER_MS, child_num, 1);\n                io_sleep(30 * 1000, child_num, 1);\n                cpu_work(10 * ITER_PER_MS, child_num, 2);\n                io_sleep(30 * 1000, child_num, 2);\n            } else if (child_num == 2) { // Child 2: (20ms CPU, 10ms IO) x 2\n                cpu_work(20 * ITER_PER_MS, child_num, 1);\n                io_sleep(10 * 1000, child_num, 1);\n                cpu_work(20 * ITER_PER_MS, child_num, 2);\n                io_sleep(10 * 1000, child_num, 2);\n            } else { // Child 3: (10ms CPU, 10ms IO) x 2\n                cpu_work(10 * ITER_PER_MS, child_num, 1);\n                io_sleep(10 * 1000, child_num, 1);\n                cpu_work(10 * ITER_PER_MS, child_num, 2);\n                io_sleep(10 * 1000, child_num, 2);\n            }\n            printf(\"Child %d: Exiting\\n\", child_num);\n            exit(0);\n        }\n    }\n\n    // Parent waits for children\n    for (int i = 0; i < 3; ++i) {\n        wait(NULL);\n    }\n\n    printf(\"Parent: Exiting\\n\");\n    return 0;\n}",
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "נבצע סימולציה מפורטת של ריצת התוכנית, תוך מעקב אחר מצבי התהליכים (מוכן, רץ, חסום) ותורות ההרצה והחסימה. הקוונטום הוא 10ms.\n\n**מאפייני התהליכים:**\n*   **P1 (Child 1):** צורך 10ms CPU, נחסם ל-30ms I/O, צורך 10ms CPU, נחסם ל-30ms I/O -> יציאה.\n*   **P2 (Child 2):** צורך 20ms CPU, נחסם ל-10ms I/O, צורך 20ms CPU, נחסם ל-10ms I/O -> יציאה.\n*   **P3 (Child 3):** צורך 10ms CPU, נחסם ל-10ms I/O, צורך 10ms CPU, נחסם ל-10ms I/O -> יציאה.\n\n**תור ההרצה ההתחלתי (Ready Queue):** [P1, P2, P3] (לפי סדר יצירתם).\n\n**טבלת מעקב:**\n\n| זמן (ms) | אירוע | תהליך רץ | תור הרצה (Ready Queue) | תור חסומים (Blocked Queue) | פלט |\n|---|---|---|---|---|---|\n| 0 | התחלת המערכת, יצירת תהליכים | - | [P1, P2, P3] | [] | Parent: Starting<br>Child 1: Forked (PID ...)<br>Child 2: Forked (PID ...)<br>Child 3: Forked (PID ...) |\n| 0 | מתזמן בוחר את P1 | P1 | [P2, P3] | [] | |\n| 0-10 | P1 רץ (מבצע 10ms מתוך CPU1) | P1 | [P2, P3] | [] | |\n| 10 | P1 מסיים CPU1 | P1 | [P2, P3] | [] | Child 1: CPU done (stage 1) |\n| 10 | P1 נחסם (I/O1: 30ms, ישתחרר ב-40ms) | - | [P2, P3] | [P1(unblock@40)] | |\n| 10 | מתזמן בוחר את P2 | P2 | [P3] | [P1(unblock@40)] | |\n| 10-20 | P2 רץ (מבצע 10ms מתוך CPU1, נותרו 10ms) | P2 | [P3] | [P1(unblock@40)] | |\n| 20 | הקוונטום של P2 נגמר. P2 עובר לסוף תור ההרצה. | - | [P3, P2] | [P1(unblock@40)] | |\n| 20 | מתזמן בוחר את P3 | P3 | [P2] | [P1(unblock@40)] | |\n| 20-30 | P3 רץ (מבצע 10ms מתוך CPU1) | P3 | [P2] | [P1(unblock@40)] | |\n| 30 | P3 מסיים CPU1 | P3 | [P2] | [P1(unblock@40)] | Child 3: CPU done (stage 1) |\n| 30 | P3 נחסם (I/O1: 10ms, ישתחרר ב-40ms) | - | [P2] | [P1(unblock@40), P3(unblock@40)] | |\n| 30 | מתזמן בוחר את P2 | P2 | [] | [P1(unblock@40), P3(unblock@40)] | |\n| 30-40 | P2 רץ (מבצע 10ms הנותרים מ-CPU1) | P2 | [] | [P1(unblock@40), P3(unblock@40)] | |\n| 40 | P2 מסיים CPU1 (סה\"כ 20ms) | P2 | [] | [P1(unblock@40), P3(unblock@40)] | Child 2: CPU done (stage 1) |\n| 40 | P1 משתחרר מחסימה (I/O1 הסתיים). עובר לסוף תור ההרצה. | - | [P1] | [P3(unblock@40)] | Child 1: I/O done (stage 1) |\n| 40 | P3 משתחרר מחסימה (I/O1 הסתיים). עובר לסוף תור ההרצה. | - | [P1, P3] | [] | Child 3: I/O done (stage 1) |\n| 40 | P2 נחסם (I/O1: 10ms, ישתחרר ב-50ms) | - | [P1, P3] | [P2(unblock@50)] | |\n| 40 | מתזמן בוחר את P1 | P1 | [P3] | [P2(unblock@50)] | |\n| 40-50 | P1 רץ (מבצע 10ms מתוך CPU2) | P1 | [P3] | [P2(unblock@50)] | |\n| 50 | P1 מסיים CPU2 | P1 | [P3] | [P2(unblock@50)] | Child 1: CPU done (stage 2) |\n| 50 | P2 משתחרר מחסימה (I/O1 הסתיים). עובר לסוף תור ההרצה. | - | [P3, P2] | [] | Child 2: I/O done (stage 1) |\n| 50 | P1 נחסם (I/O2: 30ms, ישתחרר ב-80ms) | - | [P3, P2] | [P1(unblock@80)] | |\n| 50 | מתזמן בוחר את P3 | P3 | [P2] | [P1(unblock@80)] | |\n| 50-60 | P3 רץ (מבצע 10ms מתוך CPU2) | P3 | [P2] | [P1(unblock@80)] | |\n| 60 | P3 מסיים CPU2 | P3 | [P2] | [P1(unblock@80)] | Child 3: CPU done (stage 2) |\n| 60 | P3 נחסם (I/O2: 10ms, ישתחרר ב-70ms) | - | [P2] | [P1(unblock@80), P3(unblock@70)] | |\n| 60 | מתזמן בוחר את P2 | P2 | [] | [P1(unblock@80), P3(unblock@70)] | |\n| 60-70 | P2 רץ (מבצע 10ms מתוך CPU2, נותרו 10ms) | P2 | [] | [P1(unblock@80), P3(unblock@70)] | |\n| 70 | P3 משתחרר מחסימה (I/O2 הסתיים). עובר לסוף תור ההרצה. | - | [P3] | [P1(unblock@80)] | Child 3: I/O done (stage 2) |\n| 70 | הקוונטום של P2 נגמר. P2 עובר לסוף תור ההרצה. | - | [P3, P2] | [P1(unblock@80)] | |\n| 70 | מתזמן בוחר את P3 | P3 | [P2] | [P1(unblock@80)] | |\n| 70 | P3 מסיים את כל עבודתו ויוצא. | - | [P2] | [P1(unblock@80)] | Child 3: Exiting |\n| 70 | מתזמן בוחר את P2 | P2 | [] | [P1(unblock@80)] | |\n| 70-80 | P2 רץ (מבצע 10ms הנותרים מ-CPU2) | P2 | [] | [P1(unblock@80)] | |\n| 80 | P1 משתחרר מחסימה (I/O2 הסתיים). עובר לסוף תור ההרצה. | - | [P1] | [] | Child 1: I/O done (stage 2) |\n| 80 | P2 מסיים CPU2 (סה\"כ 20ms) | P2 | [P1] | [] | Child 2: CPU done (stage 2) |\n| 80 | P2 נחסם (I/O2: 10ms, ישתחרר ב-90ms) | - | [P1] | [P2(unblock@90)] | |\n| 80 | מתזמן בוחר את P1 | P1 | [] | [P2(unblock@90)] | |\n| 80 | P1 מסיים את כל עבודתו ויוצא. | - | [] | [P2(unblock@90)] | Child 1: Exiting |\n| 80-90 | המעבד מובטל (אין תהליכים מוכנים, P2 חסום) | - | [] | [P2(unblock@90)] | |\n| 90 | P2 משתחרר מחסימה (I/O2 הסתיים). עובר לסוף תור ההרצה. | - | [P2] | [] | Child 2: I/O done (stage 2) |\n| 90 | מתזמן בוחר את P2 | P2 | [] | [] | |\n| 90 | P2 מסיים את כל עבודתו ויוצא. | - | [] | [] | Child 2: Exiting |\n| 90 | כל תהליכי הבן הסתיימו. תהליך האב מסיים. | - | [] | [] | Parent: Exiting |\n\n**הפלט הסופי יהיה (סדר ה-PID יכול להשתנות):**\nParent: Starting\nChild 1: Forked (PID ...)\nChild 2: Forked (PID ...)\nChild 3: Forked (PID ...)\nChild 1: CPU done (stage 1)\nChild 3: CPU done (stage 1)\nChild 2: CPU done (stage 1)\nChild 1: I/O done (stage 1)\nChild 3: I/O done (stage 1)\nChild 1: CPU done (stage 2)\nChild 2: I/O done (stage 1)\nChild 3: CPU done (stage 2)\nChild 3: I/O done (stage 2)\nChild 3: Exiting\nChild 2: CPU done (stage 2)\nChild 1: I/O done (stage 2)\nChild 1: Exiting\nChild 2: I/O done (stage 2)\nChild 2: Exiting\nParent: Exiting"
    },
    "difficulty_estimation": "Hard"
  }
}