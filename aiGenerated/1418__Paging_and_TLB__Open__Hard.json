{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 10:03:20",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 3101,
      "total_tokens": 18556
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Virtual Memory",
      "Memory Management"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי עם כתובות וירטואליות ופיזיות בגודל 32 ביטים. גודל דף הוא 4KB. המערכת משתמשת בטבלת דפים היררכית בעלת 2 רמות. כל טבלת דפים (ברמה 1 או 2) מאוחסנת בדף אחד בדיוק.\nלמערכת יש TLB (Translation Lookaside Buffer) בגודל 4 כניסות, בשיטת אסוציאטיביות מלאה (fully associative) ומדיניות החלפה LRU (Least Recently Used). ה-TLB ריק בתחילת התהליך.\nיש להניח שכל הדפים שהתהליך מנסה לגשת אליהם נמצאים בזיכרון הפיזי (present bit = 1).\nנתונה סדרת גישות לכתובות וירטואליות עוקבות על ידי תהליך יחיד:\n1.  `0x00001000`\n2.  `0x00002000`\n3.  `0x00001010`\n4.  `0x00003000`\n5.  `0x00004000`\n6.  `0x00001020`\n7.  `0x00002010`\n8.  `0x00005000`\n\nיש לפרט ולנמק את כל החישובים והמעקב אחר מצב ה-TLB.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "מהו מבנה הכתובת הוירטואלית (חלוקה לביטים עבור P1, P2, Offset)?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "עבור כל אחת מהגישות לכתובות הוירטואליות הנתונות, ציין האם זוהי פגיעת TLB (TLB Hit) או החטאת TLB (TLB Miss).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "מהו מספר הגישות הכולל לזיכרון הראשי (Main Memory) עבור כל סדרת הגישות הנתונה? (יש לכלול גישות לנתונים וגישות לטבלאות דפים).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "בסיום כל סדרת הגישות, מה יהיה מצב ה-TLB (אילו כניסות יהיו בו, לפי VPN)?",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "1.1: נתון שהכתובת הוירטואלית היא בגודל 32 ביטים וגודל דף הוא 4KB (2^12 בתים). לכן, ה-Offset הוא 12 ביטים (ביטים 0-11).\nמספר הביטים הנותרים עבור ה-VPN (Virtual Page Number) הוא 32 - 12 = 20 ביטים.\nמערכת טבלת הדפים היא היררכית בעלת 2 רמות, וכל טבלת דפים מאוחסנת בדף אחד (4KB). כל טבלת דפים מכילה מספר כניסות השווה לגודל הדף חלקי גודל כניסה (PTE Size).\nאם נחלק את 20 ביטי ה-VPN באופן שווה בין P1 ל-P2, נקבל 10 ביטים ל-P1 ו-10 ביטים ל-P2. לכן, כל טבלת דפים מכילה 2^10 = 1024 כניסות.\nגודל כניסה בטבלת דפים (PTE Size) הוא 4KB / 1024 = 4096 / 1024 = 4 בתים (32 ביטים). זה תואם לגודל כתובת פיזית של 32 ביטים (PFN יכול להיות 20 ביטים ועוד ביטים לבקרה).\nלכן, מבנה הכתובת הוירטואלית הוא:\n[P1 (10 ביטים, ביטים 31-22)] [P2 (10 ביטים, ביטים 21-12)] [Offset (12 ביטים, ביטים 11-0)]\n\n1.2 ו-1.3: ננתח כל גישה:\nVPN = (VA >> 12) & 0xFFFFF (20 ביטים)\nP1 = (VA >> 22) & 0x3FF (10 ביטים)\nP2 = (VA >> 12) & 0x3FF (10 ביטים)\n\nמצב התחלתי: TLB ריק. (ייצוג TLB: [MRU, ..., LRU])\n\n1.  **גישה ל-`0x00001000` (VPN=0x00001)**\n    *   **TLB Miss**: ה-TLB ריק.\n    *   **Page Walk**: נדרשות 2 גישות לזיכרון הראשי (אחת ל-PTE ברמה 1 עבור P1=0, אחת ל-PTE ברמה 2 עבור P2=1).\n    *   **גישות לזיכרון הראשי**: 1 (לנתון) + 2 (ל-Page Table) = 3 גישות.\n    *   **עדכון TLB**: הוספת (0x00001). מצב TLB: [0x00001]\n\n2.  **גישה ל-`0x00002000` (VPN=0x00002)**\n    *   **TLB Miss**: VPN 0x00002 אינו ב-TLB.\n    *   **Page Walk**: נדרשות 2 גישות לזיכרון הראשי.\n    *   **גישות לזיכרון הראשי**: 1 (לנתון) + 2 (ל-Page Table) = 3 גישות.\n    *   **עדכון TLB**: הוספת (0x00002). מצב TLB: [0x00002, 0x00001]\n\n3.  **גישה ל-`0x00001010` (VPN=0x00001)**\n    *   **TLB Hit**: VPN 0x00001 נמצא ב-TLB.\n    *   **גישות לזיכרון הראשי**: 1 (לנתון).\n    *   **עדכון TLB**: 0x00001 הופך ל-MRU. מצב TLB: [0x00001, 0x00002]\n\n4.  **גישה ל-`0x00003000` (VPN=0x00003)**\n    *   **TLB Miss**: VPN 0x00003 אינו ב-TLB.\n    *   **Page Walk**: נדרשות 2 גישות לזיכרון הראשי.\n    *   **גישות לזיכרון הראשי**: 1 (לנתון) + 2 (ל-Page Table) = 3 גישות.\n    *   **עדכון TLB**: הוספת (0x00003). מצב TLB: [0x00003, 0x00001, 0x00002]\n\n5.  **גישה ל-`0x00004000` (VPN=0x00004)**\n    *   **TLB Miss**: VPN 0x00004 אינו ב-TLB.\n    *   **Page Walk**: נדרשות 2 גישות לזיכרון הראשי.\n    *   **גישות לזיכרון הראשי**: 1 (לנתון) + 2 (ל-Page Table) = 3 גישות.\n    *   **עדכון TLB**: הוספת (0x00004). ה-TLB מלא (4 כניסות), לכן נפנה את ה-LRU, שהוא 0x00002. מצב TLB: [0x00004, 0x00003, 0x00001, 0x00002]\n\n6.  **גישה ל-`0x00001020` (VPN=0x00001)**\n    *   **TLB Hit**: VPN 0x00001 נמצא ב-TLB.\n    *   **גישות לזיכרון הראשי**: 1 (לנתון).\n    *   **עדכון TLB**: 0x00001 הופך ל-MRU. מצב TLB: [0x00001, 0x00004, 0x00003, 0x00002]\n\n7.  **גישה ל-`0x00002010` (VPN=0x00002)**\n    *   **TLB Hit**: VPN 0x00002 נמצא ב-TLB.\n    *   **גישות לזיכרון הראשי**: 1 (לנתון).\n    *   **עדכון TLB**: 0x00002 הופך ל-MRU. מצב TLB: [0x00002, 0x00001, 0x00004, 0x00003]\n\n8.  **גישה ל-`0x00005000` (VPN=0x00005)**\n    *   **TLB Miss**: VPN 0x00005 אינו ב-TLB.\n    *   **Page Walk**: נדרשות 2 גישות לזיכרון הראשי.\n    *   **גישות לזיכרון הראשי**: 1 (לנתון) + 2 (ל-Page Table) = 3 גישות.\n    *   **עדכון TLB**: הוספת (0x00005). ה-TLB מלא, לכן נפנה את ה-LRU, שהוא 0x00003. מצב TLB: [0x00005, 0x00002, 0x00001, 0x00004]\n\n**סיכום עבור 1.2:**\n*   `0x00001000`: TLB Miss\n*   `0x00002000`: TLB Miss\n*   `0x00001010`: TLB Hit\n*   `0x00003000`: TLB Miss\n*   `0x00004000`: TLB Miss\n*   `0x00001020`: TLB Hit\n*   `0x00002010`: TLB Hit\n*   `0x00005000`: TLB Miss\n\n**סיכום עבור 1.3:**\n*   סה\"כ גיאות לזיכרון הראשי עבור Misses (5 במספרן): 5 * 3 (גיאות לכל Miss) = 15 גיאות.\n*   סה\"כ גיאות לזיכרון הראשי עבור Hits (3 במספרן): 3 * 1 (גיאה לכל Hit) = 3 גיאות.\n*   **סה\"כ גיאות לזיכרון הראשי**: 15 + 3 = 18 גיאות.\n\n1.4: בסיום כל סדרת הגישות, מצב ה-TLB (מסודר מה-MRU ל-LRU) יהיה:\n[VPN 0x00005, VPN 0x00002, VPN 0x00001, VPN 0x00004]"
    },
    "difficulty_estimation": "Hard"
  }
}