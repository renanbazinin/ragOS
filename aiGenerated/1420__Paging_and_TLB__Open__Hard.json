{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 10:04:49",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 2932,
      "total_tokens": 15737
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Virtual Memory",
      "Memory Management",
      "Performance"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם טבלת דפים רב-שכבתית וב-TLB (Translation Lookaside Buffer). גודל דף במערכת הוא 4KB. כתובת וירטואלית היא בגודל 48 ביטים, וכתובת פיזית היא בגודל 40 ביטים. טבלת הדפים היא בת 4 רמות. כל כניסה בטבלת הדפים (PTE או PDE) היא בגודל 8 בתים. ידוע שכל טבלת דפים בכל רמה (PTL0, PTL1, PTL2, PTL3) מאוחסנת בדיוק בדף זיכרון פיזי אחד (4KB). ה-TLB במערכת משיג שיעור פגיעה (Hit Rate) של 98%. זמן גישה ל-TLB הוא 1 ננו-שנייה. זמן גישה לזיכרון הראשי (RAM) הוא 100 ננו-שנייה. יש לפרט ולנמק את כל החישובים וההסברים.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "מבנה כתובת וירטואלית: פרטו את חלוקת הביטים של הכתובת הוירטואלית ל-Page Offset ולכל אחד מארבעת אינדקסי טבלת הדפים (PTL3 Index, PTL2 Index, PTL1 Index, PTL0 Index). הסבירו כיצד הנתונים מובילים לחלוקה זו.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "גישות לזיכרון עבור תרגום כתובת: כמה גישות לזיכרון הראשי (RAM) נדרשות עבור תרגום כתובת וירטואלית לכתובת פיזית בכל אחד מהמקרים הבאים? (הניחו שכתובת הבסיס של טבלת הדפים ברמה העליונה (CR3) ידועה ואינה נחשבת לגישת זיכרון).\n    א. TLB Hit: הכניסה הרצויה נמצאת ב-TLB.\n    ב. TLB Miss: הכניסה הרצויה אינה ב-TLB, אך כל כניסות טבלת הדפים הנדרשות נמצאות בזיכרון הראשי (אין Page Fault).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "זמן גישה אפקטיבי לזיכרון (EAT): חשבו את זמן הגישה האפקטיבי לזיכרון (Effective Memory Access Time - EAT) לגישת נתונים. קחו בחשבון גם את זמן תרגום הכתובת וגם את זמן הגישה לנתון עצמו.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "השפעת תבנית גישה לזיכרון: תוכנית ניגשת למערך גדול של מספרים שלמים, `int data[N];`, כאשר N גדול בהרבה ממספר הכניסות ב-TLB וגם גדול בהרבה ממספר האינטים שיכולים להיכנס לדף בודד. התוכנית מבצעת לולאה: `for (i = 0; i < N; i += K) { data[i] = i; }`. תארו כיצד שיעור הפגיעה ב-TLB ישתנה אם K קטן מאוד (לדוגמה, K=1, גישה סדרתית) בהשוואה למצב שבו K גדול מספיק כך ש-`data[i]` ו-`data[i+K]` נמצאים ככל הנראה בדפים שונים. הסבירו את הסיבה לשינוי בשיעור הפגיעה.",
        "code_snippet": "int data[N];\nfor (i = 0; i < N; i += K) {\n    data[i] = i;\n}",
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "1. מבנה כתובת וירטואלית:\n   *   גודל דף = 4KB = 2^12 בתים. מכאן ש-Page Offset הוא 12 ביטים.\n   *   גודל כתובת וירטואלית (VA) = 48 ביטים.\n   *   מספר דף וירטואלי (VPN) = VA - Page Offset = 48 - 12 = 36 ביטים.\n   *   גודל כניסה בטבלת דפים (PTE/PDE) = 8 בתים.\n   *   גודל טבלת דפים ברמה אחת = 4KB.\n   *   מספר הכניסות בכל טבלת דפים = 4KB / 8 בתים = 4096 / 8 = 512 כניסות.\n   *   מספר הביטים לכל אינדקס בטבלת הדפים = log2(512) = 9 ביטים.\n   *   מכיוון שיש 4 רמות של טבלאות דפים, סך הביטים לאינדקסים הוא 4 * 9 = 36 ביטים.\n   *   מספר זה תואם את גודל ה-VPN (36 ביטים), ולכן החלוקה היא:\n       *   PTL3 Index: 9 ביטים (ביטים 47-39)\n       *   PTL2 Index: 9 ביטים (ביטים 38-30)\n       *   PTL1 Index: 9 ביטים (ביטים 29-21)\n       *   PTL0 Index: 9 ביטים (ביטים 20-12)\n       *   Page Offset: 12 ביטים (ביטים 11-0)\n       *   סה\"כ: 9 + 9 + 9 + 9 + 12 = 48 ביטים.\n\n2. גישות לזיכרון עבור תרגום כתובת:\n   *   א. TLB Hit: במקרה של פגיעה ב-TLB, הכתובת הפיזית נמצאת ישירות ב-TLB. לכן, אין צורך בגישות לזיכרון הראשי (RAM) לצורך תרגום הכתובת. מספר גישות ל-RAM = 0 (לאחר בדיקת ה-TLB).\n   *   ב. TLB Miss (Page Hit): במקרה של החטאה ב-TLB, המערכת נדרשת לבצע מעבר (walk) על פני 4 רמות טבלת הדפים. כל רמה דורשת קריאה של כניסה מטבלת הדפים מזיכרון ה-RAM. לכן, נדרשות 4 גישות לזיכרון הראשי (אחת עבור PTL3, אחת עבור PTL2, אחת עבור PTL1 ואחת עבור PTL0) כדי למצוא את מספר המסגרת הפיזית (PFN) ולעדכן את ה-TLB. מספר גישות ל-RAM = 4.\n\n3. זמן גישה אפקטיבי לזיכרון (EAT):\n   *   שיעור פגיעה ב-TLB (H) = 0.98\n   *   שיעור החטאה ב-TLB (1-H) = 0.02\n   *   זמן גישה ל-TLB (T_tlb) = 1 ננו-שנייה\n   *   זמן גישה לזיכרון הראשי (T_mem) = 100 ננו-שנייה\n   *   גישות ל-RAM עבור תרגום ב-TLB Hit (M_hit_trans) = 0\n   *   גישות ל-RAM עבור תרגום ב-TLB Miss (M_miss_trans) = 4\n   *   גישת נתונים ל-RAM תמיד דורשת גישה אחת ל-RAM (T_data_access = T_mem).\n\n   ה-EAT מחושב כך: EAT = (H * (T_tlb + M_hit_trans * T_mem + T_data_access)) + ((1-H) * (T_tlb + M_miss_trans * T_mem + T_data_access))\n   EAT = 0.98 * (1 ננו-שנייה + 0 * 100 ננו-שנייה + 100 ננו-שנייה) + 0.02 * (1 ננו-שנייה + 4 * 100 ננו-שנייה + 100 ננו-שנייה)\n   EAT = 0.98 * (1 + 100) + 0.02 * (1 + 400 + 100)\n   EAT = 0.98 * 101 + 0.02 * 501\n   EAT = 98.98 + 10.02\n   EAT = 109 ננו-שניות.\n\n4. השפעת תבנית גישה לזיכרון:\n   *   מקרה 1: K קטן מאוד (לדוגמה, K=1, גישה סדרתית):\n       *   כאשר K=1, התוכנית ניגשת לאלמנטים סמוכים במערך (`data[0], data[1], data[2], ...`). גישות אלו מפגינות לוקליות מרחבית גבוהה. אינטים רבים ברצף ימוקמו באותו דף זיכרון.\n       *   לאחר שהתרגום של דף מסוים נטען ל-TLB (בגישה הראשונה לאותו דף), גישות עוקבות לאלמנטים אחרים באותו דף יגרמו לפגיעות ב-TLB.\n       *   לכן, שיעור הפגיעה ב-TLB יהיה גבוה מאוד (יתקרב ל-100% בתוך כל דף, ויהיה גבוה בסך הכל עד אשר סט העבודה של הדפים יחרוג מיכולת הקיבולת של ה-TLB). ה-TLB מנצל את הלוקליות המרחבית והזמנית, וגישה סדרתית ממקסמת את השימוש בכל תרגום שמור.\n   *   מקרה 2: K גדול מספיק כך ש-`data[i]` ו-`data[i+K]` נמצאים ככל הנראה בדפים שונים (גישה בקפיצות):\n       *   כאשר K גדול, כל גישה (`data[i], data[i+K], data[i+2K], ...`) עשויה לדלג לדף זיכרון אחר.\n       *   אם הקפיצה (stride) K גורמת לגישות לדפים חדשים ושונים באופן מתמיד, ומספר הדפים השונים שאליהם ניגשים בחלון זמן קצר עולה על הקיבולת של ה-TLB, אזי ה-TLB יחווה החטאות רבות.\n       *   כל גישה עשויה לדרוש תרגום דף חדש מטבלאות הדפים, מה שעלול להביא להוצאת כניסה ישנה מה-TLB שאולי עדיין נחוצה (במיוחד אם הגישות אינן חוזרות על עצמן). הדבר מוביל לשיעור פגיעה נמוך ב-TLB, שכן הלוקליות הזמנית והמרחבית המנוצלת על ידי ה-TLB מצטמצמת. ה-TLB הופך פחות יעיל בשמירת תרגומים רלוונטיים."
    },
    "difficulty_estimation": "Hard"
  }
}