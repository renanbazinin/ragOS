{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-09 20:33:06",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4186,
      "output_tokens": 3270,
      "total_tokens": 18636
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "Virtual Memory",
      "Paging",
      "TLB"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה עם זיכרון וירטואלי ופיזי. גודל כתובת וירטואלית הוא 48 ביטים, וגודל כתובת פיזית הוא 40 ביטים. גודל דף במערכת הוא 4KB. טבלת הדפים היא היררכית עם 3 רמות, כאשר כל רמה מאוחסנת בדף זיכרון בגודל 4KB. גודל כניסה בטבלת הדפים (PTE) הוא 8 בתים.\nהמערכת כוללת TLB (Translation Lookaside Buffer) עם 16 כניסות, בשיטת אסוציאטיביות 4-כיוונית (4-way set associative), ומדיניות החלפה LRU (Least Recently Used) עבור כל סט.\n\nנתון קטע הקוד הבא:\n",
      "code_snippet": "#define N_ELEMENTS (1024 * 1024) // 1M elements\n#define INT_SIZE 4 // bytes\nint arr[N_ELEMENTS]; // המערך arr מתחיל בכתובת וירטואלית 0x0000_0000_0000_0000\nvoid access_array(int step) {\n    for (int i = 0; i < N_ELEMENTS; i += step) {\n        arr[i] = arr[i] + 1;\n    }\n}",
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "מהו מבנה כתובת וירטואלית במערכת זו (חלוקת הביטים ל-Unused, Index לכל רמת טבלת דפים, ו-Offset)? מהו מספר מסגרת פיזית המקסימלי שניתן למפות?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "כמה סטים יש ב-TLB? מה גודל ה-Tag וה-Index עבור ה-TLB?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "נניח שהפונקציה `access_array` נקראת עם `step = 1024`. בהתבסס על ה-TLB ומדיניות ההחלפה LRU, כמה פעמים תתרחש החטאה ב-TLB (TLB miss) במהלך הריצה המלאה של הלולאה? פרט את החישובים והנחות.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "כיצד תשפיע בחירת ערך שונה עבור המשתנה `step` (לדוגמה, `step = 1`) על אחוז ההחטאות ב-TLB ועל ביצועי המערכת? נמק מדוע.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "1.1: חישוב מבנה הכתובת הווירטואלית והמסגרת הפיזית המקסימלית:\n   *   גודל דף: 4KB = 2^12 בתים. לכן, Page Offset הוא 12 ביטים.\n   *   כתובת וירטואלית: 48 ביטים. מספר הדף הווירטואלי (VPN) הוא 48 - 12 = 36 ביטים.\n   *   גודל כניסה בטבלת הדפים (PTE): 8 בתים.\n   *   כל רמה של טבלת הדפים מאוחסנת בדף זיכרון בגודל 4KB. מספר הכניסות בכל טבלת דפים ברמה מסוימת הוא 4KB / 8 בתים = 4096 / 8 = 512 כניסות.\n   *   לכן, כל אינדקס ברמת טבלת דפים דורש log2(512) = 9 ביטים.\n   *   יש 3 רמות של טבלת דפים, כך שסך הביטים המשמשים לאינדקסים הם 3 * 9 = 27 ביטים.\n   *   מכיוון שה-VPN הוא 36 ביטים, ורק 27 ביטים משמשים לאינדקסים, נותרו 36 - 27 = 9 ביטים 'לא בשימוש' (Unused), אשר יהיו הביטים הגבוהים ביותר של ה-VPN. \n   *   מבנה הכתובת הווירטואלית:\n      `[Unused 9 bits | L1 Index 9 bits | L2 Index 9 bits | L3 Index 9 bits | Page Offset 12 bits]`\n   *   גודל כתובת פיזית: 40 ביטים. מספר המסגרת הפיזית (PFN) הוא 40 - 12 = 28 ביטים.\n   *   מספר המסגרת הפיזית המקסימלי שניתן למפות הוא 2^28 - 1.\n\n1.2: חישוב סטים, Tag ו-Index עבור ה-TLB:\n   *   TLB מכיל 16 כניסות, בשיטת אסוציאטיביות 4-כיוונית.\n   *   מספר הסטים ב-TLB הוא: 16 כניסות / 4 כיוונים לסט = 4 סטים.\n   *   גודל ה-TLB Index (קובע לאיזה סט המיפוי שייך) הוא log2(מספר הסטים) = log2(4) = 2 ביטים.\n   *   גודל ה-TLB Tag (החלק מה-VPN המשמש להשוואה בתוך הסט) הוא: גודל ה-VPN (27 ביטים, לפי סעיף 1.1) - גודל ה-TLB Index (2 ביטים) = 25 ביטים.\n\n1.3: חישוב החטאות TLB עבור `step = 1024`:\n   *   גודל המערך `arr`: `N_ELEMENTS` * `INT_SIZE` = (1024 * 1024) * 4 בתים = 4MB.\n   *   מספר הדפים שהמערך תופס: 4MB / 4KB = 1024 דפים. נסמן אותם כ-P0, P1, ..., P1023.\n   *   כאשר `step = 1024`, הלולאה ניגשת לאיברים `arr[0], arr[1024], arr[2048], ...`. כל גישה כזו היא לאיבר הראשון בדף חדש. כלומר, הגישות הן לדפים `P0, P1, P2, ..., P1023` ברצף.\n   *   סה\"כ גישות לזיכרון בלולאה: `N_ELEMENTS / step` = (1024 * 1024) / 1024 = 1024 גישות.\n   *   כל גישה היא לדף וירטואלי ייחודי שטרם נגיש אליו (במסגרת הגישה הנוכחית).\n   *   ננתח את מיפוי ה-VPN ל-TLB:\n      *   ה-VPN הוא 27 ביטים. ה-TLB Index הוא 2 הביטים הנמוכים ביותר של ה-VPN.\n      *   דף P_k (כאשר k הוא מספר הדף) ימופה ל-TLB Set שערכו הוא `k % 4`. לדוגמה:\n          *   VPN של P0 (k=0) הוא 0 -> TLB Set 0 (00 בינארית), TLB Tag 0.\n          *   VPN של P1 (k=1) הוא 1 -> TLB Set 1 (01 בינארית), TLB Tag 0.\n          *   VPN של P2 (k=2) הוא 2 -> TLB Set 2 (10 בינארית), TLB Tag 0.\n          *   VPN של P3 (k=3) הוא 3 -> TLB Set 3 (11 בינארית), TLB Tag 0.\n          *   VPN של P4 (k=4) הוא 4 -> TLB Set 0 (00 בינארית), TLB Tag 1.\n   *   כל הגישות הללו (מ-P0 ועד P1023) הן לדפים שונים לחלוטין. ה-TLB מכיל רק 16 כניסות בסך הכל (4 כניסות לכל סט).\n   *   מכיוון שכל גישה היא לדף חדש שאינו נמצא ב-TLB (שכן ה-TLB קטן בהרבה מ-1024 דפים), כל גישה תגרום בהכרח להחטאה ב-TLB.\n   *   בכל פעם שדף חדש נטען ל-TLB, הוא יחליף את אחת הכניסות הקיימות בסט שלו לפי מדיניות ה-LRU. מכיוון שאנו ניגשים לדפים שונים ברצף, כל גישה תהיה החטאה ותגרום לטעינת כניסה חדשה ל-TLB ולרוב גם להוצאת כניסה קיימת (לאחר שה-TLB מתמלא).\n   *   לכן, מספר ההחטאות ב-TLB יהיה שווה למספר הגישות הכולל: 1024 החטאות.\n   *   אחוז ההחטאות: (1024 / 1024) * 100% = 100%.\n\n1.4: השפעת `step = 1` על אחוז ההחטאות וביצועים:\n   *   כאשר `step = 1`, הלולאה ניגשת לאיברים `arr[0], arr[1], arr[2], ... , arr[N_ELEMENTS-1]` ברצף.\n   *   כל דף (4KB) מכיל 1024 איברים מסוג `int` (4KB / 4 בתים לאינט = 1024 אינטים).\n   *   הגישות לדפים יתבצעו באופן הבא:\n      *   הגישה הראשונה לכל דף (לדוגמה, `arr[0]` עבור דף P0) תגרום להחטאה ב-TLB. מיפוי הדף (P0) ייטען ל-TLB (לסט 0 במקרה זה).\n      *   לאחר מכן, 1023 הגישות הבאות לאיברים באותו הדף (P0) ימצאו את המיפוי ב-TLB, ולכן יהיו פגיעות (hits).\n      *   כאשר הלולאה תגיע לאיבר הראשון בדף הבא (`arr[1024]` עבור דף P1), תתרחש שוב החטאה ב-TLB עבור P1. המיפוי של P1 ייטען ל-TLB (לסט 1).\n      *   דפוס זה יחזור על עצמו: גישה ראשונה לדף חדש גורמת להחטאה, ואחריה אלפי גישות לאותו דף הן פגיעות.\n      *   סה\"כ דפים שונים שניגשים אליהם: 1024 דפים.\n      *   סה\"כ החטאות ב-TLB: 1024 (אחת לכל דף בעת הגישה הראשונה אליו).\n      *   סה\"כ גישות לזיכרון: `N_ELEMENTS` = 1024 * 1024 = 1,048,576 גישות.\n      *   אחוז החטאות TLB: (1024 / 1,048,576) * 100% = (1 / 1024) * 100% ≈ 0.097%.\n   *   **השפעה על ביצועים:**\n      *   אחוז ההחטאות במקרה של `step = 1` הוא נמוך מאוד (כ-0.1%) בהשוואה ל-100% במקרה של `step = 1024`.\n      *   החטאה ב-TLB דורשת ביצוע Page Table Walk (חיפוש המיפוי בטבלאות הדפים בזיכרון הראשי), שהיא פעולה יקרה ולוקחת זמן רב יותר מגישה ל-TLB או אפילו לזיכרון מטמון.\n      *   לכן, עם `step = 1`, המערכת תבצע הרבה פחות Page Table Walks, והביצועים יהיו טובים משמעותית. הסיבה לכך היא ניצול טוב יותר של לוקליות מרחבית (Spatial Locality) – כאשר ניגשים לאיבר אחד בדף, סביר שניגש גם לאיברים אחרים באותו הדף בזמן הקרוב, והמיפוי יישאר ב-TLB ויהיה זמין לגישות הבאות."
    },
    "difficulty_estimation": "Hard"
  }
}