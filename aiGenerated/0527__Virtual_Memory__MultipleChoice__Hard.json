{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Virtual Memory",
    "requested_type": "MultipleChoice",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:20:11",
    "examples_used": 2,
    "token_usage": {
      "prompt_tokens": 969,
      "output_tokens": 1726,
      "total_tokens": 8746
    }
  },
  "question": {
    "id": 1,
    "type": "MultipleChoice",
    "topic": [
      "Virtual Memory",
      "Paging",
      "TLB",
      "Page Faults",
      "Memory Access Patterns"
    ],
    "content": {
      "text": "במערכת הפעלה מסוימת, כתובת וירטואלית היא בת 48 ביטים, גודל דף הוא 4KB, וגודל כניסה בטבלת דפים (PTE) הוא 8 בתים. מערכת ההפעלה משתמשת בטבלת דפים מרובת רמות (4 רמות), כאשר כל אינדקס ברמה הוא בן 9 ביטים. ה-TLB הוא אסוציאטיבי לחלוטין (fully associative) עם 64 כניסות ומשתמש באלגוריתם LRU להחלפה. תהליך ניגש באופן סדרתי למערך שלם בגודל `int arr[256 * 1024]` (כלומר, מ-`arr[0]` ועד `arr[256*1024 - 1]`). נניח שהמערך מתחיל בכתובת וירטואלית מיושרת לדף (page-aligned), וכל הדפים המשמשים את המערך אינם נמצאים בזיכרון הפיזי בתחילת הריצה (cold start). כמה סך הכל פספוסי TLB (TLB misses) וכמה סך הכל פסיקות דף (page faults) יתרחשו במהלך הגישה לכל המערך?",
      "code_snippet": "int arr[256 * 1024];\nfor (int i = 0; i < 256 * 1024; ++i) {\n    arr[i] = i; // Accessing arr[i]\n}",
      "options": [
        "א. פספוסי TLB: 256, פסיקות דף: 256",
        "ב. פספוסי TLB: 256 * 1024, פסיקות דף: 256",
        "ג. פספוסי TLB: 256 + (256 - 64) * 1024, פסיקות דף: 256",
        "ד. פספוסי TLB: 256, פסיקות דף: 256 * 4",
        "ה. אף אחת מהתשובות האחרות אינה נכונה."
      ]
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": "א",
      "explanation": "חישוב מספר הדפים:\nגודל המערך הוא `256 * 1024` איברים. כל איבר `int` הוא 4 בתים. סך הכל `256 * 1024 * 4 = 1,048,576` בתים (1MB).\nגודל דף הוא 4KB (`4 * 1024 = 4096` בתים).\nמספר הדפים הייחודיים הנדרשים למערך הוא `1MB / 4KB = 1024KB / 4KB = 256` דפים.\n\nפסיקות דף (Page Faults):\nמכיוון שכל 256 הדפים המשמשים את המערך אינם נמצאים בזיכרון הפיזי בתחילת הריצה (cold start), וכל דף ייחודי נגיש לפחות פעם אחת, כל גישה ראשונה לדף תגרום לפסיקת דף. לכן, יתרחשו בדיוק 256 פסיקות דף. כל פסיקת דף טוענת דף אחד לזיכרון הפיזי.\n\nפספוסי TLB (TLB Misses):\nכל דף מכיל `4096 / 4 = 1024` איברי `int`.\nהגישה היא סדרתית מ-`arr[0]` ועד `arr[256*1024 - 1]`.\n\n1.  הגישה הראשונה לכל אחד מ-256 הדפים הייחודיים (לדוגמה, ל-`arr[0]` שהוא בדף 0, ל-`arr[1024]` שהוא בדף 1, וכו') תגרום לפספוס TLB, מכיוון שכניסת טבלת הדפים (PTE) עבור דף זה אינה נמצאת ב-TLB. זה מצטבר ל-256 פספוסי TLB עבור הגישות הראשונות לכל דף.\n2.  לאחר פספוס TLB והטיפול בפסיקת הדף (אם הייתה), ה-PTE של הדף הנדרש נטען ל-TLB.\n3.  ה-TLB מכיל 64 כניסות. לאחר ש-64 הדפים הראשונים (דפים 0 עד 63) נגישים לראשונה, ה-TLB יתמלא. הגישה הראשונה לדף ה-64 (דף מספר 63) תגרום לפספוס TLB ותטען את ה-PTE שלו ל-TLB.\n4.  כאשר ניגשים לדף ה-65 (דף מספר 64), זהו פספוס TLB נוסף. כעת, כניסת ה-LRU ב-TLB (שהיא ה-PTE של דף 0) תפונה, וה-PTE של דף 64 יוכנס במקומה.\n5.  דפוס זה ממשיך: כל גישה ראשונה לדף חדש לאחר שה-TLB התמלא תגרום לפספוס TLB ולפינוי כניסה ב-TLB לפי LRU. עם זאת, מכיוון שהגישה היא סדרתית, וכל 1024 הגישות לאיברים בתוך דף מסוים מתבצעות ברצף לפני המעבר לדף הבא, לאחר שה-PTE של דף נטען ל-TLB, כל 1023 הגישות הנותרות לאיברים באותו דף יהיו פגיעות TLB (TLB hits).\n6.  עד שהתהליך יגיע לדף שה-PTE שלו פונה מה-TLB (לדוגמה, דף 0 פונה כאשר נטען דף 64), התהליך כבר עבר את כל הגישות לדף 0 ולא יחזור אליו יותר בסיבוב זה. לכן, אין פספוסי TLB נוספים עקב פינוי כניסות והצורך בטעינה מחדש של PTE עבור דפים שכבר נגישו בעבר בתוך לולאת הגישה הנוכחית.\n\nלסיכום, סך הכל פספוסי TLB שווים למספר הדפים הייחודיים הנגישים, שהם 256. סך הכל פסיקות דף שוות גם הן למספר הדפים הייחודיים הנגישים, שהם 256.\n\nלכן, התשובה הנכונה היא א'."
    },
    "difficulty_estimation": "Hard"
  }
}