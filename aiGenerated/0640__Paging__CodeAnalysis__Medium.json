{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging",
    "requested_type": "CodeAnalysis",
    "requested_difficulty": "Medium",
    "generated_at": "2026-02-07 23:18:08",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3180,
      "output_tokens": 2115,
      "total_tokens": 11859
    }
  },
  "question": {
    "id": 10,
    "type": "CodeAnalysis",
    "topic": [
      "Paging",
      "Memory Management",
      "Page Faults",
      "LRU",
      "Performance"
    ],
    "content": {
      "text": "נתונה תוכנית C המבצעת גישה למערך דו-ממדי גדול. המערכת פועלת עם זיכרון וירטואלי ומשתמשת במנגנון דפדוף (paging).\n\nהניחו את הפרטים הבאים בנוגע למערכת הזיכרון:\n- גודל דף: 4096 בתים (4KB).\n- גודל משתנה `int`: 4 בתים.\n- מספר מסגרות פיזיות זמינות *לנתוני המערך* (arr): 10 מסגרות (frames).\n- מדיניות החלפת דפים: LRU (Least Recently Used).\n- בתחילת ריצת התוכנית, טבלת הדפים של המערך ריקה (כלומר, אף דף של המערך אינו נמצא בזיכרון הפיזי).\n- שאר דפי התהליך (קוד, מחסנית, ערימה) כבר טעונים ואינם נכללים בספירת המסגרות המצוינות לעיל או בספירת כשלי הדף.\n\nכמה כשלי דף (page faults) יתרחשו במהלך ביצוע הלולאה הראשית בתוכנית הנתונה?",
      "code_snippet": "#include <stdio.h>\n#include <stdlib.h>\n\n#define ROWS 1024\n#define COLS 1024\n\nint arr[ROWS][COLS]; // מערך גלובלי\n\nint main() {\n    // גישה למערך בסדר עמודות-ראשי (column-major access)\n    for (int j = 0; j < COLS; ++j) {\n        for (int i = 0; i < ROWS; ++i) {\n            arr[i][j] = i + j; // גישה ל-arr[i][j]\n        }\n    }\n    return 0;\n}",
      "options": null
    },
    "sub_questions": null,
    "points": 20,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "נתונים:\n- גודל דף: 4096 בתים (4KB).\n- גודל משתנה `int`: 4 בתים.\n- המערך `arr[1024][1024]` מאוחסן בזיכרון בסדר שורות-ראשי (row-major order). כלומר, `arr[0][0], arr[0][1], ..., arr[0][1023]` סמוכים בזיכרון, ואחריהם `arr[1][0], arr[1][1], ...` וכן הלאה.\n\nחישוב גודל המערך והדפים:\n- כל שורה במערך, `arr[i]`, מכילה `1024 * 4 = 4096` בתים. זהו בדיוק גודל של דף אחד.\n- לכן, כל שורה `arr[i]` שוכנת בדף נפרד. המערך כולו משתרע על פני 1024 דפים שונים (נסמן אותם כ-P0 עבור `arr[0]`, P1 עבור `arr[1]`, ..., P1023 עבור `arr[1023]`).\n\nניתוח לולאות הגישה:\n- הלולאה החיצונית רצה על `j` (עמודות), והלולאה הפנימית רצה על `i` (שורות).\n- בכל איטרציה של הלולאה הפנימית, אנו ניגשים ל-`arr[i][j]`. כאשר `i` משתנה, אנו למעשה קופצים לדף אחר בזיכרון (מדף P`i` לדף P`i+1`).\n\nמספר המסגרות הפיזיות הזמינות לנתוני המערך: 10 מסגרות (frames).\nמדיניות החלפת דפים: LRU (Least Recently Used).\n\nניתוח כמות כשלי דף:\n1.  **לולאה חיצונית `j = 0` (העמודה הראשונה):**\n    - הלולאה הפנימית תגש ל-`arr[0][0], arr[1][0], ..., arr[1023][0]`. רצף הגישות לדפים הוא `P0, P1, ..., P1023`.\n    - גישה ל-`arr[0][0]` (דף P0) תגרום לכשל דף (הדף אינו בזיכרון). P0 נטען למסגרת.\n    - גישה ל-`arr[1][0]` (דף P1) תגרום לכשל דף. P1 נטען למסגרת.\n    - ...\n    - גישה ל-`arr[9][0]` (דף P9) תגרום לכשל דף. P9 נטען למסגרת. כעת כל 10 המסגרות מלאות בדפים P0-P9.\n    - גישה ל-`arr[10][0]` (דף P10) תגרום לכשל דף. מכיוון שהמסגרות מלאות, יש להחליף דף. לפי מדיניות LRU, דף P0 (שהיה בשימוש הכי פחות לאחרונה מבין אלו שבזיכרון) יוחלף על ידי P10.\n    - גישה ל-`arr[11][0]` (דף P11) תגרום לכשל דף. P1 יוחלף על ידי P11. (וכן הלאה, הדף P`i-10` יוחלף על ידי P`i`).\n    - תבנית זו חוזרת על עצמה. כל גישה ל-`arr[i][0]` עבור `i` מ-0 עד 1023 תגרום לכשל דף, שכן הדף `P_i` לא יהיה בזיכרון או יהיה דף חדש שיש לטעון.\n    - סך הכל כשלי דף עבור `j=0`: 1024 כשלי דף.\n\n2.  **לולאות חיצוניות `j = 1` עד `j = 1023`:**\n    - כאשר הלולאה החיצונית עוברת לעמודה הבאה (`j=1`), הלולאה הפנימית שוב ניגשת לדפים `P0, P1, ..., P1023` בסדר זה.\n    - נניח גישה ל-`arr[0][1]` (דף P0). דף P0 הוצא מהזיכרון במהלך הטיפול בעמודה `j=0` (כאשר P10 נטען). לכן, גישה זו תגרום לכשל דף נוסף. דף LRU הנוכחי (למשל, P1014, אם נניח שהדפים האחרונים שנטענו עבור j=0 היו P1014-P1023) יוחלף ב-P0.\n    - באופן דומה, גישה ל-`arr[1][1]` (דף P1) תגרום לכשל דף, מכיוון ש-P1 הוצא מהזיכרון במהלך הטיפול בעמודה `j=0` (כאשר P11 נטען). דף LRU יוחלף ב-P1.\n    - תבנית זו חוזרת על עצמה עבור כל `arr[i][j]` בכל עמודה.\n    - מכיוון שמספר הדפים הכולל של המערך (1024) גדול בהרבה ממספר המסגרות הזמינות (10), כל דף שנטען לזיכרון עבור `j` מסוים, ככל הנראה יוצא מהזיכרון לפני שיידרש שוב בעמודה הבאה (`j+1`). זהו מצב של 'thrashing' (הדפה) בו רוב זמן המעבד מושקע בהחלפת דפים.\n\n**סיכום:**\n- עבור כל אחת מ-`ROWS * COLS = 1024 * 1024` הגישות למערך `arr[i][j]`, יתרחש כשל דף.\n- סך כל כשלי הדף יהיה: `1024 * 1024 = 1,048,576`.\n\n**תשובה:** מספר כשלי הדף הכולל הוא 1,048,576.",
      "code_snippet": null
    },
    "difficulty_estimation": "Medium"
  }
}