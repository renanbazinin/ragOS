{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and Page Replacement",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 10:51:22",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 3430,
      "total_tokens": 15068
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "Paging",
      "Page Replacement",
      "TLB",
      "Multi-Level Page Tables"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה עם ארכיטקטורת זיכרון וירטואלי 32-ביט, המשתמשת בטבלאות דפים דו-שכבתיות. גודל דף הוא 4KB (בתים), וגודל כניסה בטבלת דפים (PTE) הוא 4 בתים. נניח שכל טבלאות הדפים ברמה 1 (Page Directory) נמצאות תמיד בזיכרון הפיזי, וכי טבלאות הדפים ברמה 2 (Page Tables) נטענות לזיכרון הפיזי לפי הצורך (page-in) אך אינן נספרות כחלק ממגבלת המסגרות הפיזיות של התהליך.\nהתהליך הנתון מוגבל לשימוש ב-4 מסגרות פיזיות בלבד (physical frames) עבור דפי נתונים (data pages).\nהמערכת כוללת TLB בגודל 4 כניסות, הפועל בשיטת אסוציאטיבית מלאה (fully associative) ומחליף כניסות בשיטת LRU. אלגוריתם החלפת הדפים עבור זיכרון פיזי (לדפי נתונים) הוא גם LRU.\nכל הדפים הווירטואליים של התהליך אינם נמצאים בזיכרון הפיזי בתחילת התהליך, וכל כניסות ה-TLB אינן תקפות.\nכל גישה לזיכרון הפיזי (לדף נתונים, ל-PTE בטבלת דפים) נחשבת לגישה אחת. גישה לדיסק (לצורך Page In / Page Out) נחשבת לפעולה נפרדת.\n\nהתהליך מבצע את סדרת הגישות הבאה לדפים וירטואליים (מספרי דפים): \n0, 1, 2, 3, 0, 4, 1, 5, 2, 6, 3, 7\n\nעקבו אחר סדרת הגישות ופרטו עבור כל גישה:\n1.  האם התרחש TLB Hit או Miss? אם Miss, האם הנתון נטען ל-TLB? אם כן, איזו כניסה פונתה (אם ה-TLB היה מלא) ומדוע?\n2.  כמה גישות לזיכרון הפיזי (לצורך תרגום כתובת) נדרשו? (כלומר, כמה גישות לטבלאות הדפים ברמה 1 וברמה 2). שימו לב: גישה לטבלת דפים ברמה 2 שאינה נמצאת בזיכרון הפיזי תיצור Page Fault עבור טבלת הדפים עצמה ותיטען לזיכרון, אך כאמור, מסגרת זו אינה נספרת מתוך 4 המסגרות המוקצות לדפי נתונים.\n3.  האם התרחש Page Fault לדף נתונים? אם כן, איזו מסגרת פיזית פונתה (אם כל המסגרות היו תפוסות) ואיזה דף וירטואלי נטען אליה?\n4.  מהו מצב ה-TLB ומצב המסגרות הפיזיות (frame table) לאחר כל גישה? יש לציין את סדר ה-LRU עבור שניהם.\n\nבסיום כל הגישות, סכמו כמה TLB Misses סך הכל וכמה Page Faults לדפי נתונים סך הכל התרחשו.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "נתוני המערכת:\n*   מרחב כתובות וירטואלי: 2^32 בתים.\n*   גודל דף: 4KB = 2^12 בתים.\n*   מספר דפים וירטואליים: 2^32 / 2^12 = 2^20 דפים.\n*   גודל כניסה בטבלת דפים (PTE): 4 בתים.\n*   מספר כניסות לטבלת דפים בדף אחד: 4KB / 4B = 1024 כניסות = 2^10 כניסות.\n*   טבלאות דפים דו-שכבתיות: 10 ביטים ל-L1 Index, 10 ביטים ל-L2 Index, 12 ביטים ל-Offset. (20 ביטים למספר דף וירטואלי).\n*   מספר מסגרות פיזיות לדפי נתונים: 4 (F0, F1, F2, F3).\n*   TLB: 4 כניסות, Fully Associative, LRU.\n*   אלגוריתם החלפת דפים (לדפי נתונים): LRU.\n\nמעקב אחר הגישות:\n\n**מצב התחלתי:**\n*   TLB: ריק (כל הכניסות לא תקפות).\n*   מסגרות פיזיות לדפי נתונים: ריקות.\n*   Page Table: כל ה-PTEs מסומנים כ-P=0 (לא נוכחים בזיכרון הפיזי).\n\n| גישה | דף וירטואלי | TLB Hit/Miss | TLB Action (LRU) | גישות לזיכרון (PT Walk) | Page Fault לדף נתונים | Page Fault Action (LRU) | TLB לאחר גישה (LRU) (MRU מימין) | מסגרות פיזיות לאחר גישה (LRU) (MRU מימין) |\n|---|---|---|---|---|---|---|---|---|\n| 1 | 0 | Miss | (0, F0) נוסף. | 2 (L1-PTE, L2-PTE) | כן | דף 0 נטען ל-F0. | [(0,F0)] | [P0@F0] |\n| 2 | 1 | Miss | (1, F1) נוסף. | 2 (L1-PTE, L2-PTE) | כן | דף 1 נטען ל-F1. | [(0,F0), (1,F1)] | [P0@F0, P1@F1] |\n| 3 | 2 | Miss | (2, F2) נוסף. | 2 (L1-PTE, L2-PTE) | כן | דף 2 נטען ל-F2. | [(0,F0), (1,F1), (2,F2)] | [P0@F0, P1@F1, P2@F2] |\n| 4 | 3 | Miss | (3, F3) נוסף. | 2 (L1-PTE, L2-PTE) | כן | דף 3 נטען ל-F3. | [(0,F0), (1,F1), (2,F2), (3,F3)] | [P0@F0, P1@F1, P2@F2, P3@F3] |\n| 5 | 0 | Hit | (0,F0) עודכן ל-MRU. | 0 | לא | - | [(1,F1), (2,F2), (3,F3), (0,F0)] | [P1@F1, P2@F2, P3@F3, P0@F0] |\n| 6 | 4 | Miss | (4, F1) החליף את (1,F1) (LRU). | 2 (L1-PTE, L2-PTE) | כן | דף 1 פונה מ-F1 (LRU). דף 4 נטען ל-F1. | [(2,F2), (3,F3), (0,F0), (4,F1)] | [P2@F2, P3@F3, P0@F0, P4@F1] |\n| 7 | 1 | Miss | (1, F2) החליף את (2,F2) (LRU). | 2 (L1-PTE, L2-PTE) | כן | דף 2 פונה מ-F2 (LRU). דף 1 נטען ל-F2. | [(3,F3), (0,F0), (4,F1), (1,F2)] | [P3@F3, P0@F0, P4@F1, P1@F2] |\n| 8 | 5 | Miss | (5, F3) החליף את (3,F3) (LRU). | 2 (L1-PTE, L2-PTE) | כן | דף 3 פונה מ-F3 (LRU). דף 5 נטען ל-F3. | [(0,F0), (4,F1), (1,F2), (5,F3)] | [P0@F0, P4@F1, P1@F2, P5@F3] |\n| 9 | 2 | Miss | (2, F0) החליף את (0,F0) (LRU). | 2 (L1-PTE, L2-PTE) | כן | דף 0 פונה מ-F0 (LRU). דף 2 נטען ל-F0. | [(4,F1), (1,F2), (5,F3), (2,F0)] | [P4@F1, P1@F2, P5@F3, P2@F0] |\n| 10 | 6 | Miss | (6, F1) החליף את (4,F1) (LRU). | 2 (L1-PTE, L2-PTE) | כן | דף 4 פונה מ-F1 (LRU). דף 6 נטען ל-F1. | [(1,F2), (5,F3), (2,F0), (6,F1)] | [P1@F2, P5@F3, P2@F0, P6@F1] |\n| 11 | 3 | Miss | (3, F2) החליף את (1,F2) (LRU). | 2 (L1-PTE, L2-PTE) | כן | דף 1 פונה מ-F2 (LRU). דף 3 נטען ל-F2. | [(5,F3), (2,F0), (6,F1), (3,F2)] | [P5@F3, P2@F0, P6@F1, P3@F2] |\n| 12 | 7 | Miss | (7, F3) החליף את (5,F3) (LRU). | 2 (L1-PTE, L2-PTE) | כן | דף 5 פונה מ-F3 (LRU). דף 7 נטען ל-F3. | [(2,F0), (6,F1), (3,F2), (7,F3)] | [P2@F0, P6@F1, P3@F2, P7@F3] |\n\n**סיכום סופי:**\n*   סה\"כ TLB Misses: 11\n*   סה\"כ Page Faults לדפי נתונים: 11\n\n**הערות לפתרון:**\n*   **חישוב עבור L1 Index ו-L2 Index:** מכיוון שגודל דף הוא 4KB (2^12 בתים) וגודל כניסה בטבלת דפים (PTE) הוא 4 בתים, כל טבלת דפים יכולה להכיל 1024 (2^10) כניסות. מרחב הכתובות הווירטואלי הוא 2^32 בתים, וגודל הדף הוא 2^12, כך שמספר הדף הווירטואלי הוא 20 ביטים. לכן, טבלת דפים דו-שכבתית תשתמש ב-10 ביטים עבור אינדקס רמה 1 (Page Directory) וב-10 ביטים עבור אינדקס רמה 2 (Page Table), ועוד 12 ביטים עבור ההיסט בתוך הדף.\n*   **גישות לזיכרון (PT Walk):** כאשר מתרחש TLB Miss, המערכת ניגשת לטבלת הדפים ברמה 1 (L1 PT) ולאחר מכן לטבלת הדפים ברמה 2 (L2 PT) כדי למצוא את מספר המסגרת הפיזית (PFN). כל אחת מגישות אלו נחשבת לגישה לזיכרון הפיזי. לכן, במקרה של TLB Miss, ישנן 2 גישות לזיכרון הפיזי לצורך תרגום הכתובת, ללא קשר אם תתרחש פסיקת דף או לא.\n*   **החלפת דפים (LRU):** יש לשים לב שאלגוריתם LRU דורש מעקב מדויק אחר סדר השימוש. עבור ה-TLB, כאשר מתרחש Hit, הכניסה שעברה אליה גישה הופכת להיות ה-Most Recently Used (MRU). עבור המסגרות הפיזיות, כאשר דף נטען או נעשה בו שימוש (גם אם דרך TLB Hit), הוא הופך להיות ה-MRU. כאשר יש צורך לפנות דף, מפוּנה הדף ה-Least Recently Used (LRU) מבין הדפים הנוכחיים בזיכרון הפיזי. במקרה של Page Fault, אם הדף המפונה (לפי LRU) נמצא ב-TLB, יש לסמן את כניסת ה-TLB כלא תקפה (invalid), אך בפתרון זה ההנחה היא שהכניסה ב-TLB שייכת לדף ה-LRU, ולכן היא תוחלף ממילא על ידי הכניסה החדשה של הדף שנטען."
    },
    "difficulty_estimation": "Hard"
  }
}