{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:00:50",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 2976,
      "total_tokens": 11192
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "Paging",
      "Virtual Memory",
      "TLB",
      "Shared Memory"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה מודרנית המשתמשת בזיכרון וירטואלי מבוסס דפדוף (paging) עם מרחב כתובות וירטואלי של 48 ביטים. גודל דף הוא 4KB. כל כניסה בטבלת הדפים (PTE) היא בגודל 8 בתים. המערכת כוללת גם TLB עם 64 כניסות, הפועל בשיטת אסוציאטיביות מלאה (fully associative).\n\nהמערכת תומכת גם בזיכרון משותף (shared memory) בין תהליכים, כאשר דפים המשותפים בין תהליכים ממופים לאותה מסגרת פיזית בזיכרון הפיזי, אך עשויים להופיע בכתובות וירטואליות שונות במרחבי הכתובות של התהליכים השונים.\n\nענו על השאלות הבאות ופרטו את כל החישובים וההנחות:",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "כמה רמות של טבלאות דפים נדרשות במערכת זו כדי למפות את מרחב הכתובות הוירטואלי? מהו גודל טבלת הדפים ברמה העליונה (root page table) בבתים?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "תהליך P1 ניגש לכתובת וירטואלית X, שאינה דף משותף. הדף המכיל את X אינו נמצא ב-TLB, אך הוא נמצא בזיכרון הפיזי (כלומר, ה-PTE שלו מסומן כ-Present=1). תארו את רצף הפעולות המלא מתחילת הגישה לכתובת X ועד לקבלת הנתונים, כולל גישות ל-TLB, לטבלאות הדפים ולזיכרון הפיזי. כמה גישות לזיכרון הראשי (RAM) מתבצעות במקרה זה?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "תהליך P2 ניגש לכתובת וירטואלית Y, הממופה לדף המשותף עם תהליך P3. נניח שהדף המשותף *אינו* ב-TLB של P2 וגם *אינו* נמצא בזיכרון הפיזי (Present=0 ב-PTE). לאחר מכן, תהליך P3 ניגש לאותה כתובת וירטואלית Y (אותו VPN), שגם עבורו הדף המשותף *אינו* ב-TLB. תארו את רצף הפעולות המלא עבור שתי הגישות (של P2 ולאחר מכן P3), כולל גישות ל-TLB, לטבלאות הדפים, לדיסק ולזיכרון הפיזי. כמה גישות לזיכרון הראשי (RAM) ולדיסק מתבצעות בסך הכל עבור שתי הגישות יחד?",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון:\n\n**1.1. חישוב רמות טבלאות הדפים וגודל טבלת הדפים ברמה העליונה:**\n*   גודל מרחב הכתובות הוירטואלי: 48 ביטים.\n*   גודל דף: 4KB = 2^12 בתים. לכן, ההיסט (offset) הוא 12 ביטים.\n*   מספר ביטים עבור מספר הדף הוירטואלי (VPN): 48 - 12 = 36 ביטים.\n*   גודל כניסה בטבלת הדפים (PTE): 8 בתים.\n*   מספר כניסות PTE שיכולות להיכנס לדף אחד: 4KB / 8 בתים/PTE = 512 כניסות (2^9 כניסות).\n*   לכן, כל רמה בטבלת הדפים משתמשת ב-9 ביטים מתוך ה-VPN כדי לאנדקס את הכניסה המתאימה.\n*   מספר רמות טבלאות הדפים הנדרשות: 36 ביטים / 9 ביטים לרמה = 4 רמות.\n*   טבלת הדפים ברמה העליונה (root page table) מכילה 512 כניסות (כיוון שהיא מאוחסנת בדף אחד). גודלה בבתים: 512 כניסות * 8 בתים/כניסה = 4096 בתים = 4KB.\n\n**תשובה:** נדרשות 4 רמות של טבלאות דפים. גודל טבלת הדפים ברמה העליונה הוא 4KB.\n\n**1.2. רצף פעולות עבור גישה לכתובת וירטואלית X (דף פרטי, TLB Miss, Page Table Hit):**\n1.  **גישה ל-TLB:** המעבד מנסה לתרגם את הכתובת הוירטואלית X באמצעות ה-TLB. מכיוון שהדף אינו ב-TLB (TLB Miss), תתרחש החמאה ב-TLB.\n2.  **גישה לטבלאות הדפים (4 רמות):** מערכת ההפעלה תתחיל לעבור על טבלאות הדפים כדי למצוא את ה-PTE המתאים:\n    *   גישה לזיכרון הראשי כדי לקרוא את הכניסה המתאימה מטבלת הדפים ברמה 1.\n    *   גישה לזיכרון הראשי כדי לקרוא את הכניסה המתאימה מטבלת הדפים ברמה 2.\n    *   גישה לזיכרון הראשי כדי לקרוא את הכניסה המתאימה מטבלת הדפים ברמה 3.\n    *   גישה לזיכרון הראשי כדי לקרוא את ה-PTE הסופי מטבלת הדפים ברמה 4. מכיוון שהדף נמצא בזיכרון הפיזי (Present=1), ה-PTE יכיל את מספר המסגרת הפיזית (PFN).\n3.  **עדכון TLB:** ה-PTE שנמצא בטבלאות הדפים יוכנס ל-TLB. מכיוון שה-TLB מלא אסוציאטיבי, הוא יוכנס לאחת הכניסות (בהתאם למדיניות ההחלפה).\n4.  **גישה לזיכרון הפיזי:** המעבד משתמש ב-PFN שהתקבל וב-offset מכתובת X כדי לגשת לכתובת הפיזית ולקבל את הנתונים.\n\n**סה\"כ גישות לזיכרון הראשי (RAM):**\n*   4 גישות לטבלאות הדפים (אחת לכל רמה).\n*   1 גישה לנתונים עצמם.\n*   סה\"כ: 5 גישות לזיכרון הראשי.\n\n**תשובה:** 5 גישות לזיכרון הראשי.\n\n**1.3. רצף פעולות עבור גישות לכתובת וירטואלית Y (דף משותף, TLB Miss, Page Fault):**\n\n**עבור גישת P2 לכתובת Y:**\n1.  **גישה ל-TLB של P2:** המעבד מנסה לתרגם את הכתובת Y. TLB Miss (הדף אינו ב-TLB).\n2.  **גישה לטבלאות הדפים של P2 (4 רמות):** מערכת ההפעלה עוברת על טבלאות הדפים של P2.\n    *   4 גישות לזיכרון הראשי לקריאת ה-PTEs ברמות 1-4.\n    *   ה-PTE הסופי נמצא, אך Present=0 (הדף אינו בזיכרון הפיזי).\n3.  **Page Fault:** מכיוון ש-Present=0, תתרחש פסיקת דף (page fault).\n    *   **טיפול בפסיקת הדף:**\n        *   מערכת ההפעלה בוחרת מסגרת פיזית פנויה (או מפנה אחת, אם אין). נניח שהיא בוחרת מסגרת F.\n        *   מערכת ההפעלה טוענת את תוכן הדף המבוקש מהדיסק למסגרת F. זוהי **גישה לדיסק** (קריאה).\n        *   מערכת ההפעלה מעדכנת את ה-PTE של דף Y בטבלאות הדפים של P2 עם ה-PFN של מסגרת F, ומסמנת Present=1 ו-Dirty=0 (אם הדף לא השתנה).\n        *   **גישה לזיכרון הראשי** לעדכון ה-PTE.\n4.  **עדכון TLB של P2:** ה-PTE המעודכן (VPN של Y, PFN של F) מוכנס ל-TLB של P2.\n5.  **גישה לזיכרון הפיזי:** המעבד משתמש ב-PFN וב-offset כדי לגשת לכתובת הפיזית ולקבל את הנתונים.\n\n**סה\"כ עבור P2:**\n*   גישות ל-RAM: 4 (לטבלאות דפים) + 1 (לעדכון PTE) + 1 (לנתונים) = 6 גישות.\n*   גישות לדיסק: 1 (לטעינת הדף).\n\n**עבור גישת P3 לכתובת Y (אותו דף משותף):**\n1.  **גישה ל-TLB של P3:** המעבד מנסה לתרגם את הכתובת Y. TLB Miss (הדף אינו ב-TLB של P3).\n2.  **גישה לטבלאות הדפים של P3 (4 רמות):** מערכת ההפעלה עוברת על טבלאות הדפים של P3.\n    *   4 גישות לזיכרון הראשי לקריאת ה-PTEs ברמות 1-4. (חשוב לזכור ש-P3 צריך את ה-PTE שלו. הדף *כבר* בזיכרון הפיזי בזכות P2, לכן ה-PTE של P3 יהיה Present=1 ומצביע על אותה מסגרת F). \n    *   מערכת ההפעלה תמצא את ה-PTE המתאים שמצביע על אותה מסגרת פיזית F, עם Present=1.\n3.  **עדכון TLB של P3:** ה-PTE שנמצא (VPN של Y, PFN של F) מוכנס ל-TLB של P3.\n4.  **גישה לזיכרון הפיזי:** המעבד משתמש ב-PFN וב-offset כדי לגשת לכתובת הפיזית ולקבל את הנתונים.\n\n**סה\"כ עבור P3:**\n*   גישות ל-RAM: 4 (לטבלאות דפים) + 1 (לנתונים) = 5 גישות.\n*   גישות לדיסק: 0 (הדף כבר נטען ע\"י P2).\n\n**סה\"כ עבור שתי הגישות יחד:**\n*   סה\"כ גישות לזיכרון הראשי (RAM): 6 (עבור P2) + 5 (עבור P3) = 11 גישות.\n*   סה\"כ גישות לדיסק: 1 (עבור P2) + 0 (עבור P3) = 1 גישה.\n\n**תשובה:** 11 גישות לזיכרון הראשי ו-1 גישה לדיסק."
    },
    "difficulty_estimation": "Hard"
  }
}