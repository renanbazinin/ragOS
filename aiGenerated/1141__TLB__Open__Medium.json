{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "TLB",
    "requested_type": "Open",
    "requested_difficulty": "Medium",
    "generated_at": "2026-02-08 08:11:34",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 2223,
      "output_tokens": 1377,
      "total_tokens": 7281
    }
  },
  "question": {
    "id": 10,
    "type": "Open",
    "topic": [
      "TLB",
      "Virtual Memory",
      "Paging",
      "Memory Management",
      "Context Switch"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת במנגנון זיכרון וירטואלי עם טבלאות דפים דו-שכבתיות (two-level paging) וכן ברכיב TLB (Translation Lookaside Buffer) לשיפור ביצועי תרגום הכתובות.\nא. תאר/י בפירוט את תהליך תרגום כתובת וירטואלית לכתובת פיזית במערכת זו, החל מרגע גישת המעבד לכתובת הווירטואלית ועד לקבלת הכתובת הפיזית, תוך התייחסות למצב של TLB hit ולמצב של TLB miss.\nב. הסבר/י מדוע יש צורך לבצע פעולות מסוימות על ה-TLB בעת החלפת הקשר (context switch) בין תהליכים, ותאר/י אילו פעולות אלו עשויות להיות.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "חלק א': תהליך תרגום כתובת וירטואלית\n1.  קבלת כתובת וירטואלית: המעבד יוצר כתובת וירטואלית.\n2.  בדיקת TLB: ה-MMU מפרק את הכתובת הווירטואלית למספר דף וירטואלי (VPN) והיסט (offset). ה-VPN נשלח ל-TLB.\n    *   TLB Hit: אם ה-VPN נמצא ב-TLB, ה-TLB מחזיר באופן מיידי את מספר המסגרת הפיזית (PFN) המתאים. ה-PFN משולב עם ההיסט כדי ליצור את הכתובת הפיזית, והגישה לזיכרון מתבצעת. זהו תהליך מהיר מאוד.\n    *   TLB Miss: אם ה-VPN אינו נמצא ב-TLB, יש צורך לגשת לטבלאות הדפים בזיכרון הראשי.\n        *   גישה לטבלת דפים ברמה ראשונה: ה-MMU משתמש בחלק הראשון של ה-VPN כדי לאתר את הכניסה המתאימה בטבלת הדפים ברמה הראשונה (Page Directory). כניסה זו מכילה מצביע (או PFN) לטבלת הדפים ברמה השנייה.\n        *   גישה לטבלת דפים ברמה שנייה: ה-MMU משתמש בחלק השני של ה-VPN כדי לאתר את הכניסה המתאימה בטבלת הדפים ברמה השנייה (Page Table). כניסה זו מכילה את ה-PFN של הדף המבוקש, יחד עם ביטי הרשאות וסטטוס.\n        *   עדכון TLB: לאחר מציאת ה-PFN בטבלאות הדפים, הצמד (VPN, PFN) נטען ל-TLB לשימוש עתידי (בהתאם למדיניות ההחלפה של ה-TLB).\n        *   יצירת כתובת פיזית: ה-PFN משולב עם ההיסט כדי ליצור את הכתובת הפיזית, והגישה לזיכרון מתבצעת.\n3.  גישה לזיכרון: הכתובת הפיזית משמשת לגישה לנתונים בזיכרון הפיזי.\n\nחלק ב': TLB והחלפת הקשר (Context Switch)\nבעת החלפת הקשר, מערכת ההפעלה מחליפה בין תהליך אחד לאחר. לכל תהליך יש מרחב כתובות וירטואלי משלו וטבלאות דפים משלו (או לפחות טבלת דפים ראשית משלו). אם ה-TLB הכיל כניסות מתהליך A, וכעת תהליך B מתחיל לרוץ, כניסות אלו אינן רלוונטיות (ואף שגויות ומסוכנות) עבור תהליך B.\nלכן, יש צורך לבצע אחת מהפעולות הבאות:\n*   ניקוי (Flush) מלא של ה-TLB: זוהי הגישה הנפוצה והפשוטה ביותר. כל הכניסות ב-TLB מנוקות, כך שה-TLB ריק. כאשר תהליך B יתחיל לגשת לכתובות, ה-TLB יתמלא מחדש בכניסות הרלוונטיות עבורו. חיסרון: גורם לביצועים נמוכים בתחילת ריצת התהליך החדש עקב ריבוי TLB misses.\n*   שימוש ב-ASID (Address Space Identifier): מעבדים מסוימים תומכים ב-ASID. כל כניסה ב-TLB מקושרת גם ל-ASID של התהליך שיצר אותה. בעת החלפת קשר, אין צורך לנקות את ה-TLB כולו. במקום זאת, ה-MMU פשוט משנה את ה-ASID הפעיל. כניסות TLB עם ASID שאינו תואם את ה-ASID הפעיל פשוט לא יימצאו. זה מאפשר לכניסות מתהליכים שונים להישאר ב-TLB בו זמנית, מה שיכול לשפר ביצועים במקרים מסוימים (למשל, החלפות קשר תכופות בין מספר קטן של תהליכים)."
    },
    "difficulty_estimation": "Medium"
  }
}