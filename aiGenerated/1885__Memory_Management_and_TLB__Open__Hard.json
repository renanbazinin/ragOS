{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 21:30:32",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 5472,
      "total_tokens": 22601
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה עם ארכיטקטורת 64 ביט וזיכרון וירטואלי של 40 ביט (כלומר, הכתובות הוירטואליות הן בנות 40 ביט). גודל הדף הוא 4KB. מערכת טבלאות הדפים היא תלת-רמתית (3-level page table), כאשר חלוקת הביטים עבור מספרי הדפים הוירטואליים היא: 10 ביטים לרמה הראשונה, 9 ביטים לרמה השנייה, ו-9 ביטים לרמה השלישית. גודל כל כניסה בטבלת הדפים (PTE) הוא 8 בתים. \n\nבמערכת קיים TLB בגודל 16 כניסות, בגישת אסוציאטיביות 2-כיוונית (2-way set associative) עם מדיניות החלפה LRU. ה-TLB מחשב את אינדקס הסט (Set Index) ע\"י הפעלת מודולו 8 על מספר הדף הוירטואלי (VPN % 8).\n\nבהתחלה, ה-TLB ריק. נתון כי כל הדפים הדרושים נמצאים בזיכרון הפיזי, למעט במקרים שבהם ביט ה-Present (P bit) ב-PTE שווה ל-0.\n\nחשב/י את מספר הגישות לזיכרון הראשי (Main Memory), מספר הפסילות ב-TLB (TLB Misses), ומספר פסיקות הדף (Page Faults) עבור סדרת הגישות לכתובות הוירטואליות הבאות:\n\n0x0000A000\n0x0000B000\n0x0000A000\n0x0000C000\n0x0000A000\n0x0000D000\n0x0000E000\n0x0000F000\n0x00010000\n0x00011000\n0x00012000\n0x00013000\n0x00014000\n0x00015000\n0x00016000\n0x00017000\n0x00018000\n0x00019000\n0x0001A000\n0x0001B000\n\n**הנחות נוספות:**\n*   כל גישה ל-TLB נחשבת כגישה נפרדת (אך אינה גישה לזיכרון הראשי). \n*   כל גישה לזיכרון הראשי (לקריאת PTE או נתונים) נחשבת כגישה נפרדת. \n*   PTEs הדרושים עבור כתובות בטווח 0x0000A000 עד 0x0000F000 קיימים ו-Present בטבלאות הדפים.\n*   PTEs הדרושים עבור כתובות בטווח 0x00010000 עד 0x0001B000 קיימים בטבלאות הדפים אך ביט ה-Present שלהם הוא 0, ולכן יגרמו ל-Page Fault.\n*   כל Page Fault גורם לגישה לדיסק (page-in) ועוד גישה אחת לזיכרון הראשי (לעדכון ה-PTE לאחר טעינת הדף). לאחר מכן, ה-PTE החדש נטען ל-TLB. אין צורך להתחשב בעלות של כתיבת דף לדיסק (page-out).",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "**ניתוח מבנה הזיכרון הוירטואלי וה-TLB:**\n*   **כתובת וירטואלית:** 40 ביט.\n*   **גודל דף:** 4KB (2^12 בתים). לכן, ההיסט (Offset) הוא 12 ביטים.\n*   **מספר דף וירטואלי (VPN):** 40 - 12 = 28 ביטים.\n*   **טבלת דפים תלת-רמתית:**\n    *   רמה 1: 10 ביטים.\n    *   רמה 2: 9 ביטים.\n    *   רמה 3: 9 ביטים.\n    *   סה\"כ ביטים למספר דף: 10 + 9 + 9 = 28 ביטים. (תואם ל-VPN).\n*   **גודל כניסה בטבלת דפים (PTE):** 8 בתים.\n*   **TLB:** 16 כניסות, 2-כיווני אסוציאטיבי.\n    *   מספר סטים ב-TLB: 16 כניסות / 2 כיוונים = 8 סטים.\n    *   אינדקס הסט ב-TLB: מחושב ע\"י VPN % 8 (3 ביטים).\n    *   ה-Tag ב-TLB: שאר ביטי ה-VPN (28 - 3 = 25 ביטים).\n*   **עלויות גישה:**\n    *   **TLB Hit:** 0 גישות לזיכרון הראשי (ה-PTE נמצא ב-TLB).\n    *   **TLB Miss (ללא Page Fault):** 3 גישות לזיכרון הראשי (עבור Page Table Walk – קריאת 3 PTEs ברמות השונות). לאחר מכן, ה-PTE נטען ל-TLB.\n    *   **TLB Miss (עם Page Fault):**\n        1.  3 גישות לזיכרון הראשי (עבור Page Table Walk, אשר יגלה שה-P bit הוא 0).\n        2.  גישה לדיסק (page-in). (זוהי גישת I/O, לא גישת זיכרון ראשי CPU)\n        3.  1 גישה לזיכרון הראשי (לעדכון ה-PTE עם ה-PFN החדש ו-P bit = 1).\n        4.  לאחר מכן, ה-PTE נטען ל-TLB.\n        סה\"כ: 4 גישות לזיכרון הראשי + גישת דיסק אחת.\n\n**המרת כתובות ל-VPN וחישוב TLB Index/Tag:**\nנמיר את הכתובות ההקסה-דצימליות למספרי דף וירטואליים (VPN) על ידי חלוקה בגודל הדף (4KB = 4096). לאחר מכן, נחשב את ה-TLB Index (VPN % 8) ואת ה-TLB Tag (VPN / 8).\n\n| כתובת וירטואלית | VPN (עשרוני) | TLB Index (VPN % 8) | TLB Tag (VPN / 8) |\n|--------------------|---------------|----------------------|--------------------|\n| 0x0000A000         | 10            | 2                    | 1                  |\n| 0x0000B000         | 11            | 3                    | 1                  |\n| 0x0000A000         | 10            | 2                    | 1                  |\n| 0x0000C000         | 12            | 4                    | 1                  |\n| 0x0000A000         | 10            | 2                    | 1                  |\n| 0x0000D000         | 13            | 5                    | 1                  |\n| 0x0000E000         | 14            | 6                    | 1                  |\n| 0x0000F000         | 15            | 7                    | 1                  |\n| 0x00010000         | 16            | 0                    | 2                  |\n| 0x00011000         | 17            | 1                    | 2                  |\n| 0x00012000         | 18            | 2                    | 2                  |\n| 0x00013000         | 19            | 3                    | 2                  |\n| 0x00014000         | 20            | 4                    | 2                  |\n| 0x00015000         | 21            | 5                    | 2                  |\n| 0x00016000         | 22            | 6                    | 2                  |\n| 0x00017000         | 23            | 7                    | 2                  |\n| 0x00018000         | 24            | 0                    | 3                  |\n| 0x00019000         | 25            | 1                    | 3                  |\n| 0x0001A000         | 26            | 2                    | 3                  |\n| 0x0001B000         | 27            | 3                    | 3                  |\n\n**מעקב אחר גישות לזיכרון ו-TLB:**\nנשתמש ב-8 סטים, כאשר כל סט יכול להכיל 2 כניסות (2-way associative) ובמדיניות LRU.\n\n**Initial State:** TLB empty. Total MM Accesses = 0, TLB Misses = 0, Page Faults = 0.\n\n1.  **VPN 10 (Set 2, Tag 1):**\n    *   TLB Miss (TLB ריק).\n    *   Page Table Walk: 3 גישות לזיכרון הראשי (PTEs קיימים ו-Present).\n    *   הוספה ל-TLB (Set 2: [VPN 10]).\n    *   **MM: 3, TLB Misses: 1, PFs: 0.**\n\n2.  **VPN 11 (Set 3, Tag 1):**\n    *   TLB Miss.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 3: [VPN 11]).\n    *   **MM: 3+3=6, TLB Misses: 1+1=2, PFs: 0.**\n\n3.  **VPN 10 (Set 2, Tag 1):**\n    *   TLB Hit.\n    *   עדכון LRU (VPN 10 הוא ה-MRU ב-Set 2).\n    *   **MM: 6, TLB Misses: 2, PFs: 0.**\n\n4.  **VPN 12 (Set 4, Tag 1):**\n    *   TLB Miss.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 4: [VPN 12]).\n    *   **MM: 6+3=9, TLB Misses: 2+1=3, PFs: 0.**\n\n5.  **VPN 10 (Set 2, Tag 1):**\n    *   TLB Hit.\n    *   עדכון LRU (VPN 10 הוא ה-MRU ב-Set 2).\n    *   **MM: 9, TLB Misses: 3, PFs: 0.**\n\n6.  **VPN 13 (Set 5, Tag 1):**\n    *   TLB Miss.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 5: [VPN 13]).\n    *   **MM: 9+3=12, TLB Misses: 3+1=4, PFs: 0.**\n\n7.  **VPN 14 (Set 6, Tag 1):**\n    *   TLB Miss.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 6: [VPN 14]).\n    *   **MM: 12+3=15, TLB Misses: 4+1=5, PFs: 0.**\n\n8.  **VPN 15 (Set 7, Tag 1):**\n    *   TLB Miss.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 7: [VPN 15]).\n    *   **MM: 15+3=18, TLB Misses: 5+1=6, PFs: 0.**\n\n9.  **VPN 16 (Set 0, Tag 2):**\n    *   TLB Miss.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי (לעדכון PTE) + גישה לדיסק.\n    *   הוספה ל-TLB (Set 0: [VPN 16]).\n    *   **MM: 18+3+1=22, TLB Misses: 6+1=7, PFs: 0+1=1.**\n\n10. **VPN 17 (Set 1, Tag 2):**\n    *   TLB Miss.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 1: [VPN 17]).\n    *   **MM: 22+3+1=26, TLB Misses: 7+1=8, PFs: 1+1=2.**\n\n11. **VPN 18 (Set 2, Tag 2):**\n    *   TLB Miss (Set 2 מכיל רק את VPN 10). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 2: [VPN 10, VPN 18]).\n    *   **MM: 26+3+1=30, TLB Misses: 8+1=9, PFs: 2+1=3.**\n\n12. **VPN 19 (Set 3, Tag 2):**\n    *   TLB Miss (Set 3 מכיל רק את VPN 11). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 3: [VPN 11, VPN 19]).\n    *   **MM: 30+3+1=34, TLB Misses: 9+1=10, PFs: 3+1=4.**\n\n13. **VPN 20 (Set 4, Tag 2):**\n    *   TLB Miss (Set 4 מכיל רק את VPN 12). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 4: [VPN 12, VPN 20]).\n    *   **MM: 34+3+1=38, TLB Misses: 10+1=11, PFs: 4+1=5.**\n\n14. **VPN 21 (Set 5, Tag 2):**\n    *   TLB Miss (Set 5 מכיל רק את VPN 13). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 5: [VPN 13, VPN 21]).\n    *   **MM: 38+3+1=42, TLB Misses: 11+1=12, PFs: 5+1=6.**\n\n15. **VPN 22 (Set 6, Tag 2):**\n    *   TLB Miss (Set 6 מכיל רק את VPN 14). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 6: [VPN 14, VPN 22]).\n    *   **MM: 42+3+1=46, TLB Misses: 12+1=13, PFs: 6+1=7.**\n\n16. **VPN 23 (Set 7, Tag 2):**\n    *   TLB Miss (Set 7 מכיל רק את VPN 15). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 7: [VPN 15, VPN 23]).\n    *   **MM: 46+3+1=50, TLB Misses: 13+1=14, PFs: 7+1=8.**\n\n17. **VPN 24 (Set 0, Tag 3):**\n    *   TLB Miss (Set 0 מכיל רק את VPN 16). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 0: [VPN 16, VPN 24]).\n    *   **MM: 50+3+1=54, TLB Misses: 14+1=15, PFs: 8+1=9.**\n\n18. **VPN 25 (Set 1, Tag 3):**\n    *   TLB Miss (Set 1 מכיל רק את VPN 17). אין התנגשות ב-Tag.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 1: [VPN 17, VPN 25]).\n    *   **MM: 54+3+1=58, TLB Misses: 15+1=16, PFs: 9+1=10.**\n\n19. **VPN 26 (Set 2, Tag 3):**\n    *   TLB Miss (Set 2 מכיל את VPN 10 (LRU) ו-VPN 18 (MRU)). VPN 10 מוחלף לפי מדיניות LRU.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 2: [VPN 18, VPN 26]).\n    *   **MM: 58+3+1=62, TLB Misses: 16+1=17, PFs: 10+1=11.**\n\n20. **VPN 27 (Set 3, Tag 3):**\n    *   TLB Miss (Set 3 מכיל את VPN 11 (LRU) ו-VPN 19 (MRU)). VPN 11 מוחלף לפי מדיניות LRU.\n    *   Page Table Walk: 3 גישות לזיכרון הראשי. נמצא P bit = 0. **Page Fault!**\n    *   Page Fault Cost: 1 גישה לזיכרון הראשי.\n    *   הוספה ל-TLB (Set 3: [VPN 19, VPN 27]).\n    *   **MM: 62+3+1=66, TLB Misses: 17+1=18, PFs: 11+1=12.**\n\n**סיכום סופי:**\n*   **סה\"כ גישות לזיכרון הראשי (Main Memory Accesses): 66**\n*   **סה\"כ פסילות ב-TLB (TLB Misses): 18**\n*   **סה\"כ פסיקות דף (Page Faults): 12**"
    },
    "difficulty_estimation": "Hard"
  }
}