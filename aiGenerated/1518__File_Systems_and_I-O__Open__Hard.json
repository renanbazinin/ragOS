{
  "metadata": {
    "source": "ai_generated",
    "subject": "File Systems",
    "topic_hint": "File Systems and I/O",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 11:02:07",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4088,
      "output_tokens": 4556,
      "total_tokens": 15370
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "File Systems",
      "I/O"
    ],
    "content": {
      "text": "נתונה מערכת קבצים חדשה בשם VSFS-Lite. מאפייני המערכת:\n*   גודל בלוק: 4KB.\n*   גודל Inode: 256 בתים.\n*   כל Inode מסוגל לאחסן עד 128 בתים של נתוני קובץ ישירות בתוכו (inline data).\n*   אם גודל הקובץ חורג מ-128 בתים, ה-Inode מתחיל להשתמש במצביעים: 10 מצביעים ישירים, מצביע עקיף יחיד אחד, ומצביע עקיף כפול אחד. גודל מצביע הוא 4 בתים.\n*   רשומת תיקייה מכילה שם קובץ (עד 255 תווים) ומספר Inode (4 בתים).\n*   מערכת הקבצים משתמשת ב-metadata journaling (בלוקי נתונים נכתבים ישירות למיקומם הסופי, שינויי metadata נכתבים ללוג).\n\nעליך לענות על הסעיפים הבאים, תוך פירוט ונימוק כל צעד וחישוב.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "משתמש יוצר קובץ חדש `/home/user/my_document.txt` וכותב אליו 200 בתים. לאחר מכן, הוא מוסיף (append) עוד 4KB לקובץ. נתון שאף cache אינו מכיל מידע רלוונטי לביצוע הפעולה כולה. מה המספר המינימלי הכולל של פעולות קריאה וכתיבה מהדיסק הנדרשות עבור כל הפעולות שתוארו (יצירה, כתיבה ראשונית והוספה)? יש לפרט את סוגי הבלוקים הנקראים והנכתבים בכל שלב משמעותי.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "בהתבסס על תרחיש ההוספה (append) של 4KB לקובץ מסעיף 1.1: תאר נקודת כשל ספציפית (קריסה של המערכת) שעלולה להתרחש *ללא שימוש ב-journaling* ולגרום למצב לא עקבי במערכת הקבצים. הסבר מדוע מצב זה לא עקבי, וכיצד מנגנון ה-metadata journaling (כפי שתואר) מונע חוסר עקביות זה.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "חשב את הגודל המקסימלי של קובץ הנתמך במערכת קבצים זו. בנוסף, כמה רשומות תיקייה (directory entries) יכול בלוק נתונים יחיד בגודל 4KB של תיקייה להכיל לכל היותר?",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": false,
      "correct_option": null,
      "explanation": "פתרון לשאלה 1:\n\n**סעיף 1.1: חישוב קריאות וכתיבות מינימליות**\nנניח שכל גישה לבלוק שאינו במטמון נחשבת לקריאה/כתיבה נפרדת. הנתון \"אף cache אינו מכיל מידע רלוונטי לביצוע הפעולה כולה\" אומר שלכל שלב הגיוני בפעולה (למשל, יצירה ואז הוספה), נצטרך לקרוא מחדש בלוקים שייתכן ונקראו קודם אם הם לא נשמרים באופן לוגי בין השלבים.\n\n**חלק א': יצירת קובץ וכתיבת 200 בתים**\nפעולה זו כוללת: איתור נתיב, הקצאת Inode, הקצאת בלוק נתונים (כי 200 בתים חורגים מ-128), עדכון Inode, עדכון בלוק הנתונים של תיקיית האב, כתיבת נתונים.\n\n**קריאות מהדיסק (לפני וכחלק מהטרנזקציה):**\n1.  קריאת Superblock (למציאת מפות סיביות וראש ה-journal). (1 Read)\n2.  קריאת Inode של `/` (לשם איתור `home`). (1 Read)\n3.  קריאת בלוק הנתונים של `/` (למציאת רשומת `home`). (1 Read)\n4.  קריאת Inode של `home` (לשם איתור `user`). (1 Read)\n5.  קריאת בלוק הנתונים של `home` (למציאת רשומת `user`). (1 Read)\n6.  קריאת Inode של `user` (לשם איתור `my_document.txt` ובדיקה שאינו קיים). (1 Read)\n7.  קריאת בלוק הנתונים של `user` (למציאת רשומת `my_document.txt` ובדיקה שאינו קיים). (1 Read)\n8.  קריאת Inode Bitmap (למציאת Inode פנוי). (1 Read)\n9.  קריאת Data Bitmap (למציאת בלוק נתונים פנוי). (1 Read)\n**סה\"כ קריאות לחלק א': 9**\n\n**כתיבות לדיסק (טרנזקציית journaling + כתיבת נתונים):**\n1.  כתיבת TxB (Transaction Begin) ל-journal. (1 Write)\n2.  כתיבת עדכון Inode Bitmap ל-journal (סימון Inode כפנוי). (1 Write)\n3.  כתיבת עדכון Data Bitmap ל-journal (סימון בלוק נתונים כפנוי). (1 Write)\n4.  כתיבת Inode חדש ל-journal (כולל גודל, מצביע לבלוק נתונים, זמנים). (1 Write)\n5.  כתיבת עדכון בלוק הנתונים של `user` ל-journal (הוספת רשומת `my_document.txt`). (1 Write)\n6.  כתיבת עדכון Inode של `user` ל-journal (עדכון זמן שינוי). (1 Write)\n7.  כתיבת 200 בתים לבלוק הנתונים שהוקצה. (1 Write למיקום הסופי של הנתונים)\n8.  כתיבת TxE (Transaction End) ל-journal. (1 Write)\n9.  Checkpointing: כתיבת Inode Bitmap מעודכן למיקומו הקבוע בדיסק. (1 Write)\n10. Checkpointing: כתיבת Data Bitmap מעודכן למיקומו הקבוע בדיסק. (1 Write)\n11. Checkpointing: כתיבת Inode החדש למיקומו הקבוע בדיסק. (1 Write)\n12. Checkpointing: כתיבת בלוק הנתונים המעודכן של `user` למיקומו הקבוע בדיסק. (1 Write)\n13. Checkpointing: כתיבת Inode המעודכן של `user` למיקומו הקבוע בדיסק. (1 Write)\n14. ניקוי רשומת הטרנזקציה מה-journal (למשל, עדכון ראש ה-journal ב-Superblock). (1 Write)\n**סה\"כ כתיבות לחלק א': 14**\n\n**חלק ב': הוספת 4KB לקובץ**\nפעולה זו כוללת: איתור נתיב, איתור Inode של הקובץ, הקצאת בלוק נתונים נוסף, עדכון Inode, כתיבת נתונים.\n\n**קריאות מהדיסק (לפני וכחלק מהטרנזקציה):**\n1.  קריאת Superblock (כמו קודם, מניחים 'no cache'). (1 Read)\n2.  קריאת Inode של `/`. (1 Read)\n3.  קריאת בלוק הנתונים של `/`. (1 Read)\n4.  קריאת Inode של `home`. (1 Read)\n5.  קריאת בלוק הנתונים של `home`. (1 Read)\n6.  קריאת Inode של `user`. (1 Read)\n7.  קריאת בלוק הנתונים של `user` (למציאת רשומת `my_document.txt` ומספר ה-Inode שלו). (1 Read)\n8.  קריאת Inode של `my_document.txt` (כדי לקבל את גודל הקובץ הנוכחי והמצביעים). (1 Read)\n9.  קריאת Data Bitmap (למציאת בלוק נתונים פנוי נוסף). (1 Read)\n**סה\"כ קריאות לחלק ב': 9**\n\n**כתיבות לדיסק (טרנזקציית journaling + כתיבת נתונים):**\n1.  כתיבת TxB ל-journal. (1 Write)\n2.  כתיבת עדכון Data Bitmap ל-journal (סימון בלוק נתונים כפנוי). (1 Write)\n3.  כתיבת Inode מעודכן של `my_document.txt` ל-journal (כולל גודל חדש, מצביע חדש, זמנים). (1 Write)\n4.  כתיבת 4KB לבלוק הנתונים החדש שהוקצה. (1 Write למיקום הסופי של הנתונים)\n5.  כתיבת TxE ל-journal. (1 Write)\n6.  Checkpointing: כתיבת Data Bitmap מעודכן למיקומו הקבוע בדיסק. (1 Write)\n7.  Checkpointing: כתיבת Inode המעודכן של `my_document.txt` למיקומו הקבוע בדיסק. (1 Write)\n8.  ניקוי רשומת הטרנזקציה מה-journal. (1 Write)\n**סה\"כ כתיבות לחלק ב': 8**\n\n**סה\"כ פעולות קריאה וכתיבה:**\n*   **סה\"כ קריאות:** 9 (חלק א') + 9 (חלק ב') = **18 קריאות**\n*   **סה\"כ כתיבות:** 14 (חלק א') + 8 (חלק ב') = **22 כתיבות**\n\n--- \n\n**סעיף 1.2: עקביות קריסה במהלך הוספה (append)**\n\n**נקודת כשל ללא journaling:**\nתרחיש ההוספה (append) של 4KB כולל את השלבים הבאים (בלי journaling):\n1.  הקצאת בלוק נתונים חדש (עדכון Data Bitmap בדיסק). (Write 1)\n2.  כתיבת 4KB הנתונים לבלוק הנתונים החדש. (Write 1)\n3.  עדכון ה-Inode של `my_document.txt` (עדכון גודל הקובץ, הוספת מצביע לבלוק החדש, עדכון זמן שינוי) וכתיבתו לדיסק. (Write 1)\n\nנקודת כשל בעייתית במיוחד תתרחש אם המערכת קורסת *לאחר שלב 2 (הנתונים החדשים נכתבו לדיסק)* אך *לפני שלב 3 (ה-Inode של הקובץ עודכן ונכתב לדיסק)*.\n\n**הסבר לחוסר העקביות:**\nבמצב זה, ה-4KB החדשים נכתבו לבלוק נתונים בדיסק, וגם ה-Data Bitmap עודכן כדי לסמן את הבלוק הזה כתפוס. עם זאת, ה-Inode של הקובץ עדיין נמצא במצבו הישן בדיסק – הוא אינו מכיל מצביע לבלוק החדש וגודל הקובץ הרשום בו אינו כולל את ה-4KB שהתווספו. לאחר התאוששות מהקריסה:\n*   מנקודת מבטו של הקובץ, הנתונים החדשים 'אבדו', שכן ה-Inode אינו מצביע עליהם, וגודל הקובץ אינו משקף אותם.\n*   מנקודת מבטה של מערכת הקבצים, בלוק הנתונים החדש מסומן כתפוס ב-Data Bitmap אך אינו משויך לאף קובץ (כי אף Inode אינו מצביע עליו). זוהי 'דליפת מקום' (space leak) – בלוק תפוס אך לא בשימוש יעיל, מה שעלול להוביל לחוסר מקום או לנתונים פגומים.\n\n**כיצד metadata journaling מונע חוסר עקביות זה:**\nmetadata journaling מטפל בבעיה זו על ידי הבטחת אטומיות (atomicity) של שינויי ה-metadata. כל שינוי ב-metadata (כמו עדכון ה-Data Bitmap ועדכון ה-Inode של הקובץ) נרשם תחילה ללוג (journal) לפני שהוא נכתב למיקומו הסופי בדיסק. הנתונים עצמם (ה-4KB החדשים) נכתבים ישירות למיקומם הסופי.\n\nאם קריסה מתרחשת בנקודה שתוארה (לאחר כתיבת 4KB הנתונים אך לפני עדכון ה-Inode בדיסק), יש שני תרחישים עיקריים:\n1.  **הטרנזקציה עדיין לא נרשמה כ-committed ב-journal (כלומר, ה-TxE לא נכתב):** במקרה זה, לאחר התאוששות, מערכת הקבצים תתעלם מהטרנזקציה הלא שלמה ב-journal. ה-Inode של הקובץ וה-Data Bitmap יחזרו למצבם שלפני הניסיון לבצע את ההוספה. בלוק הנתונים שבו נכתבו ה-4KB עשוי להישאר עם הנתונים, אך הוא ישוחרר על ידי כלי fsck (או יסומן כפנוי ב-Data Bitmap אם גם שינוי ה-bitmap לא שוקף במלואו ל-journal). העיקר הוא שאין חוסר עקביות ב-metadata – הקובץ נשאר שלם במצבו הקודם, ובלוק הנתונים הפנוי (או הלא משויך) יטופל.\n2.  **הטרנזקציה נרשמה כ-committed ב-journal (כלומר, ה-TxE נכתב בהצלחה):** במקרה זה, גם אם ה-Inode המעודכן לא נכתב למיקומו הסופי בדיסק לפני הקריסה, תהליך ההתאוששות יזהה את הטרנזקציה השלמה ב-journal. מערכת הקבצים תבצע 'replay' של הלוג ותכתוב את ה-Inode המעודכן למיקומו הסופי בדיסק. כך, ה-Inode יכלול את המצביע לבלוק החדש ואת גודל הקובץ המעודכן, והקובץ יהיה עקבי.\n\nבכל מקרה, ה-metadata תישאר עקבית, ונתוני הקובץ לא יאבדו או יגרמו לחוסר עקביות במבנה מערכת הקבצים.\n\n--- \n\n**סעיף 1.3: גודל קובץ מקסימלי ומספר רשומות תיקייה**\n\n**גודל קובץ מקסימלי:**\nה-Inode יכול לאחסן נתונים במספר דרכים:\n1.  **Inline data:** 128 בתים ישירות ב-Inode.\n2.  **מצביעים ישירים:** 10 מצביעים. כל מצביע מפנה לבלוק נתונים בגודל 4KB.\n    *   סה\"כ נתונים ממצביעים ישירים: 10 * 4KB = 40KB.\n3.  **מצביע עקיף יחיד (Single Indirect):** מצביע לבלוק שמכיל מצביעים לבלוקי נתונים.\n    *   מספר מצביעים בבלוק עקיף: גודל בלוק / גודל מצביע = 4KB / 4 בתים = 1024 מצביעים.\n    *   סה\"כ נתונים ממצביע עקיף יחיד: 1024 * 4KB = 4MB.\n4.  **מצביע עקיף כפול (Double Indirect):** מצביע לבלוק שמכיל מצביעים לבלוקים עקיפים יחידים.\n    *   מספר בלוקים עקיפים יחידים שמצביע עקיף כפול יכול להפנות אליהם: 1024 (כמו בחישוב לעיל).\n    *   סה\"כ נתונים ממצביע עקיף כפול: 1024 * (1024 * 4KB) = 1024 * 4MB = 4GB.\n\n**גודל קובץ מקסימלי כולל:**\n128 בתים (inline) + 40KB (ישירים) + 4MB (עקיף יחיד) + 4GB (עקיף כפול)\n= 128 + 40,960 + 4,194,304 + 4,294,967,296 = **4,299,102,688 בתים (כ-4GB)**.\n\n\n**מספר רשומות תיקייה בבלוק נתונים יחיד של 4KB:**\n*   גודל רשומת תיקייה: שם קובץ (מקסימום 255 תווים) + מספר Inode (4 בתים) = 255 + 4 = 259 בתים.\n*   גודל בלוק נתונים: 4KB = 4096 בתים.\n\n*   מספר רשומות מקסימלי בבלוק: 4096 בתים / 259 בתים לרשומה = 15.81.\n\nמכיוון שניתן לאחסן רק רשומות שלמות, בלוק נתונים יחיד בגודל 4KB של תיקייה יכול להכיל לכל היותר **15 רשומות תיקייה**."
    },
    "difficulty_estimation": "Hard"
  }
}