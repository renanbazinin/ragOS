{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 10:10:15",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 3077,
      "total_tokens": 17953
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Virtual Memory",
      "Memory Management",
      "Effective Access Time"
    ],
    "content": {
      "text": "מערכת הפעלה משתמשת בזיכרון וירטואלי עם טבלת דפים היררכית בת 2 רמות. נתונים המאפיינים הבאים:\n*   גודל דף: 4KB.\n*   כתובת וירטואלית: 32 ביטים.\n*   גודל כניסה בטבלת דפים (PTE): 4 בתים.\n*   TLB: מכיל 16 כניסות, אסוציאטיבי מלא, מדיניות החלפה LRU.\n*   זמן גישה ל-TLB: 10ns.\n*   זמן גישה לזיכרון פיזי (RAM): 100ns.\n*   ה-TLB ריק בתחילת כל תרחיש סעיף 2, 3 ו-4.\n*   נניח שכל טבלת דפים ברמה כלשהי תופסת דף אחד בדיוק בזיכרון הפיזי.\n\nתהליך מבצע לולאה שבה הוא ניגש לאיברי מערך גדול של מספרים שלמים (int). כל איבר `int` הוא בגודל 4 בתים.\nהלולאה מבצעת `M` גישות לזיכרון:\n",
      "code_snippet": "int arr[N]; // N is a large number\nfor (int i = 0; i < M; ++i) {\n    int val = arr[i * S];\n}",
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "כמה ביטים מוקצים לכל אינדקס בטבלת הדפים (P1, P2) וכמה ביטים לאופסט? מהו מספר הדפים המקסימלי במרחב הכתובות הוירטואלי של תהליך?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "תרחיש 1: גישה בתוך אותו דף.\nנניח ש-`S = 1`. התהליך ניגש ל-`M` איברים ברצף: `arr[0], arr[1], ..., arr[M-1]`. חשב את זמן הגישה האפקטיבי הממוצע (EAT) לגישה יחידה ל-`arr[i]` אם `M = 1024` (מספר האיברים בדף יחיד).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "תרחיש 2: קפיצה בין דפים וירטואליים רציפים.\nנניח ש-`S` גדול מספיק כך שכל גישה `arr[i*S]` נופלת לדף וירטואלי חדש, אך דפים אלו רציפים במרחב הכתובות הוירטואלי (כלומר, `VPN_k`, `VPN_k+1`, `VPN_k+2`, ...). התהליך ניגש ל-`M` איברים, כאשר `M` גדול בהרבה מ-16 (גודל ה-TLB). חשב את זמן הגישה האפקטיבי הממוצע (EAT) לגישה יחידה ל-`arr[i*S]` במצב יציב (לאחר שה-TLB התמלא והגיע לשיווי משקל). נמק את ההנחות שלך לגבי עלות ה-Page Table Walk במקרה זה.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "תרחיש 3: קפיצה בין דפים וירטואליים לא רציפים.\nנניח ש-`S` גדול מאוד, כך שכל גישה `arr[i*S]` נופלת לדף וירטואלי חדש, שאינו רציף לדף הקודם (כלומר, הגישות קופצות לכתובות וירטואליות מרוחקות מאוד). בנוסף, נניח שהגישות לדפים אלו לא מציגות לוקאליות מרחבית או זמנית משמעותית מעבר ל-16 הגישות האחרונות. חשב את זמן הגישה האפקטיבי הממוצע (EAT) לגישה יחידה ל-`arr[i*S]` במצב יציב.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פירוט ונימוק לכל סעיף:\n\n**1.1 חישוב מבנה טבלת הדפים:**\n*   **גודל דף:** 4KB = 2^12 בתים. מכאן שאופסט הכתובת הווירטואלית הוא 12 ביטים.\n*   **כתובת וירטואלית:** 32 ביטים. מספר הביטים ל-VPN (Virtual Page Number) הוא 32 - 12 = 20 ביטים.\n*   **גודל כניסה בטבלת דפים (PTE):** 4 בתים.\n*   **מספר כניסות בדף טבלה יחיד:** דף טבלה בגודל 4KB יכול להכיל 4KB / 4B = 1024 כניסות (2^10 כניסות).\n*   **מספר ביטים לכל אינדקס:** מכיוון שיש 2 רמות טבלה ו-20 ביטים ל-VPN, וכל רמה תופסת דף יחיד (1024 כניסות), אזי כל אינדקס (P1, P2) מקבל 10 ביטים (2^10 = 1024).\n    *   P1 Index: 10 ביטים.\n    *   P2 Index: 10 ביטים.\n*   **מספר דפים מקסימלי במרחב הכתובות הוירטואלי:** VPN הוא 20 ביטים, לכן יש 2^20 דפים וירטואליים מקסימליים לתהליך.\n\n**1.2 תרחיש 1: גישה בתוך אותו דף (S=1, M=1024):**\n*   המערך מכיל איברים בגודל 4 בתים. דף בגודל 4KB יכול להכיל 4KB / 4B = 1024 איברים.\n*   הלולאה ניגשת ל-1024 איברים רצופים (arr[0] עד arr[1023]), שכולם נמצאים באותו דף וירטואלי.\n*   **גישה ראשונה (ל-arr[0]):** זו תהיה בוודאות TLB Miss מכיוון שה-TLB ריק. לאחר מכן, תהיה הליכה בטבלת הדפים (Page Table Walk) הדורשת 2 גישות לזיכרון פיזי (אחת לטבלת P1 ואחת לטבלת P2). לבסוף, תהיה גישה לנתונים עצמם בזיכרון הפיזי. ה-PTE של דף זה יוכנס ל-TLB.\n    *   עלות גישה ראשונה: זמן TLB + (2 * זמן גישת RAM ל-PTW) + זמן גישת RAM לנתונים\n    *   עלות = 10ns + (2 * 100ns) + 100ns = 10ns + 200ns + 100ns = 310ns.\n*   **1023 הגישות הבאות (ל-arr[1] עד arr[1023]):** כולן יהיו TLB Hit מכיוון שה-PTE של הדף כבר נמצא ב-TLB. לאחר מכן, תהיה גישה לנתונים עצמם בזיכרון הפיזי.\n    *   עלות לגישה בודדת: זמן TLB + זמן גישת RAM לנתונים\n    *   עלות = 10ns + 100ns = 110ns.\n*   **זמן גישה אפקטיבי ממוצע (EAT):**\n    *   EAT = (עלות גישה ראשונה + (1023 * עלות גישת Hit)) / 1024\n    *   EAT = (310ns + (1023 * 110ns)) / 1024 = (310ns + 112530ns) / 1024 = 112840ns / 1024 ≈ 110.2ns.\n\n**1.3 תרחיש 2: קפיצה בין דפים וירטואליים רציפים (מצב יציב):**\n*   במצב זה, כל גישה `arr[i*S]` נופלת לדף וירטואלי חדש (`VPN_k`, `VPN_k+1`, וכו'). מכיוון ש-`M` גדול בהרבה מגודל ה-TLB (16 כניסות), ובכל גישה ניגשים לדף *חדש*, ה-TLB Hit Rate ישאף ל-0% במצב יציב (כל גישה לדף חדש תגרום להוצאת ה-PTE הישן ביותר ב-LRU).\n*   **עלות TLB Miss:** זמן TLB + עלות Page Table Walk + זמן גישת RAM לנתונים.\n*   **נימוק לגבי עלות ה-Page Table Walk:** מכיוון שהדפים הוירטואליים רציפים, סביר להניח שרוב הדפים הללו חולקים את אותו אינדקס P1. המשמעות היא שהטבלה ברמה P1 עבור אזור זיכרון זה תישאר בזיכרון הפיזי וסביר מאוד שתהיה ב-Cache של המעבד. לכן, הגישה הראשונה ב-PTW (ל-P1) תהיה ברובה המכריע Cache Hit (ועלותה זניחה ביחס ל-100ns). רק הגישה השנייה ב-PTW (ל-P2) תהיה גישת RAM מלאה.\n    *   עלות Page Table Walk במקרה זה: 1 * 100ns = 100ns (גישה ל-P2 בלבד).\n*   **עלות לגישה בודדת (TLB Miss):** 10ns (TLB) + 100ns (PTW) + 100ns (Data) = 210ns.\n*   **זמן גישה אפקטיבי ממוצע (EAT):** במצב יציב, כל גישה היא TLB Miss, ולכן EAT = 210ns.\n\n**1.4 תרחיש 3: קפיצה בין דפים וירטואליים לא רציפים (מצב יציב):**\n*   בדומה לתרחיש 2, כל גישה נופלת לדף וירטואלי חדש, ו-`M` גדול בהרבה מ-16, לכן ה-TLB Hit Rate ישאף ל-0% במצב יציב.\n*   **עלות TLB Miss:** זמן TLB + עלות Page Table Walk + זמן גישת RAM לנתונים.\n*   **נימוק לגבי עלות ה-Page Table Walk:** מכיוון שהדפים הוירטואליים אינם רציפים וקופצים לכתובות מרוחקות, אין לוקאליות מרחבית שתעזור ל-Cache של המעבד. לכן, כל הליכה בטבלת הדפים תדרוש שתי גישות מלאות לזיכרון הפיזי (אחת ל-P1 ואחת ל-P2).\n    *   עלות Page Table Walk במקרה זה: 2 * 100ns = 200ns (גישה ל-P1 וגישה ל-P2).\n*   **עלות לגישה בודדת (TLB Miss):** 10ns (TLB) + 200ns (PTW) + 100ns (Data) = 310ns.\n*   **זמן גישה אפקטיבי ממוצע (EAT):** במצב יציב, כל גישה היא TLB Miss, ולכן EAT = 310ns."
    },
    "difficulty_estimation": "Hard"
  }
}