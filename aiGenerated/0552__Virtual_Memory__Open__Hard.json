{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Virtual Memory",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:39:27",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 2046,
      "total_tokens": 8261
    }
  },
  "question": {
    "id": 101,
    "type": "Open",
    "topic": [
      "Virtual Memory",
      "Paging",
      "Memory Management",
      "Page Table Structures",
      "Large Address Spaces"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה הפועלת על ארכיטקטורת 64 ביט, עם כתובות וירטואליות בגודל 64 ביט וגודל דף של 4KB. ידוע כי תהליכים רבים במערכת משתמשים במרחבי כתובות וירטואליים דלילים (sparse), כלומר, הם מנצלים רק חלק קטן מהמרחב העצום של 2^64 בתים, וזאת באופן לא רציף, עם פערים גדולים בין אזורים ממופים.\nתאר/י מבנה טבלאות דפים אלטרנטיבי לטבלאות דפים מרובות רמות (multi-level page tables) קונבנציונליות, שיאפשר ניהול יעיל יותר של מרחבי כתובות וירטואליים דלילים וגדולים במיוחד.\nעליך לפרט את המבנה המוצע, להסביר כיצד הוא עובד (תרגום כתובות), ולנתח את יתרונותיו וחסרונותיו ביחס לטבלאות דפים מרובות רמות במקרה הנתון. התייחס/י לשיקולים כגון צריכת זיכרון, ביצועי תרגום כתובות (כולל השפעה על ה-TLB), ומורכבות הטיפול ב-page faults.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "הפתרון המוצע מתאר מבנה Hashed Page Table (HPT) כחלופה לטבלאות דפים מרובות רמות:\n\n**מבנה מוצע: Hashed Page Table (HPT) – טבלת דפים מבוססת גיבוב**\nבמקום טבלאות היררכיות, HPT משתמשת בטבלת גיבוב (Hash Table) אחת גדולה. כל כניסה בטבלת הגיבוב מצביעה על רשימה מקושרת של רשומות טבלת דפים (PTEs) שערך ה-Virtual Page Number (VPN) שלהן יצר את אותו ערך גיבוב. כל PTE ברשימה מכילה את ה-VPN המלא (כדי להתמודד עם התנגשויות), את ה-PFN (Physical Frame Number), וביטי בקרה (כגון valid, dirty, accessed).\n\n**תהליך תרגום כתובת:**\n1.  **חלוקת הכתובת הוירטואלית**: הכתובת הוירטואלית (64 ביט) מחולקת ל-VPN (64-12 = 52 ביט, עבור גודל דף 4KB) ולהיסט (12 ביט).\n2.  **חישוב גיבוב**: מחושבת פונקציית גיבוב על ה-VPN. תוצאת הגיבוב משמשת כאינדקס לכניסה בטבלת הגיבוב הראשית.\n3.  **גישה לטבלת הגיבוב**: ניגשים לכניסה המתאימה בטבלת הגיבוב.\n4.  **סריקת רשימה מקושרת**: עוברים על הרשימה המקושרת של ה-PTEs המחוברת לכניסה זו. עבור כל PTE ברשימה, משווים את ה-VPN המלא השמור בו ל-VPN המקורי של הכתובת הוירטואלית.\n5.  **התאמה נמצאה**: אם נמצאה התאמה, מחלצים את ה-PFN מה-PTE ומרכיבים את הכתובת הפיזית על ידי שילוב ה-PFN עם ההיסט המקורי.\n6.  **Page Fault**: אם לא נמצאה התאמה לאחר סריקת כל הרשימה המקושרת, מתרחשת Page Fault.\n\n**יתרונות עבור מרחבי כתובות דלילים וגדולים:**\n*   **יעילות בזיכרון**: המבנה הזה דורש זיכרון רק עבור הדפים שממופים בפועל. אין צורך להקצות טבלאות דפים ברמות ביניים (כמו בטבלאות מרובות רמות) עבור אזורים ריקים או לא ממופים במרחב הכתובות הוירטואלי העצום (2^64 בתים). זה חוסך כמויות אדירות של זיכרון עבור תהליכים עם מרחבי כתובות דלילים, שהם המקרה הנפוץ במערכות 64 ביט.\n*   **סקלאביליות**: מתאים היטב לטיפול בכתובות וירטואליות רחבות מאוד (כמו 64 ביט), שכן גודל טבלת הדפים אינו תלוי ישירות בגודל מרחב הכתובות הוירטואלי, אלא במספר הדפים הממופים בפועל ובגודל טבלת הגיבוב.\n\n**חסרונות:**\n*   **ביצועי תרגום כתובות**: במקרה של התנגשויות (hash collisions), תרגום כתובת דורש סריקה של רשימה מקושרת, מה שמוסיף זמן השהיה משמעותי בהשוואה לגישה ישירה בטבלאות מרובות רמות. הדבר פוגע בביצועים כאשר ה-TLB מחמיץ (TLB miss), שכן הגישה לזיכרון עבור טבלת הדפים עלולה להיות יקרה יותר.\n*   **השפעה על ה-TLB**: ה-TLB הופך להיות קריטי אף יותר. כיוון שגישה ל-HPT איטית יותר, שיעור פגיעות גבוה ב-TLB חיוני לשמירה על ביצועים טובים. אם ה-TLB מחמיץ, העלות של תרגום הכתובת דרך ה-HPT גבוהה יותר.\n*   **מורכבות**: ניהול טבלת גיבוב (בחירת פונקציית גיבוב טובה, טיפול יעיל בהתנגשויות, שינוי גודל הטבלה דינמית) מורכב יותר ליישום במערכת ההפעלה.\n*   **locality cache**: סריקת רשימות מקושרות עלולה לפגוע ב-locality cache, בניגוד לטבלאות דפים מרובות רמות שבהן הגישות לרמות השונות הן לרוב רציפות בזיכרון.\n*   **טיפול ב-page faults**: מורכבות הטיפול ב-page faults עולה מעט, שכן יש למצוא מקום בשרשרת הגיבוב המתאימה ולהוסיף PTE חדש, או להסיר PTE קיים במקרה של החלפת דף.\n\n**השוואה לטבלאות דפים מרובות רמות במקרה הנתון:**\n*   **טבלאות מרובות רמות**: עבור מרחב כתובות וירטואלי של 64 ביט ודף בגודל 4KB, נדרשים 52 ביטים ל-VPN. אם כל רמה ממפה 9-10 ביטים, ידרשו 5-6 רמות של טבלאות דפים. זהו מבנה בזבזני מאוד בזיכרון עבור מרחבי כתובות דלילים או עצומים, שכן הוא דורש הקצאת טבלאות ביניים רבות גם אם רובן ריקות. עם זאת, כאשר ה-TLB מחמיץ, הגישה לטבלת הדפים היא לרוב מהירה יותר ובעלת locality cache טובה יותר.\n*   **HPT**: חוסכת זיכרון משמעותית עבור מרחבי כתובות דלילים ועצומים על חשבון מורכבות וזמן תרגום ארוך יותר במקרה של TLB miss (בגלל התנגשויות וסריקת רשימות). היא יעילה יותר בזיכרון וסקלאבילית יותר למרחבי כתובות ענקיים, אך דורשת TLB גדול ויעיל מאוד כדי למזער את עלויות התרגום."
    },
    "difficulty_estimation": "Hard"
  }
}