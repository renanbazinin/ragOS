{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management",
    "requested_type": "MultipleChoice",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 21:49:42",
    "examples_used": 2,
    "token_usage": {
      "prompt_tokens": 969,
      "output_tokens": 1609,
      "total_tokens": 7464
    }
  },
  "question": {
    "id": 101,
    "type": "MultipleChoice",
    "topic": [
      "Memory Management",
      "Paging",
      "Locality",
      "Virtual Memory"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי מבוסס דפים (demand paging) עם גודל דף של 4KB. תהליך מקצה דינמית מערך דו-ממדי בגודל `int arr[1024][1024]` (כאשר `sizeof(int) = 4` בתים). ההקצאה מתבצעת באופן רציף בזיכרון הוירטואלי והמערך מתחיל בגבול דף. נניח שזיכרון פיזי זמין מוגבל ואינו מסוגל להכיל את כל המערך. שקול את שני קטעי הקוד הבאים לאתחול המערך:\n\n```c\n// קטע קוד א'\nfor (int i = 0; i < 1024; ++i) {\n    for (int j = 0; j < 1024; ++j) {\n        arr[i][j] = i + j;\n    }\n}\n\n// קטע קוד ב'\nfor (int j = 0; j < 1024; ++j) {\n    for (int i = 0; i < 1024; ++i) {\n        arr[i][j] = i + j;\n    }\n}\n```\n\nאיזו טענה נכונה לגבי מספר פסיקות הדף (page faults) שייגרמו על ידי שני קטעי הקוד?",
      "code_snippet": null,
      "options": [
        "א. קטע קוד א' וקטע קוד ב' יגרמו למספר זהה של פסיקות דף, מכיוון שהם ניגשים לאותם נתונים.",
        "ב. קטע קוד א' יגרום לכ-1024 פסיקות דף, בעוד שקטע קוד ב' יגרום למספר קטן יותר, מכיוון שהוא מנצל טוב יותר את ה-TLB.",
        "ג. קטע קוד א' יגרום למספר נמוך משמעותית של פסיקות דף בהשוואה לקטע קוד ב', מכיוון שהוא מנצל טוב יותר את לוקליות הנתונים.",
        "ד. קטע קוד ב' יגרום למספר נמוך משמעותית של פסיקות דף בהשוואה לקטע קוד א', מכיוון שהוא מאפשר טעינה מקבילית של דפים.",
        "ה. מספר פסיקות הדף תלוי רק באלגוריתם החלפת הדפים ובכמות הזיכרון הפיזי, ולא בסדר הגישה."
      ]
    },
    "sub_questions": null,
    "points": 5,
    "solution": {
      "is_present_in_file": true,
      "correct_option": "ג",
      "explanation": "ג. גודל המערך הוא `1024 * 1024 * 4` בתים = 4MB. גודל הדף הוא 4KB.\n\n**קטע קוד א' (גישה לפי שורות - row-major):**\nכל שורה במערך היא בגודל `1024 * 4 = 4096` בתים, שזה בדיוק גודל דף אחד (4KB).\nכאשר קטע קוד א' ניגש לנתונים, הוא קורא את כל הנתונים של שורה מסוימת ברצף. מכיוון שהשורה כולה נכנסת לדף אחד, גישה לשורה תגרום לפסיקת דף אחת בלבד (אם הדף אינו בזיכרון). לאחר מכן, כל הגישות לשאר האיברים באותה שורה יהיו בתוך אותו דף שכבר נטען.\nבסך הכל, יהיו כ-1024 פסיקות דף (אחת לכל שורה), מכיוון שיש 1024 שורות וכל שורה תופסת דף אחר בזיכרון הוירטואלי. זהו ניצול טוב של לוקליות מרחבית (spatial locality).\n\n**קטע קוד ב' (גישה לפי עמודות - column-major):**\nכאשר קטע קוד ב' ניגש לנתונים, הלולאה הפנימית משתנה על `i` עבור `j` קבוע. הגישה היא ל-`arr[0][j]`, `arr[1][j]`, `arr[2][j]`, וכו'.\nכתובת הזיכרון של `arr[i][j]` היא `base + (i * 1024 + j) * sizeof(int)`.\nההפרש בכתובות בין `arr[i][j]` ל-`arr[i+1][j]` הוא `1024 * sizeof(int) = 1024 * 4 = 4096` בתים, שזה בדיוק גודל דף אחד.\nמשמעות הדבר היא שכל גישה ל-`arr[i][j]` כאשר `i` עולה, תהיה כמעט בוודאות בדף זיכרון וירטואלי שונה. מכיוון שיש 1024 שורות, הלולאה הפנימית תנסה לגשת ל-1024 דפים שונים ברצף מהיר.\nאם הזיכרון הפיזי מוגבל (לדוגמה, פחות מ-1024 דפים זמינים), אז עבור כל `i` בלולאה הפנימית, תתרחש ככל הנראה פסיקת דף, מכיוון שהדף הנדרש סביר להניח שהוחלף כבר על ידי דף אחר (במיוחד עם אלגוריתמי החלפת דפים נפוצים כמו LRU).\nלכן, עבור כל `j` (הלולאה החיצונית), הלולאה הפנימית תגרום לכ-1024 פסיקות דף. ובסה\"כ, מספר פסיקות הדף יכול להגיע לכ-`1024 * 1024 = 1,048,576` פסיקות דף.\nזהו ניצול גרוע מאוד של לוקליות מרחבית וגורם למספר עצום של פסיקות דף.\n\nלכן, קטע קוד א' יגרום למספר נמוך משמעותית של פסיקות דף בהשוואה לקטע קוד ב'."
    },
    "difficulty_estimation": "Hard"
  }
}