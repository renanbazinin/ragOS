{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 10:05:35",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 3736,
      "total_tokens": 16940
    }
  },
  "question": {
    "id": 7,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Memory Management",
      "Virtual Memory"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם כתובות וירטואליות בגודל 32 ביטים וגודל דף של 4KB. המערכת משתמשת בטבלת דפים היררכית בעלת 2 רמות. כל כניסה בטבלת הדפים (PTE) היא בגודל 4 בתים.\nהמערכת כוללת גם TLB (Translation Lookaside Buffer) בגודל 16 כניסות, בשיטת אסוציאטיביות מלאה (Fully Associative) ומדיניות החלפה LRU (Least Recently Used).\nזמני הגישה במערכת הם כדלקמן:\n- פגיעה ב-TLB (TLB Hit): 1 ננו-שנייה.\n- גישה לזיכרון הראשי (Main Memory Access), בין אם לנתונים/פקודות ובין אם לכניסה בטבלת הדפים: 100 ננו-שניות.\nיש להניח שכל הדפים המעורבים בגישות הבאות נמצאים בזיכרון הפיזי (כלומר, אין Page Faults).",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "7.1",
        "text": "חשב/י את הפרטים הבאים:\nא. גודל מרחב הכתובות הוירטואלי המקסימלי במערכת.\nב. גודל הזיכרון הפיזי המקסימלי במערכת (בהנחה שמספר המסגרת יכול לנצל את מירב הביטים הזמינים).\nג. מספר הכניסות בכל רמה של טבלת הדפים.\nד. חלוקת הביטים בכתובת הוירטואלית (לכמה ביטים מוקצים עבור VPN1, VPN2 ו-Offset).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.2",
        "text": "תהליך מבצע את סדרת הגישות הבאה לכתובות וירטואליות:\n`0x10000000, 0x10001000, 0x20000000, 0x10000004, 0x30000000, 0x10002000, 0x20000008, 0x40000000, 0x1000000C, 0x50000000`\nעבור כל גישה בסדרה:\nא. ציין/י האם זו פגיעה (Hit) או פספוס (Miss) ב-TLB.\nב. אם זה פספוס ב-TLB, כמה גישות לזיכרון ראשי נדרשות לטיפול בו (טיול בטבלת הדפים)?\nג. מהו שיעור הפגיעות הכולל ב-TLB עבור סדרה זו של גישות?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.3",
        "text": "חשב/י את זמן הגישה האפקטיבי הממוצע (Effective Access Time) עבור סדרת הגישות כולה.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.4",
        "text": "הסבר/י כיצד החלפת הקשר (Context Switch) משפיעה על ביצועי ה-TLB והצע/י מנגנון אחד שיכול למזער השפעה זו.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "7.1:\nא. גודל מרחב הכתובות הוירטואלי המקסימלי: כתובות וירטואליות בגודל 32 ביטים מאפשרות מרחב של 2^32 בתים, כלומר 4 גיגה-בתים (4GB).\nב. גודל הזיכרון הפיזי המקסימלי: גודל דף הוא 4KB = 2^12 בתים, כך שה-Offset הוא 12 ביטים. מספר הביטים ל-VPN הוא 32 - 12 = 20 ביטים. כניסה בטבלת הדפים (PTE) בגודל 4 בתים מאפשרת לאחסן מספר מסגרת (PFN) בגודל של עד 32 ביטים (אילו כל ה-4 בתים היו מוקדשים ל-PFN). אך בפועל, ה-PFN נגזר ממספר הביטים הנותרים לאחר ה-Offset. במערכת 32 ביט עם 12 ביטים לאופסט, נשארים 20 ביטים עבור ה-VPN. אם ה-PFN הוא גם בגודל 20 ביטים (כמו ה-VPN), אז מספר המסגרות המקסימלי הוא 2^20. לכן, גודל הזיכרון הפיזי המקסימלי הוא 2^20 מסגרות * 2^12 בתים/מסגרת = 2^32 בתים = 4GB.\nג. מספר הכניסות בכל רמה של טבלת הדפים: גודל דף הוא 4KB = 4096 בתים. גודל כניסה בטבלת דפים (PTE) הוא 4 בתים. לכן, מספר הכניסות בכל טבלת דפים (שמלאה בדף אחד) הוא 4096 / 4 = 1024 כניסות.\nד. חלוקת הביטים בכתובת הוירטואלית: Offset הוא 12 ביטים (עבור 4KB). נותרו 20 ביטים עבור ה-VPN. מכיוון שבכל רמה בטבלת הדפים יש 1024 כניסות (2^10), כל רמה צורכת 10 ביטים מה-VPN. לכן, VPN1 מוקצה 10 ביטים, VPN2 מוקצה 10 ביטים, ו-Offset מוקצה 12 ביטים. סה\"כ: 10 + 10 + 12 = 32 ביטים.\n\n7.2:\nננתח את סדרת הגישות. נתייחס לחלק ה-VPN של כל כתובת (ה-20 ביטים העליונים, או הכתובת חלקי גודל דף).\nVPNs בסדרה: `0x10000`, `0x10001`, `0x20000`, `0x10000`, `0x30000`, `0x10002`, `0x20000`, `0x40000`, `0x10000`, `0x50000`.\nגודל ה-TLB הוא 16 כניסות. כל עוד מספר הדפים הייחודיים שאליהם ניגשים קטן מ-16, כל דף שנטען ל-TLB יישאר שם.\n\nסימולציית TLB:\n1.  `0x10000000` (VPN `0x10000`): פספוס TLB. הדף נטען ל-TLB. נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים (אחת ל-PTE ברמה 1, אחת ל-PTE ברמה 2) + גישה אחת לנתון בזיכרון הראשי. סה\"כ 3 גישות לזיכרון הראשי.\n2.  `0x10001000` (VPN `0x10001`): פספוס TLB. הדף נטען ל-TLB. נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים + גישה אחת לנתון. סה\"כ 3 גישות לזיכרון הראשי.\n3.  `0x20000000` (VPN `0x20000`): פספוס TLB. הדף נטען ל-TLB. נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים + גישה אחת לנתון. סה\"כ 3 גישות לזיכרון הראשי.\n4.  `0x10000004` (VPN `0x10000`): פגיעה TLB. הדף כבר ב-TLB.\n5.  `0x30000000` (VPN `0x30000`): פספוס TLB. הדף נטען ל-TLB. נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים + גישה אחת לנתון. סה\"כ 3 גישות לזיכרון הראשי.\n6.  `0x10002000` (VPN `0x10002`): פספוס TLB. הדף נטען ל-TLB. נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים + גישה אחת לנתון. סה\"כ 3 גישות לזיכרון הראשי.\n7.  `0x20000008` (VPN `0x20000`): פגיעה TLB. הדף כבר ב-TLB.\n8.  `0x40000000` (VPN `0x40000`): פספוס TLB. הדף נטען ל-TLB. נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים + גישה אחת לנתון. סה\"כ 3 גישות לזיכרון הראשי.\n9.  `0x1000000C` (VPN `0x10000`): פגיעה TLB. הדף כבר ב-TLB.\n10. `0x50000000` (VPN `0x50000`): פספוס TLB. הדף נטען ל-TLB. נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים + גישה אחת לנתון. סה\"כ 3 גישות לזיכרון הראשי.\n\nסיכום:\n-   סה\"כ גישות: 10\n-   פגיעות TLB: 3 (בגישות 4, 7, 9)\n-   פספוסי TLB: 7 (בגישות 1, 2, 3, 5, 6, 8, 10)\n-   עבור כל פספוס TLB, נדרשות 2 גישות לזיכרון ראשי עבור טיול בטבלת הדפים (PTEs ברמה 1 ו-2). בנוסף, יש גישה אחת לנתון/פקודה עצמו בזיכרון הראשי.\n-   שיעור הפגיעות הכולל ב-TLB: 3 פגיעות / 10 גישות = 0.3 = 30%.\n\n7.3:\nזמן גישה אפקטיבי ממוצע (EAT) מחושב כך:\nEAT = (מספר פגיעות TLB * זמן פגיעה TLB) + (מספר פספוסי TLB * (זמן פגיעה TLB + זמן טיול בטבלת הדפים + זמן גישה לזיכרון ראשי))\nזמן טיול בטבלת הדפים עבור 2 רמות = 2 * זמן גישה לזיכרון ראשי = 2 * 100ns = 200ns.\n\nEAT כולל = (3 * 1ns) + (7 * (1ns + 200ns + 100ns))\nEAT כולל = 3ns + (7 * 301ns)\nEAT כולל = 3ns + 2107ns = 2110ns.\n\nזמן גישה אפקטיבי ממוצע לגישה אחת = 2110ns / 10 גישות = 211 ננו-שניות.\n\n7.4:\nהחלפת הקשר (Context Switch) משפיעה באופן משמעותי על ביצועי ה-TLB. כאשר מערכת ההפעלה מחליפה בין תהליכים, מרחב הכתובות הוירטואלי של התהליך הקודם אינו רלוונטי יותר עבור התהליך החדש. אם ה-TLB מכיל כניסות השייכות לתהליך הקודם, הן אינן תקפות עבור התהליך החדש. כדי למנוע גישה שגויה לזיכרון, יש שתי גישות עיקריות:\n1.  **ניקוי (Flush) ה-TLB:** המנגנון הפשוט ביותר הוא לנקות את כל כניסות ה-TLB בכל החלפת קשר. זה מבטיח שהתהליך החדש לא ישתמש בכניסות שגויות. עם זאת, ניקוי ה-TLB גורם ל\"TLB קר\" (cold TLB) עבור התהליך החדש, מה שאומר שכל הגישות הראשוניות שלו לזיכרון יגרמו לפספוסי TLB ולטיולים יקרים בטבלת הדפים, עד שה-TLB יתמלא מחדש בכניסות הרלוונטיות לתהליך הנוכחי. זה פוגע בביצועים.\n2.  **שימוש במזהי מרחבי כתובות (ASID - Address Space Identifiers):** כדי למזער את הצורך בניקוי ה-TLB, מעבדים רבים תומכים ב-ASID. לכל תהליך מוקצה ASID ייחודי. כל כניסה ב-TLB מאחסנת לא רק את מיפוי הכתובת הוירטואלית לפיזית, אלא גם את ה-ASID של התהליך שהיא שייכת לו. כאשר מתרחשת החלפת קשר, אין צורך לנקות את כל ה-TLB. במקום זאת, המעבד פשוט משתמש ב-ASID של התהליך הנוכחי כדי לבדוק האם כניסה ב-TLB רלוונטית. אם ה-ASID של הכניסה ב-TLB תואם ל-ASID של התהליך הרץ, הכניסה תקפה. אם לא, היא אינה תקפה ותטופל כפספוס TLB. כניסות של תהליכים אחרים יכולות להישאר ב-TLB ולהיות בשימוש חוזר אם התהליכים הללו יחזרו לרוץ, ובכך נמנעת הפגיעה בביצועים של \"TLB קר\" בכל החלפת קשר. כאשר ה-TLB מתמלא, כניסות ישנות (של תהליכים אחרים או של התהליך הנוכחי) יוחלפו לפי מדיניות ההחלפה (כמו LRU)."
    },
    "difficulty_estimation": "Hard"
  }
}