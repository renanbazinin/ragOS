{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Virtual Memory",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:35:42",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 1972,
      "total_tokens": 10708
    }
  },
  "question": {
    "id": 6,
    "type": "Open",
    "topic": [
      "Virtual Memory",
      "Paging",
      "Memory Management",
      "TLB",
      "Context Switching",
      "Memory Protection",
      "Copy-on-Write"
    ],
    "content": {
      "text": "מערכת הפעלה מודרנית פועלת על מעבד 64-ביט התומך במרחב כתובות וירטואלי בגודל 48 ביטים. גודל הדף במערכת הוא 4KB. המערכת נדרשת לתמוך ביעילות בתהליכים עם מרחבי כתובות וירטואליים דלילים (sparse) ובמעבר מהיר בין הקשרים (context switches).",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "6.1",
        "text": "תארו ובססו חישובית את מבנה טבלת הדפים הרב-רמתית הנדרשת במערכת זו. כמה רמות טבלאות דפים יהיו, ומה יהיה גודל כל אינדקס רמה (ביחידות ביטים)? הניחו שכל כניסה בטבלת דפים (PTE) תופסת 8 בתים.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "6.2",
        "text": "כיצד מבנה טבלת הדפים שבחרתם משפיע על ביצועי ה-TLB, ובאילו דרכים ניתן למזער את העלות של פסיקות TLB (TLB misses) הנובעות ממעבר הקשרים (context switches)?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "6.3",
        "text": "פרטו כיצד ניתן להשתמש בדגלים (flags) בכניסות טבלת הדפים (PTEs) כדי לממש הגנת זיכרון (read/write/execute) ושיתוף זיכרון בין תהליכים (לדוגמה, ספריות משותפות או Copy-on-Write)?",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "6.1: גודל מרחב הכתובות הוירטואלי הוא 48 ביטים. גודל הדף הוא 4KB (2^12 בתים), לכן ההיסט (offset) בתוך הדף הוא 12 ביטים. מספר הדף הוירטואלי (VPN) הוא 48 - 12 = 36 ביטים.\nכל כניסה בטבלת הדפים (PTE) היא בגודל 8 בתים. גודל דף הוא 4KB (4096 בתים). מספר הכניסות בכל טבלת דפים (שמאוחסנת בדף אחד) הוא 4096 בתים / 8 בתים/כניסה = 512 כניסות. כל אינדקס רמה בטבלת הדפים יצטרך log2(512) = 9 ביטים.\nכדי למפות VPN באורך 36 ביטים באמצעות אינדקסים של 9 ביטים, נדרש: מספר רמות = ceil(36 ביטים / 9 ביטים לרמה) = 4 רמות. מבנה טבלת הדפים יהיה רב-רמתי עם 4 רמות, כאשר כל אינדקס בכל רמה הוא באורך 9 ביטים.\n\n6.2: מבנה טבלת הדפים הרב-רמתי מגדיל את מספר הגישות לזיכרון הראשי הנדרשות לתרגום כתובת וירטואלית (במקרה של TLB miss). במערכת 4 רמות, זה יכול לדרוש עד 4 גישות לזיכרון הראשי רק כדי למצוא את ה-PTE הסופי. ה-TLB נועד לצמצם את העלות הזו על ידי שמירת מיפויים בזיכרון מטמון מהיר.\nעל מנת למזער את עלות פסיקות TLB (TLB misses) הנובעות ממעבר הקשרים:\n*   **ASID (Address Space ID)**: הוספת מזהה מרחב כתובות (ASID) לכל כניסה ב-TLB. כאשר מתבצע מעבר הקשרים, במקום לנקות את כל ה-TLB, המערכת יכולה פשוט לטעון את ה-ASID של התהליך החדש. כניסות TLB של תהליכים אחרים יישארו, אך לא ישומשו אלא אם ה-ASID שלהן תואם את ה-ASID הפעיל. זה מפחית את הצורך ב-TLB flush מלא.\n*   **Large Pages / Huge Pages**: שימוש בדפים גדולים יותר (לדוגמה, 2MB או 1GB) עבור אזורים גדולים ורציפים בזיכרון. דף גדול אחד יכול לכסות טווח זיכרון נרחב יותר, ובכך להפחית את מספר כניסות ה-TLB הנדרשות עבור אותו טווח, מה שמוביל לפחות TLB misses.\n*   **Global Pages**: סימון דפים מסוימים (כמו קוד ליבת מערכת ההפעלה) כ\"גלובליים\" (Global). כניסות TLB עבור דפים גלובליים אינן מנוקות במעבר הקשרים, מכיוון שהן רלוונטיות לכל התהליכים.\n*   **Hardware Prefetching**: מעבדים מודרניים כוללים מנגנוני prefetching חומרתיים שיכולים לזהות דפוסי גישה לטבלאות דפים ולטעון מראש PTEs ל-TLB, לפני שהם נדרשים בפועל.\n\n6.3: דגלים (flags) בכניסות טבלת הדפים (PTEs) חיוניים ליישום הגנת זיכרון ושיתוף זיכרון:\n*   **הגנת זיכרון (Memory Protection)**:\n    *   **Read/Write/Execute (R/W/X) bits**: ביטים אלו קובעים את הרשאות הגישה לדף. לדוגמה, דף המכיל קוד יסומן כ-Read/Execute בלבד, דף נתונים יסומן כ-Read/Write, ודף stack יכול להיות Read/Write. ניסיון גישה שאינו תואם את ההרשאות יגרום ל-page fault (פסיקת הגנת זיכרון).\n    *   **User/Supervisor bit**: ביט זה קובע אם הדף נגיש למצב משתמש (User mode) או רק למצב מנהל (Supervisor mode). דפים המכילים קוד ונתוני ליבה נגישים רק במצב מנהל.\n*   **שיתוף זיכרון (Memory Sharing)**:\n    *   **Shared Libraries**: כדי לשתף ספריות משותפות (לדוגמה, libc.so), כניסות PTE שונות במרחבי כתובות של תהליכים שונים יכולות להצביע לאותה מסגרת פיזית (PFN). דפי קוד ונתונים קבועים של הספריות יסומנו כ-Read-only וישותפו בין תהליכים מרובים.\n    *   **Copy-on-Write (CoW)**: מנגנון זה משמש לשיתוף דפים בין תהליכים (לדוגמה, לאחר קריאת fork()). דפים מסומנים כ-Read-only ומשותפים. כאשר אחד התהליכים מנסה לכתוב לדף משותף, מתרחשת פסיקת דף. מערכת ההפעלה יוצרת עותק פיזי של הדף, מעדכנת את ה-PTE של התהליך הכותב להצביע על המסגרת החדשה, ומסמנת אותה כ-Writable. הדף המקורי נשאר משותף (אם יש לו עדיין שותפים) או נשאר בבעלותו של התהליך השני."
    },
    "difficulty_estimation": "Hard"
  }
}