{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Virtual Memory",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:38:07",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 3540,
      "total_tokens": 15404
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Virtual Memory",
      "Paging",
      "TLB",
      "Page Faults",
      "Memory Management",
      "C/C++"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם המאפיינים הבאים:\n*   מרחב כתובות וירטואלי: 48 ביטים.\n*   מרחב כתובות פיזי: 40 ביטים.\n*   גודל דף (Page Size): 4KB.\n*   טבלת דפים רב-שכבתית (Multi-level Page Table).\n*   גודל כניסה בטבלת הדפים (PTE): 8 בתים (64 ביטים).\n*   TLB: מכיל 16 כניסות, אסוציאטיבי מלא (Fully Associative), מדיניות החלפה LRU.\n*   מדיניות החלפת דפים בזיכרון הפיזי: LRU.\n*   לכל תהליך מוקצים 32 מסגרות פיזיות (frames) בלבד עבור קטע הנתונים שלו (data segment).\n*   ה-TLB ריק בתחילת הפעלת הקוד, ואין דפים טעונים מראש לזיכרון הפיזי עבור קטע הנתונים של התהליך.\n\nנתון קטע הקוד הבא בשפת C, המאתחל מטריצה גדולה:\n",
      "code_snippet": "#define ARRAY_SIZE_X 1024\n#define ARRAY_SIZE_Y 1024\nint matrix[ARRAY_SIZE_X][ARRAY_SIZE_Y];\n\nvoid initialize_matrix() {\n    for (int i = 0; i < ARRAY_SIZE_X; ++i) {\n        for (int j = 0; j < ARRAY_SIZE_Y; ++j) {\n            matrix[i][j] = i + j;\n        }\n    }\n}",
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "כמה רמות קיימות בטבלת הדפים? פרטו את החישוב.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "כמה דפים יידרשו לאחסון המטריצה `matrix` כולה? פרטו את החישוב.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "כמה Page Faults סך הכל יתרחשו במהלך ביצוע הפונקציה `initialize_matrix`? נמקו והסבירו את מדיניות החלפת הדפים.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "כמה TLB Misses סך הכל יתרחשו במהלך ביצוע הפונקציה `initialize_matrix`? נמקו והסבירו את מדיניות החלפת ה-TLB.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.5",
        "text": "מהו המספר הכולל של גישות לזיכרון הראשי (RAM) עבור נתוני המטריצה ועבור טבלאות הדפים (ללא ספירת גישות לדיסק) במהלך ביצוע הפונקציה `initialize_matrix`? פרטו את החישוב עבור כל סוג גישה (TLB hit, TLB miss, Page Fault).",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "### פתרון\n\n**1.1. כמה רמות קיימות בטבלת הדפים?**\n*   גודל כתובת וירטואלית: 48 ביטים.\n*   גודל דף: 4KB = 2^12 בתים. לכן, ה-Offset בדף הוא 12 ביטים.\n*   מספר הביטים לכתובת דף וירטואלי (VPN): 48 - 12 = 36 ביטים.\n*   גודל כניסה בטבלת הדפים (PTE): 8 בתים.\n*   מספר כניסות בטבלת דפים אחת (שממוקמת בדף פיזי אחד): 4KB / 8 בתים/כניסה = 512 כניסות = 2^9 כניסות.\n*   לכן, כל רמה בטבלת הדפים משתמשת ב-9 ביטים מתוך ה-VPN.\n*   מספר הרמות הנדרש: 36 ביטים (VPN) / 9 ביטים/רמה = 4 רמות.\n\n**תשובה: 4 רמות.**\n\n**1.2. כמה דפים יידרשו לאחסון המטריצה `matrix` כולה?**\n*   גודל `int`: 4 בתים.\n*   גודל שורה במטריצה: `1024 * 4` בתים = `4096` בתים = `4KB`.\n*   מאחר שגודל דף הוא 4KB, כל שורה במטריצה תופסת בדיוק דף אחד.\n*   מספר השורות במטריצה: 1024.\n*   לכן, המטריצה כולה תתפרס על פני 1024 דפים שונים.\n\n**תשובה: 1024 דפים.**\n\n**1.3. כמה Page Faults סך הכל יתרחשו?**\n*   המטריצה מתפרסת על 1024 דפים שונים (כפי שחושב בסעיף 1.2).\n*   לכל תהליך מוקצים 32 מסגרות פיזיות בלבד עבור קטע הנתונים שלו.\n*   מדיניות החלפת הדפים היא LRU.\n*   בהתחלה, אף דף של המטריצה אינו טעון לזיכרון הפיזי, וה-TLB ריק.\n*   הלולאה החיצונית רצה `i` מ-0 עד 1023. הלולאה הפנימית רצה `j` מ-0 עד 1023, וניגשת לכל האלמנטים בשורה `i`.\n*   גישה ראשונה לכל שורה `i` (לדוגמה `matrix[i][0]`) תגרום ל-Page Fault, מכיוון שהדף עבור שורה `i` אינו נמצא בזיכרון הפיזי.\n*   **ה-32 דפים הראשונים (שורות 0 עד 31)**: כל גישה ראשונה לדף חדש תגרום ל-Page Fault. מכיוון שיש מספיק מסגרות פנויות (32), הדפים ייטענו לזיכרון הפיזי. סך הכל 32 Page Faults.\n*   **הדפים הבאים (שורות 32 עד 1023)**: כאשר ניגשים לדף עבור שורה `i` (כאשר `i >= 32`), 32 המסגרות הפיזיות כבר מלאות. לכן, כל גישה לדף חדש תגרום ל-Page Fault, אשר תפעיל את מדיניות LRU. הדף שהיה בשימוש הכי פחות לאחרונה (במקרה זה, דף `i-32`) יוחלף על ידי הדף החדש. כלומר, עבור כל אחת מ-`1024 - 32 = 992` השורות הנותרות, יתרחש Page Fault.\n*   סה\"כ Page Faults = 32 (לדפים הראשונים) + 992 (לדפים הבאים עם החלפה) = 1024.\n*   יש לציין שכל דפי המטריצה נכתבים (`matrix[i][j] = i + j;`), ולכן כולם יהיו \"מלוכלכים\" (dirty). כאשר דף מלוכלך מוחלף (החל מה-33 Page Fault ואילך), הוא ייכתב לדיסק לפני טעינת הדף החדש.\n\n**תשובה: 1024 Page Faults.**\n\n**1.4. כמה TLB Misses סך הכל יתרחשו?**\n*   ה-TLB מכיל 16 כניסות, אסוציאטיבי מלא, מדיניות החלפה LRU.\n*   ה-TLB ריק בתחילת הפונקציה.\n*   כל גישה לדף וירטואלי חדש (שאינו ב-TLB) תגרום ל-TLB Miss. לאחר ה-TLB Miss, ה-PTE המתאים יוכנס ל-TLB.\n*   הלולאה הפנימית (`j`) ניגשת ל-1024 אלמנטים בתוך אותה שורה (כלומר, באותו דף). לכן, הגישה הראשונה לאלמנט בשורה `i` (לדוגמה `matrix[i][0]`) תגרום ל-TLB Miss עבור הדף של שורה `i`. כל 1023 הגישות הבאות לאלמנטים באותה שורה (`matrix[i][1]` עד `matrix[i][1023]`) יגרמו ל-TLB Hit, מכיוון שהדף של שורה `i` נמצא כעת ב-TLB.\n*   כאשר הלולאה החיצונית עוברת לשורה הבאה (`i+1`), ניגשים לדף חדש. גישה זו תגרום ל-TLB Miss.\n*   מכיוון שה-TLB יכול להכיל רק 16 כניסות, ולאחר 16 גישות לדפים שונים, הכניסה ה-17 תגרום ל-TLB Miss ותחליף את הכניסה שהייתה בשימוש הכי פחות לאחרונה (LRU).\n*   בסך הכל, יש 1024 דפים ייחודיים שהמטריצה מתפרסת עליהם. כל גישה *ראשונה* לכל אחד מ-1024 הדפים הללו תגרום ל-TLB Miss.\n\n**תשובה: 1024 TLB Misses.**\n\n**1.5. מהו המספר הכולל של גישות לזיכרון הראשי (RAM) עבור נתוני המטריצה ועבור טבלאות הדפים?**\n*   סה\"כ גישות לכתיבת נתונים למטריצה: `1024 * 1024 = 1,048,576` פעולות כתיבה.\n\n*   **ניתוח גישות לזיכרון הראשי (RAM) לכל פעולת כתיבה למטריצה:**\n    1.  **TLB Hit**: אם הכניסה לדף נמצאת ב-TLB, מתבצעת גישה אחת ל-RAM (כתיבת הנתון).\n    2.  **TLB Miss**: אם הכניסה לדף אינה ב-TLB, מתבצעת סריקת טבלת הדפים (Page Table Walk).\n        *   **Page Table Walk**: 4 רמות של טבלת דפים, כל רמה דורשת גישה ל-RAM. סך הכל 4 גישות ל-RAM.\n        *   **אם ה-PTE תקף (Present Bit = 1)**: ה-PTE נטען ל-TLB. לאחר מכן, מתבצעת גישה אחת ל-RAM (כתיבת הנתון). סך הכל 4 (PT) + 1 (נתון) = 5 גישות ל-RAM.\n        *   **אם ה-PTE אינו תקף (Present Bit = 0) - Page Fault**: \n            *   מתבצעות 4 גישות ל-RAM עבור סריקת טבלת הדפים.\n            *   מערכת ההפעלה מטפלת ב-Page Fault: בוחרת מסגרת פיזית (ייתכן שכוללת החלפת דף קיים לדיסק אם הוא מלוכלך - *פעולות דיסק אינן נספרות כאן*), טוענת את הדף החדש מהדיסק.\n            *   לאחר טעינת הדף, ה-PTE בטבלת הדפים מתעדכן (Present Bit = 1, PFN, Dirty, Accessed). זה דורש גישת כתיבה אחת ל-RAM.\n            *   ה-PTE החדש נטען ל-TLB.\n            *   הפקודה המקורית מבוצעת מחדש: כעת ה-TLB יכיל את ה-PTE (TLB Hit), ומתבצעת גישה אחת ל-RAM (כתיבת הנתון).\n            *   סה\"כ עבור מקרה Page Fault (ללא דיסק): 4 (PT) + 1 (עדכון PTE) + 1 (כתיבת נתון) = 6 גישות ל-RAM.\n\n*   **חישוב כולל:**\n    *   **מספר TLB Misses שהם גם Page Faults**: 1024 (כפי שחושב בסעיף 1.3 ו-1.4). עבור כל אחד מהם: 6 גישות ל-RAM.\n        *   סה\"כ גישות מ-Page Faults: `1024 * 6 = 6144` גישות ל-RAM.\n    *   **מספר TLB Hits**: סה\"כ גישות לנתונים פחות מספר ה-TLB Misses = `1,048,576 - 1024 = 1,047,552`.\n        *   עבור כל TLB Hit: גישה אחת ל-RAM (כתיבת הנתון).\n        *   סה\"כ גישות מ-TLB Hits: `1,047,552 * 1 = 1,047,552` גישות ל-RAM.\n\n*   **סה\"כ גישות ל-RAM**: `6144 (מ-Page Faults) + 1,047,552 (מ-TLB Hits) = 1,053,696` גישות ל-RAM.\n\n**תשובה: 1,053,696 גישות לזיכרון הראשי (RAM).**"
    },
    "difficulty_estimation": "Hard"
  }
}