{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-09 20:41:15",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 3850,
      "total_tokens": 19525
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Memory Management",
      "Context Switch"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי בעלת כתובות וירטואליות בגודל 32 ביט, וגודל דף של 4KB. טבלת הדפים היא היררכית בעלת שתי רמות, כאשר כל רמה של טבלת הדפים תופסת דף אחד בדיוק. כל כניסה בטבלת הדפים (PTE) היא בגודל 4 בתים. למערכת יש TLB (Translation Lookaside Buffer) בגודל 4 כניסות, בשיטת אסוציאטיבית מלאה (Fully Associative), עם מדיניות החלפה LRU (Least Recently Used). כל כניסה ב-TLB כוללת גם מזהה מרחב כתובות (ASID) כדי לתמוך בריבוי תהליכים.\nזמני הגישה לזיכרון הם כדלקמן:\n*   פגיעת TLB (TLB Hit): 10 ננו-שניות.\n*   החמצת TLB (TLB Miss) ללא כשל דף (Page Fault) – כולל הליכה בטבלת הדפים וגישה לזיכרון: 100 ננו-שניות.\n*   כשל דף (Page Fault): אנו מניחים שכל הדפים נמצאים בזיכרון הפיזי ואין כשלי דף אמיתיים במהלך ההדמיה. כלומר, כל החמצת TLB תגרור הליכה בטבלת הדפים בלבד.\n\nה-TLB ריק בתחילת ההדמיה. טבלאות הדפים עבור שני התהליכים מאוכלסות במלואן בזיכרון הפיזי.\n\nבצעו מעקב מפורט אחר מצב ה-TLB (VPN, PFN, ASID, סדר LRU) וחשבו את עלות הגישה לזיכרון עבור כל אחת מהפעולות הבאות:\n\n**רצף פעולות:**\n\n**תהליך A (ASID=1):**\n1.  גישה לכתובת וירטואלית 0x1000 (ממופה ל-PFN 0x10)\n2.  גישה לכתובת וירטואלית 0x2000 (ממופה ל-PFN 0x20)\n3.  גישה לכתובת וירטואלית 0x3000 (ממופה ל-PFN 0x30)\n4.  גישה לכתובת וירטואלית 0x4000 (ממופה ל-PFN 0x40)\n5.  גישה לכתובת וירטואלית 0x1000 (ממופה ל-PFN 0x10)\n6.  גישה לכתובת וירטואלית 0x5000 (ממופה ל-PFN 0x50)\n7.  גישה לכתובת וירטואלית 0x2000 (ממופה ל-PFN 0x20)\n\n**החלפת הקשר (Context Switch) לתהליך B (ASID=2):**\n\n8.  גישה לכתובת וירטואלית 0x1000 (ממופה ל-PFN 0x11)\n9.  גישה לכתובת וירטואלית 0x2000 (ממופה ל-PFN 0x21)\n10. גישה לכתובת וירטואלית 0x3000 (ממופה ל-PFN 0x31)\n\n**החלפת הקשר בחזרה לתהליך A (ASID=1):**\n\n11. גישה לכתובת וירטואלית 0x6000 (ממופה ל-PFN 0x60)\n12. גישה לכתובת וירטואלית 0x1000 (ממופה ל-PFN 0x10)\n\n\n**שאלות:**\nא. תארו את מצב ה-TLB (VPN, PFN, ASID, סדר LRU) לאחר כל גישת זיכרון. ציינו האם זו פגיעה או החמצה ב-TLB.\nב. מהי עלות הגישה הכוללת לזיכרון עבור כל רצף הפעולות?",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פירוט המערכת:\nגודל דף: 4KB = 2^12 בתים. לכן, 12 ביטים מכתובת וירטואלית מוקדשים ל-Offset.\nכתובת וירטואלית 32 ביט. לכן, VPN (Virtual Page Number) הוא 32-12 = 20 ביטים.\nטבלת דפים 2 רמות: אם כל רמה תופסת דף אחד (4KB) וכל PTE הוא 4 בתים, אז כל רמה מכילה 4KB/4B = 1024 כניסות. לכן, כל אינדקס לטבלת דפים הוא 10 ביטים (2^10 = 1024). סה\"כ 10 ביטים לרמה ראשונה ו-10 ביטים לרמה שנייה, אשר יחד נותנים 20 ביטים ל-VPN.\nTLB: 4 כניסות, Fully Associative, LRU, כולל ASID.\nזמני גישה: TLB Hit = 10ns, TLB Miss = 100ns (ללא Page Fault).\n\nמעקב אחר מצב ה-TLB:\nנציג את מצב ה-TLB כרשימה של כניסות מה-MRU (Accessed Most Recently) ל-LRU (Accessed Least Recently). כל כניסה היא (VPN, PFN, ASID).\n\n**מצב התחלתי: TLB ריק []**\n\n**תהליך A (ASID=1):**\n1.  **גישה ל-VA 0x1000 (VPN 0x1)** -> PFN 0x10\n    *   **TLB Miss**. עלות: 100ns. הליכה בטבלת הדפים. הוספת כניסה ל-TLB.\n    *   **TLB: [(0x1, 0x10, 1)]**\n\n2.  **גישה ל-VA 0x2000 (VPN 0x2)** -> PFN 0x20\n    *   **TLB Miss**. עלות: 100ns. הליכה בטבלת הדפים. הוספת כניסה ל-TLB.\n    *   **TLB: [(0x2, 0x20, 1), (0x1, 0x10, 1)]**\n\n3.  **גישה ל-VA 0x3000 (VPN 0x3)** -> PFN 0x30\n    *   **TLB Miss**. עלות: 100ns. הליכה בטבלת הדפים. הוספת כניסה ל-TLB.\n    *   **TLB: [(0x3, 0x30, 1), (0x2, 0x20, 1), (0x1, 0x10, 1)]**\n\n4.  **גישה ל-VA 0x4000 (VPN 0x4)** -> PFN 0x40\n    *   **TLB Miss**. עלות: 100ns. הליכה בטבלת הדפים. הוספת כניסה ל-TLB. ה-TLB מלא, לכן הכניסה ה-LRU (0x1, 0x10, 1) מפונה כדי לפנות מקום, והכניסה החדשה מתווספת כ-MRU.\n    *   **TLB: [(0x4, 0x40, 1), (0x3, 0x30, 1), (0x2, 0x20, 1), (0x1, 0x10, 1)]**\n\n5.  **גישה ל-VA 0x1000 (VPN 0x1)** -> PFN 0x10\n    *   **TLB Hit**. עלות: 10ns. הכניסה (0x1, 0x10, 1) נמצאת ב-TLB. היא נגישה ומועברת לראש רשימת ה-MRU.\n    *   **TLB: [(0x1, 0x10, 1), (0x4, 0x40, 1), (0x3, 0x30, 1), (0x2, 0x20, 1)]**\n\n6.  **גישה ל-VA 0x5000 (VPN 0x5)** -> PFN 0x50\n    *   **TLB Miss**. עלות: 100ns. הליכה בטבלת הדפים. ה-TLB מלא, נפנה את הכניסה ה-LRU (0x2, 0x20, 1).\n    *   **TLB: [(0x5, 0x50, 1), (0x1, 0x10, 1), (0x4, 0x40, 1), (0x3, 0x30, 1)]**\n\n7.  **גישה ל-VA 0x2000 (VPN 0x2)** -> PFN 0x20\n    *   **TLB Miss**. עלות: 100ns. הליכה בטבלת הדפים. ה-TLB מלא, נפנה את הכניסה ה-LRU (0x3, 0x30, 1).\n    *   **TLB: [(0x2, 0x20, 1), (0x5, 0x50, 1), (0x1, 0x10, 1), (0x4, 0x40, 1)]**\n\n**סה\"כ עלות לתהליך A (לפני החלפת הקשר): 6 * 100ns (Miss) + 1 * 10ns (Hit) = 610ns.**\n\n**החלפת הקשר לתהליך B (ASID=2):**\n*   בהחלפת קשר, אין צורך לרוקן את ה-TLB בזכות מזהה ה-ASID. הכניסות הקיימות נשארות, אך נגישות רק לתהליך עם ה-ASID המתאים.\n\n8.  **גישה ל-VA 0x1000 (VPN 0x1)** -> PFN 0x11\n    *   **TLB Miss**. עלות: 100ns. VPN 0x1 קיים ב-TLB אך עם ASID=1. זוהי החמצה עבור ASID=2. הליכה בטבלת הדפים. ה-TLB מלא, נפנה את הכניסה ה-LRU (0x4, 0x40, 1).\n    *   **TLB: [(0x1, 0x11, 2), (0x2, 0x20, 1), (0x5, 0x50, 1), (0x1, 0x10, 1)]**\n\n9.  **גישה ל-VA 0x2000 (VPN 0x2)** -> PFN 0x21\n    *   **TLB Miss**. עלות: 100ns. VPN 0x2 קיים ב-TLB אך עם ASID=1. זוהי החמצה עבור ASID=2. הליכה בטבלת הדפים. ה-TLB מלא, נפנה את הכניסה ה-LRU (0x1, 0x10, 1).\n    *   **TLB: [(0x2, 0x21, 2), (0x1, 0x11, 2), (0x2, 0x20, 1), (0x5, 0x50, 1)]**\n\n10. **גישה ל-VA 0x3000 (VPN 0x3)** -> PFN 0x31\n    *   **TLB Miss**. עלות: 100ns. VPN 0x3 (עם ASID=2) לא קיים ב-TLB. הליכה בטבלת הדפים. ה-TLB מלא, נפנה את הכניסה ה-LRU (0x5, 0x50, 1).\n    *   **TLB: [(0x3, 0x31, 2), (0x2, 0x21, 2), (0x1, 0x11, 2), (0x2, 0x20, 1)]**\n\n**סה\"כ עלות לתהליך B: 3 * 100ns (Miss) = 300ns.**\n\n**החלפת הקשר בחזרה לתהליך A (ASID=1):**\n*   גם כאן, ה-TLB נשאר כפי שהוא. הגישות יתבצעו עם ASID=1.\n\n11. **גישה ל-VA 0x6000 (VPN 0x6)** -> PFN 0x60\n    *   **TLB Miss**. עלות: 100ns. VPN 0x6 (עם ASID=1) לא קיים ב-TLB. הליכה בטבלת הדפים. ה-TLB מלא, נפנה את הכניסה ה-LRU (0x2, 0x20, 1).\n    *   **TLB: [(0x6, 0x60, 1), (0x3, 0x31, 2), (0x2, 0x21, 2), (0x1, 0x11, 2)]**\n\n12. **גישה ל-VA 0x1000 (VPN 0x1)** -> PFN 0x10\n    *   **TLB Miss**. עלות: 100ns. VPN 0x1 (עם ASID=1) לא נמצא ב-TLB (הוא פונה בשלב 9). הליכה בטבלת הדפים. ה-TLB מלא, נפנה את הכניסה ה-LRU (0x1, 0x11, 2).\n    *   **TLB: [(0x1, 0x10, 1), (0x6, 0x60, 1), (0x3, 0x31, 2), (0x2, 0x21, 2)]**\n\n**סה\"כ עלות לתהליך A (לאחר החלפת קשר): 2 * 100ns (Miss) = 200ns.**\n\n**ב. עלות הגישה הכוללת לזיכרון עבור כל רצף הפעולות:**\nעלות כוללת = עלות תהליך A (לפני החלפת קשר) + עלות תהליך B + עלות תהליך A (אחרי החלפת קשר)\nעלות כוללת = 610ns + 300ns + 200ns = **1110ns**."
    },
    "difficulty_estimation": "Hard"
  }
}