{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 08:13:43",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4186,
      "output_tokens": 3135,
      "total_tokens": 14769
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "TLB",
      "Memory Management",
      "Paging",
      "Cache Replacement Policies"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי בעלת כתובת וירטואלית בגודל 39 ביט וכתובת פיזית בגודל 40 ביט. גודל דף הוא 4KB (קילו-בתים). טבלת הדפים היא היררכית בת 3 רמות, כאשר כל כניסה בטבלת דפים (PTE) היא בגודל 8 בתים.\nהמערכת כוללת TLB (Translation Lookaside Buffer) בגודל 8 כניסות, מאפיין Fully Associative, ומדיניות החלפה LRU (Least Recently Used). ה-TLB ריק לחלוטין בתחילת ריצת התוכנית.\nנתונה תוכנית C המבצעת גישה למערך דו-ממדי:\n\n",
      "code_snippet": "#define N_ROWS 1024\n#define N_COLS 1024\n\nint matrix[N_ROWS][N_COLS]; // int is 4 bytes\n\nvoid access_matrix() {\n    // Part 1: Row-major access with stride\n    for (int i = 0; i < N_ROWS; ++i) {\n        for (int j = 0; j < N_COLS; j += 128) {\n            matrix[i][j] = matrix[i][j] + 1;\n        }\n    }\n\n    // Part 2: Column-major access with stride\n    for (int k = 0; k < N_COLS; ++k) {\n        for (int l = 0; l < N_ROWS; l += 128) {\n            matrix[l][k] = matrix[l][k] + 1;\n        }\n    }\n}",
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "פרטו את חלוקת הביטים של הכתובת הוירטואלית למספרי דף (VPN ברמות השונות) ולהיסט בתוך הדף. נמקו את החישובים.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "עבור הלולאה המקוננת הראשונה (Part 1), כמה TLB Misses יתרחשו? מה יהיה מצב ה-TLB (אילו כניסות יכיל) בסיום הלולאה הראשונה? הניחו שה-TLB ריק בתחילת התוכנית.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "עבור הלולאה המקוננת השנייה (Part 2), כמה TLB Misses יתרחשו? מה יהיה מצב ה-TLB (אילו כניסות יכיל) בסיום הלולאה השנייה?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "מהו המספר הכולל של TLB Misses במהלך כל ריצת הפונקציה access_matrix()?",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "1.1: נתחיל עם גודל הדף: 4KB = 2^12 בתים. מכאן שההיסט בתוך הדף דורש 12 ביטים.\nהכתובת הוירטואלית היא בגודל 39 ביטים. אם 12 ביטים מוקדשים להיסט, נותרו 39 - 12 = 27 ביטים עבור מספרי הדפים הוירטואליים (VPN).\nטבלת הדפים היא בת 3 רמות היררכיות. כל כניסה בטבלת דפים (PTE) היא בגודל 8 בתים.\nגודל כל טבלת דפים הוא דף אחד, כלומר 4KB. לכן, מספר הכניסות בכל טבלת דפים הוא 4KB / 8 בתים/כניסה = 512 כניסות = 2^9 כניסות. משמעות הדבר היא שכל רמה של VPN דורשת 9 ביטים.\nלכן, חלוקת הביטים היא: VPN רמה 1 (9 ביטים) | VPN רמה 2 (9 ביטים) | VPN רמה 3 (9 ביטים) | היסט (12 ביטים).\nסך הכל: 9 + 9 + 9 + 12 = 39 ביטים, כנדרש.\n\n1.2: גודל המערך matrix הוא 1024 שורות * 1024 עמודות * 4 בתים/int = 4,194,304 בתים = 4MB.\nגודל דף הוא 4KB. לכן המערך תופס 4MB / 4KB = 1024 דפים בזיכרון הווירטואלי (נניח שהם ממופים לדפים וירטואליים רציפים החל מדף 0).\nכל שורה במערך, matrix[i], תופסת 1024 עמודות * 4 בתים/int = 4096 בתים = דף אחד בדיוק. כלומר, matrix[i][j] נמצא בדף הווירטואלי מספר i (ביחס לתחילת המערך).\nבלולאה הפנימית: `for (int j = 0; j < N_COLS; j += 128)`, עבור i קבוע, הגישות הן ל-`matrix[i][0]`, `matrix[i][128]`, `matrix[i][256]`, ..., `matrix[i][896]`. כל 8 הגישות הללו הן לאלמנטים שונים בתוך *אותו הדף* (דף מספר i).\nמכיוון שכל 8 הגישות הן לאותו דף, עבור כל שורת i:\nהגישה הראשונה (לדוגמה `matrix[i][0]`) תגרום ל-TLB Miss עבור דף i. ה-PTE של דף i יוכנס ל-TLB.\n7 הגישות הבאות (לדוגמה `matrix[i][128]` וכו') יהיו TLB Hits, מכיוון שדף i כבר נמצא ב-TLB.\nהלולאה החיצונית רצה מ-`i=0` עד `i=1023` (סה\"כ 1024 איטרציות), וכל איטרציה ניגשת לדף וירטואלי חדש (דף 0, דף 1, ..., דף 1023).\nה-TLB מכיל 8 כניסות, והוא Fully Associative עם מדיניות LRU.\n*   עבור `i=0` עד `i=7`: כל גישה ראשונה לדף חדש תגרום ל-TLB Miss. סה\"כ 8 TLB Misses. ה-TLB יתמלא בכניסות עבור דפים P0 עד P7.\n*   עבור `i=8`: הגישה לדף P8 תגרום ל-TLB Miss. כניסת ה-PTE עבור דף P0 (שהוא ה-LRU) תפונה, וכניסה עבור P8 תוכנס במקומה.\n*   דפוס זה חוזר על עצמו: עבור כל ערך של i, תתרחש TLB Miss אחת עבור דף i (ולאחר מכן 7 hits). מכיוון שיש 1024 שורות (כלומר 1024 דפים וירטואליים נפרדים), יהיו סך הכל 1024 TLB Misses בלולאה הראשונה.\nבסיום הלולאה הראשונה, ה-TLB יכיל את ה-PTEs עבור 8 הדפים האחרונים אליהם ניגשו: P1016, P1017, P1018, P1019, P1020, P1021, P1022, P1023.\n\n1.3: ה-TLB מכיל בתחילת הלולאה השנייה את הדפים P1016-P1023.\nהלולאה החיצונית השנייה: `for (int k = 0; k < N_COLS; ++k)` רצה מ-`k=0` עד `k=1023`. (1024 איטרציות)\nהלולאה הפנימית השנייה: `for (int l = 0; l < N_ROWS; l += 128)` רצה עבור `l` בערכים: `0, 128, 256, 384, 512, 640, 768, 896`. אלו 8 ערכי l שונים.\nהגישה היא ל-`matrix[l][k]`. עבור k קבוע, הגישות הן לדפים: P0, P128, P256, P384, P512, P640, P768, P896. (אלו 8 דפים וירטואליים שונים וקבועים לכל k).\nננתח את ה-TLB Misses:\n*   עבור `k=0`: ה-TLB מכיל את P1016-P1023. אף אחד מהדפים P0, P128, ..., P896 אינו נמצא ב-TLB.\n    *   `matrix[0][0]` (דף P0): TLB Miss. P1016 (LRU) מפונה, P0 נכנס. TLB: `{P1017, ..., P1023, P0}`.\n    *   `matrix[128][0]` (דף P128): TLB Miss. P1017 (LRU) מפונה, P128 נכנס. TLB: `{P1018, ..., P1023, P0, P128}`.\n    *   ... כך ימשיך עבור כל 8 הגישות. כל גישה תהיה TLB Miss ותפנה את אחד מהדפים P1016-P1023 ותכניס את הדף החדש. סה\"כ 8 TLB Misses עבור `k=0`.\n    *   בסיום האיטרציה `k=0`, ה-TLB יכיל את הדפים: `{P0, P128, P256, P384, P512, P640, P768, P896}`. (הסדר ב-LRU תלוי בסדר הגישות בתוך הלולאה הפנימית).\n*   עבור `k=1`: ה-TLB מכיל כעת את 8 הדפים הנדרשים (P0, P128, ..., P896).\n    *   `matrix[0][1]` (דף P0): TLB Hit. P0 הופך ל-MRU.\n    *   `matrix[128][1]` (דף P128): TLB Hit. P128 הופך ל-MRU.\n    *   ... כל 8 הגישות יהיו TLB Hits. (0 TLB Misses).\n*   עבור `k=2` עד `k=1023`: המצב זהה ל-`k=1`. ה-8 דפים הנדרשים כבר נמצאים ב-TLB, וכל הגישות יהיו TLB Hits. (0 TLB Misses לכל איטרציה של k).\nלכן, בסך הכל יתרחשו 8 TLB Misses בלולאה השנייה (כולם באיטרציה `k=0`).\nבסיום הלולאה השנייה, ה-TLB יכיל את אותם 8 דפים: `{P0, P128, P256, P384, P512, P640, P768, P896}`. (הדף P896 יהיה ה-MRU, ו-P0 יהיה ה-LRU, בהנחה שהגישות ב-l הן בסדר עולה).\n\n1.4: סך הכל TLB Misses במהלך ריצת הפונקציה `access_matrix()` הוא סכום ה-Misses מהלולאה הראשונה והלולאה השנייה:\n1024 (מ-Part 1) + 8 (מ-Part 2) = 1032 TLB Misses."
    },
    "difficulty_estimation": "Hard"
  }
}