{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 23:10:14",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4788,
      "output_tokens": 4540,
      "total_tokens": 16497
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "Virtual Memory",
      "Memory Management",
      "Copy-On-Write"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המממשת זיכרון וירטואלי באמצעות דפדוף (Paging).\nמאפייני המערכת הם כדלקמן:\n*   גודל דף (Page Size) הוא 4KB.\n*   כתובות וירטואליות הן בגודל 32 ביטים.\n*   כתובות פיזיות הן בגודל 30 ביטים.\n*   טבלת הדפים היא היררכית, בעלת שתי רמות (Level 1 ו-Level 2).\n*   כל כניסה בטבלת דפים (PTE) היא בגודל 4 בתים (32 ביטים).\n*   פורמט ה-PTE הוא: [מספר מסגרת פיזית (PFN)] [V|P|D|A|COW|Reserved]. כאשר V=Valid, P=Present, D=Dirty, A=Accessed, COW=Copy-On-Write. ביטים Reserved שמורים לשימוש עתידי, יש להתעלם מהם.\n*   ביט ה-COW (Copy-On-Write) ב-PTE מציין האם הדף משותף וצריך להעתיקו לפני כתיבה. כאשר ביט זה דולק (1), כתיבה לדף תגרום לפסיקת דף (COW fault), הקצאת מסגרת פיזית חדשה, העתקת התוכן, עדכון ה-PTE של התהליך הכותב (כיבוי ביט COW והגדרת ביט D), ועדכון ה-PTE של התהליכים האחרים (אם רלוונטי).\n\nנתונים שני תהליכים, P1 ו-P2, המשתמשים בזיכרון.\n*   תהליך P1 משתמש ב-10 דפים פרטיים (Private Pages).\n*   תהליך P2 משתמש ב-5 דפים פרטיים (Private Pages).\n*   שני התהליכים חולקים אזור זיכרון של 8 דפים (Shared Pages) באמצעות מנגנון Copy-On-Write. בתחילה, דפים אלו ממופים לאותן מסגרות פיזיות בזיכרון, וביט ה-COW שלהם דולק בטבלאות הדפים של שני התהליכים.\n\nיש לפרט ולנמק את כל החישובים.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "מבנה הכתובת הוירטואלית:\n*   כמה ביטים מוקצים לכל אחד מהשדות הבאים בכתובת הוירטואלית: Offset, Page Number Level 2 (P2), Page Number Level 1 (P1)?\n*   מהו גודל הזיכרון הוירטואלי המקסימלי במערכת בבתים?\n*   מהו גודל הזיכרון הפיזי המקסימלי במערכת בבתים?\n*   כמה ביטים מוקצים ל-PFN ב-PTE?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "תרגום כתובת וטיפול ב-COW:\n*   תהליך P1 ניגש לכתובת וירטואלית `0x00401050`. נניח שזוהי כתובת בדף משותף (COW page) שטרם נכתב אליו על ידי P1. נניח ש-PTE עבור דף זה ברמה 2 של P1 מכיל: `PFN=0x2F3DE, V=1, P=1, D=0, A=0, COW=1`.\n*   א. אם הגישה היא קריאה (Read), מהי הכתובת הפיזית אליה יתורגם הגישה? אילו ביטים ב-PTE ישונו (אם בכלל)?\n*   ב. אם הגישה היא כתיבה (Write), מה יקרה? תאר את השלבים המלאים, כולל טיפול בפסיקת ה-COW, וציין אילו ביטים ב-PTE ישונו וכיצד. הנח שהמערכת מקצה מסגרת פיזית חדשה `0x3FFFF` עבור ההעתקה.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "ניצול זיכרון:\n*   חשב את סך הזיכרון הפיזי (בבתים) הנדרש עבור טבלאות הדפים (בכל הרמות) של שני התהליכים P1 ו-P2 יחד.\n*   חשב את סך הזיכרון הפיזי (בבתים) הנדרש עבור דפי הנתונים (Private + Shared) של שני התהליכים P1 ו-P2 יחד, *לפני* פעולת הכתיבה בסעיף 1.2ב.\n*   חשב את סך הזיכרון הפיזי (בבתים) הנדרש עבור דפי הנתונים (Private + Shared) של שני התהליכים P1 ו-P2 יחד, *לאחר* פעולת הכתיבה בסעיף 1.2ב.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון:\n\n**1.1. מבנה הכתובת הוירטואלית**\n*   **Offset**: גודל דף הוא 4KB = 2^12 בתים. לכן, ההיסט (Offset) הוא 12 ביטים.\n*   **Page Number**: כתובת וירטואלית היא 32 ביטים. אם 12 ביטים הם Offset, נשארים 32 - 12 = 20 ביטים למספר הדף הוירטואלי.\n*   **P1, P2**: טבלת הדפים היררכית עם 2 רמות. כל כניסה בטבלת דפים היא 4 בתים. גודל דף הוא 4KB. לכן, כל טבלת דפים (ברמה 1 או 2) יכולה להכיל 4KB / 4 בתים/כניסה = 1024 כניסות. 1024 = 2^10.\n    *   לכן, כל רמה של טבלת הדפים (P1 ו-P2) דורשת 10 ביטים עבור אינדקס הדף.\n    *   P1 (Level 1 Page Number): 10 ביטים.\n    *   P2 (Level 2 Page Number): 10 ביטים.\n    *   **סיכום חלוקת הביטים**: P1 (10 ביטים) | P2 (10 ביטים) | Offset (12 ביטים).\n\n*   **גודל הזיכרון הוירטואלי המקסימלי**: 2^32 בתים = 4GB. (מכיוון שהכתובת הווירטואלית היא 32 ביטים).\n\n*   **גודל הזיכרון הפיזי המקסימלי**: כתובת פיזית היא 30 ביטים. לכן, גודל הזיכרון הפיזי המקסימלי הוא 2^30 בתים = 1GB.\n\n*   **PFN ב-PTE**: כתובת פיזית היא 30 ביטים. 12 ביטים הם Offset. לכן, מספר מסגרת פיזית (PFN) הוא 30 - 12 = 18 ביטים.\n\n**1.2. תרגום כתובת וטיפול ב-COW**\n\nכתובת וירטואלית `0x00401050`.\nנמיר לבסיס 2 כדי לפרק ל-P1, P2, Offset:\n`0x00401050` = `0000 0000 0100 0000 0001 0000 0101 0000` בבינארי.\n\nלפי החלוקה שחושבה בסעיף 1.1: P1 (10 ביטים) | P2 (10 ביטים) | Offset (12 ביטים).\n*   Offset: `0000 0101 0000` = `0x050` (12 ביטים אחרונים).\n*   P2: `0000 0001 00` = `0x004` (10 ביטים לפני האופסט).\n*   P1: `0000 0000 01` = `0x001` (10 ביטים ראשונים).\n\nPTE עבור דף זה ברמה 2 של P1 מכיל: `PFN=0x2F3DE, V=1, P=1, D=0, A=0, COW=1`.\n\n*   **א. גישת קריאה (Read)**:\n    *   הגישה היא קריאה, וביט ה-COW דולק (1). מכיוון שזו קריאה, אין צורך להפעיל את מנגנון ה-COW.\n    *   **תרגום כתובת פיזית**:\n        *   PFN הוא `0x2F3DE` (18 ביטים).\n        *   הכתובת הפיזית תורכב מ-PFN ועוד Offset.\n        *   PFN (בינארי): `0010 1111 0011 1101 1110`\n        *   Offset (בינארי): `0000 0101 0000`\n        *   הכתובת הפיזית היא צירוף PFN + Offset: `0010 1111 0011 1101 1110 0000 0101 0000` בבינארי.\n        *   בבסיס 16: `0x2F3DE050`.\n    *   **שינוי ביטים ב-PTE**: רק ביט ה-Accessed (A) ישתנה ל-1, כדי לסמן שהדף נקרא.\n        *   PTE לאחר קריאה: `PFN=0x2F3DE, V=1, P=1, D=0, A=1, COW=1`.\n\n*   **ב. גישת כתיבה (Write)**:\n    *   הגישה היא כתיבה, וביט ה-COW דולק (1). זה יגרום ל-COW fault (פסיקת דף מסוג Copy-On-Write).\n    *   **שלבים**:\n        1.  **פסיקת COW**: מערכת ההפעלה (OS) מקבלת את הפסיקה.\n        2.  **הקצאת מסגרת חדשה**: ה-OS מקצה מסגרת פיזית חדשה עבור P1. נתון שהמסגרת החדשה היא `0x3FFFF` (18 ביטים).\n        3.  **העתקת תוכן**: תוכן הדף המקורי (במסגרת `0x2F3DE`) מועתק למסגרת הפיזית החדשה (`0x3FFFF`).\n        4.  **עדכון PTE של P1**: ה-PTE של P1 עבור הדף הספציפי מתעדכן:\n            *   ה-PFN משתנה ל-`0x3FFFF`.\n            *   ביט ה-COW כבה (0), מכיוון שהדף אינו משותף יותר עבור P1.\n            *   ביט ה-Dirty (D) נדלק (1), מכיוון שהדף נכתב.\n            *   ביט ה-Accessed (A) נדלק (1).\n            *   PTE לאחר כתיבה עבור P1: `PFN=0x3FFFF, V=1, P=1, D=1, A=1, COW=0`.\n        5.  **עדכון PTE של P2 (אם רלוונטי)**: ה-PTE של P2 עבור הדף המקורי נשאר ללא שינוי, עם ביט COW דולק, וממשיך להצביע על המסגרת הפיזית `0x2F3DE`. אם P2 ינסה לכתוב לדף זה, גם הוא יבצע COW משלו ויקבל מסגרת חדשה משלו.\n        6.  **המשך פעולה**: פעולת הכתיבה המקורית מתבצעת כעת במסגרת הפיזית החדשה (`0x3FFFF`).\n\n**1.3. ניצול זיכרון**\n\n*   **חישוב סך הזיכרון הפיזי עבור טבלאות הדפים (בכל הרמות) של P1 ו-P2 יחד**:\n    *   גודל דף = 4KB.\n    *   כל טבלת דפים (ברמה 1 או 2) תופסת דף אחד (4KB).\n    *   **תהליך P1**:\n        *   סה\"כ דפים בשימוש על ידי P1 (פרטיים + משותפים): 10 + 8 = 18 דפים.\n        *   בהנחת פיזור מינימלי, כל 18 הדפים ממופים על ידי כניסות בודדות בטבלת רמה 2 אחת. לכן, P1 יזדקק לטבלת רמה 2 אחת.\n        *   כדי להגיע לטבלת רמה 2 זו, נדרשת כניסה אחת בטבלת רמה 1 של P1. לכן, P1 יזדקק לטבלת רמה 1 אחת.\n        *   סה\"כ מסגרות לטבלאות דפים עבור P1: 1 (רמה 1) + 1 (רמה 2) = 2 מסגרות.\n    *   **תהליך P2**:\n        *   סה\"כ דפים בשימוש על ידי P2 (פרטיים + משותפים): 5 + 8 = 13 דפים.\n        *   בהנחת פיזור מינימלי, P2 יזדקק לטבלת רמה 2 אחת.\n        *   כדי להגיע לטבלת רמה 2 זו, נדרשת כניסה אחת בטבלת רמה 1 של P2. לכן, P2 יזדקק לטבלת רמה 1 אחת.\n        *   סה\"כ מסגרות לטבלאות דפים עבור P2: 1 (רמה 1) + 1 (רמה 2) = 2 מסגרות.\n    *   **סה\"כ מסגרות לטבלאות דפים עבור P1 ו-P2 יחד**: 2 (עבור P1) + 2 (עבור P2) = 4 מסגרות.\n    *   **סך זיכרון פיזי לטבלאות דפים**: 4 מסגרות * 4KB/מסגרת = 16KB.\n\n*   **חישוב סך הזיכרון הפיזי עבור דפי הנתונים (Private + Shared) של P1 ו-P2 יחד, *לפני* פעולת הכתיבה בסעיף 1.2ב**:\n    *   דפים פרטיים של P1: 10 דפים = 10 מסגרות פיזיות.\n    *   דפים פרטיים של P2: 5 דפים = 5 מסגרות פיזיות.\n    *   דפים משותפים (COW): 8 דפים. מכיוון שהם משותפים וטרם נכתב אליהם, הם ממופים לאותן מסגרות פיזיות. לכן, הם תופסים 8 מסגרות פיזיות.\n    *   **סה\"כ מסגרות לדפי נתונים לפני COW**: 10 (P1 פרטי) + 5 (P2 פרטי) + 8 (משותף COW) = 23 מסגרות.\n    *   **סך זיכרון פיזי לדפי נתונים לפני COW**: 23 מסגרות * 4KB/מסגרת = 92KB.\n\n*   **חישוב סך הזיכרון הפיזי עבור דפי הנתונים (Private + Shared) של P1 ו-P2 יחד, *לאחר* פעולת הכתיבה בסעיף 1.2ב**:\n    *   תהליך P1 כתב לאחד מהדפים המשותפים, מה שגרם להעתקה (COW).\n    *   דפים פרטיים של P1: 10 דפים = 10 מסגרות פיזיות.\n    *   דפים פרטיים של P2: 5 דפים = 5 מסגרות פיזיות.\n    *   דפים שהיו משותפים (COW) - מצב חדש:\n        *   7 דפים נותרו משותפים בין P1 ל-P2, והם ממופים ל-7 מסגרות פיזיות.\n        *   הדף ה-8 (ש-P1 כתב אליו) קיבל עותק חדש עבור P1, שמופה למסגרת פיזית חדשה (1 מסגרת).\n        *   המסגרת הפיזית המקורית של הדף ה-8 עדיין משמשת את P2 (כדף משותף עם COW). כלומר, היא נחשבת כעת למסגרת בשימוש על ידי P2 (אך לא על ידי P1 עבור דף זה). (1 מסגרת).\n        *   סה\"כ מסגרות עבור הדפים שהיו במקור משותפים: 7 (נותרו משותפים) + 1 (עותק P1) + 1 (מקורי, עדיין בשימוש P2) = 9 מסגרות.\n    *   **סה\"כ מסגרות לדפי נתונים לאחר COW**: 10 (P1 פרטי) + 5 (P2 פרטי) + 9 (דפים שהיו משותפים לאחר COW) = 24 מסגרות.\n    *   **סך זיכרון פיזי לדפי נתונים לאחר COW**: 24 מסגרות * 4KB/מסגרת = 96KB."
    },
    "difficulty_estimation": "Hard"
  }
}