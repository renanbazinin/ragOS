{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 21:58:55",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 2812,
      "total_tokens": 12607
    }
  },
  "question": {
    "id": 11,
    "type": "Open",
    "topic": [
      "Memory Management",
      "Virtual Memory",
      "Paging",
      "TLB",
      "Page Faults",
      "Page Replacement"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם המאפיינים הבאים:\n*   כתובת וירטואלית: 48 ביטים\n*   כתובת פיזית: 32 ביטים\n*   גודל דף: 4KB\n*   גודל כניסה בטבלת דפים (PTE): 4 בתים (32 ביטים), המכילה מספר מסגרת פיזית (PFN), וביטים Valid, Dirty, Accessed, וביטי הרשאות קריאה/כתיבה/הרצה.\n*   TLB (Translation Lookaside Buffer): בעל 128 כניסות, ממומש כ-fully associative, ומשתמש במדיניות החלפה LRU. כל כניסה ב-TLB כוללת VPN, PFN, וביטי הרשאות.\n\nתהליך מנסה לבצע פעולת כתיבה לכתובת הווירטואלית `0x0000_1234_5678`.\nתארו באופן מלא ומפורט את תהליך תרגום הכתובת, החל מהגישה הראשונית ועד להשלמת הכתיבה, בהנחה שמדובר ב'מקרה הגרוע ביותר' (worst-case scenario).\nיש לכלול בתיאור:\n1.  פירוט מבנה טבלת הדפים (מספר רמות, חלוקת ביטי ה-VPN).\n2.  כיצד ה-TLB מעורב בתהליך (בכל שלב).\n3.  את כל הגישות לזיכרון הראשי (RAM) ולזיכרון המשני (דיסק) שיתרחשו.\n4.  כיצד מטופלת פסיקת דף (Page Fault) במקרה זה (בהנחה שכל המסגרות הפיזיות בשימוש, ונדרשת החלפת דף 'מלוכלך').\n5.  את השינויים הנדרשים במבני הנתונים (TLB וטבלת הדפים) בעקבות התהליך.\nיש לפרט את כל החישובים הרלוונטיים.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "1.  **פירוק הכתובת הווירטואלית ומבנה טבלת הדפים:**\n    *   גודל כתובת וירטואלית: 48 ביטים.\n    *   גודל דף: 4KB = 2^12 בתים. לכן, 12 הביטים האחרונים של הכתובת הווירטואלית הם ה-Offset בתוך הדף.\n    *   מספר דף וירטואלי (VPN): 48 - 12 = 36 ביטים.\n    *   גודל כניסה בטבלת דפים (PTE): 4 בתים (32 ביטים).\n    *   מספר כניסות PTE בדף בודד: גודל דף / גודל PTE = 4KB / 4 בתים = 1024 כניסות (2^10).\n    *   כל רמה בטבלת הדפים משתמשת ב-10 ביטים מה-VPN.\n    *   מספר רמות נדרש: VPN באורך 36 ביטים. 36 חלקי 10 שווה 3 עם שארית 6. לכן, נדרשות 4 רמות של טבלאות דפים:\n        *   רמה 1: 6 ביטים (המצביעים לטבלת דפים רמה 2)\n        *   רמה 2: 10 ביטים (המצביעים לטבלת דפים רמה 3)\n        *   רמה 3: 10 ביטים (המצביעים לטבלת דפים רמה 4)\n        *   רמה 4: 10 ביטים (המצביעים לדף הפיזי)\n    *   סה\"כ ביטי VPN: 6 + 10 + 10 + 10 = 36 ביטים.\n    *   הכתובת הווירטואלית `0x0000_1234_5678`:\n        *   Offset: `0x678` (12 ביטים).\n        *   VPN: `0x0000_1234_5` (36 ביטים).\n        *   פירוק ה-VPN (בייצוג בינארי של 36 ביטים: `00000000000000010010001101000101`):\n            *   L1 Index (6 ביטים עליונים): `000000` (0)\n            *   L2 Index (10 ביטים הבאים): `0000000100` (4)\n            *   L3 Index (10 ביטים הבאים): `1000110100` (564)\n            *   L4 Index (10 ביטים תחתונים): `0100010101` (277)\n\n2.  **תהליך תרגום הכתובת במקרה הגרוע ביותר:**\n    *   **שלב 1: גישה ל-TLB (TLB Miss)**: ה-CPU מקבל את הכתובת הווירטואלית. הוא מנסה למצוא את ה-VPN (`0x0000_1234_5`) ב-TLB. במקרה הגרוע ביותר, ה-VPN לא נמצא ב-TLB (TLB Miss). זוהי גישת TLB אחת.\n\n    *   **שלב 2: הליכה בטבלת הדפים (Page Table Walk)**: מאחר שה-VPN לא נמצא ב-TLB, מערכת ההפעלה (או חומרת MMU) מבצעת הליכה בטבלאות הדפים המרובות בזיכרון הראשי:\n        *   ה-CPU ניגש לזיכרון הראשי (RAM) כדי לקרוא את ה-PTE המתאים בטבלת הדפים של רמה 1 (כתובת הבסיס של L1 נמצאת ברגיסטר כמו CR3). הוא משתמש ב-L1 Index (0) כדי למצוא את המצביע לטבלת הדפים של רמה 2. (גישת RAM 1).\n        *   ה-CPU ניגש לזיכרון הראשי (RAM) כדי לקרוא את ה-PTE המתאים בטבלת הדפים של רמה 2. הוא משתמש ב-L2 Index (4) כדי למצוא את המצביע לטבלת הדפים של רמה 3. (גישת RAM 2).\n        *   ה-CPU ניגש לזיכרון הראשי (RAM) כדי לקרוא את ה-PTE המתאים בטבלת הדפים של רמה 3. הוא משתמש ב-L3 Index (564) כדי למצוא את המצביע לטבלת הדפים של רמה 4. (גישת RAM 3).\n        *   ה-CPU ניגש לזיכרון הראשי (RAM) כדי לקרוא את ה-PTE המתאים בטבלת הדפים של רמה 4. הוא משתמש ב-L4 Index (277) כדי לקבל את ה-PTE המלא של הדף המבוקש. (גישת RAM 4).\n\n    *   **שלב 3: פסיקת דף (Page Fault)**: במקרה הגרוע ביותר, ה-PTE שנקרא מרמה 4 מצביע על כך שהדף אינו נמצא בזיכרון הפיזי (Valid bit = 0), או שאין לו הרשאות כתיבה עבור הפעולה המבוקשת (Write permission bit = 0). במקרה כזה תתרחש פסיקת דף.\n        *   מערכת ההפעלה מקבלת פסיקת דף.\n        *   **טיפול בפסיקה:**\n            *   מערכת ההפעלה צריכה למצוא מסגרת פיזית פנויה לטעינת הדף. בהנחה שכל המסגרות בשימוש, היא תפעיל אלגוריתם החלפת דפים (לדוגמה, LRU) כדי לבחור דף לפינוי.\n            *   אם הדף הנבחר לפינוי הוא \"מלוכלך\" (Dirty bit = 1), כלומר תוכנו השתנה מאז נטען, יש לכתוב אותו בחזרה לדיסק לפני פינויו. (גישת דיסק 1 – כתיבת דף מלוכלך לדיסק).\n            *   מערכת ההפעלה טוענת את הדף המבוקש מהדיסק לתוך המסגרת הפיזית שהתפנתה. (גישת דיסק 2 – קריאת דף מהדיסק).\n            *   מערכת ההפעלה מעדכנת את ה-PTE המתאים בטבלת הדפים של רמה 4 (אותו PTE שגרם לפסיקה): היא מכניסה את ה-PFN של המסגרת החדשה, קובעת Valid bit = 1, Dirty bit = 0, Accessed bit = 1, ומאפשרת הרשאות כתיבה. (גישת RAM 5 – כתיבה ל-PTE ב-RAM).\n\n    *   **שלב 4: עדכון ה-TLB**: לאחר שהדף נטען וה-PTE עודכן, מערכת ההפעלה מוסיפה את המיפוי החדש (VPN, PFN, הרשאות) ל-TLB. אם ה-TLB מלא, כניסה אחרת (לפי LRU) תפונה. (גישת TLB 2 – כתיבה ל-TLB).\n\n    *   **שלב 5: הפעלת ההוראה מחדש וגישה ל-TLB (TLB Hit)**: ה-CPU מפעיל מחדש את ההוראה שגרמה לפסיקת הדף. הפעם, כאשר הוא ניגש ל-TLB, הוא ימצא את ה-VPN (TLB Hit). (גישת TLB 3 – קריאה מ-TLB).\n\n    *   **שלב 6: גישה פיזית לזיכרון**: ה-CPU משתמש ב-PFN שהתקבל מה-TLB וב-Offset המקורי כדי לגשת לכתובת הפיזית ולבצע את פעולת הכתיבה בפועל. (גישת RAM 6 – כתיבה לזיכרון הפיזי).\n\n3.  **סיכום גישות במקרה הגרוע ביותר:**\n    *   **גישות ל-TLB:** 3 (אחת ל-miss, אחת לכתיבת entry חדש, אחת ל-hit לאחר הטיפול בפסיקה).\n    *   **גישות לזיכרון הראשי (RAM):** 6 (4 להליכה בטבלת הדפים, 1 לעדכון PTE, 1 לכתיבת הנתון בפועל).\n    *   **גישות לדיסק:** 2 (אחת לכתיבת דף מלוכלך מפונה, אחת לקריאת הדף המבוקש)."
    },
    "difficulty_estimation": "Hard"
  }
}