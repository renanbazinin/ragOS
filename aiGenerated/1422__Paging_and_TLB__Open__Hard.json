{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-09 20:40:14",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 5657,
      "total_tokens": 24899
    }
  },
  "question": {
    "id": 7,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Memory Management",
      "Virtual Memory"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי עם גודל דף של 4KB ומרחב כתובות וירטואלי ופיזי של 32 ביט. טבלת הדפים היא היררכית עם 2 רמות. כל כניסה בטבלת הדפים (PTE או PDE) היא בגודל 4 בתים, וכל טבלת דפים (ברמה 1 או 2) מאוחסנת בדף אחד בדיוק. המערכת כוללת TLB בגודל 16 כניסות, בשיטת אסוציאטיביות 4-כיוונית (4-way set associative) עם מדיניות החלפה LRU.\nזמני גישה:\n*   פגיעה ב-TLB (TLB Hit): 10 ננו-שניות.\n*   גישה לזיכרון (עבור טבלת דפים או נתונים): 100 ננו-שניות.\n*   טיפול בכשל דף (Page Fault) (כולל גישת דיסק, עדכון טבלת דפים ועדכון TLB): 10 מילי-שניות (10,000,000 ננו-שניות).\n\nתהליך חדש מתחיל כאשר ה-TLB ריק ואין דפים טעונים בזיכרון הפיזי. התהליך מבצע את רצף גישות הזיכרון הוירטואלי הבא (כולן גישות לקריאה/כתיבה לכתובת הנתונים):\n1.  קריאה לכתובת 0x00001000\n2.  כתיבה לכתובת 0x00005000\n3.  קריאה לכתובת 0x00009000\n4.  כתיבה לכתובת 0x0000D000\n5.  קריאה לכתובת 0x00001000\n6.  קריאה לכתובת 0x00011000\n7.  קריאה לכתובת 0x00002000\n8.  כתיבה לכתובת 0x00006000\n9.  קריאה לכתובת 0x0000A000\n10. כתיבה לכתובת 0x0000E000\n11. קריאה לכתובת 0x00001000\n12. קריאה לכתובת 0x00002000\n13. קריאה לכתובת 0x00012000\n14. קריאה לכתובת 0x00003000\n15. קריאה לכתובת 0x00007000\n16. קריאה לכתובת 0x0000B000\n17. קריאה לכתובת 0x0000F000\n18. קריאה לכתובת 0x00004000\n\nיש לפרט ולנמק את כל החישובים.\n\n**שאלות:**\n1.  כמה סטים קיימים ב-TLB? כמה כניסות יכול להכיל כל סט? הסבר כיצד מחושב אינדקס הסט (Set Index) עבור כתובת וירטואלית נתונה.\n2.  עבור רצף הגישות הנתון, פרט באופן מלא את פעולת ה-TLB וטבלת הדפים עבור כל גישה: האם זו פגיעה (Hit) או החטאה (Miss) ב-TLB? האם מתרחש כשל דף? אם מתרחש כשל דף, ציין זאת. אם מתבצעת החלפה ב-TLB, ציין איזו כניסה הוחלפה. יש להניח כי עבור כל דף וירטואלי חדש שנגשים אליו בפעם הראשונה, הוא אינו נמצא בזיכרון הפיזי ויתרחש כשל דף.\n3.  מהו שיעור הפגיעות (Hit Rate) של ה-TLB עבור רצף גישות זה? חשב את זמן הגישה האפקטיבי הממוצע (Effective Access Time) עבור רצף גישות זה.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "1.  **חישוב מספר הסטים וכניסות לסט:**\n    *   גודל ה-TLB הוא 16 כניסות.\n    *   ה-TLB הוא אסוציאטיבי 4-כיווני (4-way set associative).\n    *   מספר הסטים ב-TLB = גודל TLB / אסוציאטיביות = 16 כניסות / 4 כיוונים = 4 סטים.\n    *   כל סט יכול להכיל 4 כניסות.\n    *   **חישוב אינדקס הסט:** גודל דף הוא 4KB = 2^12 בתים, לכן 12 הביטים הפחות משמעותיים של הכתובת הוירטואלית הם ה-Offset. שאר 20 הביטים העליונים הם ה-Virtual Page Number (VPN). מכיוון שיש 4 סטים (2^2), נדרשים 2 ביטים מתוך ה-VPN כדי לקבוע את אינדקס הסט. נשתמש ב-2 הביטים הפחות משמעותיים של ה-VPN (VPN Modulo 4). לדוגמה, עבור VPN=0x1, אינדקס הסט הוא 1. עבור VPN=0x5, אינדקס הסט הוא 1.\n\n2.  **מעקב אחר פעולת ה-TLB וטבלת הדפים:**\n    נשתמש ב-PFN פיקטיביים החל מ-0x1000 עבור דפים חדשים. מצב ה-TLB יתואר כרשימה של זוגות (VPN, PFN) בתוך כל סט, כאשר הכניסה הימנית ביותר היא ה-MRU (Most Recently Used) והשמאלית ביותר היא ה-LRU (Least Recently Used).\n\n    *   **גישה 1: קריאה ל-VA 0x00001000 (VPN 0x1, Set 1)**\n        *   TLB Miss (סט 1 ריק).\n        *   Page Fault (דף 0x1 אינו קיים בזיכרון). PFN 0x1000 מוקצה.\n        *   עדכון TLB: הוספת (0x1, 0x1000) לסט 1.\n        *   סט 1: [(0x1, 0x1000)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 2: כתיבה ל-VA 0x00005000 (VPN 0x5, Set 1)**\n        *   TLB Miss (VPN 0x5 אינו בסט 1).\n        *   Page Fault (דף 0x5 אינו קיים בזיכרון). PFN 0x1001 מוקצה.\n        *   עדכון TLB: הוספת (0x5, 0x1001) לסט 1.\n        *   סט 1: [(0x1, 0x1000), (0x5, 0x1001)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 3: קריאה ל-VA 0x00009000 (VPN 0x9, Set 1)**\n        *   TLB Miss.\n        *   Page Fault (דף 0x9 אינו קיים בזיכרון). PFN 0x1002 מוקצה.\n        *   עדכון TLB: הוספת (0x9, 0x1002) לסט 1.\n        *   סט 1: [(0x1, 0x1000), (0x5, 0x1001), (0x9, 0x1002)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 4: כתיבה ל-VA 0x0000D000 (VPN 0xD, Set 1)**\n        *   TLB Miss.\n        *   Page Fault (דף 0xD אינו קיים בזיכרון). PFN 0x1003 מוקצה.\n        *   עדכון TLB: הוספת (0xD, 0x1003) לסט 1.\n        *   סט 1: [(0x1, 0x1000), (0x5, 0x1001), (0x9, 0x1002), (0xD, 0x1003)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 5: קריאה ל-VA 0x00001000 (VPN 0x1, Set 1)**\n        *   TLB Hit! (נמצאה הכניסה (0x1, 0x1000)).\n        *   אין Page Fault.\n        *   עדכון TLB: (0x1, 0x1000) הופך ל-MRU בסט 1.\n        *   סט 1: [(0x5, 0x1001), (0x9, 0x1002), (0xD, 0x1003), (0x1, 0x1000)]\n        *   זמן: 110 ננו-שניות.\n\n    *   **גישה 6: קריאה ל-VA 0x00011000 (VPN 0x11, Set 1)**\n        *   TLB Miss.\n        *   Page Fault (דף 0x11 אינו קיים בזיכרון). PFN 0x1004 מוקצה.\n        *   עדכון TLB: סט 1 מלא. כניסת ה-LRU היא (0x5, 0x1001). היא מוחלפת ב-(0x11, 0x1004).\n        *   סט 1: [(0x9, 0x1002), (0xD, 0x1003), (0x1, 0x1000), (0x11, 0x1004)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 7: קריאה ל-VA 0x00002000 (VPN 0x2, Set 2)**\n        *   TLB Miss (סט 2 ריק).\n        *   Page Fault (דף 0x2 אינו קיים בזיכרון). PFN 0x1005 מוקצה.\n        *   עדכון TLB: הוספת (0x2, 0x1005) לסט 2.\n        *   סט 2: [(0x2, 0x1005)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 8: כתיבה ל-VA 0x00006000 (VPN 0x6, Set 2)**\n        *   TLB Miss.\n        *   Page Fault (דף 0x6 אינו קיים בזיכרון). PFN 0x1006 מוקצה.\n        *   עדכון TLB: הוספת (0x6, 0x1006) לסט 2.\n        *   סט 2: [(0x2, 0x1005), (0x6, 0x1006)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 9: קריאה ל-VA 0x0000A000 (VPN 0xA, Set 2)**\n        *   TLB Miss.\n        *   Page Fault (דף 0xA אינו קיים בזיכרון). PFN 0x1007 מוקצה.\n        *   עדכון TLB: הוספת (0xA, 0x1007) לסט 2.\n        *   סט 2: [(0x2, 0x1005), (0x6, 0x1006), (0xA, 0x1007)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 10: כתיבה ל-VA 0x0000E000 (VPN 0xE, Set 2)**\n        *   TLB Miss.\n        *   Page Fault (דף 0xE אינו קיים בזיכרון). PFN 0x1008 מוקצה.\n        *   עדכון TLB: הוספת (0xE, 0x1008) לסט 2.\n        *   סט 2: [(0x2, 0x1005), (0x6, 0x1006), (0xA, 0x1007), (0xE, 0x1008)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 11: קריאה ל-VA 0x00001000 (VPN 0x1, Set 1)**\n        *   TLB Hit! (נמצאה הכניסה (0x1, 0x1000)).\n        *   אין Page Fault.\n        *   עדכון TLB: (0x1, 0x1000) הופך ל-MRU בסט 1.\n        *   סט 1: [(0x9, 0x1002), (0xD, 0x1003), (0x11, 0x1004), (0x1, 0x1000)]\n        *   זמן: 110 ננו-שניות.\n\n    *   **גישה 12: קריאה ל-VA 0x00002000 (VPN 0x2, Set 2)**\n        *   TLB Hit! (נמצאה הכניסה (0x2, 0x1005)).\n        *   אין Page Fault.\n        *   עדכון TLB: (0x2, 0x1005) הופך ל-MRU בסט 2.\n        *   סט 2: [(0x6, 0x1006), (0xA, 0x1007), (0xE, 0x1008), (0x2, 0x1005)]\n        *   זמן: 110 ננו-שניות.\n\n    *   **גישה 13: קריאה ל-VA 0x00012000 (VPN 0x12, Set 2)**\n        *   TLB Miss.\n        *   Page Fault (דף 0x12 אינו קיים בזיכרון). PFN 0x1009 מוקצה.\n        *   עדכון TLB: סט 2 מלא. כניסת ה-LRU היא (0x6, 0x1006). היא מוחלפת ב-(0x12, 0x1009).\n        *   סט 2: [(0xA, 0x1007), (0xE, 0x1008), (0x2, 0x1005), (0x12, 0x1009)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 14: קריאה ל-VA 0x00003000 (VPN 0x3, Set 3)**\n        *   TLB Miss (סט 3 ריק).\n        *   Page Fault (דף 0x3 אינו קיים בזיכרון). PFN 0x100A מוקצה.\n        *   עדכון TLB: הוספת (0x3, 0x100A) לסט 3.\n        *   סט 3: [(0x3, 0x100A)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 15: קריאה ל-VA 0x00007000 (VPN 0x7, Set 3)**\n        *   TLB Miss.\n        *   Page Fault (דף 0x7 אינו קיים בזיכרון). PFN 0x100B מוקצה.\n        *   עדכון TLB: הוספת (0x7, 0x100B) לסט 3.\n        *   סט 3: [(0x3, 0x100A), (0x7, 0x100B)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 16: קריאה ל-VA 0x0000B000 (VPN 0xB, Set 3)**\n        *   TLB Miss.\n        *   Page Fault (דף 0xB אינו קיים בזיכרון). PFN 0x100C מוקצה.\n        *   עדכון TLB: הוספת (0xB, 0x100C) לסט 3.\n        *   סט 3: [(0x3, 0x100A), (0x7, 0x100B), (0xB, 0x100C)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 17: קריאה ל-VA 0x0000F000 (VPN 0xF, Set 3)**\n        *   TLB Miss.\n        *   Page Fault (דף 0xF אינו קיים בזיכרון). PFN 0x100D מוקצה.\n        *   עדכון TLB: הוספת (0xF, 0x100D) לסט 3.\n        *   סט 3: [(0x3, 0x100A), (0x7, 0x100B), (0xB, 0x100C), (0xF, 0x100D)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    *   **גישה 18: קריאה ל-VA 0x00004000 (VPN 0x4, Set 0)**\n        *   TLB Miss (סט 0 ריק).\n        *   Page Fault (דף 0x4 אינו קיים בזיכרון). PFN 0x100E מוקצה.\n        *   עדכון TLB: הוספת (0x4, 0x100E) לסט 0.\n        *   סט 0: [(0x4, 0x100E)]\n        *   זמן: 10,000,310 ננו-שניות.\n\n    **סיכום גישות:**\n    *   סה\"כ גישות: 18\n    *   פגיעות TLB: 3 (גישות 5, 11, 12)\n    *   החטאות TLB: 15 (כל שאר הגישות)\n    *   כשלי דף: 15 (כל החטאות ה-TLB גררו כשל דף, לפי הנחת השאלה)\n\n3.  **חישוב שיעור הפגיעות וזמן הגישה האפקטיבי הממוצע:**\n    *   **שיעור הפגיעות (Hit Rate):**\n        *   שיעור פגיעות = (מספר פגיעות TLB) / (סה\"כ גישות) = 3 / 18 = 1/6 ≈ 0.1667 (או 16.67%).\n\n    *   **זמן הגישה האפקטיבי הממוצע (Effective Access Time - EAT):**\n        *   זמן גישה במקרה של TLB Hit: זמן TLB + זמן גישה לזיכרון נתונים = 10 ננו-שניות + 100 ננו-שניות = 110 ננו-שניות.\n        *   זמן גישה במקרה של TLB Miss וכשל דף (Page Fault): זמן TLB + זמן גישה לטבלת דפים רמה 1 + זמן גישה לטבלת דפים רמה 2 + זמן טיפול בכשל דף + זמן גישה לזיכרון נתונים (לאחר הטיפול בכשל) = 10 + 100 + 100 + 10,000,000 + 100 = 10,000,310 ננו-שניות.\n\n        *   סה\"כ זמן גישה = (מספר פגיעות TLB * זמן גישה במקרה של פגיעה) + (מספר החטאות TLB * זמן גישה במקרה של החטאה וכשל דף)\n        *   סה\"כ זמן גישה = (3 * 110 ננו-שניות) + (15 * 10,000,310 ננו-שניות)\n        *   סה\"כ זמן גישה = 330 ננו-שניות + 150,004,650 ננו-שניות = 150,004,980 ננו-שניות.\n\n        *   EAT = (סה\"כ זמן גישה) / (סה\"כ גישות)\n        *   EAT = 150,004,980 ננו-שניות / 18 ≈ 8,333,610 ננו-שניות (או 8.33 מילי-שניות).",
      "difficulty_estimation": "Hard"
    }
  }
}