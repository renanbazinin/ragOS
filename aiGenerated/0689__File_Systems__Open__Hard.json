{
  "metadata": {
    "source": "ai_generated",
    "subject": "File Systems",
    "topic_hint": "File Systems",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 23:35:15",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4084,
      "output_tokens": 4573,
      "total_tokens": 14830
    }
  },
  "question": {
    "id": 9,
    "type": "Open",
    "topic": [
      "File Systems",
      "NAND Flash",
      "SSD",
      "Wear Leveling",
      "Garbage Collection"
    ],
    "content": {
      "text": "נתונה מערכת קבצים חדשה בשם \"FlashFS\", המתוכננת במיוחד עבור התקני אחסון מסוג NAND Flash (כונני SSD). מטרת המערכת היא למזער את הגברת הכתיבה (write amplification) ולהאריך את חיי ההתקן על ידי יישום אסטרטגיות מתאימות. FlashFS משתמשת בשכבת תרגום פלאש (FTL - Flash Translation Layer) הממפה בלוקים לוגיים לבלוקים פיזיים, ומאפשרת כתיבה מחוץ למקום (out-of-place writes).\n\nנתונים:\n*   גודל עמוד (Page Size): 4KB (יחידת הכתיבה הקטנה ביותר).\n*   גודל בלוק מחיקה (Erase Block Size): 256KB (יחידת המחיקה הקטנה ביותר).\n*   כל בלוק מחיקה מכיל 64 עמודים (256KB / 4KB).\n*   מנגנון ה-FTL מאפשר מיפוי מלא (fully associative mapping) של בלוקים לוגיים לבלוקים פיזיים.\n*   ה-FTL מנהל רשימות של בלוקים ריקים (free blocks), בלוקים פעילים (active blocks) ובלוקים מיושנים (obsolete blocks).\n*   מנגנון איסוף הזבל (Garbage Collection) מופעל כאשר מספר הבלוקים הריקים יורד מתחת לסף מסוים.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "9.1",
        "text": "FlashFS מיישמת מנגנון איזון בלאי (wear leveling) כדי להאריך את חיי ה-SSD.\nא. הסבירו בקצרה מהו wear leveling, מדוע הוא קריטי ב-NAND Flash, ותארו שני סוגים עיקריים שלו (סטטי ודינמי).\nב. תארו כיצד FlashFS יכולה ליישם wear leveling דינמי יעיל. מהם היתרונות והחסרונות של גישה זו בהקשר של FlashFS?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "9.2",
        "text": "משתמש מבצע עדכון לוגי של 4KB נתונים בעמוד קיים בקובץ. העמוד הלוגי ממופה כרגע לעמוד פיזי P1 בבלוק מחיקה B1.\nא. תארו את רצף הפעולות הפיזיות (קריאה, כתיבה, מחיקה) הנדרשות על ידי ה-FTL וה-FlashFS כדי לבצע את העדכון, בהנחה שאין מספיק עמודים ריקים בבלוק הפעיל הנוכחי, ונדרש להפעיל איסוף זבל (Garbage Collection) על בלוק B_GC שנבחר. בלוק B_GC מכיל 50% עמודים תקפים ו-50% עמודים מיושנים.\nב. חשבו את גורם הגברת הכתיבה (Write Amplification Factor - WAF) עבור פעולת העדכון המתוארת בסעיף א'. הראו את החישוב המלא ונמקו. (התעלמו מפעולות קריאה של מטא-דאטה שגרתיות).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "9.3",
        "text": "התקני SSD רבים כוללים שטח אחסון נוסף המכונה \"over-provisioning\".\nא. הסבירו מהו over-provisioning וכיצד הוא תורם לשיפור הביצועים ואורך חיי ה-SSD במערכת קבצים כמו FlashFS.\nב. הציעו דוגמה מספרית (באחוזים) של over-provisioning וציינו אילו פרמטרים של מערכת הקבצים או דפוסי השימוש יכולים להשפיע על הבחירה באחוז זה.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון לשאלה 9:\n\n**פתרון לסעיף 9.1.א. (Wear Leveling)**\n*   **מהו Wear Leveling ומדוע הוא קריטי:** NAND Flash הוא התקן בעל אורך חיים מוגבל, כאשר כל בלוק מחיקה יכול לעמוד במספר מוגבל של מחזורי מחיקה/כתיבה (Program/Erase cycles - P/E cycles) לפני שהוא נשחק ונהרס. ללא מנגנון מיוחד, בלוקים מסוימים שבהם נכתבים נתונים בתדירות גבוהה (לדוגמה, בלוקים המכילים מטא-דאטה של מערכת הקבצים או קבצים זמניים) יישחקו מהר יותר מאחרים, ויגרמו לכשל מוקדם של כל ההתקן. Wear leveling הוא מנגנון שמטרתו לפזר את פעולות הכתיבה/מחיקה באופן אחיד על פני כל הבלוקים הפיזיים בהתקן, ובכך להאריך את חיי ה-SSD כולו.\n*   **סוגים עיקריים:**\n    *   **Wear Leveling סטטי (Static Wear Leveling):** מנגנון זה מפקח גם על בלוקים המכילים נתונים \"קרים\" (שאינם משתנים לעיתים קרובות). אם בלוק כזה לא נכתב מחדש במשך זמן רב, ובלוקים אחרים נשחקים במהירות, המערכת תעתיק את הנתונים מהבלוק הקר לבלוק אחר עם ספירת P/E נמוכה יותר, ותשחרר את הבלוק הקר כדי שיוכל לשמש לנתונים \"חמים\" (שמשתנים בתדירות גבוהה). זה מאריך את חיי ה-SSD בצורה הטובה ביותר אך דורש פעולות העתקה נוספות.\n    *   **Wear Leveling דינמי (Dynamic Wear Leveling):** מנגנון זה מתמקד בעיקר בבלוקים המכילים נתונים \"חמים\" (שמשתנים לעיתים קרובות). ה-FTL עוקב אחר ספירת ה-P/E של בלוקים פנויים (או בלוקים שיש בהם נתונים שמשתנים). כאשר נדרשת כתיבה לוגית חדשה, ה-FTL יבחר בלוק פיזי פנוי עם ספירת ה-P/E הנמוכה ביותר מבין הבלוקים הזמינים. גישה זו פשוטה יותר ליישום אך אינה מונעת שחיקה לא אחידה אם חלק מהבלוקים נשארים עם נתונים סטטיים ואינם נכתבים מחדש.\n\n**פתרון לסעיף 9.1.ב. (יישום Wear Leveling דינמי ב-FlashFS)**\n*   **כיצד FlashFS יכולה ליישם:** FlashFS, באמצעות ה-FTL שלה, יכולה לשמור עבור כל בלוק פיזי ספירת P/E (Program/Erase cycles). כאשר FlashFS צריכה לכתוב נתונים חדשים (לדוגמה, כתוצאה מעדכון עמוד לוגי קיים, או כתיבת עמוד לוגי חדש), היא תבקש מה-FTL בלוק פיזי פנוי (או בלוק שיהפוך לפנוי לאחר איסוף זבל). ה-FTL יבחר את הבלוק הפיזי הפנוי (או את הבלוק בעל הנתונים המיושנים ביותר שניתן למחוק) בעל ספירת ה-P/E הנמוכה ביותר. לאחר מחיקה וכתיבה לבלוק זה, ספירת ה-P/E שלו תעודכן. זה מבטיח שבלוקים ששוחררו ונמחקו ישמשו לכתיבות הבאות בצורה מאוזנת.\n*   **יתרונות:**\n    *   **פשטות יחסית:** קל יותר ליישום מ-Static Wear Leveling, מכיוון שאינו דורש מעקב והעתקה של נתונים \"קרים\".\n    *   **יעילות עבור נתונים דינמיים:** מבטיח שבלוקים המעורבים בפעולות כתיבה תכופות ישחקו באופן אחיד.\n    *   **הפחתת Overheads:** אין צורך לבצע העתקות מיותרות של נתונים סטטיים, מה שחוסך משאבי כתיבה.\n*   **חסרונות:**\n    *   **פוטנציאל לשחיקה לא אחידה:** אם ישנם בלוקים המכילים נתונים סטטיים מאוד שאינם משתנים לעולם, הם לא ייכללו במנגנון ה-wear leveling הדינמי, ובלוקים אחרים ימשיכו להישחק. זה עלול להוביל לכשל מוקדם יותר של ההתקן בהשוואה ל-Static Wear Leveling.\n    *   **תלות בדפוסי שימוש:** יעילותו תלויה מאוד בכמות הנתונים הסטטיים מול הדינמיים.\n\n**פתרון לסעיף 9.2.א. (רצף פעולות לעדכון נתונים)**\nעדכון עמוד לוגי של 4KB הממופה לעמוד פיזי P1 בבלוק B1, כאשר נדרש איסוף זבל על בלוק B_GC (50% תקפים, 50% מיושנים):\n\n1.  **קריאת נתונים תקפים מבלוק B_GC:** ה-FTL יבחר בלוק B_GC לצורך איסוף זבל. מכיוון ש-50% מהעמודים בו תקפים (32 עמודים, כלומר 32 * 4KB = 128KB), יש לקרוא אותם.\n2.  **כתיבת הנתונים התקפים מבלוק B_GC לבלוק פיזי פנוי חדש:** ה-FTL יבחר בלוק פיזי פנוי (נניח B_NEW_GC) ויכתוב אליו את 32 העמודים התקפים שנקראו מ-B_GC.\n3.  **מחיקת בלוק B_GC:** לאחר שכל הנתונים התקפים מ-B_GC הועתקו, בלוק B_GC נמחק במלואו (Erase operation). כעת הוא בלוק פנוי וניתן להקצותו מחדש.\n4.  **בחירת עמוד ריק לכתיבת הנתונים המעודכנים:** ה-FTL יבחר עמוד ריק בבלוק הפעיל הנוכחי (או בבלוק B_NEW_GC אם הוא נבחר כבלוק הפעיל), נניח P_NEW.\n5.  **כתיבת הנתונים המעודכנים לעמוד P_NEW:** ה-FTL כותב את 4KB הנתונים המעודכנים לעמוד הפיזי P_NEW.\n6.  **עדכון טבלת המיפוי ב-FTL:** ה-FTL מעדכן את טבלת המיפוי כך שהעמוד הלוגי מצביע כעת על העמוד הפיזי P_NEW. העמוד הפיזי P1 בבלוק B1 מסומן כעת כמיושן (obsolete).\n7.  **עדכון ספירות P/E:** ספירת ה-P/E של בלוק B_GC (שנמחק וכעת פנוי) תעודכן לאחר המחיקה.\n\n**פתרון לסעיף 9.2.ב. (חישוב Write Amplification Factor - WAF)**\n*   **הגדרת WAF:** WAF הוא היחס בין כמות הנתונים הפיזיים שנכתבו בפועל ל-NAND Flash לבין כמות הנתונים הלוגיים שהמארח ביקש לכתוב.\n    WAF = (סה\"כ כתיבות פיזיות) / (סה\"כ כתיבות לוגיות)\n\n*   **חישוב:**\n    *   **כתיבה לוגית:** 4KB (העדכון המקורי).\n    *   **כתיבות פיזיות:**\n        1.  **העתקת נתונים תקפים מ-B_GC:** 32 עמודים * 4KB/עמוד = 128KB. (אלו כתיבות פנימיות של ה-FTL, לא כתיבה ישירה של המארח אך נחשבות ככתיבה פיזית). יש להעתיק אותם לבלוק פיזי חדש.\n        2.  **כתיבת הנתונים המעודכנים:** 4KB. (הנתונים הלוגיים המעודכנים נכתבים לעמוד פיזי חדש).\n    *   סה\"כ כתיבות פיזיות = 128KB (העתקה) + 4KB (נתונים חדשים) = 132KB.\n\n    WAF = 132KB / 4KB = 33.\n\n    **נימוק:** גורם הגברת הכתיבה הוא 33. זאת מכיוון שעל מנת לעדכן 4KB של נתונים לוגיים, ה-FTL נאלץ לבצע איסוף זבל. איסוף הזבל דרש העתקה של 128KB של נתונים תקפים (50% מבלוק ה-GC). בנוסף לכך, נכתבו ה-4KB של הנתונים המעודכנים עצמם. סך הכתיבות הפיזיות הוא 128KB (העתקה) + 4KB (נתונים חדשים) = 132KB. היחס בין 132KB ל-4KB הוא 33.\n\n**פתרון לסעיף 9.3.א. (Over-provisioning)**\n*   **מהו Over-provisioning:** Over-provisioning (OP) הוא שטח אחסון פיזי נוסף ב-SSD שאינו נגיש למערכת ההפעלה או למשתמש. הוא שמור באופן בלעדי לשימוש פנימי של בקר ה-SSD (ה-FTL) לצורך ניהול, כגון איסוף זבל, wear leveling, הקצאת בלוקים פגומים (bad block management) וניהול מטמון. לדוגמה, SSD של 120GB עשוי להיות מבוסס על שבבי פלאש בנפח פיזי של 128GB, כאשר 8GB (כ-7%) שמורים ל-OP.\n*   **תרומה לשיפור ביצועים ואורך חיים ב-FlashFS:**\n    *   **הפחתת WAF ושיפור אורך חיים:** שטח OP מספק ל-FTL יותר בלוקים פנויים לעבודה. ככל שיש יותר בלוקים פנויים, ה-FTL יכול לבחור בלוקים בצורה חכמה יותר עבור איסוף זבל ו-wear leveling. זה מאפשר לו לאסוף זבל בצורה יעילה יותר (לדוגמה, לבחור בלוקים עם אחוז גבוה יותר של עמודים מיושנים), מה שמפחית את הצורך להעתיק נתונים תקפים ומוביל להפחתה ב-WAF. WAF נמוך יותר משמעותו פחות כתיבות פיזיות, מה שמאריך את חיי ה-SSD.\n    *   **שיפור ביצועים (במיוחד בכתיבה):** כמות גדולה יותר של בלוקים פנויים מאפשרת ל-FTL לשמור רשימה ארוכה יותר של בלוקים ריקים, מה שמפחית את התדירות שבה חייבים לבצע איסוף זבל. פעולות איסוף זבל (מחיקה והעתקה) צורכות זמן ומשאבי I/O, ועלולות להאט את ביצועי הכתיבה. עם שטח OP גדול יותר, ה-SSD יכול לשמור על ביצועי כתיבה גבוהים יותר לאורך זמן, גם תחת עומס כתיבה כבד.\n    *   **גמישות ב-Wear Leveling:** שטח OP מאפשר ל-FTL לבצע wear leveling בצורה יעילה יותר על ידי מתן יותר אפשרויות לבלוקים להחלפה.\n\n**פתרון לסעיף 9.3.ב. (דוגמה מספרית והשפעה)**\n*   **דוגמה מספרית:** אחוז OP נפוץ נע בין 7% (לדוגמה, 240GB לוגיים מתוך 256GB פיזיים) ל-28% (לדוגמה, 400GB לוגיים שמשתמשים ב-512GB פיזיים). ב-SSD המיועד ליישומים ארגוניים עם עומס כתיבה גבוה, נראה לעיתים קרובות OP של 28%. ב-SSD לצרכן ביתי, נראה לרוב OP של 7%.\n*   **פרמטרים המשפיעים על הבחירה באחוז ה-OP:**\n    *   **דפוס עומס העבודה (Workload Pattern):** כוננים המיועדים לעומסי כתיבה כבדים ורנדומליים (לדוגמה, שרתי בסיסי נתונים) ייהנו משטח OP גדול יותר כדי להפחית את ה-WAF ולשמור על ביצועים עקביים. כוננים עם עומסי קריאה בעיקר ו/או כתיבות סדרתיות צפויות פחות להזדקק ל-OP גבוה.\n    *   **אורך חיים רצוי (Desired Endurance):** יישומים הדורשים אורך חיים ארוך יותר (יותר P/E cycles) יבחרו ב-OP גבוה יותר כדי למזער את השחיקה.\n    *   **עלות:** שטח OP גבוה יותר משמעותו פחות שטח זמין למשתמש, ולכן עלות גבוהה יותר לכל GB שימושי. יש למצוא איזון בין עלות, ביצועים ואורך חיים.\n    *   **אלגוריתמי ה-FTL ואיסוף הזבל:** אלגוריתמים מתוחכמים יותר של FTL ואיסוף זבל עשויים לדרוש פחות OP כדי להשיג רמות ביצועים ואורך חיים דומות.\n    *   **אחוז הנתונים המיושנים (Stale Data Ratio):** בסביבות שבהן אחוז גבוה של נתונים הופך למיושן במהירות, OP גבוה יותר יכול לסייע ל-FTL לנהל את הבלוקים ביעילות רבה יותר."
    },
    "difficulty_estimation": "Hard"
  }
}