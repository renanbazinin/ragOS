{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Virtual Memory",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:37:19",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 3169,
      "total_tokens": 13992
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Virtual Memory",
      "Paging",
      "Memory Management",
      "TLB",
      "Page Faults",
      "Performance"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה עם מנגנון זיכרון וירטואלי המשתמש בטבלאות דפים מרובות רמות וב-TLB. פרטי המערכת הם כדלקמן:\n*   מרחב כתובות וירטואלי (VA): 48 ביטים.\n*   מרחב כתובות פיזי (PA): 40 ביטים.\n*   גודל דף (Page Size): 4KB.\n*   גודל כניסה בטבלת דפים (PTE): 8 בתים.\n*   כל טבלת דפים (בכל רמה) מאוחסנת בדף אחד בדיוק.\n*   ה-TLB הוא בגודל 128 כניסות, אסוציאטיבי מלא (Fully Associative), ומשתמש במדיניות החלפה LRU.\n*   מספר המסגרות הפיזיות הזמינות לתהליך (לצורך טעינת דפי נתונים בלבד, לא דפי טבלאות דפים): 100 מסגרות.\n*   זמני גישה:\n    *   TLB Hit: 1ns\n    *   גישה לזיכרון הראשי (לדף נתונים או כניסה בטבלת דפים): 100ns\n    *   גישה לדיסק (עקב Page Fault): 10ms (10,000,000ns)\n\nנתון הקוד הבא המופעל על ידי תהליך יחיד. המערך `arr` מתחיל בכתובת וירטואלית מיושרת לדף (page-aligned).\n\nענו על השאלות הבאות, ופרטו את כל החישובים וההנחות:",
      "code_snippet": "#include <stdio.h>\n#include <stdlib.h>\n\n#define NUM_PAGES 2560 // Total pages to access\n#define PAGE_SIZE 4096 // 4KB\n\nint main() {\n    char *arr = (char *)malloc(NUM_PAGES * PAGE_SIZE); // Allocate 10MB\n    if (arr == NULL) {\n        perror(\"malloc failed\");\n        return 1;\n    }\n\n    for (int i = 0; i < NUM_PAGES; i++) {\n        arr[i * PAGE_SIZE] = 0; // Access the first byte of each page\n    }\n\n    free(arr);\n    return 0;\n}",
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "מבנה כתובת וירטואלית וטבלאות דפים:\n    *   כמה רמות של טבלאות דפים נדרשות? פרטו את חלוקת הביטים של הכתובת הוירטואלית לכל רמה ולהיסט.\n    *   מהו הגודל הכולל (בבתים) של כל טבלאות הדפים הנדרשות כדי למפות את כל המרחב הוירטואלי של תהליך אחד? (הניחו שכל הדפים במרחב הוירטואלי יכולים להיות ממופים, גם אם לא כולם בזיכרון הפיזי).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "ביצועי TLB ו-Page Faults:\n    *   כמה גישות ל-TLB יתבצעו במהלך ריצת הלולאה?\n    *   כמה TLB misses יתרחשו במהלך ריצת הלולאה?\n    *   כמה Page Faults יתרחשו במהלך ריצת הלולאה? (הניחו שה-TLB והזיכרון הפיזי ריקים בתחילת הלולאה, ורק דפי הנתונים נכנסים ל-100 המסגרות הזמינות, לא דפי טבלאות דפים).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "זמן גישה אפקטיבי:\n    *   מהו זמן הגישה הממוצע (Effective Access Time - EAT) לכל גישת זיכרון בתוך הלולאה?\n    *   מהו הזמן הכולל לביצוע הלולאה, בהתחשב בזמני הגישה שצוינו? (התעלמו מזמני CPU, התמקדו רק בגישות לזיכרון).",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון:\n\n1.1. מבנה כתובת וירטואלית וטבלאות דפים:\n*   **גודל היסט (Offset)**: גודל דף הוא 4KB = 2^12 בתים. לכן, ההיסט הוא 12 ביטים.\n*   **ביטים עבור מספר דף וירטואלי (VPN)**: מרחב הכתובות הוירטואלי הוא 48 ביטים. לאחר הפחתת ההיסט, נשארים 48 - 12 = 36 ביטים עבור ה-VPN.\n*   **מספר כניסות לטבלת דפים בדף אחד**: גודל כניסה בטבלת דפים (PTE) הוא 8 בתים. גודל דף הוא 4KB = 4096 בתים. לכן, מספר הכניסות בכל טבלת דפים הוא 4096 / 8 = 512 כניסות. 512 = 2^9, כלומר כל רמה בטבלת הדפים משתמשת ב-9 ביטים מתוך ה-VPN.\n*   **מספר רמות**: ה-VPN הוא 36 ביטים, וכל רמה צורכת 9 ביטים. לכן, מספר הרמות הנדרשות הוא 36 / 9 = 4 רמות.\n*   **חלוקת הכתובת הוירטואלית**: P1 (רמה 1): 9 ביטים | P2 (רמה 2): 9 ביטים | P3 (רמה 3): 9 ביטים | P4 (רמה 4): 9 ביטים | Offset (היסט): 12 ביטים. סה\"כ: 9 + 9 + 9 + 9 + 12 = 48 ביטים.\n\n*   **גודל כולל של טבלאות הדפים (למיפוי כל המרחב הוירטואלי):**\n    *   כדי למפות את כל המרחב הוירטואלי (2^36 דפים), נדרשות טבלאות דפים בכל הרמות:\n        *   רמה 1 (טבלת הבסיס): 1 דף.\n        *   רמה 2: 2^9 טבלאות (כי לרמה 1 יש 2^9 כניסות, וכל כניסה מצביעה על טבלת רמה 2).\n        *   רמה 3: 2^9 * 2^9 = 2^18 טבלאות.\n        *   רמה 4: 2^9 * 2^9 * 2^9 = 2^27 טבלאות.\n    *   סה\"כ דפים לטבלאות דפים = 1 + 2^9 + 2^18 + 2^27.\n    *   הגודל הכולל בבתים = (1 + 512 + 262,144 + 134,217,728) * 4KB.\n    *   מכיוון שהמספר הגדול ביותר דומיננטי, הגודל הוא בקירוב 2^27 * 4KB = 2^27 * 2^12 בתים = 2^39 בתים.\n    *   2^39 בתים = 512 ג'יגה-בייט (GB).\n\n1.2. ביצועי TLB ו-Page Faults:\n*   **מספר גישות ל-TLB**: הלולאה מבצעת גישה לדף אחד בכל איטרציה, ובסה\"כ 2560 איטרציות (NUM_PAGES). לכן, יהיו 2560 גישות ל-TLB.\n*   **מספר TLB misses**: ה-TLB בגודל 128 כניסות. המערך ניגש ל-2560 דפים ייחודיים באופן סדרתי. מכיוון שכל דף נגיש פעם אחת בלבד במהלך הלולאה, ואין גישות חוזרות לדפים שכבר הוצאו מה-TLB, כל 2560 הגישות יגרמו ל-TLB misses.\n*   **מספר Page Faults**: מספר המסגרות הפיזיות הזמינות לדפי נתונים הוא 100. אנו ניגשים ל-2560 דפים ייחודיים. בדומה ל-TLB, מכיוון שכל דף נגיש פעם אחת בלבד והזיכרון הפיזי יכול להכיל רק 100 דפים, כל 2560 הגישות יגרמו ל-Page Faults (ה-100 הראשונים יטענו דפים, וה-2460 הנותרים יגרמו להחלפה של דפים קיימים שאינם נגישים יותר).\n\n1.3. זמן גישה אפקטיבי:\nכל גישת זיכרון בתוך הלולאה גורמת ל-TLB miss וגם ל-Page Fault. נחשב את הזמן הכולל עבור גישת זיכרון לוגית אחת:\n\n*   **1. גישת TLB (Miss)**: 1ns.\n*   **2. מעבר על טבלאות הדפים (Page Table Walk)**: ישנן 4 רמות של טבלאות דפים. כל גישה ל-PTE בזיכרון הראשי אורכת 100ns. לכן, 4 * 100ns = 400ns. במהלך המעבר הזה מתגלה שקיים Page Fault.\n*   **3. טיפול ב-Page Fault**: (בהנחה שדף מלוכלך וצריך להיכתב לדיסק)\n    *   קריאה מהדיסק (Page-in) של הדף המבוקש: 10,000,000ns (10ms).\n    *   כתיבה לדיסק (Page-out) של דף שהוצא מהזיכרון: 10,000,000ns (10ms).\n    *   עדכון כניסת טבלת הדפים (PTE) בזיכרון הראשי (לאחר טעינת הדף): 100ns.\n    *   עדכון ה-TLB עם הכניסה החדשה: 1ns.\n    *   בשלב זה, הפקודה המקורית מופעלת מחדש.\n*   **4. ביצוע הפקודה מחדש**: (לאחר שהדף כבר בזיכרון הפיזי וה-TLB מעודכן)\n    *   גישת TLB (כעת Hit): 1ns.\n    *   גישה לנתונים בזיכרון הראשי: 100ns.\n\n*   **זמן גישה אפקטיבי (EAT) לגישת זיכרון לוגית אחת**:\n    EAT = (1ns TLB miss) + (400ns PT walk) + (10,000,000ns Page-in) + (10,000,000ns Page-out) + (100ns PTE update) + (1ns TLB update) + (1ns TLB hit) + (100ns data access)\n    EAT = 1 + 400 + 10,000,000 + 10,000,000 + 100 + 1 + 1 + 100\n    EAT = 20,000,603 ns.\n\n*   **זמן כולל לביצוע הלולאה**:\n    סה\"כ גישות זיכרון = 2560.\n    זמן כולל = EAT * מספר הגישות\n    זמן כולל = 20,000,603 ns * 2560\n    זמן כולל = 51,201,543,680 ns\n    זמן כולל = 51.20154368 שניות (כ-51.2 שניות)."
    },
    "difficulty_estimation": "Hard"
  }
}