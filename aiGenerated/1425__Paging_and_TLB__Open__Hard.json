{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 10:12:25",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 4647,
      "total_tokens": 23182
    }
  },
  "question": {
    "id": 7,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Memory Management",
      "Virtual Memory"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי עם המאפיינים הבאים:\n*   גודל דף: 4KB.\n*   מרחב כתובות וירטואלי: 32 סיביות.\n*   טבלת דפים היררכית בעלת 2 רמות. כל כניסה בטבלת דפים (PTE/PDE) היא בגודל 4 בתים. כל טבלה (Page Directory או Page Table) מאוחסנת בדף זיכרון פיזי בודד.\n*   TLB: מכיל 16 כניסות, בעל אסוציאטיביות 4-כיוונית (4-way set-associative), עם מדיניות החלפה LRU בתוך כל סט. כל כניסת TLB כוללת מזהה מרחב כתובות (ASID).\n*   זמני גישה:\n    *   פגיעת TLB (TLB Hit): 10 ננו-שניות.\n    *   גישה לזיכרון פיזי (לדף נתונים או לכניסת טבלת דפים): 100 ננו-שניות.\n    *   טיפול בכשל דף (Page Fault): 10 מילי-שניות (כולל גישת דיסק ועדכון טבלת דפים).\n*   ה-TLB ריק בתחילת ריצת כל תהליך.\n\nיש לפרט ולנמק את כל החישובים וההסברים בכל סעיף.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "7.1",
        "text": "פרק כתובת וירטואלית בגודל 32 סיביות לרכיביה: אינדקס לרמת טבלת דפים ראשונה (P1), אינדקס לרמת טבלת דפים שנייה (P2), והיסט (Offset) בתוך הדף. ציין את גודל כל רכיב בביטים.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.2",
        "text": "תהליך P1 מבצע את רצף הגישות הבאות לכתובות וירטואליות (כולן קריאה):\n`0x00001000`, `0x00002000`, `0x00001000`, `0x00003000`, `0x00004000`, `0x00001000`, `0x00002000`, `0x00005000`\nבהנחה שכל הדפים הנדרשים נמצאים בזיכרון הפיזי (אין Page Faults), וטבלת הדפים של P1 כבר טעונה לזיכרון.\nחשב את זמן הגישה הכולל עבור רצף גישות זה. תאר את מצב ה-TLB לאחר כל גישה (אילו כניסות נוספו/הוחלפו).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.3",
        "text": "לאחר רצף הגישות בסעיף 7.2, תהליך P1 מנסה לגשת לכתובת `0x00006000`. דף זה אינו נמצא בזיכרון הפיזי (Present Bit = 0).\n*   מהו זמן הגישה לכתובת זו?\n*   תאר את ההשפעה על טבלת הדפים וה-TLB לאחר טיפול בכשל הדף.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.4",
        "text": "לאחר הגישה בסעיף 7.3, מתבצעת החלפת הקשר לתהליך P2 (שלו ASID שונה). תהליך P2 מבצע גישה לכתובת `0x00001000`. לאחר מכן, מתבצעת החלפת קשר חזרה לתהליך P1. תהליך P1 מבצע שוב גישה לכתובת `0x00001000`.\n*   תאר את מצב ה-TLB לאחר החלפת הקשר ל-P2.\n*   תאר את מצב ה-TLB לאחר הגישה של P2.\n*   תאר את מצב ה-TLB לאחר החלפת הקשר חזרה ל-P1.\n*   מהו זמן הגישה של P1 לכתובת `0x00001000` בפעם השנייה לאחר החלפת הקשר? נמק.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.5",
        "text": "כיצד ישתנה זמן הגישה הכולל עבור רצף הגישות **הכולל** של P1 (הגישות בסעיף 7.2 + הגישה בסעיף 7.3 + הגישה האחרונה בסעיף 7.4), אם ה-TLB היה *מלא אסוציאטיבי* (fully associative) עם 16 כניסות, אך ללא שימוש ב-ASID (כלומר, ה-TLB מתרוקן לחלוטין בכל החלפת קשר)? נמק והשווה לזמן שחושב עבור אותו רצף בסעיפים 7.2, 7.3 ו-7.4.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "7.1: פירוק כתובת וירטואלית:\n*   גודל דף: 4KB = 2^12 בתים. לכן, Offset הוא 12 ביטים.\n*   מרחב כתובות וירטואלי: 32 ביטים.\n*   מספר ביטי ה-VPN (Virtual Page Number) הוא 32 - 12 = 20 ביטים.\n*   טבלת דפים 2 רמות, וכל טבלה מאוחסנת בדף בודד (4KB).\n*   גודל PTE/PDE הוא 4 בתים.\n*   מספר הכניסות בכל טבלה: 4KB / 4 בתים = 1024 כניסות.\n*   לכן, כל אינדקס (P1, P2) דורש log2(1024) = 10 ביטים.\n*   P1: 10 ביטים (ביטים 22-31 של הכתובת הוירטואלית).\n*   P2: 10 ביטים (ביטים 12-21 של הכתובת הוירטואלית).\n*   Offset: 12 ביטים (ביטים 0-11 של הכתובת הוירטואלית).\n\n7.2: רצף גישות זיכרון ראשוני (P1):\nנחשב את ה-VPN עבור כל גישה:\n*   `0x00001000` -> VPN = `0x00001` (P1=0, P2=1)\n*   `0x00002000` -> VPN = `0x00002` (P1=0, P2=2)\n*   `0x00001000` -> VPN = `0x00001` (P1=0, P2=1)\n*   `0x00003000` -> VPN = `0x00003` (P1=0, P2=3)\n*   `0x00004000` -> VPN = `0x00004` (P1=0, P2=4)\n*   `0x00001000` -> VPN = `0x00001` (P1=0, P2=1)\n*   `0x00002000` -> VPN = `0x00002` (P1=0, P2=2)\n*   `0x00005000` -> VPN = `0x00005` (P1=0, P2=5)\n\nTLB: 16 כניסות, 4-way set-associative. מספר הסטים: 16 / 4 = 4 סטים. אינדקס הסט (TLB Set Index) הוא 2 ביטים (log2(4)). נשתמש ב-2 הביטים הנמוכים ביותר של ה-P2 (ביטים 0-1) כאינדקס לסט.\n\nVPN (P2) | TLB Set Index\n----------|----------------\n0x00001 (01)| 1\n0x00002 (10)| 2\n0x00003 (11)| 3\n0x00004 (00)| 0\n0x00005 (01)| 1\n0x00006 (10)| 2\n\nחישוב זמן גישה לכל גישה (TLB Hit = 10ns + 100ns data = 110ns; TLB Miss = 10ns lookup + 100ns PDE + 100ns PTE + 100ns data = 310ns):\n*   **גישה 1: `0x00001000` (V1, Set 1)**\n    *   TLB Miss (ריק). עלות: 310ns. מצב TLB Set 1: [V1(newest)]\n*   **גישה 2: `0x00002000` (V2, Set 2)**\n    *   TLB Miss (ריק). עלות: 310ns. מצב TLB Set 2: [V2(newest)]\n*   **גישה 3: `0x00001000` (V1, Set 1)**\n    *   TLB Hit. עלות: 110ns. מצב TLB Set 1: [V1(newest)]\n*   **גישה 4: `0x00003000` (V3, Set 3)**\n    *   TLB Miss (ריק). עלות: 310ns. מצב TLB Set 3: [V3(newest)]\n*   **גישה 5: `0x00004000` (V4, Set 0)**\n    *   TLB Miss (ריק). עלות: 310ns. מצב TLB Set 0: [V4(newest)]\n*   **גישה 6: `0x00001000` (V1, Set 1)**\n    *   TLB Hit. עלות: 110ns. מצב TLB Set 1: [V1(newest)]\n*   **גישה 7: `0x00002000` (V2, Set 2)**\n    *   TLB Hit. עלות: 110ns. מצב TLB Set 2: [V2(newest)]\n*   **גישה 8: `0x00005000` (V5, Set 1)**\n    *   TLB Miss (V5 לא ב-TLB). עלות: 310ns. מצב TLB Set 1: [V1(oldest), V5(newest)]. (לסט יש 4 מקומות, V1 היה היחיד בו, כעת V5 מתווסף).\n\nזמן גישה כולל: (5 * 310ns) + (3 * 110ns) = 1550ns + 330ns = **1880ns**.\n\n7.3: כשל דף:\nתהליך P1 ניגש לכתובת `0x00006000` (V6, Set 2).\n*   **TLB Miss:** ה-VPN=0x00006 אינו ב-TLB (10ns).\n*   **Page Table Walk:** גישה ל-Page Directory (100ns) וגישה ל-Page Table (100ns). נמצא ש-Present Bit = 0.\n*   **Page Fault:** זמן טיפול בכשל דף: 10ms = 10,000,000ns. הדף נטען וה-PTE מתעדכן.\n*   **חזרה לגישה:** ה-PTE המתאים נמצא כעת בזיכרון. הוא מתווסף ל-TLB (Set 2). גישה לנתונים (100ns).\n*   זמן הגישה הכולל לכתובת זו: 10 + 100 + 100 + 10,000,000 + 100 = **10,000,310ns**.\n*   **השפעה על טבלת הדפים וה-TLB:**\n    *   **טבלת דפים:** כניסת ה-PTE עבור V6 ברמה 2 תתעדכן: Present Bit יהפוך ל-1, ויוכנס PFN חדש.\n    *   **TLB:** כניסה חדשה עבור V6 ו-ASID של P1 תתווסף ל-TLB ב-Set 2. מצב TLB Set 2: [V2(oldest), V6(newest)].\n\n7.4: החלפת הקשר ו-ASID:\n*   **מצב TLB לפני החלפת הקשר:**\n    *   Set 0: [V4(P1)]\n    *   Set 1: [V1(P1, LRU=oldest), V5(P1, LRU=newest)]\n    *   Set 2: [V2(P1, LRU=oldest), V6(P1, LRU=newest)]\n    *   Set 3: [V3(P1)]\n*   **לאחר החלפת הקשר ל-P2:** ה-TLB אינו מתרוקן לחלוטין בזכות השימוש ב-ASID. כניסות P1 נשמרות אך אינן נגישות לתהליך P2.\n*   **P2 מבצע גישה לכתובת `0x00001000` (V1, Set 1):**\n    *   TLB Miss (עבור ASID של P2). עלות: 310ns.\n    *   V1 (P2) מתווסף ל-TLB Set 1. מצב TLB Set 1: [V1(P1, LRU), V5(P1), V1(P2, newest)]. (יש מקום ל-4 כניסות בסט).\n*   **לאחר החלפת קשר חזרה ל-P1:** כניסות ה-TLB של P1 (כולל V1(P1)) הופכות שוב לנגישות. כניסות P2 נשארות אך אינן נגישות ל-P1.\n*   **P1 מבצע שוב גישה לכתובת `0x00001000` (V1, Set 1):**\n    *   זוהי **TLB Hit** עבור V1(P1), שכן הכניסה V1(P1) עדיין קיימת ב-TLB Set 1.\n    *   זמן הגישה: 110ns.\n    *   נימוק: השימוש ב-ASID מנע את ריקון ה-TLB על אף החלפת הקשר, ולכן הכניסה של V1 עבור P1 (שלא הוחלפה על ידי כניסה אחרת בסט זה) נשמרה.\n\n7.5: השפעת TLB שונה (Fully Associative, ללא ASID, פלאש מלא):\nנחשב את הזמן הכולל עבור P1 ברצף המלא (גישות 7.2 + גישה 7.3 + גישה 7.4 האחרונה), אך עם TLB מלא אסוציאטיבי וללא ASID (כלומר, TLB מתרוקן בהחלפת קשר):\n\n*   **רצף גישות 1-8 של P1:** זהה למקרה הקודם (TLB מלא אסוציאטיבי עם 16 כניסות יתנהג באופן זהה ל-4-way set-associative במקרה זה כי אין התנגשויות או תפוסה מלאה). 5 TLB Misses, 3 TLB Hits. עלות כוללת: 1880ns.\n*   **הגישה של P1 ל-`0x00006000` (V6):** כשל דף. עלות: 10,000,310ns.\n*   **החלפת קשר ל-P2:** במערכת זו אין ASID, ולכן ה-TLB מתרוקן לחלוטין (full flush).\n*   **P2 ניגש ל-`0x00001000` (V1):** TLB Miss (ה-TLB ריק). עלות: 310ns.\n*   **החלפת קשר חזרה ל-P1:** ה-TLB מתרוקן שוב לחלוטין (full flush).\n*   **P1 ניגש שוב ל-`0x00001000` (V1):** **TLB Miss**. ה-TLB ריק עקב שני הפלאשים, ולכן אין כניסה עבור V1.\n    *   עלות: 310ns.\n*   **זמן כולל עבור P1 במערכת החלופית:** 1880ns + 10,000,310ns + 310ns = **10,002,500ns**.\n*   **השוואה:**\n    *   במערכת המקורית (4-way set-associative, עם ASID): 10,002,300ns.\n    *   במערכת החלופית (Fully associative, ללא ASID, פלאש מלא): 10,002,500ns.\n    המערכת החלופית איטית יותר ב-200ns. ההפרש נובע מכך שהגישה האחרונה של P1 ל-V1 הייתה TLB Miss במערכת ללא ASID (בגלל פלאש TLB בהחלפת קשר), בעוד שבמערכת עם ASID היא הייתה TLB Hit, מה שמדגים את היתרון בשימוש ב-ASID למניעת ריקון TLB מלא בהחלפות קשר תכופות."
    },
    "difficulty_estimation": "Hard"
  }
}