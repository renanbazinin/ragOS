{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-09 21:11:22",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 3153,
      "total_tokens": 14550
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory",
      "Multi-Level Page Tables"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי מבוסס דפדוף (paging) וטבלת דפים רב-שכבתית (multi-level page table). המערכת כוללת גם יחידת TLB (Translation Lookaside Buffer) לשיפור ביצועים. להלן הפרמטרים של המערכת:\n\n*   גודל כתובת וירטואלית (VA): 42 ביטים.\n*   גודל כתובת פיזית (PA): 40 ביטים.\n*   גודל דף (Page Size): 4KB (4096 בתים).\n*   גודל כניסה בטבלת דפים (PTE): 4 בתים (32 ביטים).\n*   TLB: מכיל 128 כניסות, אסוציאטיבי מלא (fully associative).",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "בהינתן שכל טבלת דפים (ברמה כלשהי) נשמרת בדף פיזי אחד בדיוק, כמה רמות נדרשות לטבלת הדפים? פרטו את חלוקת הביטים בין שדות ה-VPN (מספר דף וירטואלי) השונים וה-offset. מהו הגודל המקסימלי של טבלת דפים אחת (ברמה בודדת) בבתים?",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "נתונים זמני גישה:\n*   זמן גישה ל-TLB (במקרה של פגיעה): 10 ננו-שניות.\n*   זמן גישה לזיכרון הראשי (Main Memory): 100 ננו-שניות.\n*   שיעור פגיעות ב-TLB (TLB hit rate): 95%.\n\nחשבו את זמן הגישה האפקטיבי הממוצע (Effective Access Time - EAT) לזיכרון, בהנחה שאין Page Faults. הציגו את כל החישובים.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "תארו בפירוט את רצף הפעולות והגישות לזיכרון (TLB, זיכרון ראשי, דיסק) המתרחשות כאשר תהליך מנסה לגשת לכתובת וירטואלית כלשהי, ומתקיימים התנאים הבאים:\n*   זוהי החטאה ב-TLB (TLB Miss).\n*   הדף המבוקש אינו נמצא בזיכרון הפיזי (Page Fault).\n*   ה-PTE המתאים לדף זה מציין שהוא אינו תקף (Valid=0).\n*   יש צורך לפנות דף קיים מהזיכרון הפיזי לדיסק, כיוון שביט ה-Dirty שלו דולק (Dirty=1).\n*   המערכת משתמשת בטבלת דפים בעלת 3 רמות (כפי שהייתם אמורים לחשב בסעיף 1.1).\n\nכמו כן, חשבו את הזמן הכולל שייקח לביצוע גישה בודדת זו לזיכרון, מרגע הבקשה ועד קבלת הנתונים בפועל. נתון זמן גישה לדיסק (Page Fault I/O): 10 מילי-שניות (10,000,000 ננו-שניות).",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "1.1:\nחישובים:\nגודל דף: 4KB = 2^12 בתים. לכן, ההיסט (offset) הוא 12 ביטים.\nגודל כתובת וירטואלית: 42 ביטים.\nמספר דף וירטואלי (VPN) = 42 - 12 = 30 ביטים.\nגודל כניסה בטבלת דפים (PTE): 4 בתים.\nגודל טבלת דפים אחת (ברמה בודדת) הוא דף פיזי אחד, כלומר 4KB.\nמספר הכניסות בטבלת דפים אחת = גודל דף / גודל PTE = 4KB / 4 בתים = 4096 / 4 = 1024 כניסות.\nכדי למפות 1024 כניסות, נדרשים log2(1024) = 10 ביטים לכל אינדקס של טבלת דפים.\n\nמספר רמות טבלת הדפים:\nיש למפות 30 ביטים של VPN. כל רמה ממפה 10 ביטים.\nלכן, מספר הרמות = 30 ביטים / 10 ביטים לרמה = 3 רמות.\n\nחלוקת הביטים:\nאינדקס רמה 1: 10 ביטים (מתוך ה-VPN)\nאינדקס רמה 2: 10 ביטים (מתוך ה-VPN)\nאינדקס רמה 3: 10 ביטים (מתוך ה-VPN)\nהיסט (offset): 12 ביטים\nסה\"כ: 10 + 10 + 10 + 12 = 42 ביטים (גודל הכתובת הוירטואלית).\n\nהגודל המקסימלי של טבלת דפים אחת (ברמה בודדת) הוא 4KB, כפי שצוין בשאלה שכל טבלה נשמרת בדף פיזי אחד.\n\n1.2:\nזמן גישה ל-TLB: 10 ננו-שניות.\nזמן גישה לזיכרון ראשי: 100 ננו-שניות.\nשיעור פגיעות ב-TLB: 0.95.\nשיעור החטאות ב-TLB: 1 - 0.95 = 0.05.\n\nחישוב זמן גישה אפקטיבי (EAT):\nEAT = (שיעור פגיעות * (זמן גישה ל-TLB + זמן גישה לזיכרון ראשי)) + (שיעור החטאות * (זמן גישה ל-TLB + מספר רמות * זמן גישה לזיכרון ראשי עבור טבלת דפים + זמן גישה לזיכרון ראשי עבור הנתונים))\nEAT = (0.95 * (10 ננו-שניות + 100 ננו-שניות)) + (0.05 * (10 ננו-שניות + (3 * 100 ננו-שניות) + 100 ננו-שניות))\nEAT = (0.95 * 110 ננו-שניות) + (0.05 * (10 ננו-שניות + 300 ננו-שניות + 100 ננו-שניות))\nEAT = (0.95 * 110 ננו-שניות) + (0.05 * 410 ננו-שניות)\nEAT = 104.5 ננו-שניות + 20.5 ננו-שניות\nEAT = 125 ננו-שניות.\n\n1.3:\nרצף הפעולות והגישות לזיכרון:\n1.  **CPU מייצר כתובת וירטואלית (VA).**\n2.  **חיפוש ב-TLB:** חומרת ה-MMU בודקת את ה-TLB עבור מיפוי ה-VA.\n    *   **תוצאה:** החטאה (TLB Miss). (זמן: 10 ננו-שניות עבור בדיקת ה-TLB).\n3.  **מעבר בטבלת הדפים (Page Table Walk) - 3 רמות:**\n    *   גישה לזיכרון הראשי כדי לאחזר את ה-PTE של רמה 1. (זמן: 100 ננו-שניות).\n    *   גישה לזיכרון הראשי כדי לאחזר את ה-PTE של רמה 2. (זמן: 100 ננו-שניות).\n    *   גישה לזיכרון הראשי כדי לאחזר את ה-PTE של רמה 3. (זמן: 100 ננו-שניות).\n4.  **בדיקת Page Fault:** חומרת ה-MMU בוחנת את ה-PTE של רמה 3.\n    *   **תוצאה:** ה-PTE מציין שהדף אינו נוכח בזיכרון הפיזי (Valid=0). הדבר גורם לפסיקת דף (Page Fault).\n5.  **טיפול בפסיקת דף ע\"י מערכת ההפעלה:**\n    *   **החלפת הקשר:** מערכת ההפעלה נכנסת לפעולה, שומרת את מצב התהליך ומחליפה קונטקסט למצב קרנל.\n    *   **בחירת דף קורבן:** מערכת ההפעלה בוחרת דף בזיכרון הפיזי שיפונה (victim page).\n    *   **בדיקת ביט ה-Dirty:** מערכת ההפעלה בודקת את ביט ה-Dirty של דף הקורבן. נתון שהוא דולק (Dirty=1).\n    *   **כתיבת דף הקורבן לדיסק:** מערכת ההפעלה כותבת את תוכן דף הקורבן לדיסק. (זמן: 10,000,000 ננו-שניות).\n    *   **טעינת הדף המבוקש מהדיסק:** מערכת ההפעלה קוראת את הדף המבוקש מהדיסק למסגרת הפיזית שהתפנתה. (זמן: 10,000,000 ננו-שניות).\n    *   **עדכון טבלת הדפים:** מערכת ההפעלה מעדכנת את ה-PTE של רמה 3 עם מספר המסגרת הפיזית החדש (PFN), מציבה Valid=1, Dirty=0 (בתחילה), Accessed=1. (זמן: 100 ננו-שניות לכתיבה לזיכרון הראשי).\n    *   **עדכון ה-TLB:** מערכת ההפעלה מוסיפה את המיפוי החדש (VA ל-PA) ל-TLB.\n    *   **החלפת קונטקסט:** שחזור מצב התהליך והחזרת השליטה לתהליך המשתמש.\n6.  **ניסיון חוזר לפקודה:** ה-CPU מבצע מחדש את הפקודה שגרמה לפסיקת הדף.\n7.  **חיפוש ב-TLB (ניסיון שני):** חומרת ה-MMU בודקת שוב את ה-TLB.\n    *   **תוצאה:** פגיעה (TLB Hit), מכיוון שמערכת ההפעלה עדכנה את ה-TLB. (זמן: 10 ננו-שניות עבור בדיקת ה-TLB).\n8.  **גישה לנתונים:** גישה לזיכרון הראשי כדי לאחזר את הנתונים בפועל. (זמן: 100 ננו-שניות).\n\nחישוב הזמן הכולל:\nזמן החטאת TLB ראשונית: 10 ננו-שניות.\nזמן מעבר בטבלת דפים (3 רמות): 3 * 100 ננו-שניות = 300 ננו-שניות.\nזמן כתיבת דף קורבן לדיסק: 10,000,000 ננו-שניות.\nזמן טעינת דף מבוקש מהדיסק: 10,000,000 ננו-שניות.\nזמן עדכון PTE בזיכרון ראשי: 100 ננו-שניות.\nזמן פגיעה ב-TLB (ניסיון שני): 10 ננו-שניות.\nזמן גישה לנתונים בזיכרון ראשי: 100 ננו-שניות.\n\nזמן כולל = 10 + 300 + 10,000,000 + 10,000,000 + 100 + 10 + 100 = 20,000,530 ננו-שניות."
    },
    "difficulty_estimation": "Hard"
  }
}