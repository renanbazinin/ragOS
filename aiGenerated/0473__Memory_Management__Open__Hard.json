{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 22:26:53",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 2379,
      "total_tokens": 12478
    }
  },
  "question": {
    "id": 7,
    "type": "Open",
    "topic": [
      "Memory Management",
      "Paging",
      "Virtual Memory",
      "TLB",
      "Page Replacement",
      "Protection"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם מנגנון דפדוף (paging) רב-שכבתי. להלן פרטי המערכת:\n*   גודל מרחב הכתובות הווירטואלי (Virtual Address Space) הוא 48 ביטים.\n*   גודל דף פיזי ולוגי הוא 8KB (כלומר, 2^13 בתים).\n*   טבלאות הדפים הן רב-שכבתיות (Multi-level Page Tables), וכל טבלת דפים ברמה מסוימת נשמרת בדף פיזי אחד בדיוק.\n*   כל כניסה בטבלת דפים (Page Table Entry - PTE) היא בגודל 64 ביטים (8 בתים) ומכילה את מספר המסגרת הפיזית (Physical Frame Number - PFN) וכן 6 ביטי בקרה (Valid, Dirty, Accessed, Read/Write, Execute, Global).\n*   המערכת כוללת TLB בגודל 128 כניסות, שהוא Fully Associative.\n*   זמני גישה:\n    *   גישה ל-TLB: 1 מחזור שעון (CPU cycle).\n    *   גישה לזיכרון ראשי (RAM): 100 מחזורי שעון.\n    *   גישה לזיכרון משני (דיסק): 10^7 מחזורי שעון.\n*   מדיניות החלפת הדפים (Page Replacement Policy) היא LRU.\n",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "7.1",
        "text": "כמה רמות של טבלאות דפים נדרשות במערכת זו כדי למפות את מרחב הכתובות הווירטואלי? פרט את החישוב.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.2",
        "text": "מהו גודל הזיכרון הפיזי המקסימלי במערכת זו? פרט את החישוב.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.3",
        "text": "תהליך מנסה לבצע פעולת כתיבה (write) לכתובת וירטואלית מסוימת. תאר את רצף הפעולות שיתרחשו במקרה הגרוע ביותר (worst-case scenario), וחשב את הזמן הכולל שייקח לפעולה זו במחזורי שעון.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "7.4",
        "text": "נניח שתהליך מנסה לבצע קוד (fetch instruction) מכתובת וירטואלית שה-PTE שלה מציין Read/Write=1, Execute=0. מה יקרה? הסבר.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון שאלה 7:\n\n7.1: חישוב מספר רמות טבלת הדפים:\n*   גודל מרחב הכתובות הווירטואלי (VA) הוא 48 ביטים.\n*   גודל דף הוא 8KB, כלומר 2^13 בתים. לכן, ההיסט (offset) בתוך הדף הוא 13 ביטים.\n*   מספר הביטים לכתובת הדף הווירטואלי (VPN) הוא: 48 ביטים (VA) - 13 ביטים (offset) = 35 ביטים.\n*   כל כניסה בטבלת דפים (PTE) היא בגודל 8 בתים (64 ביטים).\n*   כל טבלת דפים מאוחסנת בדף פיזי אחד בגודל 8KB. לכן, מספר הכניסות בכל טבלת דפים הוא: 8KB / 8 בתים/PTE = 1024 כניסות (2^10 כניסות).\n*   כל רמה בטבלת הדפים משתמשת ב-10 ביטים מתוך ה-VPN כדי לבחור את הכניסה המתאימה.\n*   מספר הרמות הנדרשות הוא: ceil(35 ביטים / 10 ביטים לרמה) = ceil(3.5) = 4 רמות.\n    *   רמה 1: 10 ביטים\n    *   רמה 2: 10 ביטים\n    *   רמה 3: 10 ביטים\n    *   רמה 4: 5 ביטים\n    (סה\"כ 35 ביטים עבור VPN).\n\n7.2: חישוב גודל הזיכרון הפיזי המקסימלי:\n*   גודל PTE הוא 64 ביטים. 6 ביטים מוקדשים לביטי בקרה (Valid, Dirty, Accessed, Read/Write, Execute, Global).\n*   לכן, מספר הביטים הזמינים עבור מספר המסגרת הפיזית (PFN) הוא: 64 ביטים - 6 ביטים = 58 ביטים.\n*   מספר המסגרות הפיזיות המקסימלי הוא 2^58.\n*   גודל כל מסגרת פיזית הוא 8KB (2^13 בתים).\n*   גודל הזיכרון הפיזי המקסימלי הוא: 2^58 (מספר מסגרות) * 2^13 (גודל מסגרת) = 2^71 בתים.\n\n7.3: עלות גישה לכתובת וירטואלית במקרה הגרוע ביותר:\nמקרה גרוע ביותר כולל:\n1.  **TLB Miss**: הכניסה המבוקשת אינה נמצאת ב-TLB. עלות: 1 מחזור שעון.\n2.  **Page Table Walk עם Page Faults עבור טבלאות הדפים**: כל 4 הרמות של טבלאות הדפים אינן נמצאות בזיכרון הראשי (RAM) ודורשות טעינה מהדיסק.\n    *   עבור כל רמה (4 רמות): גישה לדיסק כדי לטעון את דף טבלת הדפים (10^7 מחזורי שעון) + כתיבת הדף ל-RAM (100 מחזורי שעון) + קריאת ה-PTE מאותו דף ב-RAM (100 מחזורי שעון).\n    *   סה\"כ עבור Page Table Walk: 4 * (10^7 + 100 + 100) = 4 * (10^7 + 200) מחזורי שעון.\n3.  **Page Fault עבור דף הנתונים**: ה-PTE הסופי מצביע על כך שדף הנתונים אינו נמצא ב-RAM (Valid=0).\n    *   נניח שהדף שיש לפנות (victim page) הוא 'מלוכלך' (Dirty=1) ולכן יש לכתוב אותו לדיסק: 10^7 מחזורי שעון (Disk Write).\n    *   טעינת הדף המבוקש מהדיסק ל-RAM: 10^7 מחזורי שעון (Disk Read).\n    *   עדכון ה-PTE המתאים ב-RAM (לציין Valid=1, PFN החדש): 100 מחזורי שעון (RAM Write).\n4.  **גישה בפועל לנתונים**: ביצוע פעולת הכתיבה לכתובת הפיזית ב-RAM: 100 מחזורי שעון (RAM Write).\n\nחישוב סך הזמן הכולל:\n1 (TLB Miss) +\n4 * (10^7 + 200) (Page Table Walk עם 4 Page Faults עבור טבלאות הדפים) +\n10^7 (Disk Write ל-victim page) +\n10^7 (Disk Read לדף המבוקש) +\n100 (עדכון PTE ב-RAM) +\n100 (גישה בפועל לנתונים ב-RAM)\n\n= 1 + 4*10^7 + 800 + 10^7 + 10^7 + 100 + 100\n= (4 + 1 + 1) * 10^7 + (1 + 800 + 100 + 100)\n= 6 * 10^7 + 1001 מחזורי שעון.\n\n7.4: השפעת ביט ה-Execute:\nאם תהליך מנסה לבצע קוד (fetch instruction) מכתובת וירטואלית שה-PTE שלה מציין Execute=0, המערכת תזהה הפרת הרשאה (protection violation). גם אם ביט Read/Write מוגדר כ-1, אין לתהליך הרשאת ביצוע (Execute) באותו דף. במקרה כזה, מערכת ההפעלה תייצר חריגה (exception) כגון 'הפרת סגמנטציה' (segmentation fault) או 'הפרת הגנה' (protection fault), ותסיים את ריצת התהליך הפוגע. זהו מנגנון אבטחה קריטי למניעת הרצת קוד זדוני או לא מורשה מאזורי זיכרון המיועדים לנתונים בלבד."
    },
    "difficulty_estimation": "Hard"
  }
}