{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 23:08:18",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4788,
      "output_tokens": 6142,
      "total_tokens": 25991
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "Virtual Memory",
      "TLB",
      "Page Faults",
      "Memory Management"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם טבלאות דפים היררכיות דו-רמתיות (Two-level Paging). פרטי המערכת הם כדלקמן:\n*   **גודל כתובת וירטואלית**: 32 ביטים.\n*   **גודל כתובת פיזית**: 28 ביטים.\n*   **גודל דף**: 4KB.\n*   **גודל כניסה בטבלת דפים (PTE)**: 4 בתים.\n    *   פורמט ה-PTE: `[PFN (16 ביטים)] [V (1)] [P (1)] [D (1)] [A (1)] [שמור (12 ביטים)]`\n    *   `V` (Valid) מציין אם הכניסה חוקית. `P` (Present) מציין אם הדף נמצא בזיכרון הפיזי. `D` (Dirty) מציין אם הדף שונה מאז נטען. `A` (Accessed) מציין אם הדף נקרא או נכתב לאחרונה.\n*   **TLB**: מכיל 4 כניסות, אסוציאטיבי מלא (fully associative), משתמש באלגוריתם LRU להחלפת כניסות.\n    *   פורמט כניסה ב-TLB: `[VPN (20 ביטים)] [PFN (16 ביטים)] [V (1)] [P (1)] [D (1)] [A (1)] [נתוני LRU]`\n\nתהליך מסוים מתחיל עם המצב הבא:\n*   **כתובת בסיס טבלת דפים רמה 1 (P1)**: ממוקמת במסגרת פיזית `0x100`.\n*   **מצב טבלאות דפים (חלקי)**:\n    *   **טבלת P1 (ב-0x100)**:\n        *   `P1[0]` מצביע לטבלת P2 במסגרת `0x200`. (V=1, P=1)\n        *   `P1[1]` מצביע לטבלת P2 במסגרת `0x300`. (V=1, P=1)\n        *   `P1[2]` מצביע לטבלת P2 במסגרת `0x400`. (V=1, P=1)\n        *   `P1[3]` מצביע לטבלת P2 במסגרת `0x500`. (V=1, P=0)\n        *   `P1[4]` (וכל שאר הכניסות ב-P1) הן V=0, P=0.\n    *   **טבלת P2_A (ב-0x200)**:\n        *   `P2_A[0]` ממפה ל-PFN `0x1A`. (V=1, P=1, D=0, A=0)\n        *   `P2_A[1]` ממפה ל-PFN `0x1B`. (V=1, P=1, D=0, A=0)\n        *   `P2_A[2]` ממפה ל-PFN `0x1C`. (V=1, P=1, D=0, A=0)\n        *   (כל שאר הכניסות ב-P2_A הן V=0, P=0)\n    *   **טבלת P2_B (ב-0x300)**:\n        *   `P2_B[0]` ממפה ל-PFN `0x2A`. (V=1, P=1, D=0, A=0)\n        *   `P2_B[1]` ממפה ל-PFN `0x2B`. (V=1, P=0, D=0, A=0)\n        *   (כל שאר הכניסות ב-P2_B הן V=0, P=0)\n    *   **טבלת P2_C (ב-0x400)**:\n        *   `P2_C[0]` ממפה ל-PFN `0x3A`. (V=1, P=1, D=0, A=0)\n        *   (כל שאר הכניסות ב-P2_C הן V=0, P=0)\n*   **מצב TLB התחלתי**:\n    *   כניסה 0: `VPN=0x00000`, `PFN=0x1A`, V=1, P=1, D=0, A=0, LRU=3 (הכי חדש)\n    *   כניסה 1: `VPN=0x00001`, `PFN=0x1B`, V=1, P=1, D=0, A=0, LRU=2\n    *   כניסה 2: `VPN=0x01000`, `PFN=0x2A`, V=1, P=1, D=0, A=0, LRU=1\n    *   כניסה 3: פנויה (או V=0), LRU=0 (הכי ישן)\n\nבצעו את סדרת הגישות הבאה לזיכרון הוירטואלי. עבור כל גישה:\n1.  ציינו אם התרחשה פגיעת TLB (TLB Hit) או החטאה (TLB Miss).\n2.  במקרה של החטאה, תארו את תהליך ה-Page Walk (חיפוש בטבלאות הדפים P1 ו-P2).\n3.  ציינו אם התרחשה תקלת דף (Page Fault). אם כן, הסבירו מדוע.\n4.  אם לא התרחשה תקלת דף, מהי הכתובת הפיזית המתקבלת?\n5.  תארו את שינויי המצב ב-TLB ובטבלאות הדפים (PTEs) כתוצאה מהגישה.\n6.  בסיום כל הגישות, הציגו את המצב הסופי של ה-TLB.\n\n**רשימת גישות (Virtual Address, סוג פעולה):**\n1.  `0x00000010`, קריאה\n2.  `0x00001020`, כתיבה\n3.  `0x01000030`, קריאה\n4.  `0x00002040`, כתיבה\n5.  `0x01001050`, קריאה\n6.  `0x02000060`, קריאה\n7.  `0x03000070`, כתיבה",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "**ניתוח פרמטרי מערכת:**\n*   **גודל כתובת וירטואלית**: 32 ביטים.\n*   **גודל דף**: 4KB = 2^12 בתים. לכן, ההיסט (Offset) הוא 12 ביטים.\n*   **מספר ביטים ל-VPN**: 32 - 12 = 20 ביטים.\n*   **טבלאות דפים דו-רמתיות**: 20 ביטים ל-VPN מתחלקים ל-10 ביטים עבור אינדקס P1 ול-10 ביטים עבור אינדקס P2.\n    *   P1 Index: VA[31:22]\n    *   P2 Index: VA[21:12]\n*   **גודל כתובת פיזית**: 28 ביטים. זיכרון פיזי מקסימלי: 2^28 בתים = 256MB.\n*   **מספר ביטים ל-PFN**: 28 - 12 = 16 ביטים. (תואם את פורמט ה-PTE).\n\n**מצב TLB התחלתי:**\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 0 | 3 |\n| 1 | 00001 | 1B | 1 | 1 | 0 | 0 | 2 |\n| 2 | 01000 | 2A | 1 | 1 | 0 | 0 | 1 |\n| 3 | - (ריק) | - | 0 | 0 | 0 | 0 | 0 |\n\n**מעקב אחר גישות לזיכרון:**\n\n**1. גישה: קריאה ל-`VA 0x00000010`**\n*   **פירוק כתובת**: P1 Index = `0x0`, P2 Index = `0x0`, Offset = `0x010`. VPN = `0x00000`.\n*   **בדיקת TLB**: VPN `0x00000` נמצא בכניסה 0. **TLB Hit!**\n*   **תקלת דף**: לא התרחשה (P=1).\n*   **כתובת פיזית**: `PFN 0x1A` + `Offset 0x010` = `0x1A010`.\n*   **עדכון מצב**: \n    *   **TLB**: כניסה 0 (VPN `0x00000`) מקבלת LRU=3, A=1. שאר הכניסות יורדות ב-LRU (E1:2, E2:1, E3:0).\n    *   **PTE (זיכרון)**: ה-PTE המתאים בטבלת `P2_A[0]` מעודכן ל-A=1.\n\n**מצב TLB לאחר גישה 1:**\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 1 | 3 |\n| 1 | 00001 | 1B | 1 | 1 | 0 | 0 | 2 |\n| 2 | 01000 | 2A | 1 | 1 | 0 | 0 | 1 |\n| 3 | - (ריק) | - | 0 | 0 | 0 | 0 | 0 |\n\n**2. גישה: כתיבה ל-`VA 0x00001020`**\n*   **פירוק כתובת**: P1 Index = `0x0`, P2 Index = `0x1`, Offset = `0x020`. VPN = `0x00001`.\n*   **בדיקת TLB**: VPN `0x00001` נמצא בכניסה 1. **TLB Hit!**\n*   **תקלת דף**: לא התרחשה (P=1).\n*   **כתובת פיזית**: `PFN 0x1B` + `Offset 0x020` = `0x1B020`.\n*   **עדכון מצב**: \n    *   **TLB**: כניסה 1 (VPN `0x00001`) מקבלת LRU=3, A=1, D=1. שאר הכניסות יורדות ב-LRU (E0:2, E2:1, E3:0).\n    *   **PTE (זיכרון)**: ה-PTE המתאים בטבלת `P2_A[1]` מעודכן ל-A=1, D=1.\n\n**מצב TLB לאחר גישה 2:**\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 1 | 2 |\n| 1 | 00001 | 1B | 1 | 1 | 1 | 1 | 3 |\n| 2 | 01000 | 2A | 1 | 1 | 0 | 0 | 1 |\n| 3 | - (ריק) | - | 0 | 0 | 0 | 0 | 0 |\n\n**3. גישה: קריאה ל-`VA 0x01000030`**\n*   **פירוק כתובת**: P1 Index = `0x1`, P2 Index = `0x0`, Offset = `0x030`. VPN = `0x01000`.\n*   **בדיקת TLB**: VPN `0x01000` נמצא בכניסה 2. **TLB Hit!**\n*   **תקלת דף**: לא התרחשה (P=1).\n*   **כתובת פיזית**: `PFN 0x2A` + `Offset 0x030` = `0x2A030`.\n*   **עדכון מצב**: \n    *   **TLB**: כניסה 2 (VPN `0x01000`) מקבלת LRU=3, A=1. שאר הכניסות יורדות ב-LRU (E0:1, E1:2, E3:0).\n    *   **PTE (זיכרון)**: ה-PTE המתאים בטבלת `P2_B[0]` מעודכן ל-A=1.\n\n**מצב TLB לאחר גישה 3:**\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 1 | 1 |\n| 1 | 00001 | 1B | 1 | 1 | 1 | 1 | 2 |\n| 2 | 01000 | 2A | 1 | 1 | 0 | 1 | 3 |\n| 3 | - (ריק) | - | 0 | 0 | 0 | 0 | 0 |\n\n**4. גישה: כתיבה ל-`VA 0x00002040`**\n*   **פירוק כתובת**: P1 Index = `0x0`, P2 Index = `0x2`, Offset = `0x040`. VPN = `0x00002`.\n*   **בדיקת TLB**: VPN `0x00002` **לא** נמצא ב-TLB. **TLB Miss!**\n*   **Page Walk**: \n    1.  קריאת `P1[0]` מטבלת P1 (במסגרת `0x100`). ה-PTE מצביע לטבלת P2 במסגרת `0x200` (V=1, P=1).\n    2.  קריאת `P2_A[2]` מטבלת P2_A (במסגרת `0x200`). ה-PTE ממפה ל-PFN `0x1C` (V=1, P=1, D=0, A=0).\n*   **תקלת דף**: לא התרחשה (P=1).\n*   **כתובת פיזית**: `PFN 0x1C` + `Offset 0x040` = `0x1C040`.\n*   **עדכון מצב**: \n    *   **TLB**: כניסה חדשה עבור VPN `0x00002` נטענת. כניסה 3 (הריקה, LRU=0) נבחרת להחלפה. הכניסה החדשה מקבלת LRU=3, A=1, D=1. שאר הכניסות יורדות ב-LRU (E0:2, E1:1, E2:0).\n    *   **PTE (זיכרון)**: ה-PTE המתאים בטבלת `P2_A[2]` מעודכן ל-A=1, D=1.\n\n**מצב TLB לאחר גישה 4:**\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 1 | 2 |\n| 1 | 00001 | 1B | 1 | 1 | 1 | 1 | 1 |\n| 2 | 01000 | 2A | 1 | 1 | 0 | 1 | 0 |\n| 3 | 00002 | 1C | 1 | 1 | 1 | 1 | 3 |\n\n**5. גישה: קריאה ל-`VA 0x01001050`**\n*   **פירוק כתובת**: P1 Index = `0x1`, P2 Index = `0x1`, Offset = `0x050`. VPN = `0x01001`.\n*   **בדיקת TLB**: VPN `0x01001` **לא** נמצא ב-TLB. **TLB Miss!**\n*   **Page Walk**: \n    1.  קריאת `P1[1]` מטבלת P1 (במסגרת `0x100`). ה-PTE מצביע לטבלת P2 במסגרת `0x300` (V=1, P=1).\n    2.  קריאת `P2_B[1]` מטבלת P2_B (במסגרת `0x300`). ה-PTE ממפה ל-PFN `0x2B` (V=1, P=0, D=0, A=0).\n*   **תקלת דף**: **כן!** ה-PTE של הדף הנדרש (P2_B[1]) מראה P=0 (לא נוכח בזיכרון הפיזי). מערכת ההפעלה תצטרך לטעון את הדף.\n*   **כתובת פיזית**: לא מחושבת עקב תקלת דף.\n*   **עדכון מצב**: \n    *   **TLB**: לא מתווספת כניסה חדשה ל-TLB עד לטיפול בתקלת הדף וטעינת הדף. מצב ה-TLB נשאר ללא שינוי.\n    *   **PTE (זיכרון)**: ה-PTE המתאים בטבלת `P2_B[1]` מעודכן ל-A=1 (על ידי החומרה לפני הפעלת ה-trap).\n\n**מצב TLB לאחר גישה 5:** (ללא שינוי)\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 1 | 2 |\n| 1 | 00001 | 1B | 1 | 1 | 1 | 1 | 1 |\n| 2 | 01000 | 2A | 1 | 1 | 0 | 1 | 0 |\n| 3 | 00002 | 1C | 1 | 1 | 1 | 1 | 3 |\n\n**6. גישה: קריאה ל-`VA 0x02000060`**\n*   **פירוק כתובת**: P1 Index = `0x2`, P2 Index = `0x0`, Offset = `0x060`. VPN = `0x02000`.\n*   **בדיקת TLB**: VPN `0x02000` **לא** נמצא ב-TLB. **TLB Miss!**\n*   **Page Walk**: \n    1.  קריאת `P1[2]` מטבלת P1 (במסגרת `0x100`). ה-PTE מצביע לטבלת P2 במסגרת `0x400` (V=1, P=1).\n    2.  קריאת `P2_C[0]` מטבלת P2_C (במסגרת `0x400`). ה-PTE ממפה ל-PFN `0x3A` (V=1, P=1, D=0, A=0).\n*   **תקלת דף**: לא התרחשה (P=1).\n*   **כתובת פיזית**: `PFN 0x3A` + `Offset 0x060` = `0x3A060`.\n*   **עדכון מצב**: \n    *   **TLB**: כניסה חדשה עבור VPN `0x02000` נטענת. כניסה 2 (LRU=0) נבחרת להחלפה (כי היא ה-LRU ביותר מבין הכניסות התפוסות). הכניסה החדשה מקבלת LRU=3, A=1, D=0. שאר הכניסות יורדות ב-LRU (E0:1, E1:0, E3:2).\n    *   **PTE (זיכרון)**: ה-PTE המתאים בטבלת `P2_C[0]` מעודכן ל-A=1.\n\n**מצב TLB לאחר גישה 6:**\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 1 | 1 |\n| 1 | 00001 | 1B | 1 | 1 | 1 | 1 | 0 |\n| 2 | 02000 | 3A | 1 | 1 | 0 | 1 | 3 |\n| 3 | 00002 | 1C | 1 | 1 | 1 | 1 | 2 |\n\n**7. גישה: כתיבה ל-`VA 0x03000070`**\n*   **פירוק כתובת**: P1 Index = `0x3`, P2 Index = `0x0`, Offset = `0x070`. VPN = `0x03000`.\n*   **בדיקת TLB**: VPN `0x03000` **לא** נמצא ב-TLB. **TLB Miss!**\n*   **Page Walk**: \n    1.  קריאת `P1[3]` מטבלת P1 (במסגרת `0x100`). ה-PTE מצביע לטבלת P2 במסגרת `0x500` (V=1, P=0).\n*   **תקלת דף**: **כן!** ה-PTE של טבלת P2 עצמה (P1[3]) מראה P=0. טבלת הדפים של רמה 2 אינה נוכחת בזיכרון הפיזי. מערכת ההפעלה תצטרך לטעון אותה.\n*   **כתובת פיזית**: לא מחושבת עקב תקלת דף.\n*   **עדכון מצב**: \n    *   **TLB**: לא מתווספת כניסה חדשה ל-TLB. מצב ה-TLB נשאר ללא שינוי.\n    *   **PTE (זיכרון)**: ה-PTE המתאים בטבלת `P1[3]` מעודכן ל-A=1.\n\n**מצב TLB סופי לאחר כל הגישות:**\n| כניסה | VPN (0x) | PFN (0x) | V | P | D | A | LRU |\n|---|---|---|---|---|---|---|---|\n| 0 | 00000 | 1A | 1 | 1 | 0 | 1 | 1 |\n| 1 | 00001 | 1B | 1 | 1 | 1 | 1 | 0 |\n| 2 | 02000 | 3A | 1 | 1 | 0 | 1 | 3 |\n| 3 | 00002 | 1C | 1 | 1 | 1 | 1 | 2 |\n"
    },
    "difficulty_estimation": "Hard"
  }
}