{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging",
    "requested_type": "CodeAnalysis",
    "requested_difficulty": "Medium",
    "generated_at": "2026-02-07 23:14:17",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3180,
      "output_tokens": 2338,
      "total_tokens": 14501
    }
  },
  "question": {
    "id": 9,
    "type": "CodeAnalysis",
    "topic": [
      "Paging",
      "Virtual Memory",
      "TLB",
      "Page Faults",
      "Memory Access Patterns"
    ],
    "content": {
      "text": "נתונה התוכנית הבאה בשפת C המבצעת אתחול של מערך דו-ממדי גדול בשתי תבניות גישה שונות. המערכת עליה רצה התוכנית מוגדרת באופן הבא:\n- גודל דף: 4KB.\n- גודל מטמון תרגום כתובות (TLB): 64 כניסות.\n- גודל זיכרון פיזי: קטן מספיק כך שלא כל דפי המערך יכולים להיות בזיכרון הפיזי בו זמנית, מה שמוביל להחלפת דפים תכופה.\n- מדיניות החלפת דפים בזיכרון הפיזי וב-TLB היא LRU (Least Recently Used).\n- גודל int הוא 4 בתים.",
      "code_snippet": "#include <stdio.h>\n#include <stdlib.h>\n\n#define ROWS 1024\n#define COLS 1024\n#define PAGE_SIZE 4096 // 4KB\n\nint main() {\n    int (*matrix)[COLS] = (int (*)[COLS])malloc(ROWS * COLS * sizeof(int));\n    if (matrix == NULL) {\n        perror(\"malloc failed\");\n        return 1;\n    }\n\n    // Access pattern 1: Row-major\n    // אתחול בסדר שורה-עיקרי\n    for (int i = 0; i < ROWS; ++i) {\n        for (int j = 0; j < COLS; ++j) {\n            matrix[i][j] = i * COLS + j;\n        }\n    }\n\n    // Access pattern 2: Column-major\n    // אתחול בסדר עמודה-עיקרי\n    for (int j = 0; j < COLS; ++j) {\n        for (int i = 0; i < ROWS; ++i) {\n            matrix[i][j] = i * COLS + j;\n        }\n    }\n\n    free(matrix);\n    return 0;\n}"
    },
    "sub_questions": [
      {
        "id": "9.1",
        "text": "כמה תקלות דף (page faults) וכמה אי-פגיעות ב-TLB (TLB misses) יתרחשו במהלך לולאת הגישה הראשונה (סדר שורה-עיקרי) למערך? נמקו.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "9.2",
        "text": "כמה תקלות דף וכמה אי-פגיעות ב-TLB יתרחשו במהלך לולאת הגישה השנייה (סדר עמודה-עיקרי) למערך? נמקו.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": false,
      "correct_option": null,
      "explanation": "חישובים מקדימים:\n*   גודל המערך הכולל: ROWS * COLS * sizeof(int) = 1024 * 1024 * 4 בתים = 4MB.\n*   מספר הדפים שהמערך תופס: 4MB / 4KB = 1024 דפים.\n*   מספר איברים מסוג int לדף: 4KB / 4 בתים = 1024 איברים.\n*   כל שורה במערך: COLS * sizeof(int) = 1024 * 4 בתים = 4KB. כלומר, כל שורה תופסת בדיוק דף אחד.\n\nלולאת גישה ראשונה (סדר שורה-עיקרי):\n`for (int i = 0; i < ROWS; ++i) { for (int j = 0; j < COLS; ++j) { matrix[i][j] = ...; } }`\n\n*   תקלות דף (Page Faults):\n    *   הגישה היא סדרתית, שורה-אחר-שורה. כל שורה (4KB) מתאימה בדיוק לדף אחד.\n    *   כאשר ניגשים לאיבר הראשון בשורה (`matrix[i][0]`), נגרמת תקלת דף (אם הדף אינו כבר בזיכרון הפיזי). הדף כולו נטען לזיכרון הפיזי.\n    *   כל שאר הגישות לאיברים באותה שורה (`matrix[i][1]` עד `matrix[i][COLS-1]`) יהיו פגיעות בדף שכבר נטען.\n    *   מכיוון שיש ROWS = 1024 שורות, וכל שורה נמצאת בדף נפרד, ובהנחה שהזיכרון הפיזי אינו יכול להכיל את כל 1024 הדפים בו-זמנית (ומדיניות LRU תגרום להחלפה), כל גישה ראשונה לשורה חדשה תגרום לתקלת דף.\n    *   סה\"כ תקלות דף: ROWS = 1024.\n*   אי-פגיעות ב-TLB (TLB Misses):\n    *   עבור כל שורה i, הגישה הראשונה `matrix[i][0]` גורמת לאי-פגיעה ב-TLB (הכתובת הווירטואלית לדף זה אינה ב-TLB). הערך נטען ל-TLB.\n    *   כל שאר הגישות לאיברים באותה שורה (`matrix[i][1]` עד `matrix[i][COLS-1]`) יהיו פגיעות ב-TLB, מכיוון שהדף כבר נמצא ב-TLB.\n    *   מכיוון שיש ROWS = 1024 שורות, ומספר הדפים הייחודיים (1024) גדול בהרבה מגודל ה-TLB (64), בכל פעם שנעבור לשורה חדשה (דף חדש), הדף הקודם ביותר ב-TLB יוחלף (לפי LRU). לכן, הגישה הראשונה לכל שורה תגרום לאי-פגיעה ב-TLB.\n    *   סה\"כ אי-פגיעות ב-TLB: ROWS = 1024.\n\nלולאת גישה שנייה (סדר עמודה-עיקרי):\n`for (int j = 0; j < COLS; ++j) { for (int i = 0; i < ROWS; ++i) { matrix[i][j] = ...; } }`\n\n*   תקלות דף (Page Faults):\n    *   הגישה היא עמודה-אחר-עמודה. כל גישה `matrix[i][j]` ולאחריה `matrix[i+1][j]` היא גישה לאיברים המרוחקים ב- `COLS * sizeof(int) = 4096 בתים = 1 דף`.\n    *   משמעות הדבר היא שכל גישה לאיבר `matrix[i][j]` (למעט `i=0`) היא לדף שונה מהגישה הקודמת (`matrix[i-1][j]`).\n    *   במהלך הלולאה הפנימית (`for i`), אנו ניגשים ל-ROWS = 1024 דפים שונים ברצף. מכיוון שהזיכרון הפיזי קטן מ-1024 דפים, ובהתאם למדיניות LRU, רוב הדפים ייזרקו מהזיכרון הפיזי לפני שנגיע אליהם שוב בלולאה החיצונית הבאה (`j+1`).\n    *   למעשה, כל גישה לאיבר (`matrix[i][j]`) תהיה ככל הנראה לדף שאינו בזיכרון הפיזי, מכיוון שאנו עוברים בין 1024 דפים שונים עבור כל j, ורק 64 דפים יכולים להיות ב-TLB, ופחות מ-1024 דפים בזיכרון הפיזי. סדר הגישה הטורי (קפיצות של גודל דף) מבטיח שכל גישה כמעט תמיד תהיה לדף חדש או לדף שהוצא מזמן.\n    *   סה\"כ תקלות דף: ROWS * COLS = 1024 * 1024 = 1,048,576.\n*   אי-פגיעות ב-TLB (TLB Misses):\n    *   בדומה לתקלות הדף, כל גישה לאיבר `matrix[i][j]` (למעט `i=0`) היא לדף שונה מהגישה הקודמת.\n    *   במהלך הלולאה הפנימית (`for i`), אנו ניגשים ל-ROWS = 1024 דפים שונים. מכיוון שגודל ה-TLB הוא 64 כניסות בלבד, כל גישה לאיבר (`matrix[i][j]`) תגרום לאי-פגיעה ב-TLB, מכיוון שהדף המתאים יוצא מן ה-TLB לפני שנגיע אליו שוב (אם בכלל).\n    *   סה\"כ אי-פגיעות ב-TLB: ROWS * COLS = 1024 * 1024 = 1,048,576."
    },
    "difficulty_estimation": "Medium"
  }
}