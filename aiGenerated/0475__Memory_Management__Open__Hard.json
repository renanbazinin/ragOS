{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 21:58:15",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3218,
      "output_tokens": 3822,
      "total_tokens": 34777
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "Paging",
      "Virtual Memory",
      "TLB",
      "Page Replacement"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה 64 ביט המשתמשת בזיכרון וירטואלי עם טבלת דפים היררכית בעלת 4 רמות (כמו ב-x86-64). גודל כתובת וירטואלית הוא 48 ביט, וגודל דף הוא 4KB. כל כניסה בטבלת הדפים (PTE) היא בגודל 8 בתים ומכילה מספר מסגרת פיזית (PFN) באורך 40 ביט ו-4 ביטי סטטוס (Valid, Dirty, Accessed, Global). \nבמערכת קיים TLB בגודל 128 כניסות, בעל אסוציאטיביות של 4 דרכים (4-way set associative), ומשתמש באלגוריתם החלפה LRU. כל כניסה ב-TLB שומרת את ה-VPN המלא, ה-PFN וביטי הגנה (Valid, Dirty, Accessed). \n\nהניחו כי ה-TLB ריק בתחילת הריצה. כמו כן, הניחו שכל טבלאות הדפים הביניים (PML4, PDPT, PD, PT) תמיד נמצאות בזיכרון הפיזי וכניסותיהן תקינות (Valid, Present). Page Fault יתרחש רק אם דף הנתונים עצמו אינו נמצא בזיכרון הפיזי (PTE.Present=0). במקרה של Page Fault, הדף נטען לזיכרון הפיזי, ה-PTE מעודכן (Present=1, Dirty=0, Accessed=1) והגישה ממשיכה. במקרה של TLB Miss, יש לגשת לטבלת הדפים בזיכרון הראשי כדי לבצע את התרגום.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "מהו גודל הזיכרון הפיזי המקסימלי הנתמך על ידי מערכת זו? נמקו.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "עקבו אחר רצף הגישות לכתובות הוירטואליות הבאות (בסדר נתון). עבור כל גישה, ציינו האם מדובר ב-TLB Hit או TLB Miss, האם מתרחש Page Fault, וכמה גישות לזיכרון הראשי (Main Memory) נדרשות עבור תרגום הכתובת (לא כולל הגישה לנתון עצמו).\n\nנתוני מיפוי PFN ראשוניים:\n*   `VPN (0x100_0000_00)` ממופה ל-`PFN 0x1000`, `Present=1`.\n*   `VPN (0x100_0000_01)` ממופה ל-`PFN 0x2000`, `Present=1`.\n*   `VPN (0x100_0000_02)` ממופה ל-`PFN 0x3000`, `Present=1`.\n*   `VPN (0x200_0000_00)` ממופה ל-`PFN 0x4000`, `Present=1`.\n*   `VPN (0x300_0000_00)` ממופה ל-`PFN 0x5000`, `Present=1`.\n*   `VPN (0x400_0000_00)` ממופה ל-`PFN 0x6000`, `Present=0` (גורם ל-Page Fault).\n*   לאחר Page Fault, `VPN (0x400_0000_00)` ממופה ל-`PFN 0x6000`, `Present=1`.\n\nרצף הכתובות הוירטואליות:\n1.  `0x1000_0000_0000`\n2.  `0x1000_0000_1000`\n3.  `0x1000_0000_0000`\n4.  `0x1000_0000_2000`\n5.  `0x2000_0000_0000`\n6.  `0x3000_0000_0000`\n7.  `0x4000_0000_0000`",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "תארו את מצב ה-TLB (אילו VPNs נמצאים באילו סטים ובאילו דרכים, ומה סדר ה-LRU בכל סט) לאחר סיום כל הגישות ברצף הנתון בסעיף 2.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "**פתרון:**\n\n**1.1. גודל הזיכרון הפיזי המקסימלי:**\n*   גודל כניסה בטבלת הדפים (PTE) הוא 8 בתים.\n*   מספר מסגרת פיזית (PFN) הוא באורך 40 ביט.\n*   מספר ביטי ה-PFN קובע את מספר המסגרות הפיזיות המקסימלי: 2^40 מסגרות.\n*   גודל דף נתון כ-4KB (2^12 בתים).\n*   גודל הזיכרון הפיזי המקסימלי = מספר המסגרות * גודל דף = 2^40 * 2^12 = 2^52 בתים.\n*   2^52 בתים = 4 פטה-בתים (PB).\n\n**1.2. מעקב אחר רצף הגישות:**\n**חישובים מקדימים:**\n*   כתובת וירטואלית (VA) = 48 ביט.\n*   היסט (Offset) = 12 ביט (מכיוון שגודל דף = 4KB = 2^12).\n*   מספר דף וירטואלי (VPN) = 48 - 12 = 36 ביט.\n*   טבלת דפים היררכית בעלת 4 רמות: כל רמה משתמשת ב- 36 / 4 = 9 ביטים עבור האינדקס שלה (PML4_idx, PDPT_idx, PD_idx, PT_idx).\n*   TLB: 128 כניסות, 4-way set associative.\n*   מספר הסטים ב-TLB = 128 כניסות / 4 דרכים = 32 סטים (2^5 סטים).\n*   אינדקס הסט ב-TLB: 5 הביטים האחרונים של ה-VPN (VPN[4:0]). במקרה זה, אלו 5 הביטים האחרונים של אינדקס טבלת הדפים ברמה האחרונה (PT_idx[4:0]).\n*   תגית (Tag) ב-TLB: שאר ביטי ה-VPN (VPN[35:5]).\n*   מספר גישות זיכרון לתרגום (במקרה של TLB Miss): 4 גישות (אחת לכל רמה בטבלת הדפים: PML4, PDPT, PD, PT).\n\n**פירוט VPN ו-TLB עבור הכתובות:**\n*   `VPN_A = 0x100_0000_00` (PML4=0x1, PDPT=0x0, PD=0x0, PT=0x0). `PT_idx=0x000`. `TLB_set=0` (`00000` בינארי). `TLB_tag=0x100_0000_0`.\n*   `VPN_B = 0x100_0000_01` (PML4=0x1, PDPT=0x0, PD=0x0, PT=0x1). `PT_idx=0x001`. `TLB_set=1` (`00001` בינארי). `TLB_tag=0x100_0000_0`.\n*   `VPN_C = 0x100_0000_02` (PML4=0x1, PDPT=0x0, PD=0x0, PT=0x2). `PT_idx=0x002`. `TLB_set=2` (`00010` בינארי). `TLB_tag=0x100_0000_0`.\n*   `VPN_D = 0x200_0000_00` (PML4=0x2, PDPT=0x0, PD=0x0, PT=0x0). `PT_idx=0x000`. `TLB_set=0` (`00000` בינארי). `TLB_tag=0x200_0000_0`.\n*   `VPN_E = 0x300_0000_00` (PML4=0x3, PDPT=0x0, PD=0x0, PT=0x0). `PT_idx=0x000`. `TLB_set=0` (`00000` בינארי). `TLB_tag=0x300_0000_0`.\n*   `VPN_F = 0x400_0000_00` (PML4=0x4, PDPT=0x0, PD=0x0, PT=0x0). `PT_idx=0x000`. `TLB_set=0` (`00000` בינארי). `TLB_tag=0x400_0000_0`.\n\n**טבלת מעקב:**\n\n| גישה # | כתובת וירטואלית | VPN            | TLB Set | TLB Hit/Miss | Page Fault | גישות לזיכרון (תרגום) | מצב סט 0 (LRU -> MRU) |\n| :----- | :--------------- | :------------- | :------ | :----------- | :--------- | :--------------------- | :------------------------------------ |\n| 1      | `0x1000_0000_0000` | `VPN_A`        | 0       | Miss         | No         | 4                      | {(`VPN_A`)}                         |\n| 2      | `0x1000_0000_1000` | `VPN_B`        | 1       | Miss         | No         | 4                      | {(`VPN_A`)}                         |\n| 3      | `0x1000_0000_0000` | `VPN_A`        | 0       | Hit          | No         | 0                      | {(`VPN_A`)}                         |\n| 4      | `0x1000_0000_2000` | `VPN_C`        | 2       | Miss         | No         | 4                      | {(`VPN_A`)}                         |\n| 5      | `0x2000_0000_0000` | `VPN_D`        | 0       | Miss         | No         | 4                      | {(`VPN_A`), (`VPN_D`)}              |\n| 6      | `0x3000_0000_0000` | `VPN_E`        | 0       | Miss         | No         | 4                      | {(`VPN_A`), (`VPN_D`), (`VPN_E`)}   |\n| 7      | `0x4000_0000_0000` | `VPN_F`        | 0       | Miss         | Yes        | 4                      | {(`VPN_A`), (`VPN_D`), (`VPN_E`), (`VPN_F`)} |\n\n**הסבר למצב סט 0:**\n*   **גישה 1 (VPN_A):** TLB Miss. `VPN_A` נטען לסט 0. מצב: {(`VPN_A`)}. `VPN_A` הוא ה-MRU (Most Recently Used).\n*   **גישה 3 (VPN_A):** TLB Hit. `VPN_A` נשאר בסט 0 והופך שוב ל-MRU. מצב: {(`VPN_A`)}.\n*   **גישה 5 (VPN_D):** TLB Miss. `VPN_D` נטען לסט 0. מצב: {(`VPN_A`), (`VPN_D`)}. `VPN_A` הוא ה-LRU (Least Recently Used), `VPN_D` הוא ה-MRU.\n*   **גישה 6 (VPN_E):** TLB Miss. `VPN_E` נטען לסט 0. מצב: {(`VPN_A`), (`VPN_D`), (`VPN_E`)}. סדר LRU -> MRU: `VPN_A`, `VPN_D`, `VPN_E`.\n*   **גישה 7 (VPN_F):** TLB Miss. סט 0 אינו מלא (יש בו 3 כניסות מתוך 4). `VPN_F` נטען לכניסה הפנויה. מתרחש Page Fault עבור `VPN_F`, הדף נטען וה-PTE מתעדכן. מצב: {(`VPN_A`), (`VPN_D`), (`VPN_E`), (`VPN_F`)}. סדר LRU -> MRU: `VPN_A`, `VPN_D`, `VPN_E`, `VPN_F`.\n\n**1.3. מצב ה-TLB לאחר כל הגישות:**\n\n*   **סט 0 (LRU -> MRU):**\n    *   `VPN_A` (Tag `0x100_0000_0`, PFN `0x1000`)\n    *   `VPN_D` (Tag `0x200_0000_0`, PFN `0x4000`)\n    *   `VPN_E` (Tag `0x300_0000_0`, PFN `0x5000`)\n    *   `VPN_F` (Tag `0x400_0000_0`, PFN `0x6000`)\n\n*   **סט 1 (LRU -> MRU):**\n    *   `VPN_B` (Tag `0x100_0000_0`, PFN `0x2000`)\n\n*   **סט 2 (LRU -> MRU):**\n    *   `VPN_C` (Tag `0x100_0000_0`, PFN `0x3000`)\n\n*   **שאר הסטים ב-TLB (סטים 3-31) ריקים.**"
    },
    "difficulty_estimation": "Hard"
  }
}