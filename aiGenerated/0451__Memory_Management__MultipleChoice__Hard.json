{
  "metadata": {
    "source": "ai_generated",
    "topic_hint": "Memory Management",
    "requested_type": "MultipleChoice",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 21:35:57",
    "examples_used": 2,
    "token_usage": {
      "prompt_tokens": 969,
      "output_tokens": 1926,
      "total_tokens": 11225
    }
  },
  "question": {
    "id": 1,
    "type": "MultipleChoice",
    "topic": [
      "Memory Management",
      "Virtual Memory",
      "Paging",
      "TLB"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם כתובות וירטואליות בנות 64 ביטים וגודל דף של 4KB. טבלת הדפים היא בעלת 4 רמות. ה-TLB מכיל 128 כניסות ומשתמש במדיניות החלפה LRU. בהתחלה, ה-TLB ריק וכל הדפים אינם נמצאים בזיכרון הפיזי.\n\nכמה החטאות TLB (TLB misses), כמה פסיקות דף (page faults) וכמה גישות זיכרון כוללות (memory accesses) יתרחשו במהלך ביצוע הלולאה הבאה? יש לכלול בגישות הזיכרון גם גישות לטבלאות הדפים וגם גישות לנתונים עצמם. הנח כי עדכון PTE בזיכרון וטעינת ה-PTE ל-TLB נחשבים כגישת זיכרון אחת כל אחד, וכי טעינת דף מהדיסק אינה נחשבת גישת זיכרון.",
      "code_snippet": "long long *arr = (long long *)0x100000000000; // כתובת וירטואלית התחלתית\nfor (int i = 0; i < 200; ++i) {\n    arr[i * 1024]; // גישה לאיבר\n}",
      "options": [
        "א. 200 החטאות TLB, 200 פסיקות דף, 600 גישות זיכרון.",
        "ב. 200 החטאות TLB, 200 פסיקות דף, 1200 גישות זיכרון.",
        "ג. 128 החטאות TLB, 200 פסיקות דף, 1000 גישות זיכרון.",
        "ד. 200 החטאות TLB, 128 פסיקות דף, 800 גישות זיכרון.",
        "ה. אף אחת מהתשובות האחרות אינה נכונה."
      ]
    },
    "sub_questions": null,
    "points": 10,
    "solution": {
      "is_present_in_file": true,
      "correct_option": "ה",
      "explanation": "נתונים:\n*   גודל כתובת וירטואלית: 64 ביטים\n*   גודל דף: 4KB (2^12 בתים)\n*   מבנה טבלת הדפים: 4 רמות\n*   גודל TLB: 128 כניסות, מדיניות LRU\n*   מצב התחלתי: TLB ריק, כל הדפים אינם בזיכרון הפיזי.\n\nניתוח קטע הקוד:\nהלולאה מבצעת 200 איטרציות. בכל איטרציה, מתבצעת גישה לאיבר `arr[i * 1024]`. גודל `long long` הוא 8 בתים. לכן, הגישה היא לכתובת `base_address + (i * 1024 * 8)`. המרווח בין גישות עוקבות הוא `1024 * 8 = 8192` בתים.\nמאחר שגודל הדף הוא 4KB (4096 בתים) והמרווח בין גישות הוא 8192 בתים, כל גישה בלולאה תהיה לדף וירטואלי *שונה* וחדש. כלומר, 200 דפים וירטואליים נפרדים ייגשו במהלך הלולאה.\n\n1.  **החטאות TLB (TLB misses)**:\n    *   200 דפים וירטואליים נפרדים נגשים. גודל ה-TLB הוא 128 כניסות. מכיוון שקבוצת העבודה (200 דפים) גדולה מקיבולת ה-TLB (128 כניסות), וכל גישה היא לדף חדש שלא נגש קודם לכן בלולאה, כל 200 הגישות יגרמו להחטאת TLB. גם לאחר שה-TLB יתמלא (אחרי 128 גישות), כל גישה חדשה לדף תגרום להחלפה של דף אחר (לפי LRU) ולכן תהיה החטאה. מכיוון שהדפים נגשים באופן סדרתי ולא חוזרים על עצמם בתוך 200 הגישות, כל גישה תהיה החטאה.\n    *   **סה\"כ החטאות TLB: 200**.\n\n2.  **פסיקות דף (Page Faults)**:\n    *   נאמר שכל הדפים אינם בזיכרון הפיזי בתחילה. מכיוון שנגשים ל-200 דפים וירטואליים נפרדים, וכל גישה היא לדף חדש עבור הלולאה, כל אחת מ-200 הגישות תגרום לפסיקת דף (page fault) בפעם הראשונה שדף זה נגש.\n    *   **סה\"כ פסיקות דף: 200**.\n\n3.  **גישות זיכרון כוללות (Total Memory Accesses)**:\n    *   כל אחת מ-200 הגישות לזיכרון תגרום גם להחטאת TLB וגם לפסיקת דף.\n    *   כאשר מתרחשת פסיקת דף:\n        1.  ה-CPU מבצע מעבר על טבלת הדפים (page table walk) כדי לאתר את ה-PTE (Page Table Entry). עבור טבלת דפים בעלת 4 רמות, זה דורש **4 גישות קריאה לזיכרון** (ל-PML4, PDPT, PDIR, PT).\n        2.  ה-PTE מציין שהדף אינו נמצא. מערכת ההפעלה מטפלת בפסיקת הדף: טוענת את הדף מהדיסק (לא נחשב גישת זיכרון לפי הנתון), ומעדכנת את ה-PTE בזיכרון הראשי. זוהי **1 גישת כתיבה לזיכרון** (עדכון ה-PTE).\n        3.  מערכת ההפעלה טוענת את ה-PTE החדש ל-TLB. הנח כי פעולה זו נחשבת גם היא ל**1 גישת זיכרון** (לפי הנתון בשאלה).\n        4.  ההוראה המקורית מופעלת מחדש. כעת, בדיקת ה-TLB תמצא את ה-PTE (כיוון שהוא נטען). לאחר מכן, מתבצעת גישה לנתון עצמו. זוהי **1 גישת קריאה לזיכרון**.\n    *   לכן, עבור כל גישה שגורמת לפסיקת דף, מתרחשות `4 (קריאות לטבלאות דפים) + 1 (כתיבת PTE בזיכרון) + 1 (טעינת PTE ל-TLB) + 1 (קריאת נתון)` = **7 גישות זיכרון**.\n    *   סה\"כ גישות זיכרון כוללות = `200 גישות * 7 גישות זיכרון/גישה = 1400 גישות זיכרון`.\n\nהתוצאה היא: 200 החטאות TLB, 200 פסיקות דף, 1400 גישות זיכרון. אף אחת מהאפשרויות א-ד אינה תואמת תוצאה זו.\n\nהתשובה הנכונה היא ה'."
    },
    "difficulty_estimation": "Hard"
  }
}