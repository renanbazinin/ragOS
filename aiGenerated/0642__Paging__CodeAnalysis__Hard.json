{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging",
    "requested_type": "CodeAnalysis",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-07 23:19:30",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3971,
      "output_tokens": 2509,
      "total_tokens": 14493
    }
  },
  "question": {
    "id": 1,
    "type": "CodeAnalysis",
    "topic": [
      "Paging",
      "Virtual Memory",
      "Memory Management",
      "Page Faults",
      "TLB"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת בזיכרון וירטואלי עם מנגנון Paging דו-שלבי. גודל כתובת וירטואלית הוא 32 סיביות, וגודל דף הוא 4KB. טבלת הדפים מחולקת באופן הבא: 10 סיביות לאינדקס טבלת הדפים ברמה הראשונה (Page Directory Index - PDI), 10 סיביות לאינדקס טבלת הדפים ברמה השנייה (Page Table Index - PTI), ו-12 סיביות ל-Offset בתוך הדף.\n\nנתונים מצבי הרישומים הבאים:\n*   **PDBR (Page Directory Base Register)**: מכיל את הכתובת הפיזית ההתחלתית של טבלת הדפים ברמה הראשונה (Page Directory). נניח PDBR = `0x10000000`.\n*   **TLB (Translation Lookaside Buffer)**: ריק בתחילת הריצה.\n\nנתונות כניסות ספציפיות בטבלאות הדפים (נניח שגודל כניסה בטבלה הוא 4 בתים):\n*   **Page Directory Entry (PDE) בכתובת פיזית `0x10000040`**: (מתאים ל-PDI = 16)\n    *   `Valid = 1`\n    *   `Read/Write = 1`\n    *   `PFN (Physical Frame Number)` מצביע על הכתובת הפיזית ההתחלתית של טבלת הדפים ברמה השנייה: `0x20000000`.\n*   **Page Table Entry (PTE) בכתובת פיזית `0x20000080`**: (מתאים ל-PTI = 32)\n    *   `Valid = 1`\n    *   `Read/Write = 0` (קריאה בלבד)\n    *   `PFN` מצביע על הכתובת הפיזית ההתחלתית של דף הנתונים: `0x30000000`.\n\nנתונה התוכנית הבאה שמנסה לכתוב לכתובת וירטואלית מסוימת:\n",
      "code_snippet": "#include <stdio.h>\n#include <stdint.h>\n\nint main() {\n    uint32_t *ptr = (uint32_t *)0x00402020; // Attempt to write to virtual address 0x00402020\n    *ptr = 0xDEADBEEF;\n    printf(\"Write successful, value: 0x%X\\n\", *ptr);\n    return 0;\n}",
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "מהי הכתובת הפיזית אליה מנסה התוכנית לכתוב? פרטו את שלבי התרגום.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "האם תתרחש שגיאת דף (Page Fault) במהלך הגישה לכתובת זו? אם כן, מאיזה סוג (לדוגמה: Invalid Page, Permission Violation)? הסבירו מדוע.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "כמה גישות זיכרון (Memory Accesses) בסך הכל יבוצעו על ידי חומרת ה-MMU כדי לתרגם את הכתובת הווירטואלית ולבצע את פעולת הכתיבה (כולל גישה לנתונים עצמם), בהנחה שה-TLB היה ריק בהתחלה? פרטו את הגישות.",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון:\n\nנפרק את הכתובת הווירטואלית `0x00402020`:\n*   גודל דף: 4KB = 2^12 בתים. לכן ה-Offset הוא 12 סיביות.\n*   כתובת וירטואלית 32 סיביות: PDI (10 סיביות) | PTI (10 סיביות) | Offset (12 סיביות).\n\n`0x00402020` בבינארית: `0000 0000 0100 0000 0010 0000 0010 0000`\n*   **PDI (סיביות 31-22)**: `0000 0100 00` = `0x10` (16 עשרוני)\n*   **PTI (סיביות 21-12)**: `0000 1000 00` = `0x20` (32 עשרוני)\n*   **Offset (סיביות 11-0)**: `0000 0010 0000` = `0x020` (32 עשרוני)\n\n**א. הכתובת הפיזית ושלבי התרגום:**\n1.  **חישוב כתובת ה-PDE:** ה-PDBR מכיל את הבסיס של Page Directory: `0x10000000`. כיוון שה-PDI הוא `0x10` (16), וגודל כניסת PDE הוא 4 בתים, הכתובת הפיזית של ה-PDE היא:\n    `0x10000000 + (0x10 * 4) = 0x10000000 + 0x40 = 0x10000040`.\n2.  **קריאת ה-PDE:** ה-PDE בכתובת `0x10000040` מכיל: `Valid = 1`, `Read/Write = 1`, ו-PFN המצביע על `0x20000000` (הבסיס של טבלת הדפים ברמה השנייה).\n3.  **חישוב כתובת ה-PTE:** בסיס טבלת הדפים ברמה השנייה הוא `0x20000000`. כיוון שה-PTI הוא `0x20` (32), וגודל כניסת PTE הוא 4 בתים, הכתובת הפיזית של ה-PTE היא:\n    `0x20000000 + (0x20 * 4) = 0x20000000 + 0x80 = 0x20000080`.\n4.  **קריאת ה-PTE:** ה-PTE בכתובת `0x20000080` מכיל: `Valid = 1`, `Read/Write = 0` (קריאה בלבד), ו-PFN המצביע על `0x30000000` (הבסיס של דף הנתונים).\n5.  **חישוב הכתובת הפיזית הסופית:** בסיס דף הנתונים הוא `0x30000000`. ה-Offset הוא `0x020`. לכן, הכתובת הפיזית הסופית היא:\n    `0x30000000 + 0x020 = 0x30000020`.\n\n**ב. האם תתרחש שגיאת דף?**\nכן, תתרחש שגיאת דף (Page Fault) מסוג **Permission Violation**.\nהתוכנית מנסה לבצע פעולת כתיבה (`*ptr = 0xDEADBEEF;`) לכתובת הווירטואלית `0x00402020`. לאחר תרגום הכתובת, ה-PTE המתאים (בכתובת הפיזית `0x20000080`) מציין `Read/Write = 0`, כלומר, לדף הנתונים יש הרשאת קריאה בלבד. ניסיון כתיבה לדף עם הרשאת קריאה בלבד מפר את ההרשאות וגורם לשגיאת הגנה (Permission Violation).\n\n**ג. מספר גישות זיכרון:**\nבהנחה שה-TLB ריק בתחילת הריצה, יבוצעו 3 גישות זיכרון:\n1.  **גישה ל-PDE:** ה-MMU ניגש לזיכרון הפיזי בכתובת `0x10000040` כדי לקרוא את ה-PDE. (גישה 1)\n2.  **גישה ל-PTE:** ה-MMU ניגש לזיכרון הפיזי בכתובת `0x20000080` כדי לקרוא את ה-PTE. (גישה 2)\n3.  **גישה לנתונים:** ה-MMU מנסה לגשת לזיכרון הפיזי בכתובת `0x30000020` כדי לבצע את פעולת הכתיבה. גישה זו היא חלק מתהליך התרגום והגישה לזיכרון, גם אם היא נכשלת עקב שגיאת הרשאה. (גישה 3)\n\nלאחר שתי הגישות הראשונות, ה-TLB יתעדכן עם כניסות עבור ה-PDE וה-PTE, כך שגישות עתידיות לאותה כתובת וירטואלית (או כתובות באותו דף/בטווח ה-PDI/PTI המכוסה) יהיו מהירות יותר (TLB hit)."
    },
    "difficulty_estimation": "Hard"
  }
}