{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 06:50:19",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4788,
      "output_tokens": 3924,
      "total_tokens": 22801
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "Virtual Memory",
      "TLB",
      "Copy-on-Write"
    ],
    "content": {
      "text": "נתונה מערכת הפעלה המשתמשת במנגנון דפדוף (Paging) דו-רמתי (Two-level paging) לניהול זיכרון. פרטי המערכת הם כדלקמן:\n- גודל דף (Page Size): 4KB\n- גודל כניסת טבלת דפים (PTE Size): 4 בתים\n- גודל כתובת וירטואלית (Virtual Address): 32 ביטים\n- גודל כתובת פיזית (Physical Address): 28 ביטים\n- חיץ תרגום כתובות (TLB): בעל 4 כניסות (entries), אסוציאטיבי מלא (Fully Associative) עם מדיניות החלפה LRU (Least Recently Used). כל כניסת TLB מכילה PID, VPN, PFN, ודגלי גישה (קריאה/כתיבה, מלוכלך).\n\nתהליכים P1 ו-P2 רצים במערכת. בתחילה, דפים וירטואליים 0x100 ו-0x101 (עבור שניהם) ממופים למסגרות פיזיות PF_S1 ו-PF_S2 בהתאמה, ומוגדרים כקריאה-בלבד (Read-Only) עם מנגנון העתק-בכתיבה (Copy-on-Write) פעיל. כלומר, ניסיון כתיבה לדפים אלו יגרום לפסיקת דף שתייצר עותק פרטי וניתן לכתיבה עבור התהליך הכותב. בנוסף, P1 מחזיק בדף וירטואלי פרטי 0x200 (ניתן לכתיבה) ו-P2 מחזיק בדף וירטואלי פרטי 0x300 (ניתן לכתיבה).\n\nנתונה סדרת גישות הזיכרון הבאה (בסדר כרונולוגי):\n1. P1: קריאה לכתובת וירטואלית 0x100000\n2. P2: קריאה לכתובת וירטואלית 0x101000\n3. P1: כתיבה לכתובת וירטואלית 0x100010\n4. P2: קריאה לכתובת וירטואלית 0x300000\n5. P1: קריאה לכתובת וירטואלית 0x200000\n6. P1: כתיבה לכתובת וירטואלית 0x101020\n7. P2: כתיבה לכתובת וירטואלית 0x100030\n8. P1: קריאה לכתובת וירטואלית 0x100040\n\nבכל הגישות, יש להניח שה-TLB מתחיל ריק וכל טבלאות הדפים הדרושות נמצאות בזיכרון הפיזי. יש להניח ש-PF_S1 = 0x1000, PF_S2 = 0x1001, PF_P1_private = 0x2000, PF_P2_private = 0x3000. כאשר נוצר דף חדש כתוצאה מ-CoW, יש להקצות לו את מסגרת הזיכרון הפיזית הפנויה הבאה (התחילו מ-0x4000).\n",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "פרטו כיצד כתובת וירטואלית בת 32 ביטים מתפרקת לרכיביה (אינדקסים לטבלאות דפים והיסט) במערכת זו. ציינו את גודל כל רכיב בביטים.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "בהינתן סדרת הגישות, כמה החטאות TLB (TLB misses) וכמה פסיקות דף (page faults) התרחשו בסך הכל? הציגו את מעקב ה-TLB צעד אחר צעד בטבלה, כולל מצב ה-TLB לאחר כל גישה (PID, VPN, PFN, R/W, D), תוך ציון סדר ה-LRU.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.3",
        "text": "תארו את המצב הסופי של ה-TLB לאחר כל הגישות. עבור כל כניסה ציינו: PID, VPN, PFN, דגלי גישה (R/W, Dirty) וסדר LRU (מהפחות בשימוש לאחרונה למרבה בשימוש לאחרונה).",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.4",
        "text": "תארו את המצב הסופי של כניסות טבלת הדפים (PTEs) הרלוונטיות עבור תהליכים P1 ו-P2. עבור כל PTE ציינו: PID, VPN, PFN, ודגלים (Valid, Present, R/W, Dirty, CoW אם רלוונטי).",
        "code_snippet": null,
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "### פתרון מפורט\n\n**1.1 פירוק כתובת וירטואלית:**\n- גודל דף: 4KB = 2^12 בתים. לכן, ההיסט (Offset) הוא 12 ביטים (ביטים 0-11).\n- גודל כתובת וירטואלית: 32 ביטים.\n- מספר דף וירטואלי (VPN): 32 - 12 = 20 ביטים.\n- טבלת דפים דו-רמתית: כל טבלת דפים ממוקמת בדף אחד (4KB). כניסת טבלת דפים (PTE) היא 4 בתים.\n- מספר כניסות בטבלת דפים אחת: 4KB / 4 בתים = 1024 כניסות = 2^10 כניסות.\n- לכן, כל אינדקס לטבלת דפים (P1_index, P2_index) הוא 10 ביטים.\n- פירוק הכתובת הוירטואלית:\n  - **P1_index:** ביטים 31-22 (10 ביטים)\n  - **P2_index:** ביטים 21-12 (10 ביטים)\n  - **Offset:** ביטים 11-0 (12 ביטים)\n\n**1.2 מעקב אחר TLB ו-Page Faults:**\n- TLB: 4 כניסות, LRU. מתחיל ריק. (PID, VPN, PFN, R/W, D).\n- נמספר מסגרות פיזיות חדשות (PF_new): מתחיל מ-0x4000.\n- דגלים ראשוניים של PTE עבור דפים משותפים (0x100, 0x101) הם: Valid=1, Present=1, R/W=R, CoW=1, Dirty=0.\n- דגלים ראשוניים של PTE עבור דפים פרטיים (0x200, 0x300) הם: Valid=1, Present=1, R/W=RW, CoW=0, Dirty=0.\n\n| # | תהליך | גישה | VA | VPN | PFN (תוצאה) | TLB Hit/Miss | Page Fault | מצב TLB (PID, VPN, PFN, R/W, D) (LRU -> MRU) | Next Free PF | P1.PT[VPN] changes | P2.PT[VPN] changes |\n|---|---|---|---|---|---|---|---|---|---|---|---|\n| Initial | | | | | | | | [] | 0x4000 | | |\n| 1 | P1 | Read | 0x100000 | 0x100 | 0x1000 | Miss | No | [(P1, 0x100, 0x1000, R, 0)] | 0x4000 | | |\n| 2 | P2 | Read | 0x101000 | 0x101 | 0x1001 | Miss | No | [(P1, 0x100, 0x1000, R, 0), (P2, 0x101, 0x1001, R, 0)] | 0x4000 | | |\n| 3 | P1 | Write | 0x100010 | 0x100 | 0x4000 | Miss | Yes | [(P2, 0x101, 0x1001, R, 0), (P1, 0x100, 0x4000, RW, 1)] | 0x4001 | (0x1000,R,CoW)->(0x4000,RW,D=1) | (0x1000,R,CoW)->(0x1000,R,D=0) |\n| 4 | P2 | Read | 0x300000 | 0x300 | 0x3000 | Miss | No | [(P2, 0x101, 0x1001, R, 0), (P1, 0x100, 0x4000, RW, 1), (P2, 0x300, 0x3000, RW, 0)] | 0x4001 | | |\n| 5 | P1 | Read | 0x200000 | 0x200 | 0x2000 | Miss | No | [(P2, 0x101, 0x1001, R, 0), (P1, 0x100, 0x4000, RW, 1), (P2, 0x300, 0x3000, RW, 0), (P1, 0x200, 0x2000, RW, 0)] | 0x4001 | | |\n| 6 | P1 | Write | 0x101020 | 0x101 | 0x4001 | Miss | Yes | [(P1, 0x100, 0x4000, RW, 1), (P2, 0x300, 0x3000, RW, 0), (P1, 0x200, 0x2000, RW, 0), (P1, 0x101, 0x4001, RW, 1)] (Evicted: (P2, 0x101)) | 0x4002 | (0x1001,R,CoW)->(0x4001,RW,D=1) | (0x1001,R,CoW)->(0x1001,R,D=0) |\n| 7 | P2 | Write | 0x100030 | 0x100 | 0x4002 | Miss | Yes | [(P2, 0x300, 0x3000, RW, 0), (P1, 0x200, 0x2000, RW, 0), (P1, 0x101, 0x4001, RW, 1), (P2, 0x100, 0x4002, RW, 1)] (Evicted: (P1, 0x100)) | 0x4003 | | (0x1000,R,D=0)->(0x4002,RW,D=1) |\n| 8 | P1 | Read | 0x100040 | 0x100 | 0x4000 | Miss | No | [(P1, 0x200, 0x2000, RW, 0), (P1, 0x101, 0x4001, RW, 1), (P2, 0x100, 0x4002, RW, 1), (P1, 0x100, 0x4000, RW, 1)] (Evicted: (P2, 0x300)) | 0x4003 | | |\n\n**סיכום:**\n- **סה\"כ החטאות TLB:** 8\n- **סה\"כ פסיקות דף:** 3 (בגישות 3, 6, 7)\n\n**1.3 מצב סופי של ה-TLB:**\nה-TLB מכיל 4 כניסות. סדר ה-LRU (מהפחות בשימוש לאחרונה למרבה בשימוש לאחרונה) הוא:\n1.  (PID: P1, VPN: 0x200, PFN: 0x2000, R/W: RW, Dirty: 0)\n2.  (PID: P1, VPN: 0x101, PFN: 0x4001, R/W: RW, Dirty: 1)\n3.  (PID: P2, VPN: 0x100, PFN: 0x4002, R/W: RW, Dirty: 1)\n4.  (PID: P1, VPN: 0x100, PFN: 0x4000, R/W: RW, Dirty: 1)\n\n**1.4 מצב סופי של כניסות טבלת הדפים (PTEs) הרלוונטיות:**\n\n**עבור תהליך P1:**\n- **VPN 0x100:** PFN: 0x4000, Valid: 1, Present: 1, R/W: RW, Dirty: 1, CoW: 0 (הדף הועתק ונכתב)\n- **VPN 0x101:** PFN: 0x4001, Valid: 1, Present: 1, R/W: RW, Dirty: 1, CoW: 0 (הדף הועתק ונכתב)\n- **VPN 0x200:** PFN: 0x2000, Valid: 1, Present: 1, R/W: RW, Dirty: 0 (נקרא בלבד)\n\n**עבור תהליך P2:**\n- **VPN 0x100:** PFN: 0x4002, Valid: 1, Present: 1, R/W: RW, Dirty: 1, CoW: 0 (הדף הועתק ונכתב)\n- **VPN 0x101:** PFN: 0x1001, Valid: 1, Present: 1, R/W: R, Dirty: 0, CoW: 0 (P1 העתיק, P2 ממשיך להשתמש בדף המקורי כקריאה בלבד)\n- **VPN 0x300:** PFN: 0x3000, Valid: 1, Present: 1, R/W: RW, Dirty: 0 (נקרא בלבד)\n",
      "difficulty_estimation": "Hard"
    }
  }
}