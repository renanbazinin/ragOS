{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Paging and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 10:13:35",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 4769,
      "output_tokens": 5385,
      "total_tokens": 23323
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Paging",
      "TLB",
      "Virtual Memory",
      "Memory Management"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי עם המאפיינים הבאים:\n*   **גודל דף:** 4KB (2^12 בתים).\n*   **מרחב כתובות וירטואלי:** 32 ביט.\n*   **מרחב כתובות פיזי:** 28 ביט.\n*   **טבלת דפים היררכית:** בעלת שתי רמות. כל כניסה בטבלה (PTE/PDE) היא בגודל 4 בתים. כל טבלת דפים (ברמה 1 או 2) מאוחסנת בדיוק בדף זיכרון פיזי אחד.\n*   **TLB (Translation Lookaside Buffer):** מכיל 4 כניסות, בשיטת 2-way set associative, עם מדיניות החלפה LRU (Least Recently Used) בכל סט. כל כניסת TLB מכילה: VPN (Virtual Page Number), PPN (Physical Page Number), ביט Valid, ביט Dirty, ביט Accessed.\n*   **זמני גישה:**\n    *   **פגיעת TLB (TLB Hit):** 10ns.\n    *   **החטאת TLB (TLB Miss) ופגיעת טבלת דפים (Page Table Hit):** 210ns (מורכב מ-10ns לגישת TLB ועוד 2 גישות זיכרון לטבלת הדפים, כאשר כל גישה לזיכרון לוקחת 100ns).\n    *   **כשל דף (Page Fault):** 210ns (זמן גישה לטבלת הדפים) + 10ms (זמן גישה לדיסק).\n\n**מצב התחלתי:**\nה-TLB ריק לחלוטין.\nלהלן חלקים רלוונטיים מטבלת הדפים ההיררכית (כל השאר אינם קיימים או לא תקפים, כלומר Present=0):\n*   PTE עבור VPN `0x00000`: PPN `0x1000`, Present=1, Dirty=1, Accessed=1.\n*   PTE עבור VPN `0x00001`: PPN `0x1001`, Present=1, Dirty=0, Accessed=1.\n*   PTE עבור VPN `0x00002`: PPN `0x1002`, Present=1, Dirty=0, Accessed=0.\n*   PTE עבור VPN `0x00003`: PPN `0x1003`, Present=1, Dirty=1, Accessed=0.\n\n**נדרש:**\nבצעו מעקב מפורט אחר סדרת הגישות לזיכרון הוירטואלי הבאה. עבור כל גישה, פרטו:\n1.  האם זו פגיעת TLB או החטאה?\n2.  האם זו פגיעת טבלת דפים או כשל דף?\n3.  מהי הכתובת הפיזית המתקבלת (אם הגישה מצליחה)?\n4.  מהו הזמן הכולל שלקחה הגישה?\n5.  תארו את השינויים במצב ה-TLB ובדגלי ה-PTE הרלוונטיים בטבלת הדפים (A/D). אם יש החלפה ב-TLB, ציינו איזו כניסה הוחלפה.\n\n**סדרת הגישות:**\n1.  קריאה מכתובת וירטואלית `0x00000010`\n2.  כתיבה לכתובת וירטואלית `0x00001000`\n3.  קריאה מכתובת וירטואלית `0x00002020`\n4.  קריאה מכתובת וירטואלית `0x00000030`\n5.  כתיבה לכתובת וירטואלית `0x00003000`\n6.  קריאה מכתובת וירטואלית `0x00001040`\n7.  קריאה מכתובת וירטואלית `0x00004000`\n\n**לאחר סיום כל הגישות, ענו על השאלות הבאות:**\nא.  מהו סך הזמן הכולל שלקח לכל סדרת הגישות?\nב.  מהו המצב הסופי של ה-TLB? הציגו את כל הכניסות (VPN, PPN, Valid, Dirty, Accessed, סדר LRU).\nג.  כמה כשלים בדף (Page Faults) וכמה פגיעות/החטאות TLB התרחשו בסך הכל?",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "**פירוק כתובת וירטואלית ו-TLB:**\n*   **כתובת וירטואלית:** 32 ביט.\n*   **גודל דף:** 4KB = 2^12 בתים. לכן, ה-Offset הוא 12 ביט.\n*   **VPN (Virtual Page Number):** 32 - 12 = 20 ביט.\n*   **טבלת דפים היררכית 2 רמות:** כל טבלה (4KB) מכילה 4KB / 4 בתים/PTE = 1024 כניסות. לכן, כל אינדקס רמה הוא log2(1024) = 10 ביט.\n    *   **P1 Index (רמה 1):** VPN[19:10] (10 הביטים העליונים של ה-VPN).\n    *   **P2 Index (רמה 2):** VPN[9:0] (10 הביטים התחתונים של ה-VPN).\n*   **TLB (4 כניסות, 2-way set associative):**\n    *   **מספר סטים:** 4 כניסות / 2 דרכים = 2 סטים.\n    *   **TLB Index:** log2(2) = 1 ביט. נבחר את VPN[0] כאינדקס ה-TLB (הביט הפחות משמעותי של ה-VPN).\n    *   **TLB Tag:** VPN[19:1] (19 הביטים הנותרים של ה-VPN).\n\n**מעקב אחר גישות לזיכרון:**\n\n**מצב התחלתי של TLB:**\nסט 0: [ ], [ ]\nסט 1: [ ], [ ]\n\n**מצב התחלתי של PTEs רלוונטיים:**\n*   VPN `0x00000`: PPN `0x1000`, P=1, D=1, A=1\n*   VPN `0x00001`: PPN `0x1001`, P=1, D=0, A=1\n*   VPN `0x00002`: PPN `0x1002`, P=1, D=0, A=0\n*   VPN `0x00003`: PPN `0x1003`, P=1, D=1, A=0\n\n**1. קריאה מכתובת וירטואלית `0x00000010`**\n*   VA: `0x00000010` -> Offset: `0x010`, VPN: `0x00000`\n*   TLB Index: `0` (VPN[0]=0), TLB Tag: `0x00000` (VPN[19:1]=0)\n*   **TLB:** החטאה (ריק).\n*   **טבלת דפים:** P1 Index: `0x000`, P2 Index: `0x000`. PTE עבור VPN `0x00000` (PPN `0x1000`, P=1, D=1, A=1). פגיעת טבלת דפים. אין כשל דף.\n*   **כתובת פיזית:** `0x1000010` (PPN `0x1000` + Offset `0x010`).\n*   **זמן:** 210ns.\n*   **עדכונים:**\n    *   PTE עבור VPN `0x00000`: A=1, D=1 (ללא שינוי, כבר היו כך).\n    *   TLB: הוספת כניסה (VPN `0x00000`, PPN `0x1000`, V=1, D=1, A=1) לסט 0. זו הכניסה היחידה בסט, לכן היא ה-MRU.\n    *   מצב TLB סט 0: [(VPN `0x00000`, PPN `0x1000`, V=1, D=1, A=1, MRU)], [ ]\n\n**2. כתיבה לכתובת וירטואלית `0x00001000`**\n*   VA: `0x00001000` -> Offset: `0x000`, VPN: `0x00001`\n*   TLB Index: `1` (VPN[0]=1), TLB Tag: `0x00000` (VPN[19:1]=0)\n*   **TLB:** החטאה (ריק).\n*   **טבלת דפים:** P1 Index: `0x000`, P2 Index: `0x001`. PTE עבור VPN `0x00001` (PPN `0x1001`, P=1, D=0, A=1). פגיעת טבלת דפים. אין כשל דף.\n*   **כתובת פיזית:** `0x1001000` (PPN `0x1001` + Offset `0x000`).\n*   **זמן:** 210ns.\n*   **עדכונים:**\n    *   PTE עבור VPN `0x00001`: A=1 (ללא שינוי), D=1 (כתיבה).\n    *   TLB: הוספת כניסה (VPN `0x00001`, PPN `0x1001`, V=1, D=1, A=1) לסט 1. זו הכניסה היחידה בסט, לכן היא ה-MRU.\n    *   מצב TLB סט 1: [(VPN `0x00001`, PPN `0x1001`, V=1, D=1, A=1, MRU)], [ ]\n\n**3. קריאה מכתובת וירטואלית `0x00002020`**\n*   VA: `0x00002020` -> Offset: `0x020`, VPN: `0x00002`\n*   TLB Index: `0` (VPN[0]=0), TLB Tag: `0x00001` (VPN[19:1]=1)\n*   **TLB:** החטאה (סט 0 מכיל רק את `0x00000`).\n*   **טבלת דפים:** P1 Index: `0x000`, P2 Index: `0x002`. PTE עבור VPN `0x00002` (PPN `0x1002`, P=1, D=0, A=0). פגיעת טבלת דפים. אין כשל דף.\n*   **כתובת פיזית:** `0x1002020` (PPN `0x1002` + Offset `0x020`).\n*   **זמן:** 210ns.\n*   **עדכונים:**\n    *   PTE עבור VPN `0x00002`: A=1 (קריאה), D=0 (ללא שינוי).\n    *   TLB: הוספת כניסה (VPN `0x00002`, PPN `0x1002`, V=1, D=0, A=1) לסט 0. כעת סט 0 מלא.\n    *   מצב TLB סט 0: [(VPN `0x00000`, PPN `0x1000`, V=1, D=1, A=1, LRU)], [(VPN `0x00002`, PPN `0x1002`, V=1, D=0, A=1, MRU)]\n\n**4. קריאה מכתובת וירטואלית `0x00000030`**\n*   VA: `0x00000030` -> Offset: `0x030`, VPN: `0x00000`\n*   TLB Index: `0` (VPN[0]=0), TLB Tag: `0x00000` (VPN[19:1]=0)\n*   **TLB:** פגיעה (VPN `0x00000` נמצא בסט 0).\n*   **טבלת דפים:** לא נגשת.\n*   **כתובת פיזית:** `0x1000030` (PPN `0x1000` + Offset `0x030`).\n*   **זמן:** 10ns.\n*   **עדכונים:**\n    *   TLB: כניסת `0x00000` הופכת ל-MRU בסט 0. (A=1, D=1 ללא שינוי).\n    *   מצב TLB סט 0: [(VPN `0x00002`, PPN `0x1002`, V=1, D=0, A=1, LRU)], [(VPN `0x00000`, PPN `0x1000`, V=1, D=1, A=1, MRU)]\n\n**5. כתיבה לכתובת וירטואלית `0x00003000`**\n*   VA: `0x00003000` -> Offset: `0x000`, VPN: `0x00003`\n*   TLB Index: `1` (VPN[0]=1), TLB Tag: `0x00001` (VPN[19:1]=1)\n*   **TLB:** החטאה (סט 1 מכיל רק את `0x00001`).\n*   **טבלת דפים:** P1 Index: `0x000`, P2 Index: `0x003`. PTE עבור VPN `0x00003` (PPN `0x1003`, P=1, D=1, A=0). פגיעת טבלת דפים. אין כשל דף.\n*   **כתובת פיזית:** `0x1003000` (PPN `0x1003` + Offset `0x000`).\n*   **זמן:** 210ns.\n*   **עדכונים:**\n    *   PTE עבור VPN `0x00003`: A=1 (כתיבה), D=1 (ללא שינוי).\n    *   TLB: הוספת כניסה (VPN `0x00003`, PPN `0x1003`, V=1, D=1, A=1) לסט 1. כעת סט 1 מלא.\n    *   מצב TLB סט 1: [(VPN `0x00001`, PPN `0x1001`, V=1, D=1, A=1, LRU)], [(VPN `0x00003`, PPN `0x1003`, V=1, D=1, A=1, MRU)]\n\n**6. קריאה מכתובת וירטואלית `0x00001040`**\n*   VA: `0x00001040` -> Offset: `0x040`, VPN: `0x00001`\n*   TLB Index: `1` (VPN[0]=1), TLB Tag: `0x00000` (VPN[19:1]=0)\n*   **TLB:** פגיעה (VPN `0x00001` נמצא בסט 1).\n*   **טבלת דפים:** לא נגשת.\n*   **כתובת פיזית:** `0x1001040` (PPN `0x1001` + Offset `0x040`).\n*   **זמן:** 10ns.\n*   **עדכונים:**\n    *   TLB: כניסת `0x00001` הופכת ל-MRU בסט 1. (A=1, D=1 ללא שינוי).\n    *   מצב TLB סט 1: [(VPN `0x00003`, PPN `0x1003`, V=1, D=1, A=1, LRU)], [(VPN `0x00001`, PPN `0x1001`, V=1, D=1, A=1, MRU)]\n\n**7. קריאה מכתובת וירטואלית `0x00004000`**\n*   VA: `0x00004000` -> Offset: `0x000`, VPN: `0x00004`\n*   TLB Index: `0` (VPN[0]=0), TLB Tag: `0x00002` (VPN[19:1]=2)\n*   **TLB:** החטאה (סט 0 מכיל `0x00002` ו-`0x00000`, אף אחד מהם לא `0x00004`).\n*   **טבלת דפים:** P1 Index: `0x000`, P2 Index: `0x004`. PTE עבור VPN `0x00004` הוא Present=0. **כשל דף.**\n    *   **הנחה:** מערכת ההפעלה מטפלת בכשל הדף, מקצה מסגרת פיזית חדשה (לדוגמה PPN `0x1004`), טוענת את הדף מהדיסק ומעדכנת את ה-PTE. לאחר מכן, ה-PTE עבור VPN `0x00004` יהיה: PPN `0x1004`, P=1, D=0, A=1 (קריאה).\n*   **כתובת פיזית:** `0x1004000` (בהנחה ש-PPN `0x1004` הוקצה).\n*   **זמן:** 210ns + 10ms = 10,000,210ns.\n*   **עדכונים:**\n    *   PTE עבור VPN `0x00004`: P=1, A=1, D=0, PPN `0x1004` (בהנחה שהוקצה).\n    *   TLB: כניסת LRU בסט 0 (VPN `0x00002`) מוחלפת. הוספת (VPN `0x00004`, PPN `0x1004`, V=1, D=0, A=1) לסט 0.\n    *   מצב TLB סט 0: [(VPN `0x00000`, PPN `0x1000`, V=1, D=1, A=1, LRU)], [(VPN `0x00004`, PPN `0x1004`, V=1, D=0, A=1, MRU)]\n\n**סיכום לאחר סיום כל הגישות:**\n\n**א. סך הזמן הכולל שלקח לכל סדרת הגישות:**\n(5 * 210ns) + (2 * 10ns) + 10ms = 1050ns + 20ns + 10,000,000ns = 10,001,070ns = 10.00107 ms.\n\n**ב. המצב הסופי של ה-TLB:**\n*   **סט 0:**\n    *   LRU: VPN `0x00000`, PPN `0x1000`, V=1, D=1, A=1\n    *   MRU: VPN `0x00004`, PPN `0x1004`, V=1, D=0, A=1\n*   **סט 1:**\n    *   LRU: VPN `0x00003`, PPN `0x1003`, V=1, D=1, A=1\n    *   MRU: VPN `0x00001`, PPN `0x1001`, V=1, D=1, A=1\n\n**ג. כמה כשלים בדף וכמה פגיעות/החטאות TLB התרחשו בסך הכל:**\n*   **כשלים בדף (Page Faults):** 1 (בגישה 7).\n*   **פגיעות TLB (TLB Hits):** 2 (בגישות 4 ו-6).\n*   **החטאות TLB (TLB Misses):** 5 (בגישות 1, 2, 3, 5 ו-7)."
    },
    "difficulty_estimation": "Hard"
  }
}