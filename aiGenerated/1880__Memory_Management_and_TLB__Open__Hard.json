{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-09 21:08:54",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 4313,
      "total_tokens": 14710
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory",
      "Performance Calculation"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי בעלת ארכיטקטורת 64-ביט, המשתמשת במנגנון דפדוף (Paging) עם ארבע רמות של טבלאות דפים. מרחב הכתובות הוירטואלי היעיל (המשמש למיפוי) הוא 48 ביט, ומרחב הכתובות הפיזי הוא 40 ביט.\n\nפרמטרים עיקריים של המערכת:\n*   גודל דף: 4KB.\n*   גודל כניסה בטבלת דפים (PTE): 8 בתים.\n*   מטמון תרגום כתובות (TLB): בעל 64 כניסות, מאוחד אסוציאטיבי מלא (Fully Associative), ומשתמש במדיניות החלפה LRU.\n*   זמן גישה לזיכרון הראשי (RAM): 100ns.\n*   זמן גישה לדיסק (במקרה של Page Fault): 10ms.\n*   שיעור פגיעות ב-TLB (TLB Hit Rate): 98%.\n*   שיעור כשל דף (Page Fault Rate) לאחר גישה לטבלאות הדפים: 0.01%.\n\nהניחו שזמן הגישה ל-TLB זניח, וכי כל גישה לזיכרון הראשי (קריאה או כתיבה) אורכת 100ns.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": [
      {
        "id": "1.1",
        "text": "חשבו את זמן הגישה האפקטיבי הממוצע לזיכרון (Effective Access Time - EAT) עבור מערכת זו. פרטו את החישובים וההנחות.",
        "code_snippet": null,
        "options": null
      },
      {
        "id": "1.2",
        "text": "בהתבסס על הנתונים הנ\"ל, ובהנחה שקיים TLB קטן יותר לצורך המחשה (4 כניסות, LRU), תארו בפירוט את רצף הפעולות שיתרחשו עבור כל אחת מגישות הזיכרון הוירטואלי הבאות. ציינו האם מדובר ב-TLB Hit/Miss, Page Table Walk, Page Fault, ואיזה עדכונים יבוצעו ב-TLB ובטבלאות הדפים (אם רלוונטי). הניחו שה-TLB ריק בתחילה, וכי כל הדפים הנדרשים קיימים בזיכרון הפיזי (כלומר, לא יתרחשו Page Faults בפועל במהלך הריצה, אך יש לפרט את תהליך הגישה המלא לטבלאות הדפים). הציגו את מצב ה-TLB (VPN, PFN, סדר LRU) לאחר כל גישה.",
        "code_snippet": "כתובות וירטואליות:\n1. 0x0000_0001_0000_1234\n2. 0x0000_0001_0000_5678\n3. 0x0000_0002_0000_ABCD\n4. 0x0000_0003_0000_0000\n5. 0x0000_0004_0000_1111\n6. 0x0000_0001_0000_FFFF",
        "options": null
      }
    ],
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "פתרון שאלה 1:\n\n**ניתוח פרמטרי המערכת:**\n*   **גודל דף:** 4KB = 2^12 בתים. לכן, ההיסט (Offset) הוא 12 ביטים.\n*   **מרחב כתובות וירטואלי:** 48 ביט. לכן, מספר הדף הוירטואלי (VPN) הוא 48 - 12 = 36 ביטים.\n*   **גודל כניסה בטבלת דפים (PTE):** 8 בתים.\n*   **מספר כניסות לטבלת דפים ברמה אחת:** גודל דף / גודל PTE = 4KB / 8 בתים = 4096 / 8 = 512 כניסות.\n*   **ביטים לכל רמה בטבלת הדפים:** log2(512) = 9 ביטים.\n*   **מספר רמות טבלת הדפים:** VPN / ביטים לרמה = 36 / 9 = 4 רמות.\n*   **זמן גישה לזיכרון (MA):** 100ns.\n*   **זמן גישה לדיסק (DA):** 10ms = 10,000,000ns.\n*   **שיעור פגיעה ב-TLB (HR_TLB):** 0.98.\n*   **שיעור כשל דף (PFR):** 0.0001 (0.01%).\n\n**1.1 חישוב זמן הגישה האפקטיבי הממוצע לזיכרון (EAT):**\nנוסחת ה-EAT במערכת עם TLB ודפדוף רב-רמתי (בהנחה שזמן גישה ל-TLB זניח):\nEAT = (HR_TLB * MA) + (1 - HR_TLB) * [ (1 - PFR) * (N * MA + MA) + PFR * (N * MA + DA + MA) ]\nכאשר:\n*   MA = זמן גישה לזיכרון הראשי (עבור נתונים או PTE).\n*   DA = זמן גישה לדיסק (עבור page fault).\n*   N = מספר רמות טבלת הדפים (4 במקרה זה).\n*   HR_TLB = שיעור פגיעות ב-TLB.\n*   PFR = שיעור כשל דף.\n\nנציב את הערכים:\nEAT = (0.98 * 100ns) + (1 - 0.98) * [ (1 - 0.0001) * (4 * 100ns + 100ns) + 0.0001 * (4 * 100ns + 10,000,000ns + 100ns) ]\nEAT = 98ns + 0.02 * [ (0.9999 * (400ns + 100ns)) + 0.0001 * (400ns + 10,000,000ns + 100ns) ]\nEAT = 98ns + 0.02 * [ (0.9999 * 500ns) + 0.0001 * (10,000,500ns) ]\nEAT = 98ns + 0.02 * [ 499.95ns + 1000.05ns ]\nEAT = 98ns + 0.02 * [ 1500ns ]\nEAT = 98ns + 30ns\nEAT = 128ns\n\n**זמן הגישה האפקטיבי הממוצע לזיכרון הוא 128ns.**\n\n\n**1.2 מעקב אחר גישות זיכרון וירטואלי (TLB קטן: 4 כניסות, LRU):**\n\n**פירוק כתובת וירטואלית (48 ביט):**\n*   ביטים 11-0: Offset (12 ביטים)\n*   ביטים 20-12: P1_idx (רמה 1) (9 ביטים)\n*   ביטים 29-21: P2_idx (רמה 2) (9 ביטים)\n*   ביטים 38-30: P3_idx (רמה 3) (9 ביטים)\n*   ביטים 47-39: P4_idx (רמה 4) (9 ביטים)\n\nנניח PFNים לדוגמה:\n*   VPN `0x0001_0000_0` (P1_idx=1) -> PFN `0xABCDE`\n*   VPN `0x0002_0000_0` (P1_idx=2) -> PFN `0x12345`\n*   VPN `0x0003_0000_0` (P1_idx=3) -> PFN `0x54321`\n*   VPN `0x0004_0000_0` (P1_idx=4) -> PFN `0xFEDCB`\n\n**מצב TLB התחלתי:** ריק. (LRU: ייצג את סדר השימוש, 0=הכי חדש בשימוש)\n\n**1. גישה לכתובת: 0x0000_0001_0000_1234**\n*   **VPN:** `0x0000_0001_0000_0` (ה-12 ביטים האחרונים הם Offset). נקצר ל-`0x100000`.\n*   **TLB:** Miss – ה-TLB ריק.\n*   **Page Table Walk:** נדרשות 4 גישות לזיכרון כדי לעבור על טבלאות הדפים (P4, P3, P2, P1) ולמצוא את ה-PTE המתאים ל-VPN `0x100000`. נניח שה-PTE תקין ומצביע ל-PFN `0xABCDE`.\n*   **Page Fault:** לא מתרחש (לפי נתוני השאלה).\n*   **עדכון TLB:** ה-VPN `0x100000` וה-PFN `0xABCDE` נטענים ל-TLB.\n*   **כתובת פיזית:** `0xABCDE_1234`.\n*   **מצב TLB לאחר גישה:** `[(VPN:0x100000, PFN:0xABCDE, LRU:0)]`\n\n**2. גישה לכתובת: 0x0000_0001_0000_5678**\n*   **VPN:** `0x0000_0001_0000_0` (`0x100000`).\n*   **TLB:** Hit – ה-VPN `0x100000` נמצא ב-TLB.\n*   **Page Table Walk:** לא נדרש.\n*   **Page Fault:** לא מתרחש.\n*   **עדכון TLB:** סדר ה-LRU של הכניסה `(0x100000, 0xABCDE)` מתעדכן להיות הכי חדש.\n*   **כתובת פיזית:** `0xABCDE_5678`.\n*   **מצב TLB לאחר גישה:** `[(VPN:0x100000, PFN:0xABCDE, LRU:0)]`\n\n**3. גישה לכתובת: 0x0000_0002_0000_ABCD**\n*   **VPN:** `0x0000_0002_0000_0` (`0x200000`).\n*   **TLB:** Miss – ה-VPN `0x200000` אינו ב-TLB.\n*   **Page Table Walk:** נדרשות 4 גישות לזיכרון. נניח שה-PTE המתאים מצביע ל-PFN `0x12345`.\n*   **Page Fault:** לא מתרחש.\n*   **עדכון TLB:** ה-VPN `0x200000` וה-PFN `0x12345` נטענים ל-TLB. הכניסה הקודמת (0x100000) הופכת ל-LRU הבא.\n*   **כתובת פיזית:** `0x12345_ABCD`.\n*   **מצב TLB לאחר גישה:** `[(VPN:0x200000, PFN:0x12345, LRU:0), (VPN:0x100000, PFN:0xABCDE, LRU:1)]`\n\n**4. גישה לכתובת: 0x0000_0003_0000_0000**\n*   **VPN:** `0x0000_0003_0000_0` (`0x300000`).\n*   **TLB:** Miss – ה-VPN `0x300000` אינו ב-TLB.\n*   **Page Table Walk:** נדרשות 4 גישות לזיכרון. נניח שה-PTE המתאים מצביע ל-PFN `0x54321`.\n*   **Page Fault:** לא מתרחש.\n*   **עדכון TLB:** ה-VPN `0x300000` וה-PFN `0x54321` נטענים ל-TLB.\n*   **כתובת פיזית:** `0x54321_0000`.\n*   **מצב TLB לאחר גישה:** `[(VPN:0x300000, PFN:0x54321, LRU:0), (VPN:0x200000, PFN:0x12345, LRU:1), (VPN:0x100000, PFN:0xABCDE, LRU:2)]`\n\n**5. גישה לכתובת: 0x0000_0004_0000_1111**\n*   **VPN:** `0x0000_0004_0000_0` (`0x400000`).\n*   **TLB:** Miss – ה-VPN `0x400000` אינו ב-TLB. ה-TLB מלא (4 כניסות).\n*   **החלפת LRU:** הכניסה הכי פחות בשימוש לאחרונה (LRU:2) היא `(0x100000, 0xABCDE)`. היא תוחלף.\n*   **Page Table Walk:** נדרשות 4 גישות לזיכרון. נניח שה-PTE המתאים מצביע ל-PFN `0xFEDCB`.\n*   **Page Fault:** לא מתרחש.\n*   **עדכון TLB:** ה-VPN `0x400000` וה-PFN `0xFEDCB` נטענים במקום הכניסה שהוצאה.\n*   **כתובת פיזית:** `0xFEDCB_1111`.\n*   **מצב TLB לאחר גישה:** `[(VPN:0x400000, PFN:0xFEDCB, LRU:0), (VPN:0x300000, PFN:0x54321, LRU:1), (VPN:0x200000, PFN:0x12345, LRU:2)]`\n\n**6. גישה לכתובת: 0x0000_0001_0000_FFFF**\n*   **VPN:** `0x0000_0001_0000_0` (`0x100000`).\n*   **TLB:** Miss – ה-VPN `0x100000` הוצא בגישה הקודמת (5).\n*   **החלפת LRU:** הכניסה הכי פחות בשימוש לאחרונה (LRU:2) היא `(0x200000, 0x12345)`. היא תוחלף.\n*   **Page Table Walk:** נדרשות 4 גישות לזיכרון. נניח שה-PTE המתאים מצביע ל-PFN `0xABCDE`.\n*   **Page Fault:** לא מתרחש.\n*   **עדכון TLB:** ה-VPN `0x100000` וה-PFN `0xABCDE` נטענים במקום הכניסה שהוצאה.\n*   **כתובת פיזית:** `0xABCDE_FFFF`.\n*   **מצב TLB לאחר גישה:** `[(VPN:0x100000, PFN:0xABCDE, LRU:0), (VPN:0x400000, PFN:0xFEDCB, LRU:1), (VPN:0x300000, PFN:0x54321, LRU:2)]`"
    },
    "difficulty_estimation": "Hard"
  }
}