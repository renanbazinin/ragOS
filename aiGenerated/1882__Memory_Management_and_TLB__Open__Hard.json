{
  "metadata": {
    "source": "ai_generated",
    "subject": "Virtualization",
    "topic_hint": "Memory Management and TLB",
    "requested_type": "Open",
    "requested_difficulty": "Hard",
    "generated_at": "2026-02-08 21:27:09",
    "examples_used": 3,
    "token_usage": {
      "prompt_tokens": 3221,
      "output_tokens": 5105,
      "total_tokens": 17442
    }
  },
  "question": {
    "id": 1,
    "type": "Open",
    "topic": [
      "Memory Management",
      "TLB",
      "Paging",
      "Virtual Memory"
    ],
    "content": {
      "text": "נתונה מערכת זיכרון וירטואלי עם המאפיינים הבאים:\n*   מרחב כתובות וירטואלי: 32 ביטים.\n*   גודל דף: 4KB (2^12 בתים).\n*   גודל כניסה בטבלת דפים (PTE): 4 בתים.\n*   טבלת דפים דו-רמתית (Two-level page table). כתובת וירטואלית מחולקת ל-10 ביטים עבור ה-Page Directory Index (PDI), 10 ביטים עבור ה-Page Table Index (PTI), ו-12 ביטים עבור ה-Offset.\n*   TLB (Translation Lookaside Buffer) עם 8 כניסות, אסוציאטיביות 2-כיוונית (2-way set associative) ומדיניות החלפה LRU בתוך כל סט. ה-TLB מאותחל ריק. אינדקס ה-TLB נקבע על ידי 2 הביטים האחרונים (הפחות משמעותיים) של ה-VPN.\n*   זמני גישה:\n    *   זמן גישה ל-TLB: 10ns.\n    *   זמן גישה לזיכרון הראשי (לכל גישה): 100ns.\n    *   זמן טיפול ב-Page Fault (כולל קריאה מהדיסק ועדכון טבלאות, במקרה של דף לא נוכח בזיכרון): 10ms.\n\nהתהליך P ניגש ברצף לכתובות הוירטואליות הבאות (בבסיס 16, כל הגישות הן קריאה):\n1.  0x00001010\n2.  0x00002020\n3.  0x00005030\n4.  0x00003040\n5.  0x00009050\n6.  0x00001060\n\nלצורך פשטות, נניח את המצב ההתחלתי של טבלאות הדפים:\n*   כל ה-PTE בטבלת הדפים ברמה 1 (Page Directory) זמינים בזיכרון הראשי.\n*   PTE עבור PDI = 0x00, 0x01, 0x02, 0x03 ב-Page Directory מצביעים על טבלאות דפים ברמה 2 (Page Tables) שנמצאות בזיכרון הראשי.\n*   עבור PDI = 0x00:\n    *   PTI = 0x01 מצביע על PFN 0x100 (Present=1, Dirty=0, Accessed=0)\n    *   PTI = 0x02 מצביע על PFN 0x200 (Present=1, Dirty=0, Accessed=0)\n    *   PTI = 0x03 מצביע על PFN 0x300 (Present=1, Dirty=0, Accessed=0)\n    *   PTI = 0x05 מצביע על PFN 0x500 (Present=1, Dirty=0, Accessed=0)\n    *   PTI = 0x09 מצביע על PFN 0x900 (Present=1, Dirty=0, Accessed=0)\n*   כל שאר ה-PTEs בטבלאות ברמה 2 (הנמצאות בזיכרון הראשי) מסומנים כ-Present=0.\n*   לאחר כל גישה לזיכרון, ביט ה-Accessed (A) מעודכן ל-1.\n\nנדרש:\n1.  פרט שלב אחר שלב את תהליך תרגום הכתובות עבור כל אחת מהגישות, כולל חישוב הכתובות הוירטואליות (VPN, Offset) והפיזיות (PFN, Offset).\n2.  ציין עבור כל גישה האם התרחשה TLB hit/miss, והאם התרחש Page Fault.\n3.  חשב את זמן הגישה הכולל עבור כל גישה בנפרד, ואת זמן הגישה הממוצע עבור כל רצף הגישות.\n4.  תאר את מצב ה-TLB הסופי (כולל תגיות, PFNs ורמת LRU עבור כל כניסה) לאחר כל הגישות.\n5.  הסבר כיצד שינוי בגודל הדף ל-8KB ישפיע על מבנה טבלת הדפים ועל ביצועי ה-TLB במערכת זו.",
      "code_snippet": null,
      "options": null
    },
    "sub_questions": null,
    "points": null,
    "solution": {
      "is_present_in_file": true,
      "correct_option": null,
      "explanation": "**פירוט חלוקת הכתובת הוירטואלית:**\n*   כתובת וירטואלית (32 ביטים):\n    *   PDI (Page Directory Index): ביטים [31:22] (10 ביטים)\n    *   PTI (Page Table Index): ביטים [21:12] (10 ביטים)\n    *   Offset: ביטים [11:0] (12 ביטים)\n*   VPN (Virtual Page Number) = PDI + PTI (20 ביטים).\n\n**מבנה ה-TLB:**\n*   8 כניסות, אסוציאטיביות 2-כיוונית -> 4 סטים, 2 Ways לכל סט.\n*   אינדקס ה-TLB (2 ביטים): VPN[1:0] (2 הביטים הפחות משמעותיים של ה-VPN).\n*   תג ה-TLB (18 ביטים): VPN[19:2].\n*   מדיניות החלפה: LRU בתוך כל סט (0 = הכי עדכני, 1 = פחות עדכני).\n*   מצב התחלתי: TLB ריק.\n\n**טבלת הגישות:**\nכל גישה לזיכרון ראשי (MM) עולה 100ns. גישה ל-TLB עולה 10ns.\n\n1.  **גישה ל-0x00001010:**\n    *   **כתובת וירטואלית:** PDI=0x00, PTI=0x01, Offset=0x010. VPN=0x00001 (בינארי: ...0000000001).\n    *   **TLB:** Miss (TLB ריק).\n        *   אינדקס TLB = VPN[1:0] = 01 (סט 1). תג TLB = VPN[19:2] = 0x00000.\n    *   **תרגום כתובת (Page Walk):**\n        *   גישה לטבלת דפים רמה 1 (Page Directory) עבור PDI=0x00 (MM Access 1).\n        *   גישה לטבלת דפים רמה 2 (Page Table) עבור PTI=0x01 (MM Access 2).\n        *   PTE מצביע ל-PFN 0x100 (Present=1).\n    *   **כתובת פיזית:** 0x100010.\n    *   **עדכון TLB:** הוספת (Tag=0x00000, PFN=0x100) לסט 1, Way 0 (LRU=0).\n    *   **זמן גישה:** 10ns (TLB miss) + 2 * 100ns (Page Walk) + 100ns (גישת נתונים) = **310ns**.\n\n2.  **גישה ל-0x00002020:**\n    *   **כתובת וירטואלית:** PDI=0x00, PTI=0x02, Offset=0x020. VPN=0x00002 (בינארי: ...0000000010).\n    *   **TLB:** Miss.\n        *   אינדקס TLB = VPN[1:0] = 10 (סט 2). תג TLB = VPN[19:2] = 0x00000.\n    *   **תרגום כתובת:**\n        *   גישה ל-PD עבור PDI=0x00 (MM Access 1).\n        *   גישה ל-PT עבור PTI=0x02 (MM Access 2).\n        *   PTE מצביע ל-PFN 0x200 (Present=1).\n    *   **כתובת פיזית:** 0x200020.\n    *   **עדכון TLB:** הוספת (Tag=0x00000, PFN=0x200) לסט 2, Way 0 (LRU=0).\n    *   **זמן גישה:** 10ns + 2 * 100ns + 100ns = **310ns**.\n\n3.  **גישה ל-0x00005030:**\n    *   **כתובת וירטואלית:** PDI=0x00, PTI=0x05, Offset=0x030. VPN=0x00005 (בינארי: ...0000000101).\n    *   **TLB:** Miss (סט 1 מכיל רק תג 0x00000). (אינדקס TLB = 01).\n        *   אינדקס TLB = VPN[1:0] = 01 (סט 1). תג TLB = VPN[19:2] = 0x00001.\n    *   **תרגום כתובת:**\n        *   גישה ל-PD עבור PDI=0x00 (MM Access 1).\n        *   גישה ל-PT עבור PTI=0x05 (MM Access 2).\n        *   PTE מצביע ל-PFN 0x500 (Present=1).\n    *   **כתובת פיזית:** 0x500030.\n    *   **עדכון TLB:** סט 1 מכיל כעת (Tag=0x00000, PFN=0x100, LRU=1) ו-(Tag=0x00001, PFN=0x500, LRU=0).\n    *   **זמן גישה:** 10ns + 2 * 100ns + 100ns = **310ns**.\n\n4.  **גישה ל-0x00003040:**\n    *   **כתובת וירטואלית:** PDI=0x00, PTI=0x03, Offset=0x040. VPN=0x00003 (בינארי: ...0000000011).\n    *   **TLB:** Miss.\n        *   אינדקס TLB = VPN[1:0] = 11 (סט 3). תג TLB = VPN[19:2] = 0x00000.\n    *   **תרגום כתובת:**\n        *   גישה ל-PD עבור PDI=0x00 (MM Access 1).\n        *   גישה ל-PT עבור PTI=0x03 (MM Access 2).\n        *   PTE מצביע ל-PFN 0x300 (Present=1).\n    *   **כתובת פיזית:** 0x300040.\n    *   **עדכון TLB:** הוספת (Tag=0x00000, PFN=0x300) לסט 3, Way 0 (LRU=0).\n    *   **זמן גישה:** 10ns + 2 * 100ns + 100ns = **310ns**.\n\n5.  **גישה ל-0x00009050:**\n    *   **כתובת וירטואלית:** PDI=0x00, PTI=0x09, Offset=0x050. VPN=0x00009 (בינארי: ...0000001001).\n    *   **TLB:** Miss (סט 1 מלא, תג 0x00002 לא נמצא). (אינדקס TLB = 01).\n        *   אינדקס TLB = VPN[1:0] = 01 (סט 1). תג TLB = VPN[19:2] = 0x00002.\n    *   **תרגום כתובת:**\n        *   גישה ל-PD עבור PDI=0x00 (MM Access 1).\n        *   גישה ל-PT עבור PTI=0x09 (MM Access 2).\n        *   PTE מצביע ל-PFN 0x900 (Present=1).\n    *   **כתובת פיזית:** 0x900050.\n    *   **עדכון TLB:** סט 1 מלא. לפי LRU, הכניסה (Tag=0x00000, PFN=0x100) היא הפחות עדכנית (LRU=1 לפני הגישה הקודמת לסט 1). היא מוחלפת.\n        *   סט 1 מכיל כעת (Tag=0x00001, PFN=0x500, LRU=1) ו-(Tag=0x00002, PFN=0x900, LRU=0).\n    *   **זמן גישה:** 10ns + 2 * 100ns + 100ns = **310ns**.\n\n6.  **גישה ל-0x00001060:**\n    *   **כתובת וירטואלית:** PDI=0x00, PTI=0x01, Offset=0x060. VPN=0x00001 (בינארי: ...0000000001).\n    *   **TLB:** Miss (התג 0x00000 הוחלף בגישה הקודמת). (אינדקס TLB = 01).\n        *   אינדקס TLB = VPN[1:0] = 01 (סט 1). תג TLB = VPN[19:2] = 0x00000.\n    *   **תרגום כתובת:**\n        *   גישה ל-PD עבור PDI=0x00 (MM Access 1).\n        *   גישה ל-PT עבור PTI=0x01 (MM Access 2).\n        *   PTE מצביע ל-PFN 0x100 (Present=1).\n    *   **כתובת פיזית:** 0x100060.\n    *   **עדכון TLB:** סט 1 מלא. הכניסה (Tag=0x00001, PFN=0x500) היא הפחות עדכנית (LRU=1). היא מוחלפת.\n        *   סט 1 מכיל כעת (Tag=0x00002, PFN=0x900, LRU=1) ו-(Tag=0x00000, PFN=0x100, LRU=0).\n    *   **זמן גישה:** 10ns + 2 * 100ns + 100ns = **310ns**.\n\n**סיכום זמני גישה:**\n*   סה\"כ זמן גישה: 6 * 310ns = 1860ns.\n*   זמן גישה ממוצע: 1860ns / 6 = **310ns**.\n\n**מצב ה-TLB הסופי לאחר כל הגישות:**\n*   **סט 0 (אינדקס 00):** ריק (לא נעשה בו שימוש ברצף הגישות הנתון).\n*   **סט 1 (אינדקס 01):**\n    *   Way 0: (Tag=0x00002, PFN=0x900, LRU=1)\n    *   Way 1: (Tag=0x00000, PFN=0x100, LRU=0)\n*   **סט 2 (אינדקס 10):**\n    *   Way 0: (Tag=0x00000, PFN=0x200, LRU=0)\n    *   Way 1: ריק\n*   **סט 3 (אינדקס 11):**\n    *   Way 0: (Tag=0x00000, PFN=0x300, LRU=0)\n    *   Way 1: ריק\n\n**השפעת שינוי גודל הדף ל-8KB:**\n1.  **מבנה טבלת הדפים:**\n    *   גודל דף של 8KB אומר שההיסט (Offset) יהיה 13 ביטים (log2(8KB) = 13). ה-VPN יקטן מ-20 ביטים ל-19 ביטים (32-13).\n    *   כניסה בטבלת דפים (PTE) נשארת 4 בתים. גודל דף הוא 8KB, ולכן כל דף יכול להכיל 8KB / 4 בתים = 2048 PTEs. משמעות הדבר היא שכל אינדקס בטבלת הדפים (PDI או PTI) יכול להיות בגודל של עד 11 ביטים (2^11 = 2048).\n    *   אם נשמור על טבלה דו-רמתית, נצטרך לחלק את 19 ביטי ה-VPN בין PDI ו-PTI. לדוגמה, PDI של 10 ביטים ו-PTI של 9 ביטים.\n    *   ה-Page Directory עדיין יכיל 2^10 = 1024 כניסות. כל טבלת דפים ברמה השנייה תכיל 2^9 = 512 כניסות.\n    *   מאחר שכל טבלת דפים ברמה השנייה מכילה 512 כניסות של 4 בתים כל אחת, גודלה יהיה 2KB. אם גודל הדף הוא 8KB, אז כל טבלת דפים ברמה השנייה תתפוס רק רבע מדף פיזי, מה שיוביל לבזבוז זיכרון (פירגמנטציה פנימית) אם ההקצאה היא ביחידות של דף שלם.\n    *   לחלופין, אם גודל הדף היה מאפשר, ייתכן שניתן היה להקטין את מספר הרמות בטבלת הדפים (למשל, ל-1 רמה אם ה-VPN היה קטן מספיק). אך עם 19 ביטי VPN ו-11 ביטים לכל אינדקס, עדיין נדרשות שתי רמות (11+11>19, אך 11<19). לכן, 10 ביטים ל-PDI ו-9 ביטים ל-PTI היא חלוקה סבירה.\n\n2.  **ביצועי ה-TLB:**\n    *   גודל דף גדול יותר אומר שכל כניסה ב-TLB ממפה כעת שטח זיכרון פיזי גדול יותר (8KB במקום 4KB).\n    *   זה מגדיל בדרך כלל את שיעור הפגיעות ב-TLB (TLB Hit Rate), מכיוון שגישות לכתובות סמוכות נוטות יותר ליפול באותו דף גדול יותר (locality of reference). ככל ש-TLB Hit Rate גבוה יותר, כך פחות גישות לזיכרון הראשי נדרשות לתרגום כתובות, וזמן הגישה האפקטיבי הממוצע לזיכרון יורד.\n    *   מבחינת מבנה ה-TLB, מספר ביטי ה-VPN יורד מ-20 ל-19. אינדקס ה-TLB (2 ביטים) נשאר זהה, ולכן תג ה-TLB יקטן מ-18 ביטים ל-17 ביטים.\n    *   לסיכום, סביר להניח ששינוי זה ישפר את ביצועי ה-TLB על ידי הגדלת שיעור הפגיעות, למרות פוטנציאל לבזבוז זיכרון בטבלאות הדפים אם הן לא מנוצלות במלואן בתוך הדפים הפיזיים הגדולים יותר."
    },
    "difficulty_estimation": "Hard"
  }
}